
cc7:
  tags:
    - cvmfs
  image: alisw/alidock:cc7
  stage: build
  variables:
    GIT_CLONE_PATH: '$CI_BUILDS_DIR/FairShip/'
  before_script:
    - source /cvmfs/ship.cern.ch/2_July2019/setUp.sh
    - cd ..
    - git clone https://github.com/siscia/shipdist
    - pushd shipdist && git checkout simple_build && popd
  script:
    - aliBuild -c shipdist/ --default fairship build FairShip --always-prefer-system --debug

cc7:
  tags:
    - cvmfs
  image: alisw/alidock:cc7
  stage: build
  variables:
    GIT_CLONE_PATH: '$CI_BUILDS_DIR/FairShip'
  before_script:
    - source /cvmfs/ship.cern.ch/2_July2019/setUp.sh
    - cd ..
    - git clone https://github.com/siscia/shipdist
    - pushd shipdist && git checkout simple_build && popd
    - aliBuild -c shipdist/ --default fairship build FairShip --always-prefer-system --debug
    - eval `alienv load FairShip/latest`
  script:
    - script -c 'python $FAIRSHIP/macro/run_simScript.py --test' | tee simulation; grep 'Macro finished succesfully.' simulation
    - script -c 'python $FAIRSHIP/macro/ShipReco.py -f ship.conical.Pythia8-TGeant4.root -g geofile_full.conical.Pythia8-TGeant4.root' | tee recostruction; grep 'finished writing tree' recostruction
    - script -c 'python $FAIRSHIP/macro/ShipAna.py -f ship.conical.Pythia8-TGeant4_rec.root -g geofile_full.conical.Pythia8-TGeant4.root' | tee analysis; grep 'finished making plots' analysis

