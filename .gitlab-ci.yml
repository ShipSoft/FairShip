unit-tests:
    stage: test
    cache:
        key: one-key-to-rull-them-all
        paths:
            - cache/
    image: kongyitian/new-fairship:200228-tue-fairship
    before_script:
        - pip install -r conditionsDatabase/requirements.txt
        - git pull https://d.user:getcode1@ooti-projects.win.tue.nl/gitlab/cern-st-2019/implementation.git        
        - chmod +x conditionsDatabase/start_mongodb_locally.sh
        - ./conditionsDatabase/start_mongodb_locally.sh 
    script:
        # start command from here
        # directory is /builds/gitlab/cern-st-2019/implementation/
        - export FAIRHOME="/builds/gitlab/cern-st-2019/implementation/"
        # generate the test database
        - python -m conditionsDatabase.tests.test_mongodb.generate_test_db
        # run test cases
        - pytest 
    tags:
        - jarvis
