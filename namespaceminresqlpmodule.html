<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FairShip: minresqlpmodule Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FairShip
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespaceminresqlpmodule.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">minresqlpmodule Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>MINRESQLP solves symmetric systems Ax = b or min ||Ax - b||_2, where the matrix A may be indefinite and/or singular. "A" is really (A - shift*I), where shift is an input real scalar.  
<a href="namespaceminresqlpmodule.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ab0e9f6586048493a1e8e01f5f471b2c0"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlp</a> (n, Aprod, b, shift, Msolve, disable, nout, itnlim, rtol, maxxnorm, trancond, Acondlim, x, istop, itn, rnorm, Arnorm, xnorm, Anorm, Acond)</td></tr>
<tr class="memdesc:ab0e9f6586048493a1e8e01f5f471b2c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solution of linear equation system or least squares problem.  <a href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">More...</a><br /></td></tr>
<tr class="separator:ab0e9f6586048493a1e8e01f5f471b2c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af827a771499cbe406df432ef1d5d758b"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceminresqlpmodule.html#af827a771499cbe406df432ef1d5d758b">symortho</a> (a, b, c, s, r)</td></tr>
<tr class="memdesc:af827a771499cbe406df432ef1d5d758b"><td class="mdescLeft">&#160;</td><td class="mdescRight">SymOrtho: Stable Householder reflection.  <a href="namespaceminresqlpmodule.html#af827a771499cbe406df432ef1d5d758b">More...</a><br /></td></tr>
<tr class="separator:af827a771499cbe406df432ef1d5d758b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>MINRESQLP solves symmetric systems Ax = b or min ||Ax - b||_2, where the matrix A may be indefinite and/or singular. "A" is really (A - shift*I), where shift is an input real scalar. </p>
<pre class="fragment"> 09 Sep 2013: Version 27
-------------------------------------------------------------------

 The software for MINRES-QLP is provided by SOL, Stanford University
 under the terms of the OSI Common Public License (CPL)
    http://www.opensource.org/licenses/cpl1.0.php
 or the BSD License
    http://www.opensource.org/licenses/bsd-license.php

-------------------------------------------------------------------

 Authors:
     Sou-Cheng Choi &lt;sctchoi@uchicago.edu&gt;
     Computation Institute (CI)
     University of Chicago
     Chicago, IL 60637, USA

     Michael Saunders &lt;saunders@stanford.edu&gt;
     Systems Optimization Laboratory (SOL)
     Stanford University
     Stanford, CA 94305-4026, USA

 Contributor:
     Christopher Paige &lt;paige@cs.mcgill.ca&gt;

   See also: Makefile</pre> </div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ab0e9f6586048493a1e8e01f5f471b2c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0e9f6586048493a1e8e01f5f471b2c0">&#9670;&nbsp;</a></span>minresqlp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public minresqlpmodule::minresqlp </td>
          <td>(</td>
          <td class="paramtype">integer(ip), intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Aprod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(n), intent(in)&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(in), optional&#160;</td>
          <td class="paramname"><em>shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">optional&#160;</td>
          <td class="paramname"><em>Msolve</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>disable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(ip), intent(in), optional&#160;</td>
          <td class="paramname"><em>nout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(ip), intent(in), optional&#160;</td>
          <td class="paramname"><em>itnlim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(in), optional&#160;</td>
          <td class="paramname"><em>rtol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(in), optional&#160;</td>
          <td class="paramname"><em>maxxnorm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(in), optional&#160;</td>
          <td class="paramname"><em>trancond</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(in), optional&#160;</td>
          <td class="paramname"><em>Acondlim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(n), intent(out)&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(ip), intent(out), optional&#160;</td>
          <td class="paramname"><em>istop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(ip), intent(out), optional&#160;</td>
          <td class="paramname"><em>itn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(out), optional&#160;</td>
          <td class="paramname"><em>rnorm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(out), optional&#160;</td>
          <td class="paramname"><em>Arnorm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(out), optional&#160;</td>
          <td class="paramname"><em>xnorm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(out), optional&#160;</td>
          <td class="paramname"><em>Anorm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(out), optional&#160;</td>
          <td class="paramname"><em>Acond</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Solution of linear equation system or least squares problem. </p>
<pre class="fragment">------------------------------------------------------------------

 MINRESQLP  is designed to solve the system of linear equations

                Ax = b

     or the least-squares problem

         min || Ax - b ||_2,

     where A is an n by n symmetric matrix and b is a given vector.
     The matrix A may be indefinite and/or singular.

     1. If A is known to be positive definite, the Conjugate Gradient
        Method might be preferred, since it requires roughly the same
        number of iterations as MINRESQLP but less work per iteration.
        But if a low-accuracy solution is adequate, MINRESQLP will
        terminate sooner.

     2. If A is indefinite but Ax = b is known to have a solution
        (e.g. if A is nonsingular), SYMMLQ might be preferred,
        since it requires roughly the same number of iterations as
        MINRESQLP but slightly less work per iteration.

     3. If A is indefinite and well-conditioned, and Ax = b has a
        solution, i.e., it is not a least-squares problem, MINRES might
        be preferred as it requires the same number of iterations as
        MINRESQLP but slightly less work per iteration.

     The matrix A is intended to be large and sparse.  It is accessed
     by means of a subroutine call of the form

                call Aprod ( n, x, y )

     which must return the product y = Ax for any given vector x.


     More generally, MINRESQLP is designed to solve the system

                (A - shift*I) x = b
     or
         min || (A - shift*I) x - b ||_2,

     where shift is a specified real scalar.  Again, the matrix
     (A - shift*I) may be indefinite and/or singular.
     The work per iteration is very slightly less if shift = 0.

     Note: If  shift  is an approximate eigenvalue of  A
     and  b  is an approximate eigenvector,  x  might prove to be
     a better approximate eigenvector, as in the methods of
     inverse iteration and/or Rayleigh-quotient iteration.
     However, we are not yet sure on that -- it may be better
     to use SYMMLQ.

     In this documentation, ' denotes the transpose of
     a vector or a matrix.

     A further option is that of preconditioning, which may reduce
     the number of iterations required.  If M = C C' is a positive
     definite matrix that is known to approximate  (A - shift*I)
     in some sense, and if systems of the form  My = x  can be
     solved efficiently, the parameter Msolve may be used (see below).
     When an external procedure Msolve is supplied, MINRESQLP will
     implicitly solve the system of equations

             P (A - shift*I) P' xbar  =  P b,

     i.e.                  Abar xbar  =  bbar
     where                         P  =  C**(-1),
                                Abar  =  P (A - shift*I) P',
                                bbar  =  P b,

     and return the solution       x  =  P' xbar.
     The associated residual is rbar  =  bbar - Abar xbar
                                      =  P (b - (A - shift*I)x)
                                      =  P r.

     In the discussion below, eps refers to the machine precision.
     eps is computed by MINRESQLP.  A typical value is eps = 2.22d-16
     for IEEE double-precision arithmetic.

     Parameters
     ----------
     Some inputs are optional, with default values described below.
     Mandatory inputs are n, Aprod, and b.
     All outputs other than x are optional.

     n       input      The dimension of the matrix or operator A.

     b(n)    input      The rhs vector b.

     x(n)    output     Returns the computed solution  x.

     Aprod   external   A subroutine defining the matrix A.
                        For a given vector x, the statement

                              call Aprod ( n, x, y )

                        must return the product y = Ax
                        without altering the vector x.
                        An extra call of Aprod is
                        used to check if A is symmetric.

     Msolve  external   An optional subroutine defining a
                        preconditioning matrix M, which should
                        approximate (A - shift*I) in some sense.
                        M must be positive definite.
                        For a given vector x, the statement

                              call Msolve( n, x, y )

                        must solve the linear system My = x
                        without altering the vector x.

                        In general, M should be chosen so that Abar has
                        clustered eigenvalues.  For example,
                        if A is positive definite, Abar would ideally
                        be close to a multiple of I.
                        If A or A - shift*I is indefinite, Abar might
                        be close to a multiple of diag( I  -I ).

     shift   input      Should be zero if the system Ax = b is to be
                        solved.  Otherwise, it could be an
                        approximation to an eigenvalue of A, such as
                        the Rayleigh quotient b'Ab / (b'b)
                        corresponding to the vector b.
                        If b is sufficiently like an eigenvector
                        corresponding to an eigenvalue near shift,
                        then the computed x may have very large
                        components.  When normalized, x may be
                        closer to an eigenvector than b. Default to 0.

     nout    input      A file number. The calling program must open a file
                        for output using for example:
                          open(nout, file='MINRESQLP.txt', status='unknown')
                        If nout &gt; 0, a summary of the iterations
                        will be printed on unit nout. If nout is absent or
                        the file associated with nout is not opened properly,
                        results will be written to 'MINRESQLP_tmp.txt'.
                        (Avoid 0, 5, 6 because by convention stderr=0,
                        stdin=5, stdout=6.)

     itnlim  input      An upper limit on the number of iterations. Default to 4n.

     rtol    input      A user-specified tolerance.  MINRESQLP terminates
                        if it appears that norm(rbar) is smaller than
                              rtol*[norm(Abar)*norm(xbar) + norm(b)],
                        where rbar = bbar - Abar xbar,
                        or that norm(Abar*rbar) is smaller than
                              rtol*norm(Abar)*norm(rbar).

                        If shift = 0 and Msolve is absent, MINRESQLP
                        terminates if norm(r) is smaller than
                              rtol*[norm(A)*norm(x) + norm(b)],
                        where r = b - Ax,
                        or if norm(A*r) is smaller than
                              rtol*norm(A)*norm(r).

                        Default to machine precision.

     istop   output     An integer giving the reason for termination...
               0        Initial value of istop.

               1        beta_{k+1} &lt; eps.
                        Iteration k is the final Lanczos step.

               2        beta2 = 0 in the Lanczos iteration; i.e. the
                        second Lanczos vector is zero.  This means the
                        rhs is very special.

                        If there is no preconditioner, b is an
                        eigenvector of Abar. Also, x = (1/alpha1) b
                        is a solution of Abar x = b.

                        Otherwise (if Msolve is present), let My = b.
                        If shift is zero, y is a solution of the
                        generalized eigenvalue problem Ay = lambda My,
                        with lambda = alpha1 from the Lanczos vectors.

                        In general, (A - shift*I)x = b
                        has the solution x = (1/alpha1) y
                        where My = b.

               3        b = 0, so the exact solution is x = 0.
                        No iterations were performed.

               4        Norm(rbar) appears to be less than
                        the value  rtol * [ norm(Abar) * norm(xbar) + norm(b) ].
                        The solution in  x  should be an acceptable
                        solution of Abar x = b.

               5        Norm(rbar) appears to be less than
                        the value  eps * norm(Abar) * norm(xbar).
                        This means that the solution is as accurate as
                        seems reasonable on this machine.

               6        Norm(Abar rbar) appears to be less than
                        the value  rtol * norm(Abar) * norm(rbar).
                        The solution in x should be an acceptable
                        least-squares solution.

               7        Norm(Abar rbar) appears to be less than
                        the value  eps * norm(Abar) * norm(rbar).
                        This means that the least-squares solution is as
                        accurate as seems reasonable on this machine.

               8        The iteration limit was reached before convergence.

               9        The matrix defined by Aprod does not appear
                        to be symmetric.
                        For certain vectors y = Av and r = Ay, the
                        products y'y and r'v differ significantly.

               10       The matrix defined by Msolve does not appear
                        to be symmetric.
                        For vectors satisfying My = v and Mr = y, the
                        products y'y and r'v differ significantly.

               11       An inner product of the form  x' M**(-1) x
                        was not positive, so the preconditioning matrix
                        M does not appear to be positive definite.

               12       xnorm has exceeded maxxnorm or will exceed it
                        next iteration.

               13       Acond (see below) has exceeded Acondlim or 0.1/eps,
                        so the matrix Abar must be very ill-conditioned.

               14       | gamma_k | &lt; eps.
                        This is very likely a least-squares problem but
                        x may not contain an acceptable solution yet.

               15       norm(Abar x) &lt; rtol * norm(Abar) * norm(x).
                        If disable = .true., then a null vector will be
                        obtained, given rtol.

                        If istop &gt;= 7, the final x may not be an
                        acceptable solution.

     itn     output     The number of iterations performed.

     Anorm   output     An estimate of the norm of the matrix operator
                        Abar = P (A - shift*I) P',   where P = C**(-1).

     Acond   output     An estimate of the condition of Abar above.
                        This will usually be a substantial
                        under-estimate of the true condition.

     rnorm   output     An estimate of the norm of the final
                        transformed residual vector,
                           P (b  -  (A - shift*I) x).

     xnorm   output     An estimate of the norm of xbar.
                        This is sqrt( x'Mx ).  If Msolve is absent,
                        xnorm is an estimate of norm(x).

   maxxnorm  input      An upper bound on norm(x). Default value is 1e7.

   trancond  input      If trancond &gt; 1, a switch is made from MINRES
                        iterations to MINRES-QLP iterations when
                        Acond &gt; trancond.
                        If trancond = 1, all iterations are MINRES-QLP
                        iterations.
                        If trancond = Acondlim, all iterations are
                        conventional MINRES iterations (which are
                        slightly cheaper).
                        Default to 1e7.

   Acondlim  input      An upper bound on Acond. Default value is 1e15.

   disable   input      All stopping conditions are disabled except
                        norm(Ax) / norm(x) &lt; tol. Default to .false..

------------------------------------------------------------------

     MINRESQLP is an implementation of the algorithm described in
     the following references:

     Sou-Cheng Choi,
     Iterative Methods for Singular Linear Equations and Least-
     Squares Problems, PhD dissertation, ICME, Stanford University,
     2006.

     Sou-Cheng Choi, Christopher Paige, and Michael Saunders,
     MINRES-QLP: A Krylov subspace method for indefinite or
     singular symmetric systems, SIAM Journal of Scientific
     Computing 33:4 (2011) 1810-1836.

     Sou-Cheng Choi and Michael Saunders,
     ALGORITHM &amp; DOCUMENTATION: MINRES-QLP for singular Symmetric and Hermitian
     linear equations and least-squares problems, Technical Report,
     ANL/MCS-P3027-0812, Computation Institute,
     University of Chicago/Argonne National Laboratory, 2012.

     Sou-Cheng Choi and Michael Saunders,
     ALGORITHM xxx: MINRES-QLP for singular Symmetric and Hermitian
     linear equations and least-squares problems,
     ACM Transactions on Mathematical Software, to appear, 2013.

     FORTRAN 90 and MATLAB implementations are
     downloadable from
            http://www.stanford.edu/group/SOL/software.html
            http://home.uchicago.edu/sctchoi/

------------------------------------------------------------------

     MINRESQLP development:
     14 Dec 2006: Sou-Cheng's thesis completed.
                  MINRESQLP includes a stopping rule for singular
                  systems (using an estimate of ||Ar||) and very many
                  other things(!).
                  Note that ||Ar|| small =&gt; r is a null vector for A.
     09 Oct 2007: F90 version constructed from the F77 version.
                  Initially used compiler option -r8, but this is
                  nonstandard.
     15 Oct 2007: Test on Arnorm = ||Ar|| added to recognize
                  singular systems.
     15 Oct 2007: Temporarily used real(8) everywhere.
     16 Oct 2007: Use minresqlpDataModule to define
                  dp = selected_real_kind(15).
                  We need "use minresqlpDataModule" at the
                  beginning of modules AND inside interfaces.
     06 Jun 2010: Added comments.
     12 Jul 2011: Created complex version zminresqlpModule.f90
                  from real version minresqlpModule.f90.
     23 Aug 2011: (1) Tim Hopkins ran version 17 on the NAG Fortran compiler
                  We removed half a dozen unused variables in MINRESQLP
                  and also local var sgn_a and sgn_b in SMMORTHO,
                  as they result in division by zero for inputs a=b=0.
                  (2) Version 18 was submitted to ACM TOMS for review.
     20 Aug 2012: Version 19:
                  (1) Added optional inputs and outputs, and
                  default values for optional inputs.
                  (2) Removed inputs 'checkA' and 'precon'.
                  (3) Changed slightly the order of parameters in the
                  MINRESQLP API.
                  (4) Updated documentation.
                  (5) Fixed a minor bug in printing x(1) in iteration
                      log during MINRES mode.
                  (6) Made sure MINRESQLP is portable in both single
                      and double precison.
                  (7) Fixed a bug to ensure the 2x2 Hermitian reflectors
                      are orthonormal. Make output c real.
     24 Apr 2013: istop = 12 now means xnorm just exceeded maxxnorm.
     28 Jun 2013: likeLS introduced to terminate with big xnorm
                  only if the problem seems to be singular and inconsistent.
     08 Jul 2013: (1) dot_product replaces ddotc.
     04 Aug 2013: If present(maxxnorm), use maxxnorm_ = min(maxxnorm, one/eps).
     09 Sep 2013: Initialize relresl and relAresl to zero.
------------------------------------------------------------------</pre> 
<p class="definition">Definition at line <a class="el" href="minresqlpModule_8f90_source.html#l00411">411</a> of file <a class="el" href="minresqlpModule_8f90_source.html">minresqlpModule.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">! Inputs</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordtype">integer(ip)</span>, <span class="keywordtype">intent(in)</span>             :: n</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keywordtype">    real</span>(dp),    <span class="keywordtype">intent(in)</span>             :: b(n)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordtype">integer(ip)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span>   :: itnlim, nout</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordtype">logical</span>,     <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span>   :: disable</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="keywordtype">    real</span>(dp),    <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span>   :: shift</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keywordtype">    real</span>(dp),    <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span>   :: rtol, maxxnorm, trancond, Acondlim</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">! Outputs</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="keywordtype">    real</span>(dp),    <span class="keywordtype">intent(out)</span>            :: x(n)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordtype">integer(ip)</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">optional</span>  :: istop, itn</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="keywordtype">    real</span>(dp),    <span class="keywordtype">intent(out)</span>, <span class="keywordtype">optional</span>  :: rnorm, Arnorm, xnorm, Anorm, Acond</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordtype">optional</span> :: msolve</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keyword">interface</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;       <span class="keyword">subroutine </span>aprod(n,x,y)                    <span class="comment">! y := A*x</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;         <span class="keywordtype">use </span><a class="code" href="namespaceminresqlpdatamodule.html">minresqlpdatamodule</a></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;         <span class="keywordtype">integer(ip)</span>, <span class="keywordtype">intent(in)</span>    :: n</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordtype">         real</span>(dp),    <span class="keywordtype">intent(in)</span>    :: x(n)</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="keywordtype">         real</span>(dp),    <span class="keywordtype">intent(out)</span>   :: y(n)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;       <span class="keyword">end subroutine </span>aprod</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;       <span class="keyword">subroutine </span>msolve(n,x,y)                   <span class="comment">! Solve M*y = x</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;         <span class="keywordtype">use </span><a class="code" href="namespaceminresqlpdatamodule.html">minresqlpdatamodule</a></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;         <span class="keywordtype">integer(ip)</span>, <span class="keywordtype">intent(in)</span>    :: n</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="keywordtype">         real</span>(dp),    <span class="keywordtype">intent(in)</span>    :: x(n)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="keywordtype">         real</span>(dp),    <span class="keywordtype">intent(out)</span>   :: y(n)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;       <span class="keyword">end subroutine </span>msolve</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keyword">end interface</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordtype">intrinsic</span> :: abs, sqrt, <span class="keyword">present</span>, floor, log10, dot_product</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">! Local arrays and variables</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordtype">    real</span>(dp)     :: shift_</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keywordtype">    real</span>(dp)     :: rtol_, maxxnorm_, trancond_, Acondlim_</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="keywordtype">    real</span>(dp)     :: rnorm_, Arnorm_, xnorm_, Anorm_, Acond_</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordtype">logical</span>      :: checkA_, precon_, disable_</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordtype">integer(ip)</span>  :: itnlim_, nout_, istop_, itn_</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="keywordtype">    real</span>(dp)     :: r1(n), r2(n), v(n), w(n), wl(n), wl2(n),&amp;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                    xl2(n), y(n), vec2(2), vec3(3)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="keywordtype">    real</span>(dp)     :: abs_gama, Acondl, alfa, Anorml, Arnorml,&amp;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                    Axnorm, beta, beta1, betal, betan,      &amp;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                    epsa, epsx, gminl2, ieps, pnorm,        &amp;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                    relAres, relAresl, relres, relresl,     &amp;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    rnorml, rootl, t1, t2, xl2norm,         &amp;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                    xnorm_tmp, xnorml, z,                   &amp;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    cr1, cr2, cs, dbar, dlta, dlta_QLP,     &amp;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                    dlta_tmp, dltan, epln, eplnn, eta, etal,&amp;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                    etal2, gama, gama_QLP, gama_tmp, gamal, &amp;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                    gamal_QLP, gamal_tmp, gamal2, gamal3,   &amp;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                    gbar, gmin, gminl, phi, s, sn, sr1, sr2,&amp;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                    t, tau, taul, taul2, u, u_QLP,          &amp;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                    ul, ul_QLP, ul2, ul2_QLP, ul3, ul4,     &amp;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                    vepln, vepln_QLP, veplnl, veplnl2, x1last</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordtype">integer(ip)</span>  :: j, QLPiter, headlines, lines, nprint, flag0, ios</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordtype">logical</span>      :: prnt, done, lastiter, connected, named_file, likeLS</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordtype">character(len=20)</span> :: filename</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordtype">character(len=2)</span>  :: QLPstr = <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">! Local constants</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">parameter</span> :: EPSINV  = 10.0_dp**floor(log10(one/eps))</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="keywordtype">    real</span>(dp)            :: NORMMAX = 10.0_dp**floor(log10(one/eps)/2)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: enter = <span class="stringliteral">&#39; Enter MINRES-QLP.  &#39;</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: exitt = <span class="stringliteral">&#39; Exit  MINRES-QLP.  &#39;</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: msg(1:15) =                                &amp;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      (/ <span class="stringliteral">&#39;beta_{k+1} &lt; eps.                                                &#39;</span>, &amp; <span class="comment">! 1</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;         <span class="stringliteral">&#39;beta2 = 0.  If M = I, b and x are eigenvectors of A.             &#39;</span>, &amp; <span class="comment">! 2</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;         <span class="stringliteral">&#39;beta1 = 0.  The exact solution is  x = 0.                        &#39;</span>, &amp; <span class="comment">! 3</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;         <span class="stringliteral">&#39;A solution to (poss. singular) Ax = b found, given rtol.         &#39;</span>, &amp; <span class="comment">! 4</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;         <span class="stringliteral">&#39;A solution to (poss. singular) Ax = b found, given eps.          &#39;</span>, &amp; <span class="comment">! 5</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;         <span class="stringliteral">&#39;Pseudoinverse solution for singular LS problem, given rtol.      &#39;</span>, &amp; <span class="comment">! 6</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;         <span class="stringliteral">&#39;Pseudoinverse solution for singular LS problem, given eps.       &#39;</span>, &amp; <span class="comment">! 7</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;         <span class="stringliteral">&#39;The iteration limit was reached.                                 &#39;</span>, &amp; <span class="comment">! 8</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;         <span class="stringliteral">&#39;The operator defined by Aprod appears to be unsymmetric.         &#39;</span>, &amp; <span class="comment">! 9</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;         <span class="stringliteral">&#39;The operator defined by Msolve appears to be unsymmetric.        &#39;</span>, &amp; <span class="comment">! 10</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;         <span class="stringliteral">&#39;The operator defined by Msolve appears to be indefinite.         &#39;</span>, &amp; <span class="comment">! 11</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;         <span class="stringliteral">&#39;xnorm has exceeded maxxnorm or will exceed it next iteration.    &#39;</span>, &amp; <span class="comment">! 12</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;         <span class="stringliteral">&#39;Acond has exceeded Acondlim or 0.1/eps.                          &#39;</span>, &amp; <span class="comment">! 13</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;         <span class="stringliteral">&#39;Least-squares problem but no converged solution yet.             &#39;</span>, &amp; <span class="comment">! 14</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;         <span class="stringliteral">&#39;A null vector obtained, given rtol.                              &#39;</span> /) <span class="comment">! 15</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: ddebugStr1 = <span class="stringliteral">&quot;(a, T5, i0, a, 5(e12.3))&quot;</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: ddebugStr2 = <span class="stringliteral">&quot;(5(a, i0, a, e12.3, a))&quot;</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: headerStr =                    &amp;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="stringliteral">&quot;(// 1p,    a, 4x, &#39;Solution of symmetric   Ax = b&#39;&quot;</span>    // &amp;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="stringliteral">&quot;  / &#39; n        =&#39;, i7, 6x,  &#39;||b||    =&#39;, e11.2, 3x,&quot;</span>  // &amp;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="stringliteral">&quot;     &#39;precon   =&#39;, l4                           &quot;</span>      // &amp;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="stringliteral">&quot;  / &#39; itnlim   =&#39;, i7, 6x, &#39;rtol     =&#39;, e11.2, 3x,&quot;</span>   // &amp;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="stringliteral">&quot;     &#39;shift    =&#39;, e23.14                       &quot;</span>      // &amp;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="stringliteral">&quot;  / &#39; maxxnorm =&#39;, e11.2, 2x, &#39;Acondlim =&#39;, e11.2, 3x,&quot;</span>// &amp;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="stringliteral">&quot;     &#39;trancond =&#39;, e11.2)&quot;</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: tableHeaderStr =                         &amp;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="stringliteral">&quot;(// &#39;    iter   x(1)              xnorm     rnorm     Arnorm   &#39;,&quot;</span> // &amp;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="stringliteral">&quot; &#39;Compatible   LS      norm(A)   cond(A)&#39;)&quot;</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: itnStr = <span class="stringliteral">&quot;(1p, i8, e19.10, 7e10.2, a)&quot;</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: finalStr1 =                    &amp;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="stringliteral">&quot;(/ 1p, a, 5x, a, i3,   14x, a, i8 &quot;</span>                    // &amp;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="stringliteral">&quot; /     a, 5x, a, e12.4, 5x, a, e12.4 &quot;</span>                 // &amp;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="stringliteral">&quot; /     a, 5x, a, e12.4, 5x, a, e12.4 &quot;</span>                 // &amp;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="stringliteral">&quot; /     a, 5x, a, e12.4 )&quot;</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: finalStr2 = <span class="stringliteral">&quot;(      a, 5x, a )&quot;</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    prnt = .false.</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    t1 = zero</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    t2 = zero</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    gminl = zero</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">! Optional inputs</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(shift)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;       shift_ = shift</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;       shift_ = zero</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    checka_ = .true.</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(disable)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;       disable_ = disable</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;       disable_ = .false.</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(itnlim)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;       itnlim_ = itnlim</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;       itnlim_ = 4 * n</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    connected = .false.</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    filename = <span class="stringliteral">&quot;MINRESQLP_tmp.txt&quot;</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    nout_ = 10</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(nout)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;       nout_ = nout</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;       <span class="keyword">inquire</span>(unit=nout, opened=connected, named=named_file, name=filename)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;       <span class="comment">!write(*,*) connected, named_file, filename</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;       <span class="keywordflow">if</span> (.not. connected) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;          <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;File unit &#39;nout&#39; is not open.&quot;</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          <span class="keywordflow">if</span> (nout==5  .or.  nout == 6) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;             nout_ = 10</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">if</span> (.not. connected) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;nout_ = &#39;</span>, nout_</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keyword">open</span>(nout_, file=filename, status=<span class="stringliteral">&#39;unknown&#39;</span>, iostat=ios)</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;ios = &#39;</span>, ios</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">if</span> (ios /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;           <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Error opening file &#39;&quot;</span>, filename, <span class="stringliteral">&quot;&#39;.&quot;</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;           stop</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(rtol)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;       rtol_ = rtol</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;       rtol_ = eps</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (prcsn == 6) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;       normmax = 1.0e4_dp</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(maxxnorm)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;       maxxnorm_ = min(maxxnorm, one/eps)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;       maxxnorm_ = normmax</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(trancond)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;       trancond_ = min(trancond, normmax)</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;       trancond_ = normmax</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(acondlim)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;       acondlim_ = min(acondlim, epsinv)</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;       acondlim_ = epsinv</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(msolve)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;       precon_ = .true.</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;       precon_ = .false.</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">! Print heading and initialize.</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    nprint   = min(n,20)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="comment">!debug   = .true.</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    lastiter = .false.</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    flag0    = 0</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    istop_   = flag0</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    beta1    = dnrm2(n, b, 1)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    ieps     = 0.1_dp/eps</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    itn_     = 0</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    qlpiter  = 0</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    xnorm_   = zero</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    xl2norm  = zero</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    axnorm   = zero</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    anorm_   = zero</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    acond_   = one</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    pnorm    = zero</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    relresl  = zero</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    relaresl = zero</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    x        = zero</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    xl2      = zero</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    x1last   = x(1)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">if</span> (nout_ &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;       <span class="keyword">write</span>(nout_, headerstr) enter, n, beta1, precon_, itnlim_, rtol_, &amp;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;       shift_, maxxnorm_, acondlim_, trancond_</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="comment">! Set up y and v for the first Lanczos vector v1.</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="comment">! y  =  beta1 P&#39;v1,  where  P = C**(-1).</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="comment">! v is really P&#39;v1.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    y  = b</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    r1 = b</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">if</span> ( precon_ ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;       <span class="keyword">call </span>msolve( n, b, y )</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    beta1  = dot_product(b, y)</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (beta1 &lt; zero .and. dnrm2(n, y, 1) &gt; eps) <span class="keywordflow">then</span>     <span class="comment">! M must be indefinite.</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;       istop_ = 11</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">if</span> (beta1 == zero) <span class="keywordflow">then</span>    <span class="comment">! b = 0 exactly.  Stop with x = 0.</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;       istop_ = 3</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    beta1  = sqrt( beta1 )     <span class="comment">! Normalize y to get v1 later.</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;       <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39; y_&#39;</span>, itn_, <span class="stringliteral">&#39; = &#39;</span>, (y(j), j=1,nprint)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;beta1 &#39;</span>, beta1</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="comment">! See if Msolve is symmetric.</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> (checka_  .and.  precon_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;       <span class="keyword">call </span>msolve( n, y, r2 )</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;       s      = dot_product( y, y )</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;       t      = dot_product(r1, r2)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;       z      = abs( s - t )</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;       epsa   = (abs(s) + eps) * eps**0.33333_dp</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;       <span class="keywordflow">if</span> (z &gt; epsa) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          istop_ = 10</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">! See if Aprod  is symmetric.</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">if</span> (checka_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;       <span class="keyword">call </span>aprod ( n, y, w  )  <span class="comment">! w  = A*y</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;       <span class="keyword">call </span>aprod ( n, w, r2 )  <span class="comment">! r2 = A*w</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;       s      = dot_product( w, w )</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;       t      = dot_product( y, r2)</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;       z      = abs( s - t )</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;       epsa   = (abs(s) + eps) * eps**0.33333_dp</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;       <span class="keywordflow">if</span> (z &gt; epsa) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;          istop_ = 9</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">! Initialize other quantities.</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    tau    = zero</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    taul   = zero</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    gmin   = zero</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    beta   = zero</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    betan  = beta1</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    dbar   = zero</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    dltan  = zero</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    eta    = zero</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    etal   = zero</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    etal2  = zero</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    vepln  = zero</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    veplnl = zero</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    veplnl2= zero</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    eplnn  = zero</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    gama   = zero</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    gamal  = zero</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    gamal2 = zero</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    phi    = beta1</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    cr1    = -one</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    sr1    = zero</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    cr2    = -one</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    sr2    = zero</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    cs     = -one</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    sn     = zero</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    ul3    = zero</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    ul2    = zero</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    ul     = zero</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    u      = zero</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    lines  = 1</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    headlines = 30 * lines</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    rnorm_ = betan</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    relres = rnorm_ / (anorm_*xnorm_ + beta1)</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    relares= zero</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    r2     = b</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    w      = zero    <span class="comment">! vector of zeros</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    wl     = zero</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    done   = .false.</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;       <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Checking variable values before main loop&#39;</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;istop &#39;</span>, istop_, <span class="stringliteral">&#39; done &#39;</span>, done, <span class="stringliteral">&#39; itn &#39;</span>, itn_, <span class="stringliteral">&#39; QLPiter&#39;</span> , qlpiter</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;lastiter&#39;</span>, lastiter, <span class="stringliteral">&#39; lines &#39;</span>, lines, <span class="stringliteral">&#39; headlines &#39;</span>, headlines</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;beta &#39;</span>, beta, <span class="stringliteral">&#39; tau &#39;</span>, tau, <span class="stringliteral">&#39; taul &#39;</span>, taul, <span class="stringliteral">&#39; phi &#39;</span>, phi</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;betan &#39;</span>, betan, <span class="stringliteral">&#39; gmin &#39;</span>, gmin, <span class="stringliteral">&#39; cs &#39;</span>, cs, <span class="stringliteral">&#39; sn &#39;</span>, sn</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;cr1 &#39;</span>, cr1, <span class="stringliteral">&#39; sr1 &#39;</span>, sr1, <span class="stringliteral">&#39; cr2 &#39;</span>, cr2, <span class="stringliteral">&#39; sr2 &#39;</span>, sr2</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;dltan &#39;</span>, dltan, <span class="stringliteral">&#39; eplnn &#39;</span>, eplnn, <span class="stringliteral">&#39; gama &#39;</span>, gama, <span class="stringliteral">&#39; gamal &#39;</span>, gamal</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;gamal2 &#39;</span>, gamal2, <span class="stringliteral">&#39; eta &#39;</span>, eta, <span class="stringliteral">&#39; etal &#39;</span>, etal, <span class="stringliteral">&#39;etal2&#39;</span>, etal2</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;vepln &#39;</span>, vepln, <span class="stringliteral">&#39; veplnl&#39;</span>, veplnl, <span class="stringliteral">&#39; veplnl2 &#39;</span>, veplnl2, <span class="stringliteral">&#39; ul3 &#39;</span>, ul3</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;ul2 &#39;</span>, ul2, <span class="stringliteral">&#39; ul &#39;</span>, ul, <span class="stringliteral">&#39; u &#39;</span>, u, <span class="stringliteral">&#39; rnorm &#39;</span>, rnorm_</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;xnorm &#39;</span>, xnorm_, <span class="stringliteral">&#39; xl2norm &#39;</span>, xl2norm, <span class="stringliteral">&#39; pnorm &#39;</span>, pnorm, <span class="stringliteral">&#39; Axnorm &#39;</span>, axnorm</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Anorm &#39;</span>, anorm_, <span class="stringliteral">&#39; Acond &#39;</span>, acond_, <span class="stringliteral">&#39; relres &#39;</span>, relres</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;       <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;w_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, (wl(j), j=1,nprint)</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;       <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;w_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, (w(j),  j=1,nprint)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;       <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;x_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, (x(j),  j=1,nprint)</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="comment">! Main iteration loop.</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">!------------------------------------------------------------------</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (istop_ &lt;= flag0)</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;       itn_ = itn_ + 1               <span class="comment">! k = itn = 1 first time through</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;       <span class="comment">!-----------------------------------------------------------------</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;       <span class="comment">! Obtain quantities for the next Lanczos vector vk+1, k = 1, 2,...</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;       <span class="comment">! The general iteration is similar to the case k = 1 with v0 = 0:</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;       <span class="comment">!</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;       <span class="comment">!   p1      = Operator * v1  -  beta1 * v0,</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;       <span class="comment">!   alpha1  = v1&#39;p1,</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;       <span class="comment">!   q2      = p2  -  alpha1 * v1,</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;       <span class="comment">!   beta2^2 = q2&#39;q2,</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;       <span class="comment">!   v2      = (1/beta2) q2.</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;       <span class="comment">!</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;       <span class="comment">! Again, y = betak P vk,  where  P = C**(-1).</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;       <span class="comment">! .... more description needed.</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;       <span class="comment">!-----------------------------------------------------------------</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;       betal  = beta;               <span class="comment">! betal = betak</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;       beta   = betan;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;       s      = one / beta          <span class="comment">! Normalize previous vector (in y).</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;       v      = s*y;                <span class="comment">! v = vk if P = I.</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;       <span class="keyword">call </span>aprod ( n, v, y )</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;       <span class="keywordflow">if</span> (shift_ /= zero) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;          y = y - shift_ * v</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;       <span class="keywordflow">if</span> (itn_ &gt;= 2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;          y = y + (- beta/betal) * r1</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;       alfa = dot_product(v, y)                  <span class="comment">! alphak</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;       y    = y + (- alfa/beta) * r2</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;       r1   = r2</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;       r2   = y</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;       <span class="keywordflow">if</span> ( .not. precon_ ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;          betan = dnrm2(n, y, 1)                 <span class="comment">! betan = ||y||_2</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;          <span class="keyword">call </span>msolve( n, r2, y )</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;          betan = dot_product(r2, y)             <span class="comment">! betan = betak+1^2</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;          <span class="keywordflow">if</span> (betan &gt; zero) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;             betan = sqrt(betan)</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;          <span class="keywordflow">elseif</span> ( dnrm2(n, y, 1) &gt; eps ) <span class="keywordflow">then</span>   <span class="comment">! M must be indefinite.</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;             istop_ = 11</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;             <span class="keywordflow">exit</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;       <span class="keywordflow">if</span> (itn_ == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;          vec2(1) = alfa</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;          vec2(2) = betan</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          pnorm   = dnrm2(2, vec2, 1)</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          vec3(1) = beta</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;          vec3(2) = alfa</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;          vec3(3) = betan</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;          pnorm   = dnrm2(3, vec3, 1)</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;       <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Lanczos iteration &#39;</span>, itn_</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;v_&#39;</span>,  itn_, <span class="stringliteral">&#39; = &#39;</span>, (v(j),  j=1,nprint)</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;r1_&#39;</span>, itn_, <span class="stringliteral">&#39; = &#39;</span>, (r1(j), j=1,nprint)</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;          <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;r2_&#39;</span>, itn_, <span class="stringliteral">&#39; = &#39;</span>, (r2(j), j=1,nprint)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;          <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;y_&#39;</span>,  itn_, <span class="stringliteral">&#39; = &#39;</span>, (y(j),  j=1,nprint)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;alpha_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, alfa,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                              <span class="stringliteral">&#39;beta_&#39;</span>,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, beta,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                              <span class="stringliteral">&#39;beta_&#39;</span>,  itn_+1, <span class="stringliteral">&#39; = &#39;</span>, betan, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                              <span class="stringliteral">&#39;pnorm_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, pnorm</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;       <span class="comment">! Apply previous left reflection Qk-1 to get</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;       <span class="comment">!   [deltak epslnk+1] = [cs  sn][dbark    0   ]</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;       <span class="comment">!   [gbar k dbar k+1]   [sn -cs][alfak betak+1].</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;       dbar   = dltan</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;       dlta   = cs * dbar  +  sn * alfa  <span class="comment">! dlta1  = 0         deltak</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;       epln   = eplnn;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;       gbar   = sn * dbar  -  cs * alfa  <span class="comment">! gbar 1 = alfa1     gbar k</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;       eplnn  =               sn * betan <span class="comment">! eplnn2 = 0         epslnk+1</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;       dltan  =            -  cs * betan <span class="comment">! dbar 2 = beta2     dbar k+1</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;       dlta_qlp = dlta;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;       <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;          <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;          <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Apply previous left reflection Q_{&#39;</span>, itn_-1, <span class="stringliteral">&#39;,&#39;</span>, itn_, <span class="stringliteral">&#39;}&#39;</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;c_&#39;</span>,    itn_-1, <span class="stringliteral">&#39; = &#39;</span>, cs,    <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                              <span class="stringliteral">&#39;s_&#39;</span>,    itn_-1, <span class="stringliteral">&#39; = &#39;</span>, sn</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;dlta_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, dlta,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                              <span class="stringliteral">&#39;gbar_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, gbar,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                              <span class="stringliteral">&#39;epln_&#39;</span>, itn_+1, <span class="stringliteral">&#39; = &#39;</span>, eplnn, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                              <span class="stringliteral">&#39;dbar_&#39;</span>, itn_+1, <span class="stringliteral">&#39; = &#39;</span>, dltan</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160; </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;       <span class="comment">! Compute the current left reflection Qk</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;       gamal3 = gamal2</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;       gamal2 = gamal</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;       gamal  = gama</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;       <span class="keyword">call </span>symortho(gbar, betan, cs, sn, gama)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;       gama_tmp = gama;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;       taul2  = taul</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;       taul   = tau</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;       tau    = cs * phi</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;       phi    = sn * phi                     <span class="comment">! phik</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;       axnorm = sqrt( axnorm**2 + tau**2 );</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;       <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;          <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;          <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Compute the current left reflection Q_{&#39;</span>, itn_, <span class="stringliteral">&#39;,&#39;</span>, itn_+1, <span class="stringliteral">&#39;}&#39;</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;c_&#39;</span>,    itn_, <span class="stringliteral">&#39; = &#39;</span>, cs,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                              <span class="stringliteral">&#39;s_&#39;</span>,    itn_, <span class="stringliteral">&#39; = &#39;</span>, sn</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;tau_&#39;</span>,  itn_, <span class="stringliteral">&#39; = &#39;</span>, tau,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                              <span class="stringliteral">&#39;phi_&#39;</span>,  itn_, <span class="stringliteral">&#39; = &#39;</span>, phi,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                              <span class="stringliteral">&#39;gama_&#39;</span>, itn_, <span class="stringliteral">&#39; = &#39;</span>, gama</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;       <span class="comment">! Apply the previous right reflection P{k-2,k}</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;       <span class="keywordflow">if</span> (itn_ &gt; 2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;          veplnl2  = veplnl</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          etal2    = etal</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          etal     = eta</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          dlta_tmp = sr2 * vepln - cr2 * dlta</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          veplnl   = cr2 * vepln + sr2 * dlta</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;          dlta     = dlta_tmp</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;          eta      = sr2 * gama</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;          gama     = -cr2 * gama</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;          <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;             <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;             <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Apply the previous right reflection P_{&#39;</span>, itn_-2, <span class="stringliteral">&#39;,&#39;</span>, itn_, <span class="stringliteral">&#39;}&#39;</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;cr2_&#39;</span>,    itn_,   <span class="stringliteral">&#39; = &#39;</span>, cr2,    <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                                 <span class="stringliteral">&#39;sr2_&#39;</span>,    itn_,   <span class="stringliteral">&#39; = &#39;</span>, sr2</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;gamal2_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, gamal2, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                                 <span class="stringliteral">&#39;gamal_&#39;</span>,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, gamal,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                 <span class="stringliteral">&#39;gama_&#39;</span>,   itn_,   <span class="stringliteral">&#39; = &#39;</span>, gama</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;dlta_&#39;</span>,   itn_,   <span class="stringliteral">&#39; = &#39;</span>, dlta,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                 <span class="stringliteral">&#39;vepln_&#39;</span>,  itn_-1, <span class="stringliteral">&#39; = &#39;</span>, veplnl</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;       <span class="comment">! Compute the current right reflection P{k-1,k}, P_12, P_23,...</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;       <span class="keywordflow">if</span> (itn_ &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;          <span class="keyword">call </span>symortho(gamal, dlta, cr1, sr1, gamal_tmp)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;          gamal     = gamal_tmp</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;          vepln     = sr1 * gama</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;          gama      = -cr1 * gama</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;          <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;             <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;             <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Apply the current right reflection  P_{&#39;</span>, itn_-1, <span class="stringliteral">&#39;,&#39;</span>, itn_, <span class="stringliteral">&#39;}&#39;</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;cr1_ &#39;</span>,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, cr1,    <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                                 <span class="stringliteral">&#39;sr1_&#39;</span> ,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, sr1</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;gama_&#39;</span>,  itn_-2, <span class="stringliteral">&#39; = &#39;</span>, gamal2, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                                 <span class="stringliteral">&#39;gama_&#39;</span>,  itn_-1, <span class="stringliteral">&#39; = &#39;</span>, gamal,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                                 <span class="stringliteral">&#39;gama_&#39;</span>,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, gama</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;dlta_&#39;</span>,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, dlta,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                 <span class="stringliteral">&#39;vepln_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, veplnl, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                 <span class="stringliteral">&#39;eta_&#39;</span>,   itn_,   <span class="stringliteral">&#39; = &#39;</span>, eta</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;       <span class="comment">! Update xnorm</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;       xnorml  = xnorm_</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;       ul4     = ul3</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;       ul3     = ul2</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160; </div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;       <span class="keywordflow">if</span> (itn_ &gt; 2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;          ul2 = ( taul2 - etal2 * ul4 - veplnl2 * ul3 ) / gamal2</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;          <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;tau_&#39;</span>,   itn_-2, <span class="stringliteral">&#39; = &#39;</span>, taul2,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                 <span class="stringliteral">&#39;eta_&#39;</span>,   itn_-2, <span class="stringliteral">&#39; = &#39;</span>, etal2,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                                 <span class="stringliteral">&#39;vepln_&#39;</span>, itn_-2, <span class="stringliteral">&#39; = &#39;</span>, veplnl2, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                                 <span class="stringliteral">&#39;gama_&#39;</span>,  itn_-2, <span class="stringliteral">&#39; = &#39;</span>, gamal2</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;       <span class="keywordflow">if</span> (itn_ &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;          ul  = ( taul  - etal  * ul3 - veplnl  * ul2) / gamal</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;          <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;tau_&#39;</span>,   itn_-1, <span class="stringliteral">&#39; = &#39;</span>, taul,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                                 <span class="stringliteral">&#39;eta_&#39;</span>,   itn_-1, <span class="stringliteral">&#39; = &#39;</span>, etal,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                                 <span class="stringliteral">&#39;vepln_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, veplnl, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                                 <span class="stringliteral">&#39;gamal_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, gamal</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;       vec3(1) = xl2norm</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;       vec3(2) = ul2</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;       vec3(3) = ul</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;       xnorm_tmp = dnrm2(3, vec3, 1)     <span class="comment">! norm([xl2norm ul2 ul]);</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;       <span class="keywordflow">if</span> (abs(gama) &gt; eps) <span class="keywordflow">then</span>         <span class="comment">! .and.  xnorm_tmp &lt; maxxnorm_) then</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;          <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;tau_&#39;</span>,   itn_, <span class="stringliteral">&#39; = &#39;</span>, tau,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                                 <span class="stringliteral">&#39;eta_&#39;</span>,   itn_, <span class="stringliteral">&#39; = &#39;</span>, eta,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                                 <span class="stringliteral">&#39;vepln_&#39;</span>, itn_, <span class="stringliteral">&#39; = &#39;</span>, vepln, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                                 <span class="stringliteral">&#39;gama_&#39;</span>,  itn_, <span class="stringliteral">&#39; = &#39;</span>, gama</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;          u       = (tau - eta*ul2 - vepln*ul) / gama</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;          likels  = relaresl &lt; relresl</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;          vec2(1) = xnorm_tmp</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;          vec2(2) = u</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;          <span class="keywordflow">if</span> (likels  .and.  dnrm2(2, vec2, 1) &gt; maxxnorm_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;             u      = zero</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;             istop_ = 12</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;          u      = zero</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;          istop_ = 14</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;       vec2(1)   = xl2norm</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;       vec2(2)   = ul2</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;       xl2norm   = dnrm2(2, vec2, 1)</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;       vec3(1)   = xl2norm</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;       vec3(2)   = ul</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;       vec3(3)   = u</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;       xnorm_    = dnrm2(3, vec3, 1)</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;       <span class="keywordflow">if</span> (acond_ &lt; trancond_  .and.  istop_ == flag0  .and.  qlpiter == 0) <span class="keywordflow">then</span> <span class="comment">!! MINRES updates</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;          wl2  = wl</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;          wl   = w</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;          <span class="keywordflow">if</span> (gama_tmp &gt; eps) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;             s = one / gama_tmp</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;             w = (v - epln*wl2 - dlta_qlp*wl) * s</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160; </div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;          <span class="keywordflow">if</span> (xnorm_ &lt; maxxnorm_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;             x1last = x(1)</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;             x = x + tau*w</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;             istop_   = 12</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;             lastiter = .true.</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;          <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;             <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;             <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;MINRES updates&#39;</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;             <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;gama_tmp_&#39;</span>, itn_, <span class="stringliteral">&#39; = &#39;</span>, gama_tmp, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                                 <span class="stringliteral">&#39;tau_&#39;</span>,      itn_, <span class="stringliteral">&#39; = &#39;</span>, tau,      <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                                 <span class="stringliteral">&#39;epln_&#39;</span>,     itn_, <span class="stringliteral">&#39; = &#39;</span>, epln,     <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                                 <span class="stringliteral">&#39;dlta_QLP_&#39;</span>, itn_, <span class="stringliteral">&#39; = &#39;</span>, dlta_qlp</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;             <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;v_&#39;</span>, itn_ , <span class="stringliteral">&#39; = &#39;</span>, (v(j), j=1,nprint)</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;             <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;w_&#39;</span>, itn_ , <span class="stringliteral">&#39; = &#39;</span>, (w(j), j=1,nprint)</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;       <span class="keywordflow">else</span>                                         <span class="comment">!! MINRES-QLP updates</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;          qlpiter = qlpiter + 1;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;          <span class="keywordflow">if</span> (qlpiter == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;             xl2 = zero     <span class="comment">! vector</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;             <span class="keywordflow">if</span> (itn_ &gt; 1) <span class="keywordflow">then</span>                     <span class="comment">! construct w_{k-3}, w_{k-2}, w_{k-1}</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                <span class="keywordflow">if</span> (itn_ &gt; 3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                   wl2 = gamal3*wl2 + veplnl2*wl + etal*w</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="keywordflow">                end if</span>                              <span class="comment">! w_{k-3}</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                <span class="keywordflow">if</span> (itn_ &gt; 2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                   wl = gamal_qlp*wl + vepln_qlp*w</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="keywordflow">                end if</span>                              <span class="comment">! w_{k-2}</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                w = gama_qlp*w</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                xl2 =  x - ul_qlp*wl - u_qlp*w</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="keywordflow">             end if</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;          <span class="keywordflow">if</span> (itn_ == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;             wl2 =  wl</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;             wl  =  sr1*v</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;             w   = -cr1*v</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itn_ == 2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;             wl2 = wl</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;             wl  = cr1*w + sr1*v</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;             w   = sr1*w - cr1*v</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;             wl2 = wl</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;             wl  = w</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;             w   = sr2*wl2 - cr2*v</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;             wl2 = cr2*wl2 + sr2*v</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;             v   = cr1*wl  + sr1*w</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;             w   = sr1*wl  - cr1*w</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;             wl  = v</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;          x1last = x(1)</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;          xl2 = xl2 + ul2*wl2</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;          x   = xl2 + ul *wl + u*w</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;          <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;             <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;             <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;MINRESQLP updates&#39;</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;       <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;          <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;          <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Update u, w, x and xnorm&#39;</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;u_&#39;</span>, itn_-2, <span class="stringliteral">&#39; = &#39;</span>, ul2, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                              <span class="stringliteral">&#39;u_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, ul,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                              <span class="stringliteral">&#39;u_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, u</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;          <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;w_&#39;</span>,   itn_-2, <span class="stringliteral">&#39; = &#39;</span>,  (wl2(j), j=1,nprint)</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;          <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;w_&#39;</span>,   itn_-1, <span class="stringliteral">&#39; = &#39;</span>,  (wl(j),  j=1,nprint)</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;          <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;w_&#39;</span>,   itn_,   <span class="stringliteral">&#39; = &#39;</span>,  (w(j),   j=1,nprint)</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;          <span class="keyword">write</span>(*,ddebugstr1) <span class="stringliteral">&#39;x_&#39;</span>,   itn_,   <span class="stringliteral">&#39; = &#39;</span>,  (x(j),   j=1,nprint)</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;xnorm_&#39;</span>, itn_-2, <span class="stringliteral">&#39; = &#39;</span>, xl2norm, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                              <span class="stringliteral">&#39;xnorm_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, xnorml,  <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                              <span class="stringliteral">&#39;xnorm_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, xnorm_</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160; </div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;       <span class="comment">! Compute the next right reflection P{k-1,k+1}</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160; </div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;       <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;          <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;          <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Compute the next right reflection P{&#39;</span>, itn_-1, itn_+1,<span class="stringliteral">&#39;}&#39;</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;gama_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, gamal, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                              <span class="stringliteral">&#39;epln_&#39;</span>, itn_+1, <span class="stringliteral">&#39; = &#39;</span>, eplnn</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160; </div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;       gamal_tmp = gamal</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;       <span class="keyword">call </span>symortho(gamal_tmp, eplnn, cr2, sr2, gamal)</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160; </div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;       <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;cr2_&#39;</span>,  itn_+1, <span class="stringliteral">&#39; = &#39;</span>, cr2, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                              <span class="stringliteral">&#39;sr2_&#39;</span>,  itn_+1, <span class="stringliteral">&#39; = &#39;</span>, sr2, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                              <span class="stringliteral">&#39;gama_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, gamal</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160; </div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;       <span class="comment">! Store quantities for transfering from MINRES to MINRES-QLP</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;       gamal_qlp = gamal_tmp</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;       vepln_qlp = vepln</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;       gama_qlp  = gama</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;       ul2_qlp   = ul2</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;       ul_qlp    = ul</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;       u_qlp     = u</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160; </div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;       <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;          <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;          <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Store quantities for transfering from MINRES to MINRES-QLP &#39;</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;gama_QLP_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, gamal_qlp, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                              <span class="stringliteral">&#39;vepln_QLP_&#39;</span>,itn_,   <span class="stringliteral">&#39; = &#39;</span>, vepln_qlp, <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                              <span class="stringliteral">&#39;gama_QLP_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, gama_qlp</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;u_QLP_&#39;</span>, itn_-2,    <span class="stringliteral">&#39; = &#39;</span>, ul2_qlp,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                              <span class="stringliteral">&#39;u_QLP_&#39;</span>, itn_-1,    <span class="stringliteral">&#39; = &#39;</span>, ul_qlp,    <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                              <span class="stringliteral">&#39;u_QLP_&#39;</span>, itn_,      <span class="stringliteral">&#39; = &#39;</span>, u_qlp</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;       <span class="comment">! Estimate various norms</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;       abs_gama = abs(gama)</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;       anorml   = anorm_</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;       anorm_   = max(anorm_, pnorm, gamal, abs_gama)</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;       <span class="keywordflow">if</span> (itn_ == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;          gmin  = gama</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;          gminl = gmin</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itn_ &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;          gminl2  = gminl</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;          gminl   = gmin</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;          vec3(1) = gminl2</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;          vec3(2) = gamal</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;          vec3(3) = abs_gama</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;          gmin    = min(gminl2, gamal, abs_gama)</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;       acondl   = acond_</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;       acond_   = anorm_ / gmin</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;       rnorml   = rnorm_</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;       relresl  = relres</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;       <span class="keywordflow">if</span> (istop_ /= 14) rnorm_ = phi</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;       relres   = rnorm_ / (anorm_ * xnorm_ + beta1)</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;       vec2(1)  = gbar</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;       vec2(2)  = dltan</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;       rootl    = dnrm2(2, vec2, 1)</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;       arnorml  = rnorml * rootl</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;       relaresl = rootl / anorm_</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160; </div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;       <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;          <span class="keyword">write</span>(*,*)</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;          <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Estimate various norms &#39;</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;gmin_&#39;</span>,   itn_,   <span class="stringliteral">&#39; = &#39;</span>, gmin,     <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                              <span class="stringliteral">&#39;pnorm_&#39;</span>,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, pnorm,    <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                              <span class="stringliteral">&#39;rnorm_&#39;</span>,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, rnorm_,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                              <span class="stringliteral">&#39;Arnorm_&#39;</span>, itn_-1, <span class="stringliteral">&#39; = &#39;</span>, arnorml</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;          <span class="keyword">write</span>(*,ddebugstr2) <span class="stringliteral">&#39;Axnorm_&#39;</span>, itn_,   <span class="stringliteral">&#39; = &#39;</span>, axnorm,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                              <span class="stringliteral">&#39;Anorm_&#39;</span>,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, anorm_,   <span class="stringliteral">&#39;, &#39;</span>, &amp;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                              <span class="stringliteral">&#39;Acond_&#39;</span>,  itn_,   <span class="stringliteral">&#39; = &#39;</span>, acond_</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;       <span class="comment">! See if any of the stopping criteria are satisfied.</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160; </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;       epsx = anorm_*xnorm_*eps</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;       <span class="keywordflow">if</span> (istop_ == flag0  .or.  istop_ == 14) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;          t1   = one + relres</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;          t2   = one + relaresl</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;       <span class="keywordflow">if</span> (t1 &lt;= one                  ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;          istop_ = 5                           <span class="comment">! Accurate Ax=b solution</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t2 &lt;= one             ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;          istop_ = 7                           <span class="comment">! Accurate LS solution</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relres   &lt;= rtol_     ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;          istop_ = 4                           <span class="comment">! Good enough Ax=b solution</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relaresl &lt;= rtol_     ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;          istop_ = 6                           <span class="comment">! Good enough LS solution</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (epsx     &gt;= beta1     ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;          istop_ = 2                           <span class="comment">! x is an eigenvector</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xnorm_    &gt;= maxxnorm_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;          istop_ = 12                          <span class="comment">! xnorm exceeded its limit</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (acond_    &gt;= acondlim_ .or. acond_ &gt;= ieps) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;          istop_ = 13                          <span class="comment">! Huge Acond</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itn_      &gt;= itnlim_  ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;          istop_ = 8                           <span class="comment">! Too many itns</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (betan     &lt;  eps      ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;          istop_ = 1                           <span class="comment">! Last iteration of Lanczos, rarely happens</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160; </div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;       <span class="keywordflow">if</span> (disable_  .and.  itn_ &lt; itnlim_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;          istop_ = flag0</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;          done   = .false.</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;          <span class="keywordflow">if</span> (axnorm &lt; rtol_*anorm_*xnorm_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;             istop_   = 15</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;             lastiter = .false.</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160; </div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;       <span class="keywordflow">if</span> (istop_ /= flag0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;          done = .true.</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;          <span class="keywordflow">if</span> (istop_ == 6  .or.  istop_ == 7  .or.  istop_ == 12  .or.  istop_ == 13) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;             lastiter = .true.</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;          <span class="keywordflow">if</span> (lastiter) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;             itn_   = itn_ - 1</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;             acond_ = acondl</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;             rnorm_ = rnorml</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;             relres = relresl</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160; </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;          <span class="keyword">call </span>aprod ( n, x, r1 )</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;          r1  = b - r1 + shift_*x       <span class="comment">! r1 to temporarily store residual vector</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;          <span class="keyword">call </span>aprod ( n, r1, wl2 )     <span class="comment">! wl2 to temporarily store A*r1</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;          wl2 = wl2 - shift_*r1</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;          arnorm_ = dnrm2(n, wl2, 1)</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;          <span class="keywordflow">if</span> (rnorm_ &gt; zero  .and.  anorm_ &gt; zero) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;             relares = arnorm_ / (anorm_*rnorm_)</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;       <span class="keywordflow">if</span> (nout_ &gt; 0  .and.  .not. lastiter  .and.  mod(itn_-1,lines) == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;          <span class="keywordflow">if</span> (itn_ == 101) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;             lines     = 10</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;             headlines = 30*lines</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itn_ == 1001) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;             lines = 100</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;             headlines = 30*lines</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;          <span class="keywordflow">if</span> (qlpiter == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;              qlpstr = <span class="stringliteral">&#39; P&#39;</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;              qlpstr = <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160; </div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;       <span class="comment">! See if it is time to print something.</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160; </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;       <span class="keywordflow">if</span> (nout_ &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;          prnt   = .false.</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          <span class="keywordflow">if</span> (n              &lt;= 40          ) prnt = .true.</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          <span class="keywordflow">if</span> (itn_           &lt;= 10          ) prnt = .true.</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          <span class="keywordflow">if</span> (itn_           &gt;= itnlim_ - 10) prnt = .true.</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;          <span class="keywordflow">if</span> (mod(itn_-1,10) == 0           ) prnt = .true.</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          <span class="keywordflow">if</span> (qlpiter        == 1           ) prnt = .true.</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;          <span class="keywordflow">if</span> (acond_         &gt;= 0.01_dp/eps ) prnt = .true.</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;          <span class="keywordflow">if</span> (istop_         /= flag0       ) prnt = .true.</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;          <span class="keywordflow">if</span> ( prnt ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;             <span class="keywordflow">if</span> (itn_ == 1) <span class="keyword">write</span>(nout_, tableheaderstr)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;             <span class="keyword">write</span>(nout_, itnstr) itn_-1, x1last, xnorml, &amp;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;             rnorml, arnorml, relresl, relaresl, anorml, acondl, qlpstr</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;             <span class="keywordflow">if</span> (mod(itn_,10) == 0) <span class="keyword">write</span>(nout_, <span class="stringliteral">&quot;(1x)&quot;</span>)</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;       <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;          <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;istop = &#39;</span>, istop_</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;       <span class="keywordflow">if</span> (istop_ /= flag0) <span class="keywordflow">exit</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="comment">!===================================================================</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="comment">! End of iteration loop.</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="comment">!===================================================================</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160; </div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="comment">! Optional outputs</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160; </div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(istop)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;       istop = istop_</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160; </div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(itn)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;       itn = itn_</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160; </div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(rnorm)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;       rnorm = rnorm_</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; </div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(arnorm)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;       arnorm = arnorm_</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(xnorm)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;       xnorm = xnorm_</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160; </div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(anorm)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;       anorm = anorm_</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160; </div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(acond)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;       acond = acond_</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">if</span> ( prnt ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;       <span class="keyword">write</span>(nout_, itnstr) itn_, x(1), xnorm_, &amp;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;             rnorm_, arnorm_, relres, relares, anorm_, acond_, qlpstr</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160; </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="comment">! Display final status.</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160; </div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">if</span> (nout_ &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;       <span class="keyword">write</span>(nout_, finalstr1) exitt, <span class="stringliteral">&#39;istop =&#39;</span>, istop_, <span class="stringliteral">&#39;itn    =&#39;</span>, itn_,    &amp;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                               exitt, <span class="stringliteral">&#39;Anorm =&#39;</span>, anorm_, <span class="stringliteral">&#39;Acond  =&#39;</span>, acond_,  &amp;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                               exitt, <span class="stringliteral">&#39;rnorm =&#39;</span>, rnorm_, <span class="stringliteral">&#39;Arnorm =&#39;</span>, arnorm_, &amp;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                               exitt, <span class="stringliteral">&#39;xnorm =&#39;</span>, xnorm_</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;       <span class="keyword">write</span>(nout_, finalstr2) exitt, msg(istop_)</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160; </div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="keywordflow">return</span></div>
<div class="ttc" id="anamespaceminresqlpdatamodule_html"><div class="ttname"><a href="namespaceminresqlpdatamodule.html">minresqlpdatamodule</a></div><div class="ttdoc">Defines precision and range in real(kind=dp) and integer(kind=ip) for portability and a few constants...</div><div class="ttdef"><b>Definition:</b> <a href="minresqlpDataModule_8f90_source.html#l00035">minresqlpDataModule.f90:35</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af827a771499cbe406df432ef1d5d758b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af827a771499cbe406df432ef1d5d758b">&#9670;&nbsp;</a></span>symortho()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public minresqlpmodule::symortho </td>
          <td>(</td>
          <td class="paramtype">real(dp), intent(in)&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(in)&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(out)&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(out)&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), intent(out)&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SymOrtho: Stable Householder reflection. </p>
<pre class="fragment">  USAGE:
     SymOrtho(a, b, c, s, r)

  INPUTS:
    a      first element of a two-vector  [a; b]
    b      second element of a two-vector [a; b]

  OUTPUTS:
    c      cosine(theta), where theta is the implicit angle of reflection
    s      sine(theta)
    r      two-norm of [a; b]

  DESCRIPTION:
     Stable Householder reflection that gives c and s such that
        [ c  s ][a] = [r],
        [ s -c ][b]   [0]
     where r = two norm of vector [a, b],
        c = a / sqrt(a**2 + b**2) = a / r,
        s = b / sqrt(a**2 + b**2) = b / r.
     The implementation guards against overlow in computing sqrt (a**2 + b**2).


  REFERENCES:
    Algorithm 4.9, stable unsymmetric Givens rotations in
     Golub and van Loan's book Matrix Computations, 3rd edition.

  MODIFICATION HISTORY:
    20/08/2012: Fixed a bug to ensure the 2x2 Hermitian reflectors
                are orthonormal.
    05/27/2011: Created this file from Matlab SymGivens2.m

  KNOWN BUGS:
     MM/DD/2004: description

  AUTHORS: Sou-Cheng Choi, CI, University of Chicago
           Michael Saunders, MS&amp;E, Stanford University

  CREATION DATE: 05/27/2011
</pre> 
<p class="definition">Definition at line <a class="el" href="minresqlpModule_8f90_source.html#l01334">1334</a> of file <a class="el" href="minresqlpModule_8f90_source.html">minresqlpModule.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160; </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(in)</span>  :: a, b</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(out)</span> :: c, s, r</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160; </div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="keywordtype">intrinsic</span> :: abs, sqrt</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160; </div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span> :: debug = .false.</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="keywordtype">    real</span>(dp)           :: t</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="keywordtype">    real</span>(dp)           :: abs_a, abs_b</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160; </div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    abs_a = abs(a)</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    abs_b = abs(b)</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160; </div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">if</span> (abs_b &lt;= realmin) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;       s = zero</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;       r = abs_a</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;       <span class="keywordflow">if</span> (a == zero) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;          c = one</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;          c = a / abs_a</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160; </div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (abs_a &lt;= realmin) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;       c = zero;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;       r = abs_b</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;       s = b / abs_b</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (abs_b &gt; abs_a) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;       t = a / b</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;       s = (b / abs_b) / sqrt(one + t**2)</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;       c = s * t</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;       r = b / s  <span class="comment">! computationally better than r = a / c since |c| &lt;= |s|</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160; </div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;       t = b / a</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;       c = (a / abs_a) / sqrt(one + t**2)</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;       s = c * t;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;       r = a / c  <span class="comment">! computationally better than r = b / s since |s| &lt;= |c|</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160; </div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;       <span class="keyword">write</span>(*,*)  <span class="stringliteral">&#39;c = &#39;</span>,  c, <span class="stringliteral">&#39;, s = &#39;</span>,  s, <span class="stringliteral">&#39;, r = &#39;</span>,  r</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceminresqlpmodule.html">minresqlpmodule</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
