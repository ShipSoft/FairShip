<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FairShip: millepede/pede.f90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FairShip
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pede_8f90.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">pede.f90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Millepede II program, subroutines.  
<a href="#details">More...</a></p>

<p><a href="pede_8f90_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a53bbb2675cd69493efe130814cb9042a"><td class="memItemLeft" align="right" valign="top">program&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a53bbb2675cd69493efe130814cb9042a">mptwo</a></td></tr>
<tr class="memdesc:a53bbb2675cd69493efe130814cb9042a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Millepede II main program Pede.  <a href="pede_8f90.html#a53bbb2675cd69493efe130814cb9042a">More...</a><br /></td></tr>
<tr class="separator:a53bbb2675cd69493efe130814cb9042a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43640e5d5710aee16e26f464a8d91db6"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a43640e5d5710aee16e26f464a8d91db6">solglo</a> (ivgbi)</td></tr>
<tr class="memdesc:a43640e5d5710aee16e26f464a8d91db6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Error for single global parameter from <a class="el" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">MINRES</a>.  <a href="pede_8f90.html#a43640e5d5710aee16e26f464a8d91db6">More...</a><br /></td></tr>
<tr class="separator:a43640e5d5710aee16e26f464a8d91db6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a913bbaf83d851f71a5f48ad8beda9579"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a913bbaf83d851f71a5f48ad8beda9579">solgloqlp</a> (ivgbi)</td></tr>
<tr class="memdesc:a913bbaf83d851f71a5f48ad8beda9579"><td class="mdescLeft">&#160;</td><td class="mdescRight">Error for single global parameter from <a class="el" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">MINRES-QLP</a>.  <a href="pede_8f90.html#a913bbaf83d851f71a5f48ad8beda9579">More...</a><br /></td></tr>
<tr class="separator:a913bbaf83d851f71a5f48ad8beda9579"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9376bb5e257206e87c2237f8e0b6bd28"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a9376bb5e257206e87c2237f8e0b6bd28">addcst</a></td></tr>
<tr class="memdesc:a9376bb5e257206e87c2237f8e0b6bd28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add constraint information to matrix and vector.  <a href="pede_8f90.html#a9376bb5e257206e87c2237f8e0b6bd28">More...</a><br /></td></tr>
<tr class="separator:a9376bb5e257206e87c2237f8e0b6bd28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05b5198a853192b0d4af53dcade84ae4"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a05b5198a853192b0d4af53dcade84ae4">prpcon</a></td></tr>
<tr class="memdesc:a05b5198a853192b0d4af53dcade84ae4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare constraints.  <a href="pede_8f90.html#a05b5198a853192b0d4af53dcade84ae4">More...</a><br /></td></tr>
<tr class="separator:a05b5198a853192b0d4af53dcade84ae4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d4e59446f937fc13d1441c9af06b212"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a1d4e59446f937fc13d1441c9af06b212">feasma</a></td></tr>
<tr class="memdesc:a1d4e59446f937fc13d1441c9af06b212"><td class="mdescLeft">&#160;</td><td class="mdescRight">Matrix for feasible solution.  <a href="pede_8f90.html#a1d4e59446f937fc13d1441c9af06b212">More...</a><br /></td></tr>
<tr class="separator:a1d4e59446f937fc13d1441c9af06b212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0971beb43bf6994f05975fe8638e926"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#ae0971beb43bf6994f05975fe8638e926">feasib</a> (concut, iact)</td></tr>
<tr class="memdesc:ae0971beb43bf6994f05975fe8638e926"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make parameters feasible.  <a href="pede_8f90.html#ae0971beb43bf6994f05975fe8638e926">More...</a><br /></td></tr>
<tr class="separator:ae0971beb43bf6994f05975fe8638e926"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a781f6fc2bdd91639f9a943c2b7801d4e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a781f6fc2bdd91639f9a943c2b7801d4e">peread</a> (more)</td></tr>
<tr class="memdesc:a781f6fc2bdd91639f9a943c2b7801d4e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read (block of) records from binary files.  <a href="pede_8f90.html#a781f6fc2bdd91639f9a943c2b7801d4e">More...</a><br /></td></tr>
<tr class="separator:a781f6fc2bdd91639f9a943c2b7801d4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacd49a512bb96f75b566fa8f2aee605b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#aacd49a512bb96f75b566fa8f2aee605b">peprep</a> (mode)</td></tr>
<tr class="memdesc:aacd49a512bb96f75b566fa8f2aee605b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare records.  <a href="pede_8f90.html#aacd49a512bb96f75b566fa8f2aee605b">More...</a><br /></td></tr>
<tr class="separator:aacd49a512bb96f75b566fa8f2aee605b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3fdc41dcd29ca7d77db610f59c005ff"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#af3fdc41dcd29ca7d77db610f59c005ff">pechk</a> (ibuf, nerr)</td></tr>
<tr class="memdesc:af3fdc41dcd29ca7d77db610f59c005ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check Millepede record.  <a href="pede_8f90.html#af3fdc41dcd29ca7d77db610f59c005ff">More...</a><br /></td></tr>
<tr class="separator:af3fdc41dcd29ca7d77db610f59c005ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2660e9144b1f62e900d2d8e2e1e6ba12"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a> (nst, is, ja, jb, jsp)</td></tr>
<tr class="memdesc:a2660e9144b1f62e900d2d8e2e1e6ba12"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode Millepede record.  <a href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">More...</a><br /></td></tr>
<tr class="separator:a2660e9144b1f62e900d2d8e2e1e6ba12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19f6871ad06d22ac8dbe88a839b31e4a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a19f6871ad06d22ac8dbe88a839b31e4a">loopn</a></td></tr>
<tr class="memdesc:a19f6871ad06d22ac8dbe88a839b31e4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loop with fits and sums.  <a href="pede_8f90.html#a19f6871ad06d22ac8dbe88a839b31e4a">More...</a><br /></td></tr>
<tr class="separator:a19f6871ad06d22ac8dbe88a839b31e4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a211a4f852cb64ceb591540c9980b0b1b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a211a4f852cb64ceb591540c9980b0b1b">ploopa</a> (lunp)</td></tr>
<tr class="memdesc:a211a4f852cb64ceb591540c9980b0b1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print title for iteration.  <a href="pede_8f90.html#a211a4f852cb64ceb591540c9980b0b1b">More...</a><br /></td></tr>
<tr class="separator:a211a4f852cb64ceb591540c9980b0b1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00d065081954e0f87a892d3aa5e22619"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a00d065081954e0f87a892d3aa5e22619">ploopb</a> (lunp)</td></tr>
<tr class="memdesc:a00d065081954e0f87a892d3aa5e22619"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print iteration line.  <a href="pede_8f90.html#a00d065081954e0f87a892d3aa5e22619">More...</a><br /></td></tr>
<tr class="separator:a00d065081954e0f87a892d3aa5e22619"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ab172fc202eaaabcafa19c12a28342e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a7ab172fc202eaaabcafa19c12a28342e">ploopc</a> (lunp)</td></tr>
<tr class="memdesc:a7ab172fc202eaaabcafa19c12a28342e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print sub-iteration line.  <a href="pede_8f90.html#a7ab172fc202eaaabcafa19c12a28342e">More...</a><br /></td></tr>
<tr class="separator:a7ab172fc202eaaabcafa19c12a28342e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefcec18b7566f81bf311d769ce42c736"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#aefcec18b7566f81bf311d769ce42c736">ploopd</a> (lunp)</td></tr>
<tr class="memdesc:aefcec18b7566f81bf311d769ce42c736"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print solution line.  <a href="pede_8f90.html#aefcec18b7566f81bf311d769ce42c736">More...</a><br /></td></tr>
<tr class="separator:aefcec18b7566f81bf311d769ce42c736"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5692a8832b068ae46126b2c0d8feeaa"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#ab5692a8832b068ae46126b2c0d8feeaa">explfc</a> (lunit)</td></tr>
<tr class="memdesc:ab5692a8832b068ae46126b2c0d8feeaa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print explanation of iteration table.  <a href="pede_8f90.html#ab5692a8832b068ae46126b2c0d8feeaa">More...</a><br /></td></tr>
<tr class="separator:ab5692a8832b068ae46126b2c0d8feeaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13adb5e2fcb06863ccfc03d886edd121"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a13adb5e2fcb06863ccfc03d886edd121">mupdat</a> (i, j, add)</td></tr>
<tr class="memdesc:a13adb5e2fcb06863ccfc03d886edd121"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update element of global matrix.  <a href="pede_8f90.html#a13adb5e2fcb06863ccfc03d886edd121">More...</a><br /></td></tr>
<tr class="separator:a13adb5e2fcb06863ccfc03d886edd121"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb76c893a1fbb54eb1e7c76ef189059a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#aeb76c893a1fbb54eb1e7c76ef189059a">loopbf</a> (nrej, ndfs, sndf, dchi2s, numfil, naccf, chi2f, ndff)</td></tr>
<tr class="memdesc:aeb76c893a1fbb54eb1e7c76ef189059a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loop over records in read buffer (block), fits and sums.  <a href="pede_8f90.html#aeb76c893a1fbb54eb1e7c76ef189059a">More...</a><br /></td></tr>
<tr class="separator:aeb76c893a1fbb54eb1e7c76ef189059a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b13fb17eb0fffb15b9e5b136c22f620"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a4b13fb17eb0fffb15b9e5b136c22f620">prtglo</a></td></tr>
<tr class="memdesc:a4b13fb17eb0fffb15b9e5b136c22f620"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print final log file.  <a href="pede_8f90.html#a4b13fb17eb0fffb15b9e5b136c22f620">More...</a><br /></td></tr>
<tr class="separator:a4b13fb17eb0fffb15b9e5b136c22f620"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55905c06a76e1e5c575cee7f55f244fb"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a55905c06a76e1e5c575cee7f55f244fb">prtstat</a></td></tr>
<tr class="memdesc:a55905c06a76e1e5c575cee7f55f244fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print input statistic.  <a href="pede_8f90.html#a55905c06a76e1e5c575cee7f55f244fb">More...</a><br /></td></tr>
<tr class="separator:a55905c06a76e1e5c575cee7f55f244fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9531a8f5f9a2cde1c04ef76ea1620259"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a> (n, x, b)</td></tr>
<tr class="memdesc:a9531a8f5f9a2cde1c04ef76ea1620259"><td class="mdescLeft">&#160;</td><td class="mdescRight">Product symmetric matrix times vector.  <a href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">More...</a><br /></td></tr>
<tr class="separator:a9531a8f5f9a2cde1c04ef76ea1620259"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7828f3b25225915586ac1d5a1a98206"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a> (n, x, b)</td></tr>
<tr class="memdesc:ad7828f3b25225915586ac1d5a1a98206"><td class="mdescLeft">&#160;</td><td class="mdescRight">Product symmetric matrix times vector.  <a href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">More...</a><br /></td></tr>
<tr class="separator:ad7828f3b25225915586ac1d5a1a98206"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50f66d2e4734adbf982eb00fd98b4765"><td class="memItemLeft" align="right" valign="top">integer(mpl) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a> (itema, itemb)</td></tr>
<tr class="memdesc:a50f66d2e4734adbf982eb00fd98b4765"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index for sparse storage.  <a href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">More...</a><br /></td></tr>
<tr class="separator:a50f66d2e4734adbf982eb00fd98b4765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb4bd5344ceff0a34a1ff786dedc587a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#adb4bd5344ceff0a34a1ff786dedc587a">mhalf2</a></td></tr>
<tr class="memdesc:adb4bd5344ceff0a34a1ff786dedc587a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fill 2nd half of matrix for extended storage.  <a href="pede_8f90.html#adb4bd5344ceff0a34a1ff786dedc587a">More...</a><br /></td></tr>
<tr class="separator:adb4bd5344ceff0a34a1ff786dedc587a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0e1b3c263ba5e50c1a0da7ee9d60864"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#ad0e1b3c263ba5e50c1a0da7ee9d60864">sechms</a> (deltat, nhour, minut, secnd)</td></tr>
<tr class="memdesc:ad0e1b3c263ba5e50c1a0da7ee9d60864"><td class="mdescLeft">&#160;</td><td class="mdescRight">Time conversion.  <a href="pede_8f90.html#ad0e1b3c263ba5e50c1a0da7ee9d60864">More...</a><br /></td></tr>
<tr class="separator:ad0e1b3c263ba5e50c1a0da7ee9d60864"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3441582f1e3d1880efd14bb86c592aa"><td class="memItemLeft" align="right" valign="top">integer(mpi) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a> (item)</td></tr>
<tr class="memdesc:ad3441582f1e3d1880efd14bb86c592aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Translate labels to indices (for global parameters).  <a href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">More...</a><br /></td></tr>
<tr class="separator:ad3441582f1e3d1880efd14bb86c592aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44d814f6965ac4c5b4ff7bbcd2cd2a81"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a44d814f6965ac4c5b4ff7bbcd2cd2a81">upone</a></td></tr>
<tr class="memdesc:a44d814f6965ac4c5b4ff7bbcd2cd2a81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update, redefine hash indices.  <a href="pede_8f90.html#a44d814f6965ac4c5b4ff7bbcd2cd2a81">More...</a><br /></td></tr>
<tr class="separator:a44d814f6965ac4c5b4ff7bbcd2cd2a81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7aa3f7f61de11f6e0d2a7dced6d3f69a"><td class="memItemLeft" align="right" valign="top">integer(mpi) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a7aa3f7f61de11f6e0d2a7dced6d3f69a">iprime</a> (n)</td></tr>
<tr class="memdesc:a7aa3f7f61de11f6e0d2a7dced6d3f69a"><td class="mdescLeft">&#160;</td><td class="mdescRight">largest prime number &lt; N.  <a href="pede_8f90.html#a7aa3f7f61de11f6e0d2a7dced6d3f69a">More...</a><br /></td></tr>
<tr class="separator:a7aa3f7f61de11f6e0d2a7dced6d3f69a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b511d5f8e1ab4fd3f856d4f44d69baa"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a1b511d5f8e1ab4fd3f856d4f44d69baa">loop1</a></td></tr>
<tr class="memdesc:a1b511d5f8e1ab4fd3f856d4f44d69baa"><td class="mdescLeft">&#160;</td><td class="mdescRight">First data loop (get global labels).  <a href="pede_8f90.html#a1b511d5f8e1ab4fd3f856d4f44d69baa">More...</a><br /></td></tr>
<tr class="separator:a1b511d5f8e1ab4fd3f856d4f44d69baa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada59c18037976f20c1de59572134c38e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#ada59c18037976f20c1de59572134c38e">loop1i</a></td></tr>
<tr class="memdesc:ada59c18037976f20c1de59572134c38e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iteration of first data loop.  <a href="pede_8f90.html#ada59c18037976f20c1de59572134c38e">More...</a><br /></td></tr>
<tr class="separator:ada59c18037976f20c1de59572134c38e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af70347dcf7288f096af64b5bca459d61"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#af70347dcf7288f096af64b5bca459d61">loop2</a></td></tr>
<tr class="memdesc:af70347dcf7288f096af64b5bca459d61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Second data loop (number of derivatives, global label pairs).  <a href="pede_8f90.html#af70347dcf7288f096af64b5bca459d61">More...</a><br /></td></tr>
<tr class="separator:af70347dcf7288f096af64b5bca459d61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b6537e97d3eefbb3cb1f9bab1385708"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a4b6537e97d3eefbb3cb1f9bab1385708">monres</a></td></tr>
<tr class="memdesc:a4b6537e97d3eefbb3cb1f9bab1385708"><td class="mdescLeft">&#160;</td><td class="mdescRight">Monitor input residuals.  <a href="pede_8f90.html#a4b6537e97d3eefbb3cb1f9bab1385708">More...</a><br /></td></tr>
<tr class="separator:a4b6537e97d3eefbb3cb1f9bab1385708"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeef08c1cf1a5fbab320c7e26af2322c7"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#aeef08c1cf1a5fbab320c7e26af2322c7">vmprep</a> (msize)</td></tr>
<tr class="memdesc:aeef08c1cf1a5fbab320c7e26af2322c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare storage for vectors and matrices.  <a href="pede_8f90.html#aeef08c1cf1a5fbab320c7e26af2322c7">More...</a><br /></td></tr>
<tr class="separator:aeef08c1cf1a5fbab320c7e26af2322c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac8a73c63504a2719be59c3ed1a0ac97"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#aac8a73c63504a2719be59c3ed1a0ac97">minver</a></td></tr>
<tr class="memdesc:aac8a73c63504a2719be59c3ed1a0ac97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solution by matrix inversion.  <a href="pede_8f90.html#aac8a73c63504a2719be59c3ed1a0ac97">More...</a><br /></td></tr>
<tr class="separator:aac8a73c63504a2719be59c3ed1a0ac97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51882a4f8268e9378cc1102daf447c42"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a51882a4f8268e9378cc1102daf447c42">mdiags</a></td></tr>
<tr class="memdesc:a51882a4f8268e9378cc1102daf447c42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solution by diagonalization.  <a href="pede_8f90.html#a51882a4f8268e9378cc1102daf447c42">More...</a><br /></td></tr>
<tr class="separator:a51882a4f8268e9378cc1102daf447c42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4360dd45378ac25a7f673c5ddf6d29ff"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a4360dd45378ac25a7f673c5ddf6d29ff">zdiags</a></td></tr>
<tr class="memdesc:a4360dd45378ac25a7f673c5ddf6d29ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Covariance matrix for diagonalization (,correction of eigenvectors).  <a href="pede_8f90.html#a4360dd45378ac25a7f673c5ddf6d29ff">More...</a><br /></td></tr>
<tr class="separator:a4360dd45378ac25a7f673c5ddf6d29ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bc980caefa591f99b8fd33645ea81e5"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a0bc980caefa591f99b8fd33645ea81e5">mminrs</a></td></tr>
<tr class="memdesc:a0bc980caefa591f99b8fd33645ea81e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solution with <a class="el" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">MINRES</a>.  <a href="pede_8f90.html#a0bc980caefa591f99b8fd33645ea81e5">More...</a><br /></td></tr>
<tr class="separator:a0bc980caefa591f99b8fd33645ea81e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade1c4784449e452a75d58bd02653b45e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#ade1c4784449e452a75d58bd02653b45e">mminrsqlp</a></td></tr>
<tr class="memdesc:ade1c4784449e452a75d58bd02653b45e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solution with <a class="el" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">MINRES-QLP</a>.  <a href="pede_8f90.html#ade1c4784449e452a75d58bd02653b45e">More...</a><br /></td></tr>
<tr class="separator:ade1c4784449e452a75d58bd02653b45e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0da5fd4f91da94fa7854e0939f5fd075"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a> (n, x, y)</td></tr>
<tr class="memdesc:a0da5fd4f91da94fa7854e0939f5fd075"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solution for zero band width preconditioner.  <a href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">More...</a><br /></td></tr>
<tr class="separator:a0da5fd4f91da94fa7854e0939f5fd075"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7da13e1cf0da04c46d9c36048880219"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a> (n, x, y)</td></tr>
<tr class="memdesc:ae7da13e1cf0da04c46d9c36048880219"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solution for finite band width preconditioner.  <a href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">More...</a><br /></td></tr>
<tr class="separator:ae7da13e1cf0da04c46d9c36048880219"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f814e28cf6765f05543d04194f8d4ac"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a1f814e28cf6765f05543d04194f8d4ac">xloopn</a></td></tr>
<tr class="memdesc:a1f814e28cf6765f05543d04194f8d4ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Standard solution algorithm.  <a href="pede_8f90.html#a1f814e28cf6765f05543d04194f8d4ac">More...</a><br /></td></tr>
<tr class="separator:a1f814e28cf6765f05543d04194f8d4ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfb4549b5a1993c24c6af9021688debd"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#adfb4549b5a1993c24c6af9021688debd">filetc</a></td></tr>
<tr class="memdesc:adfb4549b5a1993c24c6af9021688debd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interprete command line option, steering file.  <a href="pede_8f90.html#adfb4549b5a1993c24c6af9021688debd">More...</a><br /></td></tr>
<tr class="separator:adfb4549b5a1993c24c6af9021688debd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79cbeadbb6d7ba1b17db5588ad706199"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a79cbeadbb6d7ba1b17db5588ad706199">filetx</a></td></tr>
<tr class="memdesc:a79cbeadbb6d7ba1b17db5588ad706199"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interprete text files.  <a href="pede_8f90.html#a79cbeadbb6d7ba1b17db5588ad706199">More...</a><br /></td></tr>
<tr class="separator:a79cbeadbb6d7ba1b17db5588ad706199"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8565eccdb9c88b8593d9584b2797261"><td class="memItemLeft" align="right" valign="top">integer(mpi) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a> (fname)</td></tr>
<tr class="memdesc:af8565eccdb9c88b8593d9584b2797261"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inquire on file.  <a href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">More...</a><br /></td></tr>
<tr class="separator:af8565eccdb9c88b8593d9584b2797261"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c6bb3934f236ccdcc76e03883b379a8"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a4c6bb3934f236ccdcc76e03883b379a8">intext</a> (text, nline)</td></tr>
<tr class="memdesc:a4c6bb3934f236ccdcc76e03883b379a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interprete text.  <a href="pede_8f90.html#a4c6bb3934f236ccdcc76e03883b379a8">More...</a><br /></td></tr>
<tr class="separator:a4c6bb3934f236ccdcc76e03883b379a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fa6a026403e457dbb3e7f554ffd5dca"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a> (length, list, label, value)</td></tr>
<tr class="memdesc:a2fa6a026403e457dbb3e7f554ffd5dca"><td class="mdescLeft">&#160;</td><td class="mdescRight">add item to list  <a href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">More...</a><br /></td></tr>
<tr class="separator:a2fa6a026403e457dbb3e7f554ffd5dca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c76d03bc0e3c3a55898cf60cf1fbdcc"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a9c76d03bc0e3c3a55898cf60cf1fbdcc">mstart</a> (text)</td></tr>
<tr class="memdesc:a9c76d03bc0e3c3a55898cf60cf1fbdcc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start of 'module' printout.  <a href="pede_8f90.html#a9c76d03bc0e3c3a55898cf60cf1fbdcc">More...</a><br /></td></tr>
<tr class="separator:a9c76d03bc0e3c3a55898cf60cf1fbdcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f1cf38841260b60fa064f16b1f06cbc"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a9f1cf38841260b60fa064f16b1f06cbc">mend</a></td></tr>
<tr class="memdesc:a9f1cf38841260b60fa064f16b1f06cbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">End of 'module' printout.  <a href="pede_8f90.html#a9f1cf38841260b60fa064f16b1f06cbc">More...</a><br /></td></tr>
<tr class="separator:a9f1cf38841260b60fa064f16b1f06cbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ee8fc712707e7a8cafaf374b4a4e348"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a7ee8fc712707e7a8cafaf374b4a4e348">mvopen</a> (lun, fname)</td></tr>
<tr class="memdesc:a7ee8fc712707e7a8cafaf374b4a4e348"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open file.  <a href="pede_8f90.html#a7ee8fc712707e7a8cafaf374b4a4e348">More...</a><br /></td></tr>
<tr class="separator:a7ee8fc712707e7a8cafaf374b4a4e348"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a561b65e706ac555980a527a863d5ea"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a9a561b65e706ac555980a527a863d5ea">petime</a></td></tr>
<tr class="memdesc:a9a561b65e706ac555980a527a863d5ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print times.  <a href="pede_8f90.html#a9a561b65e706ac555980a527a863d5ea">More...</a><br /></td></tr>
<tr class="separator:a9a561b65e706ac555980a527a863d5ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16ef8020d3ee5c0aa46a0cb5b1dceba8"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a> (icode, cmessage)</td></tr>
<tr class="memdesc:a16ef8020d3ee5c0aa46a0cb5b1dceba8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print exit code.  <a href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">More...</a><br /></td></tr>
<tr class="separator:a16ef8020d3ee5c0aa46a0cb5b1dceba8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba466fbf4e152b7b0367a5cf63e8311c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#aba466fbf4e152b7b0367a5cf63e8311c">binopn</a> (kfile, ithr, ierr)</td></tr>
<tr class="memdesc:aba466fbf4e152b7b0367a5cf63e8311c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open binary file.  <a href="pede_8f90.html#aba466fbf4e152b7b0367a5cf63e8311c">More...</a><br /></td></tr>
<tr class="separator:aba466fbf4e152b7b0367a5cf63e8311c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a050daae79bead3c51481f24efcd9be87"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a050daae79bead3c51481f24efcd9be87">bincls</a> (kfile, ithr)</td></tr>
<tr class="memdesc:a050daae79bead3c51481f24efcd9be87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close binary file.  <a href="pede_8f90.html#a050daae79bead3c51481f24efcd9be87">More...</a><br /></td></tr>
<tr class="separator:a050daae79bead3c51481f24efcd9be87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a337ebc7d0fe6a4a5525ef7851cfb2a38"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a337ebc7d0fe6a4a5525ef7851cfb2a38">binrwd</a> (kfile)</td></tr>
<tr class="memdesc:a337ebc7d0fe6a4a5525ef7851cfb2a38"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rewind binary file.  <a href="pede_8f90.html#a337ebc7d0fe6a4a5525ef7851cfb2a38">More...</a><br /></td></tr>
<tr class="separator:a337ebc7d0fe6a4a5525ef7851cfb2a38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe72f30ba17fdfd70d04a47c5e3b6c08"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#abe72f30ba17fdfd70d04a47c5e3b6c08">addsum</a> (add)</td></tr>
<tr class="memdesc:abe72f30ba17fdfd70d04a47c5e3b6c08"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accurate summation.  <a href="pede_8f90.html#abe72f30ba17fdfd70d04a47c5e3b6c08">More...</a><br /></td></tr>
<tr class="separator:abe72f30ba17fdfd70d04a47c5e3b6c08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aec1171868141ca383a49764641bd7f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pede_8f90.html#a6aec1171868141ca383a49764641bd7f">getsum</a> (asum)</td></tr>
<tr class="memdesc:a6aec1171868141ca383a49764641bd7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get accurate sum.  <a href="pede_8f90.html#a6aec1171868141ca383a49764641bd7f">More...</a><br /></td></tr>
<tr class="separator:a6aec1171868141ca383a49764641bd7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Millepede II program, subroutines. </p>
<dl class="section author"><dt>Author</dt><dd>Volker Blobel, University Hamburg, 2005-2009 (initial Fortran77 version) </dd>
<dd>
Gero Flucke, University Hamburg (support of C-type binary files) </dd>
<dd>
Claus Kleinwort, DESY (maintenance and developement)</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) 2009 - 2018 Deutsches Elektronen-Synchroton, Member of the Helmholtz Association, (DESY), HAMBURG, GERMANY <br  />
<br  />
 This library is free software; you can redistribute it and/or modify it under the terms of the GNU Library General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version. <br  />
<br  />
 This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Library General Public License for more details. <br  />
<br  />
 You should have received a copy of the GNU Library General Public License along with this program (see the file COPYING.LIB for more details); if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA. </dd></dl>

<p class="definition">Definition in file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a9376bb5e257206e87c2237f8e0b6bd28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9376bb5e257206e87c2237f8e0b6bd28">&#9670;&nbsp;</a></span>addcst()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine addcst</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add constraint information to matrix and vector. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l01169">1169</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: climit</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: factr</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: sgm</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: icgb</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: irhs</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgb</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jcgb</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: l</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: label</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nop</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inone</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160; </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rhs</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: drhs(4)</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: idrh (4)</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    nop=0</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a> == 0) <span class="keywordflow">RETURN</span>  <span class="comment">! no constraints</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    climit=1.0e-5         <span class="comment">! limit for printout</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    irhs=0 <span class="comment">! number of values in DRHS(.), to be printed</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">DO</span> jcgb=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        icgb=<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(3,jcgb) <span class="comment">! unsorted constraint index</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        i=<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb)</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        rhs=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i  )%value <span class="comment">! right hand side</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        sgm=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i+1)%value <span class="comment">! sigma parameter</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordflow">DO</span> j=i+2,<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb+1)-1</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            label=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(j)%label</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            factr=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(j)%value</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            itgbi=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(label) <span class="comment">! -&gt; ITGBI= index of parameter label</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            ivgb =<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi) <span class="comment">! -&gt; variable-parameter index</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  </div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1.AND.<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a> &gt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>.AND.ivgb &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a13adb5e2fcb06863ccfc03d886edd121">mupdat</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+jcgb,ivgb,factr) <span class="comment">! add to matrix</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            rhs=rhs-factr*<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)     <span class="comment">! reduce residuum</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="keywordflow">IF</span>(abs(rhs) &gt; climit) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            irhs=irhs+1</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            idrh(irhs)=jcgb</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            drhs(irhs)=rhs</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            nop=1</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;            <span class="keywordflow">IF</span>(irhs == 4) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                <span class="keyword">WRITE</span>(*,101) (idrh(l),drhs(l),l=1,irhs)</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                irhs=0</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        <a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>(jcgb)=rhs</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a> &gt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+jcgb)=rhs</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">IF</span>(irhs /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <span class="keyword">WRITE</span>(*,101) (idrh(l),drhs(l),l=1,irhs)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="keywordflow">IF</span>(nop == 0) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="keyword">WRITE</span>(*,102) <span class="stringliteral">&#39; Constraints: only equation values &gt;&#39;</span>, climit,<span class="stringliteral">&#39; are printed&#39;</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;101 <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39;            &#39;</span>,4(i4,g11.3))</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;102 <span class="keyword">FORMAT</span>(a,g11.2,a)</div>
<div class="ttc" id="anamespacempmod_html"><div class="ttname"><a href="namespacempmod.html">mpmod</a></div><div class="ttdoc">Parameters, variables, dynamic arrays.</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00028">mpmod.f90:28</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0231b312a2d1c7f33f04f99bce560206"><div class="ttname"><a href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">mpmod::globalparameter</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable globalparameter</div><div class="ttdoc">global parameters (start values + sum(x_i))</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00174">mpmod.f90:174</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0c2a4eca186a1b56ad847a6403a40129"><div class="ttname"><a href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">mpmod::vecconsresiduals</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable vecconsresiduals</div><div class="ttdoc">residuals of constraints</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00203">mpmod.f90:203</a></div></div>
<div class="ttc" id="anamespacempmod_html_a1e60aa0ce0882db83c26c58578f9c6c3"><div class="ttname"><a href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">mpmod::matconssort</a></div><div class="ttdeci">integer(mpi), dimension(:,:), allocatable matconssort</div><div class="ttdoc">keys and index for sorting</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00207">mpmod.f90:207</a></div></div>
<div class="ttc" id="anamespacempmod_html_a4161819bdd4b40597f39eec350be2e41"><div class="ttname"><a href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">mpmod::listconstraints</a></div><div class="ttdeci">type(listitem), dimension(:), allocatable listconstraints</div><div class="ttdoc">list of constraints from steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00276">mpmod.f90:276</a></div></div>
<div class="ttc" id="anamespacempmod_html_a512aaf42b8f2cbfe6178c7a2a2e883ed"><div class="ttname"><a href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">mpmod::nagb</a></div><div class="ttdeci">integer(mpi) nagb</div><div class="ttdoc">number of all parameters (global par. + Lagrange mult.)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00119">mpmod.f90:119</a></div></div>
<div class="ttc" id="anamespacempmod_html_a8a41e0e932702180f248638fe285c63a"><div class="ttname"><a href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">mpmod::globalparlabelindex</a></div><div class="ttdeci">integer(mpi), dimension(:,:), allocatable globalparlabelindex</div><div class="ttdoc">global parameters label, total -&gt; var. index</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00214">mpmod.f90:214</a></div></div>
<div class="ttc" id="anamespacempmod_html_a8fb6c37ed80936c41bb54513f5b8fc28"><div class="ttname"><a href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">mpmod::lenconstraints</a></div><div class="ttdeci">integer(mpi) lenconstraints</div><div class="ttdoc">length of list of constraints from steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00275">mpmod.f90:275</a></div></div>
<div class="ttc" id="anamespacempmod_html_aa78a3bec7bbd9d59a39476c3f2472f13"><div class="ttname"><a href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">mpmod::vecconsstart</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable vecconsstart</div><div class="ttdoc">start of constraint in listConstraints (unsorted input)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00206">mpmod.f90:206</a></div></div>
<div class="ttc" id="anamespacempmod_html_aacb8ec6bcb93febc26d16ac84250546c"><div class="ttname"><a href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">mpmod::icalcm</a></div><div class="ttdeci">integer(mpi) icalcm</div><div class="ttdoc">calculation mode (for XLOOPN) , &gt;0: calculate matrix</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00073">mpmod.f90:73</a></div></div>
<div class="ttc" id="anamespacempmod_html_ac4ad271e889f6d6ae362bdc80e3af05c"><div class="ttname"><a href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">mpmod::globalvector</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable globalvector</div><div class="ttdoc">global vector 'x' (in A*x=b)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00185">mpmod.f90:185</a></div></div>
<div class="ttc" id="anamespacempmod_html_acfd3a7e698690995206c13b2437a93ad"><div class="ttname"><a href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">mpmod::ncgb</a></div><div class="ttdeci">integer(mpi) ncgb</div><div class="ttdoc">number of constraints</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00121">mpmod.f90:121</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad22ac7402f34720faeef22520d14c583"><div class="ttname"><a href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">mpmod::nvgb</a></div><div class="ttdeci">integer(mpi) nvgb</div><div class="ttdoc">number of variable global parameters</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00118">mpmod.f90:118</a></div></div>
<div class="ttc" id="apede_8f90_html_a13adb5e2fcb06863ccfc03d886edd121"><div class="ttname"><a href="pede_8f90.html#a13adb5e2fcb06863ccfc03d886edd121">mupdat</a></div><div class="ttdeci">subroutine mupdat(i, j, add)</div><div class="ttdoc">Update element of global matrix.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l02977">pede.f90:2978</a></div></div>
<div class="ttc" id="apede_8f90_html_ad3441582f1e3d1880efd14bb86c592aa"><div class="ttname"><a href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a></div><div class="ttdeci">integer(mpi) function inone(item)</div><div class="ttdoc">Translate labels to indices (for global parameters).</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l04662">pede.f90:4663</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2fa6a026403e457dbb3e7f554ffd5dca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fa6a026403e457dbb3e7f554ffd5dca">&#9670;&nbsp;</a></span>additem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine additem </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(inout)&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmpdef_1_1listitem.html">listitem</a>), dimension(:), intent(inout), allocatable&#160;</td>
          <td class="paramname"><em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), intent(in)&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>add item to list </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">length</td><td>length of list </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">list</td><td>list of items </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">label</td><td>item label </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">value</td><td>item value </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l08713">8713</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l08714"></a><span class="lineno"> 8714</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l08715"></a><span class="lineno"> 8715</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l08716"></a><span class="lineno"> 8716</span>&#160; </div>
<div class="line"><a name="l08717"></a><span class="lineno"> 8717</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN OUT)</span> :: length</div>
<div class="line"><a name="l08718"></a><span class="lineno"> 8718</span>&#160;    <span class="keywordtype">TYPE</span>(listItem), <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">INTENT(IN OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: list</div>
<div class="line"><a name="l08719"></a><span class="lineno"> 8719</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: label</div>
<div class="line"><a name="l08720"></a><span class="lineno"> 8720</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(IN)</span> :: value</div>
<div class="line"><a name="l08721"></a><span class="lineno"> 8721</span>&#160; </div>
<div class="line"><a name="l08722"></a><span class="lineno"> 8722</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: newSize</div>
<div class="line"><a name="l08723"></a><span class="lineno"> 8723</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: oldSize</div>
<div class="line"><a name="l08724"></a><span class="lineno"> 8724</span>&#160;    <span class="keywordtype">TYPE</span>(listItem), <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: tempList</div>
<div class="line"><a name="l08725"></a><span class="lineno"> 8725</span>&#160; </div>
<div class="line"><a name="l08726"></a><span class="lineno"> 8726</span>&#160;    <span class="keywordflow">IF</span> (label &gt; 0.AND.<span class="keywordtype">value</span> == 0.) <span class="keywordflow">RETURN</span> <span class="comment">! skip zero for valid labels</span></div>
<div class="line"><a name="l08727"></a><span class="lineno"> 8727</span>&#160;    <span class="keywordflow">IF</span> (length == 0 ) <span class="keywordflow">THEN</span>  <span class="comment">! initial list with size = 100</span></div>
<div class="line"><a name="l08728"></a><span class="lineno"> 8728</span>&#160;        newsize = 100</div>
<div class="line"><a name="l08729"></a><span class="lineno"> 8729</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(list,newsize,<span class="stringliteral">&#39; list &#39;</span>)</div>
<div class="line"><a name="l08730"></a><span class="lineno"> 8730</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l08731"></a><span class="lineno"> 8731</span>&#160;    oldsize=<span class="keyword">size</span>(list,kind=<a class="code" href="namespacempdef.html#a6552572a2e0d09bc7a0093145deb7840">mpl</a>)</div>
<div class="line"><a name="l08732"></a><span class="lineno"> 8732</span>&#160;    <span class="keywordflow">IF</span> (length &gt;= oldsize) <span class="keywordflow">THEN</span> <span class="comment">! increase sizeby 20% + 100</span></div>
<div class="line"><a name="l08733"></a><span class="lineno"> 8733</span>&#160;        newsize = oldsize + oldsize/5 + 100</div>
<div class="line"><a name="l08734"></a><span class="lineno"> 8734</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(templist,oldsize,<span class="stringliteral">&#39; temp. list &#39;</span>)</div>
<div class="line"><a name="l08735"></a><span class="lineno"> 8735</span>&#160;        templist=list</div>
<div class="line"><a name="l08736"></a><span class="lineno"> 8736</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(list)</div>
<div class="line"><a name="l08737"></a><span class="lineno"> 8737</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(list,newsize,<span class="stringliteral">&#39; list &#39;</span>)</div>
<div class="line"><a name="l08738"></a><span class="lineno"> 8738</span>&#160;        list(1:oldsize)=templist(1:oldsize)</div>
<div class="line"><a name="l08739"></a><span class="lineno"> 8739</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(templist)</div>
<div class="line"><a name="l08740"></a><span class="lineno"> 8740</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l08741"></a><span class="lineno"> 8741</span>&#160;    <span class="comment">! add to end of list</span></div>
<div class="line"><a name="l08742"></a><span class="lineno"> 8742</span>&#160;    length=length+1</div>
<div class="line"><a name="l08743"></a><span class="lineno"> 8743</span>&#160;    list(length)%label=label</div>
<div class="line"><a name="l08744"></a><span class="lineno"> 8744</span>&#160;    list(length)%value=<span class="keywordtype">value</span></div>
<div class="line"><a name="l08745"></a><span class="lineno"> 8745</span>&#160; </div>
<div class="ttc" id="ainterfacempdalc_1_1mpalloc_html"><div class="ttname"><a href="interfacempdalc_1_1mpalloc.html">mpdalc::mpalloc</a></div><div class="ttdoc">allocate array</div><div class="ttdef"><b>Definition:</b> <a href="mpdalc_8f90_source.html#l00036">mpdalc.f90:36</a></div></div>
<div class="ttc" id="ainterfacempdalc_1_1mpdealloc_html"><div class="ttname"><a href="interfacempdalc_1_1mpdealloc.html">mpdalc::mpdealloc</a></div><div class="ttdoc">deallocate array</div><div class="ttdef"><b>Definition:</b> <a href="mpdalc_8f90_source.html#l00041">mpdalc.f90:41</a></div></div>
<div class="ttc" id="anamespacempdalc_html"><div class="ttname"><a href="namespacempdalc.html">mpdalc</a></div><div class="ttdoc">(De)Allocate vectors and arrays.</div><div class="ttdef"><b>Definition:</b> <a href="mpdalc_8f90_source.html#l00024">mpdalc.f90:24</a></div></div>
<div class="ttc" id="anamespacempdef_html"><div class="ttname"><a href="namespacempdef.html">mpdef</a></div><div class="ttdoc">Definition of constants.</div><div class="ttdef"><b>Definition:</b> <a href="mpdef_8f90_source.html#l00024">mpdef.f90:24</a></div></div>
<div class="ttc" id="anamespacempdef_html_a6552572a2e0d09bc7a0093145deb7840"><div class="ttname"><a href="namespacempdef.html#a6552572a2e0d09bc7a0093145deb7840">mpdef::mpl</a></div><div class="ttdeci">integer, parameter mpl</div><div class="ttdef"><b>Definition:</b> <a href="mpdef_8f90_source.html#l00036">mpdef.f90:36</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abe72f30ba17fdfd70d04a47c5e3b6c08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe72f30ba17fdfd70d04a47c5e3b6c08">&#9670;&nbsp;</a></span>addsum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine addsum </td>
          <td>(</td>
          <td class="paramtype">real(mpd)&#160;</td>
          <td class="paramname"><em>add</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accurate summation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">add</td><td>summand </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l09041">9041</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l09042"></a><span class="lineno"> 9042</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l09043"></a><span class="lineno"> 9043</span>&#160; </div>
<div class="line"><a name="l09044"></a><span class="lineno"> 9044</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l09045"></a><span class="lineno"> 9045</span>&#160;<span class="keywordtype">    REAL</span>(mpd):: add</div>
<div class="line"><a name="l09046"></a><span class="lineno"> 9046</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> ::nadd</div>
<div class="line"><a name="l09047"></a><span class="lineno"> 9047</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l09048"></a><span class="lineno"> 9048</span>&#160;    nadd=int(add,mpi)                <span class="comment">! convert to integer</span></div>
<div class="line"><a name="l09049"></a><span class="lineno"> 9049</span>&#160;    <a class="code" href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">accuratensum</a>=<a class="code" href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">accuratensum</a>+nadd               <span class="comment">! sum integer</span></div>
<div class="line"><a name="l09050"></a><span class="lineno"> 9050</span>&#160;    <a class="code" href="namespacempmod.html#a820f63d630792597c41780dd2a6d1e55">accuratedsum</a>=<a class="code" href="namespacempmod.html#a820f63d630792597c41780dd2a6d1e55">accuratedsum</a>+(add-real(nadd,mpd)) <span class="comment">! sum remainder</span></div>
<div class="line"><a name="l09051"></a><span class="lineno"> 9051</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a820f63d630792597c41780dd2a6d1e55">accuratedsum</a> &gt; 16.0_mpd) <span class="keywordflow">THEN</span>       <span class="comment">! + - 16</span></div>
<div class="line"><a name="l09052"></a><span class="lineno"> 9052</span>&#160;        <a class="code" href="namespacempmod.html#a820f63d630792597c41780dd2a6d1e55">accuratedsum</a>=<a class="code" href="namespacempmod.html#a820f63d630792597c41780dd2a6d1e55">accuratedsum</a>-16.0_mpd</div>
<div class="line"><a name="l09053"></a><span class="lineno"> 9053</span>&#160;        <a class="code" href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">accuratensum</a>=<a class="code" href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">accuratensum</a>+16</div>
<div class="line"><a name="l09054"></a><span class="lineno"> 9054</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l09055"></a><span class="lineno"> 9055</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">accuratensum</a> &gt; <a class="code" href="namespacempmod.html#a3b047e81c0b40b59237660cf09ffb1d3">nexp20</a>) <span class="keywordflow">THEN</span>      <span class="comment">! if &gt; 2^20: + - 2^20</span></div>
<div class="line"><a name="l09056"></a><span class="lineno"> 9056</span>&#160;        <a class="code" href="namespacempmod.html#a721d239daf81dac3252383b72467d705">accuratenexp</a>=<a class="code" href="namespacempmod.html#a721d239daf81dac3252383b72467d705">accuratenexp</a>+1</div>
<div class="line"><a name="l09057"></a><span class="lineno"> 9057</span>&#160;        <a class="code" href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">accuratensum</a>=<a class="code" href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">accuratensum</a>-<a class="code" href="namespacempmod.html#a3b047e81c0b40b59237660cf09ffb1d3">nexp20</a></div>
<div class="line"><a name="l09058"></a><span class="lineno"> 9058</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l09059"></a><span class="lineno"> 9059</span>&#160;    <span class="keywordflow">RETURN</span></div>
<div class="ttc" id="anamespacempmod_html_a3b047e81c0b40b59237660cf09ffb1d3"><div class="ttname"><a href="namespacempmod.html#a3b047e81c0b40b59237660cf09ffb1d3">mpmod::nexp20</a></div><div class="ttdeci">integer(mpi), parameter nexp20</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00166">mpmod.f90:166</a></div></div>
<div class="ttc" id="anamespacempmod_html_a721d239daf81dac3252383b72467d705"><div class="ttname"><a href="namespacempmod.html#a721d239daf81dac3252383b72467d705">mpmod::accuratenexp</a></div><div class="ttdeci">integer(mpi) accuratenexp</div><div class="ttdoc">sum / 2**20</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00169">mpmod.f90:169</a></div></div>
<div class="ttc" id="anamespacempmod_html_a820f63d630792597c41780dd2a6d1e55"><div class="ttname"><a href="namespacempmod.html#a820f63d630792597c41780dd2a6d1e55">mpmod::accuratedsum</a></div><div class="ttdeci">real(mpd) accuratedsum</div><div class="ttdoc">fractional part of sum</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00167">mpmod.f90:167</a></div></div>
<div class="ttc" id="anamespacempmod_html_acc78106d0f44a814ec8e7779001f28d6"><div class="ttname"><a href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">mpmod::accuratensum</a></div><div class="ttdeci">integer(mpi) accuratensum</div><div class="ttdoc">sum mod 2**20</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00168">mpmod.f90:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9531a8f5f9a2cde1c04ef76ea1620259"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9531a8f5f9a2cde1c04ef76ea1620259">&#9670;&nbsp;</a></span>avprd0()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine avprd0 </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), dimension(n), intent(in)&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), dimension(n), intent(out)&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Product symmetric matrix times vector. </p>
<p>A(sym) * X =&gt; B. Used by <a class="el" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">MINRES</a> method (Is most CPU intensive part). The matrix A is the global matrix in full symmetric or (compressed) sparse storage.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>size of matrix </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>vector X </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>result vector B </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04226">4226</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160; </div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iencdb</div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iencdm</div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iproc</div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ir</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jc</div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jj</div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jn</div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160; </div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>          :: n</div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(IN)</span>             :: x(n)</div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(OUT)</span>            :: b(n)</div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: k</div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: kk</div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: kl</div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ku</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ll</div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: lj</div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: indij</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: indid</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ij</div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ichunk</div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;    <span class="comment">!$    INTEGER(mpi) OMP_GET_THREAD_NUM</span></div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;    <span class="comment">!$ DO i=1,n</span></div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;    <span class="comment">!$    b(i)=0.0_mpd             ! reset &#39;global&#39; B()</span></div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;    <span class="comment">!$ END DO</span></div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;    ichunk=min((n+<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>-1)/<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>/8+1,1024)</div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;        <span class="comment">! full symmetric matrix</span></div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;        <span class="comment">! parallelize row loop</span></div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;        <span class="comment">! private copy of B(N) for each thread, combined at end, init with 0.</span></div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;        <span class="comment">! slot of 1024 &#39;I&#39; for next idle thread</span></div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;        <span class="comment">!$OMP  PARALLEL DO &amp;</span></div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;        <span class="comment">!$OMP  PRIVATE(J,IJ) &amp;</span></div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;        <span class="comment">!$OMP  REDUCTION(+:B) &amp;</span></div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;        <span class="comment">!$OMP  SCHEDULE(DYNAMIC,ichunk)</span></div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;        <span class="keywordflow">DO</span> i=1,n</div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;            ij=i</div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;            ij=(ij*ij-ij)/2</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;            b(i)=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ij+i)*x(i)</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;            <span class="keywordflow">DO</span> j=1,i-1</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;                b(j)=b(j)+<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ij+j)*x(i)</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;                b(i)=b(i)+<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ij+j)*x(j)</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;        <span class="comment">!$OMP END PARALLEL DO</span></div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;        <span class="comment">! sparse, compressed matrix</span></div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(2,1) /= n+1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(24,<span class="stringliteral">&#39;Aborted, vector/matrix size mismatch&#39;</span>)</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;            stop <span class="stringliteral">&#39;AVPRD0: mismatched vector and matrix&#39;</span></div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;        iencdb=<a class="code" href="namespacempmod.html#ad7d459edc90892891995ccb3ac96b6f3">nencdb</a></div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;        iencdm=ishft(1,iencdb)-1</div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;        <span class="comment">! parallelize row loop</span></div>
<div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;        <span class="comment">! slot of 1024 &#39;I&#39; for next idle thread</span></div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;        <span class="comment">!$OMP PARALLEL DO &amp;</span></div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;        <span class="comment">!$OMP  PRIVATE(IR,K,KK,LL,KL,KU,INDID,INDIJ,J,JC,JN,LJ,JJ) &amp;</span></div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;        <span class="comment">!$OMP  REDUCTION(+:B) &amp;</span></div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;        <span class="comment">!$OMP  SCHEDULE(DYNAMIC,ichunk)</span></div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;        <span class="keywordflow">DO</span> i=1,n</div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;            iproc=0</div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;            <span class="comment">!$     IPROC=OMP_GET_THREAD_NUM()         ! thread number</span></div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;            b(i)=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(i)*x(i)    <span class="comment">! diagonal elements</span></div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;            <span class="comment">!                                ! off-diagonals double precision</span></div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;            ir=i</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;            kk=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(1,ir) <span class="comment">! offset in &#39;d&#39; (column lists)</span></div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;            ll=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(2,ir) <span class="comment">! offset in &#39;j&#39; (matrix)</span></div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;            kl=0</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;            ku=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(1,ir+1)-1-kk</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;            indid=kk</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;            indij=ll</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid) /= 0) <span class="keywordflow">THEN</span>  <span class="comment">! no compression</span></div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;                <span class="keywordflow">DO</span> k=kl,ku</div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;                    j=<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+k)</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;                    b(j)=b(j)+<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(indij+k)*x(i)</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;                    b(i)=b(i)+<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(indij+k)*x(j)</div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;                lj=0</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;                ku=((ku+1)*8)/9-1         <span class="comment">! number of regions (-1)</span></div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;                indid=indid+ku/8+1        <span class="comment">! skip group offsets</span></div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a8d3078659555c21fda8d43de37c311de">mextnd</a>&gt;0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;                    <span class="comment">! extended storage</span></div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;                    <span class="keywordflow">DO</span> kl=0,ku</div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;                        jc=<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+kl)</div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;                        j=ishft(jc,-iencdb)</div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;                        jn=iand(jc, iencdm)</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;                        b(i)=b(i)+dot_product(<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(indij+lj:indij+lj+jn-1),x(j:j+jn-1))</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;                        lj=lj+jn</div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;<span class="keywordflow">                    END DO</span>    </div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;                    <span class="keywordflow">DO</span> kl=0,ku</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;                        jc=<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+kl)</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;                        j=ishft(jc,-iencdb)</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;                        jn=iand(jc, iencdm)</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;                        <span class="keywordflow">DO</span> jj=1,jn</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;                            b(j)=b(j)+<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(indij+lj)*x(i)</div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;                            b(i)=b(i)+<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(indij+lj)*x(j)</div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;                            j=j+1</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;                            lj=lj+1</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;<span class="keywordflow">                        END DO</span></div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;<span class="keywordflow">                END IF</span> </div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160; </div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a4ef9f014f98a92d810584e67f14f40ec">nspc</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;                ir=i+n+1                     <span class="comment">! off-diagonals single precision</span></div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;                kk=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(1,ir) <span class="comment">! offset in &#39;d&#39; (column lists)</span></div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;                ll=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(2,ir) <span class="comment">! offset in &#39;.&#39; (matrix)</span></div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;                kl=0</div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;                ku=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(1,ir+1)-1-kk</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;                indid=kk</div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;                indij=ll</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid) /= 0) <span class="keywordflow">THEN</span>  <span class="comment">! no compression</span></div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;                    <span class="keywordflow">DO</span> k=kl,ku</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;                        j=<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+k)</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;                        b(j)=b(j)+real(<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(indij+k),mpd)*x(i)</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;                        b(i)=b(i)+real(<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(indij+k),mpd)*x(j)</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;                    lj=0</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;                    ku=((ku+1)*8)/9-1         <span class="comment">! number of regions (-1)</span></div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;                    indid=indid+ku/8+1        <span class="comment">! skip group offsets</span></div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;                    <span class="keywordflow">DO</span> kl=0,ku</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;                        jc=<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+kl)</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;                        j=ishft(jc,-iencdb)</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;                        jn=iand(jc, iencdm)</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a8d3078659555c21fda8d43de37c311de">mextnd</a>&gt;0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;                            <span class="comment">! extended storage</span></div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;                            <span class="keywordflow">DO</span> jj=1,jn</div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;                                b(i)=b(i)+real(<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(indij+lj),mpd)*x(j)</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;                                j=j+1</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;                                lj=lj+1</div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;<span class="keywordflow">                            END DO</span></div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;                        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;                            <span class="keywordflow">DO</span> jj=1,jn</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;                                b(j)=b(j)+real(<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(indij+lj),mpd)*x(i)</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;                                b(i)=b(i)+real(<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(indij+lj),mpd)*x(j)</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;                                j=j+1</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;                                lj=lj+1</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;<span class="keywordflow">                            END DO</span></div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;<span class="keywordflow">                        END IF</span>       </div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160; </div>
<div class="ttc" id="anamespacempmod_html_a1d26fb8a51a9907a0d5b96f7799b2873"><div class="ttname"><a href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">mpmod::matsto</a></div><div class="ttdeci">integer(mpi) matsto</div><div class="ttdoc">(global) matrix storage mode (1: full, 2: sparse)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00035">mpmod.f90:35</a></div></div>
<div class="ttc" id="anamespacempmod_html_a25cb0798e95628f518dd292ad182be59"><div class="ttname"><a href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">mpmod::sparsematrixcolumns</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable sparsematrixcolumns</div><div class="ttdoc">(compressed) list of columns for sparse matrix</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00230">mpmod.f90:230</a></div></div>
<div class="ttc" id="anamespacempmod_html_a273a17d00e4e3cee47b5435f75b77788"><div class="ttname"><a href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">mpmod::sparsematrixoffsets</a></div><div class="ttdeci">integer(mpl), dimension(:,:), allocatable sparsematrixoffsets</div><div class="ttdoc">row offsets for column list, sparse matrix elements</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00231">mpmod.f90:231</a></div></div>
<div class="ttc" id="anamespacempmod_html_a418f82bf6cdbb40027ea6d5ada0fc4dc"><div class="ttname"><a href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">mpmod::globalmatd</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable globalmatd</div><div class="ttdoc">global matrix 'A' (double, full or sparse)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00183">mpmod.f90:183</a></div></div>
<div class="ttc" id="anamespacempmod_html_a4ef9f014f98a92d810584e67f14f40ec"><div class="ttname"><a href="namespacempmod.html#a4ef9f014f98a92d810584e67f14f40ec">mpmod::nspc</a></div><div class="ttdeci">integer(mpi) nspc</div><div class="ttdoc">number of precision for sparse global matrix (1=D, 2=D+F)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00150">mpmod.f90:150</a></div></div>
<div class="ttc" id="anamespacempmod_html_a5af511204d09bc46ee6cb804dd82bd53"><div class="ttname"><a href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mpmod::mthrd</a></div><div class="ttdeci">integer(mpi) mthrd</div><div class="ttdoc">number of (OpenMP) threads</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00084">mpmod.f90:84</a></div></div>
<div class="ttc" id="anamespacempmod_html_a5f258a56ef64706cd0968dec98563b30"><div class="ttname"><a href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">mpmod::globalmatf</a></div><div class="ttdeci">real(mps), dimension(:), allocatable globalmatf</div><div class="ttdoc">global matrix 'A' (float part for compressed sparse)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00184">mpmod.f90:184</a></div></div>
<div class="ttc" id="anamespacempmod_html_a8d3078659555c21fda8d43de37c311de"><div class="ttname"><a href="namespacempmod.html#a8d3078659555c21fda8d43de37c311de">mpmod::mextnd</a></div><div class="ttdeci">integer(mpi) mextnd</div><div class="ttdoc">flag for extended storage (both 'halves' of sym. mat. for improved access patterns)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00083">mpmod.f90:83</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad7d459edc90892891995ccb3ac96b6f3"><div class="ttname"><a href="namespacempmod.html#ad7d459edc90892891995ccb3ac96b6f3">mpmod::nencdb</a></div><div class="ttdeci">integer(mpi) nencdb</div><div class="ttdoc">encoding info (number bits for column counter)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00151">mpmod.f90:151</a></div></div>
<div class="ttc" id="apede_8f90_html_a16ef8020d3ee5c0aa46a0cb5b1dceba8"><div class="ttname"><a href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a></div><div class="ttdeci">subroutine peend(icode, cmessage)</div><div class="ttdoc">Print exit code.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l08889">pede.f90:8890</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad7828f3b25225915586ac1d5a1a98206"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7828f3b25225915586ac1d5a1a98206">&#9670;&nbsp;</a></span>avprod()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine avprod </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), dimension(n), intent(in)&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), dimension(n), intent(out)&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Product symmetric matrix times vector. </p>
<p>A(sym) * X =&gt; B. Used by <a class="el" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">MINRES</a> method (Is most CPU intensive part). The matrix A is the global matrix in full symmetric or (compressed) sparse storage. Allows for size of X and smaller than size of matrix in case of solution with constriants by elimination.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>size of matrix ( &lt;= size of global matrix) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>vector X </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>result vector B </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04394">4394</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160; </div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160; </div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>          :: n</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(IN)</span>             :: x(n)</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(OUT)</span>            :: b(n)</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160; </div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    <span class="keywordflow">IF</span>(n &gt; <a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(24,<span class="stringliteral">&#39;Aborted, vector/matrix size mismatch&#39;</span>)</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;        stop <span class="stringliteral">&#39;AVPROD: mismatched vector and matrix&#39;</span></div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;    <span class="comment">! input to AVPRD0</span></div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;    <a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>(1:n)=x</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;    <a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>(n+1:<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>)=0.0_mpd</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;    <span class="keywordflow">IF</span>(n &lt; <a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>) <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>,1,.false.) <span class="comment">! Q*x</span></div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;    <span class="comment">! calclulate vecBav=globalMat*vecXav</span></div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,<a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>,<a class="code" href="namespacempmod.html#af1c41906f834bd434de691c18df074f8">vecbav</a>)</div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;    <span class="keywordflow">IF</span>(n &lt; <a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>) <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#af1c41906f834bd434de691c18df074f8">vecbav</a>,1,.true.) <span class="comment">! Q^t*x</span></div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;    <span class="comment">! output from AVPRD0</span></div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;    b=<a class="code" href="namespacempmod.html#af1c41906f834bd434de691c18df074f8">vecbav</a>(1:n)</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160; </div>
<div class="ttc" id="ampqldec_8f90_html_a3e522a08e6631a6147aeb68abfe93652"><div class="ttname"><a href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a></div><div class="ttdeci">subroutine qlmlq(x, m, t)</div><div class="ttdoc">Multiply left by Q(t).</div><div class="ttdef"><b>Definition:</b> <a href="mpqldec_8f90_source.html#l00282">mpqldec.f90:283</a></div></div>
<div class="ttc" id="anamespacempmod_html_adddb9f17136f5c963d2680cdf7040823"><div class="ttname"><a href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">mpmod::vecxav</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable vecxav</div><div class="ttdoc">vector x for AVPROD (A*x=b)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00188">mpmod.f90:188</a></div></div>
<div class="ttc" id="anamespacempmod_html_af1c41906f834bd434de691c18df074f8"><div class="ttname"><a href="namespacempmod.html#af1c41906f834bd434de691c18df074f8">mpmod::vecbav</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable vecbav</div><div class="ttdoc">vector b for AVPROD (A*x=b)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00189">mpmod.f90:189</a></div></div>
<div class="ttc" id="apede_8f90_html_a9531a8f5f9a2cde1c04ef76ea1620259"><div class="ttname"><a href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a></div><div class="ttdeci">subroutine avprd0(n, x, b)</div><div class="ttdoc">Product symmetric matrix times vector.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l04226">pede.f90:4227</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a050daae79bead3c51481f24efcd9be87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a050daae79bead3c51481f24efcd9be87">&#9670;&nbsp;</a></span>bincls()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine bincls </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>kfile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>ithr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close binary file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">kfile</td><td>file number </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ithr</td><td>thread number ([1..nthrd] - close and reopen) for C files </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l08987">8987</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l08988"></a><span class="lineno"> 8988</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l08989"></a><span class="lineno"> 8989</span>&#160; </div>
<div class="line"><a name="l08990"></a><span class="lineno"> 8990</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l08991"></a><span class="lineno"> 8991</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: kfile</div>
<div class="line"><a name="l08992"></a><span class="lineno"> 8992</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: ithr</div>
<div class="line"><a name="l08993"></a><span class="lineno"> 8993</span>&#160; </div>
<div class="line"><a name="l08994"></a><span class="lineno"> 8994</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l08995"></a><span class="lineno"> 8995</span>&#160;    </div>
<div class="line"><a name="l08996"></a><span class="lineno"> 8996</span>&#160;    lun=ithr</div>
<div class="line"><a name="l08997"></a><span class="lineno"> 8997</span>&#160;    <span class="comment">!print *, &quot; closing binary &quot;, kfile, ithr</span></div>
<div class="line"><a name="l08998"></a><span class="lineno"> 8998</span>&#160;    <span class="keywordflow">IF</span>(kfile &lt;= <a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a>) <span class="keywordflow">THEN</span> <span class="comment">! Fortran file</span></div>
<div class="line"><a name="l08999"></a><span class="lineno"> 8999</span>&#160;        lun=kfile+10 </div>
<div class="line"><a name="l09000"></a><span class="lineno"> 9000</span>&#160;        <span class="keyword">CLOSE</span>(lun)</div>
<div class="line"><a name="l09001"></a><span class="lineno"> 9001</span>&#160;<span class="preprocessor">#ifdef READ_C_FILES</span></div>
<div class="line"><a name="l09002"></a><span class="lineno"> 9002</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">ELSE</span> <span class="comment">! C file</span></div>
<div class="line"><a name="l09003"></a><span class="lineno"> 9003</span>&#160;        <span class="keyword">CALL </span>closec(lun)</div>
<div class="line"><a name="l09004"></a><span class="lineno"> 9004</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l09005"></a><span class="lineno"> 9005</span>&#160;<span class="preprocessor"></span><span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l09006"></a><span class="lineno"> 9006</span>&#160;    </div>
<div class="ttc" id="anamespacempmod_html_ad230bf8373d267fde45760392b60a9e6"><div class="ttname"><a href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">mpmod::nfilf</a></div><div class="ttdeci">integer(mpi) nfilf</div><div class="ttdoc">number of Fortran binary files</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00301">mpmod.f90:301</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aba466fbf4e152b7b0367a5cf63e8311c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba466fbf4e152b7b0367a5cf63e8311c">&#9670;&nbsp;</a></span>binopn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine binopn </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>kfile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>ithr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(out)&#160;</td>
          <td class="paramname"><em>ierr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open binary file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">kfile</td><td>file number </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ithr</td><td>thread number ([1..nthrd] - close and reopen) or 0 (next file - keep open) for C files </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ierr</td><td>error flag </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l08909">8909</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l08910"></a><span class="lineno"> 8910</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l08911"></a><span class="lineno"> 8911</span>&#160; </div>
<div class="line"><a name="l08912"></a><span class="lineno"> 8912</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l08913"></a><span class="lineno"> 8913</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: kfile</div>
<div class="line"><a name="l08914"></a><span class="lineno"> 8914</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: ithr</div>
<div class="line"><a name="l08915"></a><span class="lineno"> 8915</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(OUT)</span> :: ierr</div>
<div class="line"><a name="l08916"></a><span class="lineno"> 8916</span>&#160; </div>
<div class="line"><a name="l08917"></a><span class="lineno"> 8917</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(13)</span> :: ibuff</div>
<div class="line"><a name="l08918"></a><span class="lineno"> 8918</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioff</div>
<div class="line"><a name="l08919"></a><span class="lineno"> 8919</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ios</div>
<div class="line"><a name="l08920"></a><span class="lineno"> 8920</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l08921"></a><span class="lineno"> 8921</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lfn</div>
<div class="line"><a name="l08922"></a><span class="lineno"> 8922</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l08923"></a><span class="lineno"> 8923</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: moddate</div>
<div class="line"><a name="l08924"></a><span class="lineno"> 8924</span>&#160;    <span class="keywordtype">CHARACTER (LEN=1024)</span> :: fname</div>
<div class="line"><a name="l08925"></a><span class="lineno"> 8925</span>&#160; </div>
<div class="line"><a name="l08926"></a><span class="lineno"> 8926</span>&#160;    ierr=0</div>
<div class="line"><a name="l08927"></a><span class="lineno"> 8927</span>&#160;    lun=ithr</div>
<div class="line"><a name="l08928"></a><span class="lineno"> 8928</span>&#160;    <span class="comment">! modification date (=0: open for first time, &gt;0: reopen, &lt;0: unknown )</span></div>
<div class="line"><a name="l08929"></a><span class="lineno"> 8929</span>&#160;    moddate=<a class="code" href="namespacempmod.html#a2f93ff0ba78ec3d0cf2040a624913a19">yfd</a>(kfile) </div>
<div class="line"><a name="l08930"></a><span class="lineno"> 8930</span>&#160;    <span class="comment">! file name</span></div>
<div class="line"><a name="l08931"></a><span class="lineno"> 8931</span>&#160;    ioff=<a class="code" href="namespacempmod.html#a8d6f6c1c345293acfc79f34f94c78e1f">sfd</a>(1,kfile)</div>
<div class="line"><a name="l08932"></a><span class="lineno"> 8932</span>&#160;    lfn=<a class="code" href="namespacempmod.html#a8d6f6c1c345293acfc79f34f94c78e1f">sfd</a>(2,kfile)</div>
<div class="line"><a name="l08933"></a><span class="lineno"> 8933</span>&#160;    <span class="keywordflow">FORALL</span> (k=1:lfn) fname(k:k)=<a class="code" href="namespacempmod.html#aa4038b57cc5133652599ccafef6ab2c9">tfd</a>(ioff+k)</div>
<div class="line"><a name="l08934"></a><span class="lineno"> 8934</span>&#160;    <span class="comment">!print *, &quot; opening binary &quot;, kfile, ithr, moddate, &quot; : &quot;, fname(1:lfn)</span></div>
<div class="line"><a name="l08935"></a><span class="lineno"> 8935</span>&#160;    <span class="comment">! open</span></div>
<div class="line"><a name="l08936"></a><span class="lineno"> 8936</span>&#160;    ios=0 </div>
<div class="line"><a name="l08937"></a><span class="lineno"> 8937</span>&#160;    <span class="keywordflow">IF</span>(kfile &lt;= <a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08938"></a><span class="lineno"> 8938</span>&#160;        <span class="comment">! Fortran file</span></div>
<div class="line"><a name="l08939"></a><span class="lineno"> 8939</span>&#160;        lun=kfile+10 </div>
<div class="line"><a name="l08940"></a><span class="lineno"> 8940</span>&#160;        <span class="keyword">OPEN</span>(lun,file=fname(1:lfn),iostat=ios, form=<span class="stringliteral">&#39;UNFORMATTED&#39;</span>)</div>
<div class="line"><a name="l08941"></a><span class="lineno"> 8941</span>&#160;        print *, <span class="stringliteral">&#39; lun &#39;</span>, lun, ios</div>
<div class="line"><a name="l08942"></a><span class="lineno"> 8942</span>&#160;<span class="preprocessor">#ifdef READ_C_FILES</span></div>
<div class="line"><a name="l08943"></a><span class="lineno"> 8943</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08944"></a><span class="lineno"> 8944</span>&#160;        <span class="comment">! C file</span></div>
<div class="line"><a name="l08945"></a><span class="lineno"> 8945</span>&#160;        <span class="keyword">CALL </span>openc(fname(1:lfn),lun,ios)</div>
<div class="line"><a name="l08946"></a><span class="lineno"> 8946</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l08947"></a><span class="lineno"> 8947</span>&#160;<span class="preprocessor"></span>        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Opening of C-files not supported.&#39;</span></div>
<div class="line"><a name="l08948"></a><span class="lineno"> 8948</span>&#160;        ierr=1</div>
<div class="line"><a name="l08949"></a><span class="lineno"> 8949</span>&#160;        <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08950"></a><span class="lineno"> 8950</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l08951"></a><span class="lineno"> 8951</span>&#160;<span class="preprocessor"></span><span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l08952"></a><span class="lineno"> 8952</span>&#160;    <span class="keywordflow">IF</span>(ios /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08953"></a><span class="lineno"> 8953</span>&#160;        ierr=1</div>
<div class="line"><a name="l08954"></a><span class="lineno"> 8954</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Open error for file &#39;</span>,fname(1:lfn), ios</div>
<div class="line"><a name="l08955"></a><span class="lineno"> 8955</span>&#160;        <span class="keywordflow">IF</span> (moddate /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08956"></a><span class="lineno"> 8956</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(15,<span class="stringliteral">&#39;Aborted, open error(s) for binary files&#39;</span>)</div>
<div class="line"><a name="l08957"></a><span class="lineno"> 8957</span>&#160;            stop <span class="stringliteral">&#39;PEREAD: open error                                      &#39;</span></div>
<div class="line"><a name="l08958"></a><span class="lineno"> 8958</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l08959"></a><span class="lineno"> 8959</span>&#160;        <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08960"></a><span class="lineno"> 8960</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l08961"></a><span class="lineno"> 8961</span>&#160;    <span class="comment">! get status</span></div>
<div class="line"><a name="l08962"></a><span class="lineno"> 8962</span>&#160;    <span class="keyword">CALL </span>stat(fname(1:lfn),ibuff,ios)</div>
<div class="line"><a name="l08963"></a><span class="lineno"> 8963</span>&#160;    <span class="comment">!print *, &#39; STAT &#39;, ios, ibuff(10), moddate</span></div>
<div class="line"><a name="l08964"></a><span class="lineno"> 8964</span>&#160;    <span class="keywordflow">IF</span>(ios /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08965"></a><span class="lineno"> 8965</span>&#160;        ierr=1</div>
<div class="line"><a name="l08966"></a><span class="lineno"> 8966</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;STAT error for file &#39;</span>,fname(1:lfn), ios</div>
<div class="line"><a name="l08967"></a><span class="lineno"> 8967</span>&#160;        ibuff(10)=-1</div>
<div class="line"><a name="l08968"></a><span class="lineno"> 8968</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l08969"></a><span class="lineno"> 8969</span>&#160;    <span class="comment">! check/store modification date</span></div>
<div class="line"><a name="l08970"></a><span class="lineno"> 8970</span>&#160;    <span class="keywordflow">IF</span> (moddate /= 0) <span class="keywordflow">THEN</span>    </div>
<div class="line"><a name="l08971"></a><span class="lineno"> 8971</span>&#160;        <span class="keywordflow">IF</span> (ibuff(10) /= moddate) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08972"></a><span class="lineno"> 8972</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(19,<span class="stringliteral">&#39;Aborted, binary file(s) modified&#39;</span>)</div>
<div class="line"><a name="l08973"></a><span class="lineno"> 8973</span>&#160;            stop <span class="stringliteral">&#39;PEREAD: file modified                                   &#39;</span></div>
<div class="line"><a name="l08974"></a><span class="lineno"> 8974</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08975"></a><span class="lineno"> 8975</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08976"></a><span class="lineno"> 8976</span>&#160;        <a class="code" href="namespacempmod.html#a2f93ff0ba78ec3d0cf2040a624913a19">yfd</a>(kfile)=ibuff(10)</div>
<div class="line"><a name="l08977"></a><span class="lineno"> 8977</span>&#160;<span class="keywordflow">    END IF</span>          </div>
<div class="line"><a name="l08978"></a><span class="lineno"> 8978</span>&#160;    <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08979"></a><span class="lineno"> 8979</span>&#160; </div>
<div class="ttc" id="anamespacempmod_html_a2f93ff0ba78ec3d0cf2040a624913a19"><div class="ttname"><a href="namespacempmod.html#a2f93ff0ba78ec3d0cf2040a624913a19">mpmod::yfd</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable yfd</div><div class="ttdoc">binary file: modification date</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00294">mpmod.f90:294</a></div></div>
<div class="ttc" id="anamespacempmod_html_a8d6f6c1c345293acfc79f34f94c78e1f"><div class="ttname"><a href="namespacempmod.html#a8d6f6c1c345293acfc79f34f94c78e1f">mpmod::sfd</a></div><div class="ttdeci">integer(mpi), dimension(:,:), allocatable sfd</div><div class="ttdoc">offset (1,..), length (2,..) of binary file name in tfd</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00293">mpmod.f90:293</a></div></div>
<div class="ttc" id="anamespacempmod_html_aa4038b57cc5133652599ccafef6ab2c9"><div class="ttname"><a href="namespacempmod.html#aa4038b57cc5133652599ccafef6ab2c9">mpmod::tfd</a></div><div class="ttdeci">character, dimension(:), allocatable tfd</div><div class="ttdoc">file names (concatenation)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00297">mpmod.f90:297</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a337ebc7d0fe6a4a5525ef7851cfb2a38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a337ebc7d0fe6a4a5525ef7851cfb2a38">&#9670;&nbsp;</a></span>binrwd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine binrwd </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>kfile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Rewind binary file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">kfile</td><td>file number </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l09013">9013</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l09014"></a><span class="lineno"> 9014</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a> </div>
<div class="line"><a name="l09015"></a><span class="lineno"> 9015</span>&#160;    </div>
<div class="line"><a name="l09016"></a><span class="lineno"> 9016</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l09017"></a><span class="lineno"> 9017</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: kfile</div>
<div class="line"><a name="l09018"></a><span class="lineno"> 9018</span>&#160; </div>
<div class="line"><a name="l09019"></a><span class="lineno"> 9019</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l09020"></a><span class="lineno"> 9020</span>&#160;           </div>
<div class="line"><a name="l09021"></a><span class="lineno"> 9021</span>&#160;    <span class="comment">!print *, &quot; rewinding binary &quot;, kfile</span></div>
<div class="line"><a name="l09022"></a><span class="lineno"> 9022</span>&#160;    <span class="keywordflow">IF</span> (kfile &lt;= <a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l09023"></a><span class="lineno"> 9023</span>&#160;        lun=kfile+10</div>
<div class="line"><a name="l09024"></a><span class="lineno"> 9024</span>&#160;        rewind lun</div>
<div class="line"><a name="l09025"></a><span class="lineno"> 9025</span>&#160;<span class="preprocessor">#ifdef READ_C_FILES</span></div>
<div class="line"><a name="l09026"></a><span class="lineno"> 9026</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l09027"></a><span class="lineno"> 9027</span>&#160;        lun=kfile-<a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a></div>
<div class="line"><a name="l09028"></a><span class="lineno"> 9028</span>&#160;        <span class="keyword">CALL </span>resetc(lun)</div>
<div class="line"><a name="l09029"></a><span class="lineno"> 9029</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l09030"></a><span class="lineno"> 9030</span>&#160;<span class="preprocessor"></span><span class="keywordflow">    END IF</span> </div>
<div class="line"><a name="l09031"></a><span class="lineno"> 9031</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="ab5692a8832b068ae46126b2c0d8feeaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5692a8832b068ae46126b2c0d8feeaa">&#9670;&nbsp;</a></span>explfc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine explfc </td>
          <td>(</td>
          <td class="paramtype">integer(mpi)&#160;</td>
          <td class="paramname"><em>lunit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print explanation of iteration table. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02886">2886</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160; </div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lunit</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;    <span class="keyword">WRITE</span>(lunit,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;Explanation of iteration table&#39;</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;==============================&#39;</span></div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;it&#39;</span>,  &amp;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        <span class="stringliteral">&#39;iteration number. Global parameters are improved for it &gt; 0.&#39;</span></div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;First function evaluation is called iteraton 0.&#39;</span></div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;fc&#39;</span>, <span class="stringliteral">&#39;number of function evaluations.&#39;</span></div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;fcn_value&#39;</span>, <span class="stringliteral">&#39;value of 2 x Likelihood function (LF).&#39;</span></div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;The final value is the chi^2 value of the fit and should&#39;</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;be about equal to the NDF (see below).&#39;</span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;dfcn_exp&#39;</span>,  &amp;</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;        <span class="stringliteral">&#39;expected reduction of the value of the Likelihood function (LF)&#39;</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;slpr&#39;</span>, <span class="stringliteral">&#39;ratio of the actual slope to inital slope.&#39;</span></div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;costh&#39;</span>,  &amp;</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;        <span class="stringliteral">&#39;cosine of angle between search direction and -gradient&#39;</span></div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;        <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;iit&#39;</span>,  &amp;</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;            <span class="stringliteral">&#39;number of internal iterations in MINRES algorithm&#39;</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;        <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;st&#39;</span>, <span class="stringliteral">&#39;stop code of MINRES algorithm&#39;</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;&lt; 0:   rhs is very special, with beta2 = 0&#39;</span></div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 0:   rhs b = 0, i.e. the exact solution is  x = 0&#39;</span></div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 1    requested accuracy achieved, as determined by rtol&#39;</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 2    reasonable accuracy achieved, given eps&#39;</span></div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 3    x has converged to an eigenvector&#39;</span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 4    matrix ill-conditioned (Acond has exceeded 0.1/eps)&#39;</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 5    the iteration limit was reached&#39;</span></div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 6    Matrix x vector does not define a symmetric matrix&#39;</span></div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 7    Preconditioner does not define a symmetric matrix&#39;</span></div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;iit&#39;</span>,  &amp;</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;            <span class="stringliteral">&#39;number of internal iterations in MINRES-QLP algorithm&#39;</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;st&#39;</span>, <span class="stringliteral">&#39;stop code of MINRES-QLP algorithm&#39;</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 1: beta_{k+1} &lt; eps, iteration k is the final Lanczos step.&#39;</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 2: beta2 = 0.  If M = I, b and x are eigenvectors of A.&#39;</span></div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 3: beta1 = 0.  The exact solution is  x = 0.&#39;</span></div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 4: A solution to (poss. singular) Ax = b found, given rtol.&#39;</span></div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 5: A solution to (poss. singular) Ax = b found, given eps.&#39;</span></div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 6: Pseudoinverse solution for singular LS problem, given rtol.&#39;</span></div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 7: Pseudoinverse solution for singular LS problem, given eps.&#39;</span></div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 8: The iteration limit was reached.&#39;</span></div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 9: The operator defined by Aprod appears to be unsymmetric.&#39;</span></div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;=10: The operator defined by Msolve appears to be unsymmetric.&#39;</span></div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;=11: The operator defined by Msolve appears to be indefinite.&#39;</span></div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;=12: xnorm has exceeded maxxnorm or will exceed it next iteration.&#39;</span></div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;=13: Acond has exceeded Acondlim or 0.1/eps.&#39;</span></div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;=14: Least-squares problem but no converged solution yet.&#39;</span></div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;        <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;=15: A null vector obtained, given rtol.&#39;</span></div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;ls&#39;</span>, <span class="stringliteral">&#39;line search info&#39;</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;&lt; 0    recalculate function&#39;</span></div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 0:   N or STP lt 0 or step not descending&#39;</span></div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 1:   Linesearch convergence conditions reached&#39;</span></div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 2:   interval of uncertainty at lower limit&#39;</span></div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 3:   max nr of line search calls reached&#39;</span></div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 4:   step at the lower bound&#39;</span></div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 5:   step at the upper bound&#39;</span></div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;= 6:   rounding error limitation&#39;</span></div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;step&#39;</span>,  &amp;</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;        <span class="stringliteral">&#39;the factor for the Newton step during the line search. Usually&#39;</span></div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;    <span class="keyword">WRITE</span>(lunit,102)  &amp;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;        <span class="stringliteral">&#39;a value of 1 gives a sufficient reduction of the LF. Oherwise&#39;</span></div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;other step values are tried.&#39;</span></div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;cutf&#39;</span>,  &amp;</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;        <span class="stringliteral">&#39;cut factor. Local fits are rejected, if their chi^2 value&#39;</span></div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;    <span class="keyword">WRITE</span>(lunit,102)  &amp;</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        <span class="stringliteral">&#39;is larger than the 3-sigma chi^2 value times the cut factor.&#39;</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;A cut factor of 1 is used finally, but initially a larger&#39;</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;    <span class="keyword">WRITE</span>(lunit,102) <span class="stringliteral">&#39;factor may be used. A value of 0.0 means no cut.&#39;</span></div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;rejects&#39;</span>, <span class="stringliteral">&#39;total number of rejected local fits.&#39;</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;hmmsec&#39;</span>, <span class="stringliteral">&#39;the time in hours (h), minutes (mm) and seconds.&#39;</span></div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    <span class="keyword">WRITE</span>(lunit,101) <span class="stringliteral">&#39;FMS&#39;</span>, <span class="stringliteral">&#39;calculation of Function value, Matrix, Solution.&#39;</span></div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;    <span class="keyword">WRITE</span>(lunit,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160; </div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;101 <span class="keyword">FORMAT</span>(a9,<span class="stringliteral">&#39; =  &#39;</span>,a)</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;102 <span class="keyword">FORMAT</span>(13x,a)</div>
<div class="ttc" id="anamespacempmod_html_a10d5958e349af9b608e3126a783e3f97"><div class="ttname"><a href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">mpmod::metsol</a></div><div class="ttdeci">integer(mpi) metsol</div><div class="ttdoc">solution method (1: inversion, 2: diagonalization, 3: MINRES-QLP)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00034">mpmod.f90:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae0971beb43bf6994f05975fe8638e926"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0971beb43bf6994f05975fe8638e926">&#9670;&nbsp;</a></span>feasib()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine feasib </td>
          <td>(</td>
          <td class="paramtype">real(mps), intent(in)&#160;</td>
          <td class="paramname"><em>concut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(out)&#160;</td>
          <td class="paramname"><em>iact</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Make parameters feasible. </p>
<p>Correct for constraint equation discrepancies.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">concut</td><td>cut for discrepancies </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">iact</td><td>=1 if correction needed, else =0 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l01576">1576</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160; </div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: factr</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: sgm</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: icgb</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iter</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgb</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iblck</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ieblck</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isblck</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ifirst</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ilast</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jcgb</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: label</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inone</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncon</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160; </div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="keywordtype">    REAL</span>(mps), <span class="keywordtype">INTENT(IN)</span>     :: concut</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(OUT)</span> :: iact</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rhs</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="keywordtype">    REAL</span>(mpd) ::sum1</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="keywordtype">    REAL</span>(mpd) ::sum2</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="keywordtype">    REAL</span>(mpd) ::sum3</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160; </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: vecCorrections</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160; </div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    iact=0</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a> == 0) <span class="keywordflow">RETURN</span>  <span class="comment">! no constraints</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keywordflow">DO</span> iter=1,2</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        <a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>=0.0_mpd</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  </div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        <span class="comment">!      calculate right constraint equation discrepancies</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        <span class="keywordflow">DO</span> jcgb=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            icgb=<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(3,jcgb) <span class="comment">! unsorted constraint index</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            i=<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb)</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            rhs=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i  )%value <span class="comment">! right hand side</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            sgm=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i+1)%value <span class="comment">! sigma parameter</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;            <span class="keywordflow">DO</span> j=i+2,<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb+1)-1</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                label=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(j)%label</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                factr=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(j)%value</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                itgbi=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(label) <span class="comment">! -&gt; ITGBI= index of parameter label</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                rhs=rhs-factr*<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)     <span class="comment">! reduce residuum</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="keywordflow">            ENDDO</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;            <a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>(jcgb)=rhs        <span class="comment">! constraint discrepancy</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  </div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <span class="comment">!      constraint equation discrepancies -------------------------------</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  </div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        sum1=0.0_mpd</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        sum2=0.0_mpd</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        sum3=0.0_mpd</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <span class="keywordflow">DO</span> icgb=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            sum1=sum1+<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>(icgb)**2</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            sum2=sum2+abs(<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>(icgb))</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            sum3=max(sum3,abs(<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>(icgb)))</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        sum1=sqrt(sum1/real(<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>,mpd))</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        sum2=sum2/real(<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>,mpd)</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  </div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        <span class="keywordflow">IF</span>(iter == 1.AND.sum1 &lt; concut) <span class="keywordflow">RETURN</span>  <span class="comment">! do nothing if correction small</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        <span class="keywordflow">IF</span>(iter == 1.AND.<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a> &lt;= 12) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Constraint equation discrepancies:&#39;</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <span class="keyword">WRITE</span>(*,101) (icgb,<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>(icgb),icgb=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>)</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;101         <span class="keyword">FORMAT</span>(4x,4(i5,g12.4))</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            <span class="keyword">WRITE</span>(*,103) concut</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;103         <span class="keyword">FORMAT</span>(10x,<span class="stringliteral">&#39; Cut on rms value is&#39;</span>,g8.1)</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;  </div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        <span class="keywordflow">IF</span>(iact == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Improve constraints&#39;</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        iact=1</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;  </div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <span class="keyword">WRITE</span>(*,102) iter,sum1,sum2,sum3</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;102     <span class="keyword">FORMAT</span>(i6,<span class="stringliteral">&#39;   rms&#39;</span>,g12.4,<span class="stringliteral">&#39;  avrg_abs&#39;</span>,g12.4,<span class="stringliteral">&#39;  max_abs&#39;</span>,g12.4)</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;  </div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(veccorrections,int(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,mpl),<span class="stringliteral">&#39;constraint corrections&#39;</span>)</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        veccorrections=0.0_mpd</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160; </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="comment">!      multiply (block-wise) inverse matrix and constraint vector</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        isblck=0</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <span class="keywordflow">DO</span> iblck=1,<a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            ifirst=<a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(1,iblck)     <span class="comment">! first constraint in block</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;            ilast=<a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(1,iblck+1)-1  <span class="comment">! last constraint in block</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;            ncon=ilast+1-ifirst</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;            ieblck=isblck+(ncon*(ncon+1))/2</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#ae51d83946746b8fd144656d5c4ef8771">dbsvx</a>(<a class="code" href="namespacempmod.html#a2e994df1caaa49513db6d462ce5c5ef0">matconsproduct</a>(isblck+1:ieblck),<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>(ifirst:ilast),<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>(ifirst:ilast),ncon)</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;            isblck=ieblck</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="keywordflow">        END DO</span>    </div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160; </div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="keywordflow">DO</span> jcgb=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            icgb=<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(3,jcgb) <span class="comment">! unsorted constraint index</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;            i=<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb)</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;            rhs=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i  )%value <span class="comment">! right hand side</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;            sgm=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i+1)%value <span class="comment">! sigma parameter</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;            <span class="keywordflow">DO</span> j=i+2,<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb+1)-1</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                label=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(j)%label</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                factr=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(j)%value</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                itgbi=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(label) <span class="comment">! -&gt; ITGBI= index of parameter label</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                ivgb =<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi) <span class="comment">! -&gt; variable-parameter index</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                <span class="keywordflow">IF</span>(ivgb &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                    veccorrections(ivgb)=veccorrections(ivgb)+<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>(jcgb)*factr</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="keywordflow">            ENDDO</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160; </div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a> <span class="comment">! add corrections</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;            itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(i)</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;            <a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)=<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)+veccorrections(i)</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160; </div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(veccorrections)</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="keywordflow">    END DO</span> <span class="comment">! iteration 1 and 2</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160; </div>
<div class="ttc" id="ampnum_8f90_html_ae51d83946746b8fd144656d5c4ef8771"><div class="ttname"><a href="mpnum_8f90.html#ae51d83946746b8fd144656d5c4ef8771">dbsvx</a></div><div class="ttdeci">subroutine dbsvx(v, a, b, n)</div><div class="ttdoc">Product symmetric matrix, vector.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l01152">mpnum.f90:1153</a></div></div>
<div class="ttc" id="anamespacempmod_html_a2e994df1caaa49513db6d462ce5c5ef0"><div class="ttname"><a href="namespacempmod.html#a2e994df1caaa49513db6d462ce5c5ef0">mpmod::matconsproduct</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable matconsproduct</div><div class="ttdoc">product matrix of constraints</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00202">mpmod.f90:202</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6b38b041e17c62cce3f1514687414691"><div class="ttname"><a href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">mpmod::vecconssolution</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable vecconssolution</div><div class="ttdoc">solution for constraint elimination</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00204">mpmod.f90:204</a></div></div>
<div class="ttc" id="anamespacempmod_html_a7ea61583b25121f0b2a93431b46abe1d"><div class="ttname"><a href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">mpmod::ncblck</a></div><div class="ttdeci">integer(mpi) ncblck</div><div class="ttdoc">number of (disjoint) constraint blocks</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00123">mpmod.f90:123</a></div></div>
<div class="ttc" id="anamespacempmod_html_a9f40327b7480f15ae2a445c2d84c2dce"><div class="ttname"><a href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">mpmod::globalparvartototal</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable globalparvartototal</div><div class="ttdoc">global parameters variable -&gt; total index</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00216">mpmod.f90:216</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad0f4ab2196b482dcb225f864b1990ef0"><div class="ttname"><a href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">mpmod::matconsblocks</a></div><div class="ttdeci">integer(mpi), dimension(:,:), allocatable matconsblocks</div><div class="ttdoc">start of constraint blocks, parameter range</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00208">mpmod.f90:208</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1d4e59446f937fc13d1441c9af06b212"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d4e59446f937fc13d1441c9af06b212">&#9670;&nbsp;</a></span>feasma()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine feasma</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Matrix for feasible solution. </p>
<p>Check rank of product matrix of constraints. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l01427">1427</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160; </div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: factr</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: sgm</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iblck</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: icgb</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ij</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ifirst</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ilast</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioffc</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioffp</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: irank</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ipar0</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgb</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jcgb</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: l</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: label</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncon</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: npar</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrank</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inone</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160; </div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="keywordtype">    REAL</span>(mpd):: rhs</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="keywordtype">    REAL</span>(mpd):: evmax</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="keywordtype">    REAL</span>(mpd):: evmin</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: length</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: matConstraintsT</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: auxVectorD</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: auxVectorI</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160; </div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a> == 0) <span class="keywordflow">RETURN</span>  <span class="comment">! no constraints</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160; </div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="comment">! QL decomposition</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#aec5d93860187b4a5c271ad2e955f19fc">qlini</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>)</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="comment">!     product matrix A A^T (A is stored as transposed)</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    length=<a class="code" href="namespacempmod.html#a757ff82bb004a2ac99fc745d44e1dc7c">mszprd</a></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a2e994df1caaa49513db6d462ce5c5ef0">matconsproduct</a>, length, <span class="stringliteral">&#39;product matrix of constraints (blocks)&#39;</span>)</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <a class="code" href="namespacempmod.html#a2e994df1caaa49513db6d462ce5c5ef0">matconsproduct</a>=0.0_mpd</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    length=<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>, length, <span class="stringliteral">&#39;residuals of constraints&#39;</span>)</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>, length, <span class="stringliteral">&#39;solution for constraints&#39;</span>)</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(auxvectori,length,<span class="stringliteral">&#39;auxiliary array (I)&#39;</span>)  <span class="comment">! int aux 1</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(auxvectord,length,<span class="stringliteral">&#39;auxiliary array (D)&#39;</span>)  <span class="comment">! double aux 1</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="comment">!     constraint matrix A (A is stored as transposed)</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    length = <a class="code" href="namespacempmod.html#ad32c2d7b939231b33b0be6888bab16ff">mszcon</a></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(matconstraintst,length,<span class="stringliteral">&#39;transposed matrix of constraints (blocks)&#39;</span>)</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    matconstraintst=0.0_mpd</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;       </div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="comment">! loop over sorted constraints, fill matrices, get rank, inverted product matrix (in blocks)</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    ioffc=0 <span class="comment">! block offset in constraint matrix</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    ioffp=0 <span class="comment">! block offset in product matrix</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    nrank=0</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keywordflow">DO</span> iblck=1,<a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        ifirst=<a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(1,iblck)     <span class="comment">! first constraint in block</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        ilast=<a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(1,iblck+1)-1  <span class="comment">! last constraint in block</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        ncon=ilast+1-ifirst               </div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        ipar0=<a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(2,iblck)-1    <span class="comment">! parameter offset</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        npar=<a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(3,iblck)-ipar0 <span class="comment">! number of parameters</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="keywordflow">DO</span> jcgb=ifirst,ilast</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            <span class="comment">! index in list </span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            icgb=<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(3,jcgb)</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            <span class="comment">! fill constraint matrix</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            i=<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb)</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            rhs=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i  )%value <span class="comment">! right hand side</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            sgm=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i+1)%value <span class="comment">! sigma parameter</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;            <span class="keywordflow">DO</span> j=i+2,<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb+1)-1</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                label=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(j)%label</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                factr=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(j)%value</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                itgbi=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(label) <span class="comment">! -&gt; ITGBI= index of parameter label</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                ivgb =<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi) <span class="comment">! -&gt; variable-parameter index</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                <span class="keywordflow">IF</span>(ivgb &gt; 0) matconstraintst(ivgb-ipar0+ioffc+(jcgb-ifirst)*npar)=factr <span class="comment">! matrix element</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                <a class="code" href="namespacempmod.html#af4b661118569bdd0c6776a5f76dbf8c0">globalparcons</a>(itgbi)=<a class="code" href="namespacempmod.html#af4b661118569bdd0c6776a5f76dbf8c0">globalparcons</a>(itgbi)+1</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                rhs=rhs-factr*<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)     <span class="comment">! reduce residuum</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            <a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>(jcgb)=rhs        <span class="comment">! constraint discrepancy</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        </div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        <span class="comment">! get rank of blocks</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        <span class="keywordflow">DO</span> l=ioffc+1,ioffc+npar</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;            ij=ioffp</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            <span class="keywordflow">DO</span> i=1,ncon</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                <span class="keywordflow">DO</span> j=1,i</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                    ij=ij+1</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                    <a class="code" href="namespacempmod.html#a2e994df1caaa49513db6d462ce5c5ef0">matconsproduct</a>(ij)=<a class="code" href="namespacempmod.html#a2e994df1caaa49513db6d462ce5c5ef0">matconsproduct</a>(ij)+matconstraintst((i-1)*npar+l)*matconstraintst((j-1)*npar+l)</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        <span class="comment">!     inversion of product matrix of constraints</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a92f02ed4dc87864fa0b65cec04e4c9e3">sqminv</a>(<a class="code" href="namespacempmod.html#a2e994df1caaa49513db6d462ce5c5ef0">matconsproduct</a>(ioffp+1:ij),<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>(ifirst:ilast),ncon,irank, auxvectord, auxvectori)</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 1) <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; Constraint block rank&#39;</span>, iblck, ncon, irank</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        nrank=nrank+irank</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        ioffc=ioffc+npar*ncon</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        ioffp=ij   </div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="keywordflow">    END DO</span>          </div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160; </div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <a class="code" href="namespacempmod.html#a5166bef83080484149414b730f3770e8">nmiss1</a>=<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>-nrank</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160; </div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Rank of product matrix of constraints is&#39;</span>,nrank,  &amp;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="stringliteral">&#39; for&#39;</span>,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>,<span class="stringliteral">&#39; constraint equations&#39;</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    <span class="keyword">WRITE</span>(8,*) <span class="stringliteral">&#39;Rank of product matrix of constraints is&#39;</span>,nrank,  &amp;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        <span class="stringliteral">&#39; for&#39;</span>,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>,<span class="stringliteral">&#39; constraint equations&#39;</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keywordflow">IF</span>(nrank &lt; <a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Warning: insufficient constraint equations!&#39;</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        <span class="keyword">WRITE</span>(8,*) <span class="stringliteral">&#39;Warning: insufficient constraint equations!&#39;</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a9da797a9827200adb3f0bc7f66769ec8">iforce</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            <a class="code" href="namespacempmod.html#ab949b3b527978632aa8cf4dd409d94af">isubit</a>=1</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;         --&gt; enforcing SUBITO mode&#39;</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            <span class="keyword">WRITE</span>(8,*) <span class="stringliteral">&#39;         --&gt; enforcing SUBITO mode&#39;</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;     </div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    <span class="comment">! QL decomposition</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        print *</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        print *, <span class="stringliteral">&#39;QL decomposition of constraints matrix&#39;</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a1fea69926a9f527ad732f4b41ab8ef5a">qldecb</a>(matconstraintst,<a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>,<a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>)</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="comment">! check eignevalues of L</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#aa0be486c55b3a9494b2ff41ebd1c9a9a">qlgete</a>(evmin,evmax)</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        print *, <span class="stringliteral">&#39;   largest  |eigenvalue| of L: &#39;</span>, evmax</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        print *, <span class="stringliteral">&#39;   smallest |eigenvalue| of L: &#39;</span>, evmin</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        <span class="keywordflow">IF</span> (evmin == 0.0_mpd) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(27,<span class="stringliteral">&#39;Aborted, singular QL decomposition of constraints matrix&#39;</span>)</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            stop <span class="stringliteral">&#39;FEASMA: stopping due to singular QL decomposition of constraints matrix&#39;</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="keywordflow">        END IF</span>    </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160; </div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(matconstraintst)</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(auxvectord)</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(auxvectori)</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160; </div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">RETURN</span></div>
<div class="ttc" id="ampnum_8f90_html_a92f02ed4dc87864fa0b65cec04e4c9e3"><div class="ttname"><a href="mpnum_8f90.html#a92f02ed4dc87864fa0b65cec04e4c9e3">sqminv</a></div><div class="ttdeci">subroutine sqminv(v, b, n, nrank, diag, next)</div><div class="ttdoc">Matrix inversion and solution.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l00093">mpnum.f90:94</a></div></div>
<div class="ttc" id="ampqldec_8f90_html_a1fea69926a9f527ad732f4b41ab8ef5a"><div class="ttname"><a href="mpqldec_8f90.html#a1fea69926a9f527ad732f4b41ab8ef5a">qldecb</a></div><div class="ttdeci">subroutine qldecb(a, nb, b)</div><div class="ttdoc">QL decomposition (for disjoint block matrix).</div><div class="ttdef"><b>Definition:</b> <a href="mpqldec_8f90_source.html#l00162">mpqldec.f90:163</a></div></div>
<div class="ttc" id="ampqldec_8f90_html_aa0be486c55b3a9494b2ff41ebd1c9a9a"><div class="ttname"><a href="mpqldec_8f90.html#aa0be486c55b3a9494b2ff41ebd1c9a9a">qlgete</a></div><div class="ttdeci">subroutine qlgete(emin, emax)</div><div class="ttdoc">Get eigenvalues.</div><div class="ttdef"><b>Definition:</b> <a href="mpqldec_8f90_source.html#l00601">mpqldec.f90:602</a></div></div>
<div class="ttc" id="ampqldec_8f90_html_aec5d93860187b4a5c271ad2e955f19fc"><div class="ttname"><a href="mpqldec_8f90.html#aec5d93860187b4a5c271ad2e955f19fc">qlini</a></div><div class="ttdeci">subroutine qlini(n, m)</div><div class="ttdoc">Initialize QL decomposition.</div><div class="ttdef"><b>Definition:</b> <a href="mpqldec_8f90_source.html#l00044">mpqldec.f90:45</a></div></div>
<div class="ttc" id="anamespacempmod_html_a376d0f92a8cc5b0dcb21f941c701013e"><div class="ttname"><a href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">mpmod::nfgb</a></div><div class="ttdeci">integer(mpi) nfgb</div><div class="ttdoc">number of fit parameters</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00120">mpmod.f90:120</a></div></div>
<div class="ttc" id="anamespacempmod_html_a3a46c2c458b2d5934aef13d8b80fa540"><div class="ttname"><a href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">mpmod::icheck</a></div><div class="ttdeci">integer(mpi) icheck</div><div class="ttdoc">flag for checking input only (no solution determined)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00103">mpmod.f90:103</a></div></div>
<div class="ttc" id="anamespacempmod_html_a5166bef83080484149414b730f3770e8"><div class="ttname"><a href="namespacempmod.html#a5166bef83080484149414b730f3770e8">mpmod::nmiss1</a></div><div class="ttdeci">integer(mpi) nmiss1</div><div class="ttdoc">rank deficit for constraints</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00147">mpmod.f90:147</a></div></div>
<div class="ttc" id="anamespacempmod_html_a757ff82bb004a2ac99fc745d44e1dc7c"><div class="ttname"><a href="namespacempmod.html#a757ff82bb004a2ac99fc745d44e1dc7c">mpmod::mszprd</a></div><div class="ttdeci">integer(mpi) mszprd</div><div class="ttdoc">(integrated block) matrix size for (constraint) product matrix</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00125">mpmod.f90:125</a></div></div>
<div class="ttc" id="anamespacempmod_html_a9da797a9827200adb3f0bc7f66769ec8"><div class="ttname"><a href="namespacempmod.html#a9da797a9827200adb3f0bc7f66769ec8">mpmod::iforce</a></div><div class="ttdeci">integer(mpi) iforce</div><div class="ttdoc">switch to SUBITO for (global) rank defects if zero</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00094">mpmod.f90:94</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab949b3b527978632aa8cf4dd409d94af"><div class="ttname"><a href="namespacempmod.html#ab949b3b527978632aa8cf4dd409d94af">mpmod::isubit</a></div><div class="ttdeci">integer(mpi) isubit</div><div class="ttdoc">subito flag '-s'</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00057">mpmod.f90:57</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad32c2d7b939231b33b0be6888bab16ff"><div class="ttname"><a href="namespacempmod.html#ad32c2d7b939231b33b0be6888bab16ff">mpmod::mszcon</a></div><div class="ttdeci">integer(mpi) mszcon</div><div class="ttdoc">(integrated block) matrix size for constraint matrix</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00124">mpmod.f90:124</a></div></div>
<div class="ttc" id="anamespacempmod_html_af4b661118569bdd0c6776a5f76dbf8c0"><div class="ttname"><a href="namespacempmod.html#af4b661118569bdd0c6776a5f76dbf8c0">mpmod::globalparcons</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable globalparcons</div><div class="ttdoc">global parameters (number of) constraints</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00181">mpmod.f90:181</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adfb4549b5a1993c24c6af9021688debd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfb4549b5a1993c24c6af9021688debd">&#9670;&nbsp;</a></span>filetc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine filetc</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interprete command line option, steering file. </p>
<p>Fetch and interprete command line options, if steering file specified, check file existence (calling NUFILE)</p>
<p>If no steering file specified, check default steering file.</p>
<p>Create test files for command line option '-t'.</p>
<p>Read steering file, print some lines, detect names of text and binary files, check file existence, store all file names.</p>
<p>Open all binary files. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l07283">7283</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l07284"></a><span class="lineno"> 7284</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l07285"></a><span class="lineno"> 7285</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l07286"></a><span class="lineno"> 7286</span>&#160; </div>
<div class="line"><a name="l07287"></a><span class="lineno"> 7287</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l07288"></a><span class="lineno"> 7288</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ia</div>
<div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iargc</div>
<div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ib</div>
<div class="line"><a name="l07292"></a><span class="lineno"> 7292</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ie</div>
<div class="line"><a name="l07293"></a><span class="lineno"> 7293</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ierrf</div>
<div class="line"><a name="l07294"></a><span class="lineno"> 7294</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ieq</div>
<div class="line"><a name="l07295"></a><span class="lineno"> 7295</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ifilb</div>
<div class="line"><a name="l07296"></a><span class="lineno"> 7296</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioff</div>
<div class="line"><a name="l07297"></a><span class="lineno"> 7297</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iopt</div>
<div class="line"><a name="l07298"></a><span class="lineno"> 7298</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ios</div>
<div class="line"><a name="l07299"></a><span class="lineno"> 7299</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iosum</div>
<div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: it</div>
<div class="line"><a name="l07301"></a><span class="lineno"> 7301</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l07302"></a><span class="lineno"> 7302</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: mat</div>
<div class="line"><a name="l07303"></a><span class="lineno"> 7303</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nab</div>
<div class="line"><a name="l07304"></a><span class="lineno"> 7304</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nline</div>
<div class="line"><a name="l07305"></a><span class="lineno"> 7305</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: npat</div>
<div class="line"><a name="l07306"></a><span class="lineno"> 7306</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ntext</div>
<div class="line"><a name="l07307"></a><span class="lineno"> 7307</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nu</div>
<div class="line"><a name="l07308"></a><span class="lineno"> 7308</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nuf</div>
<div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nums</div>
<div class="line"><a name="l07310"></a><span class="lineno"> 7310</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nufile</div>
<div class="line"><a name="l07311"></a><span class="lineno"> 7311</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lenfileInfo</div>
<div class="line"><a name="l07312"></a><span class="lineno"> 7312</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lenFileNames</div>
<div class="line"><a name="l07313"></a><span class="lineno"> 7313</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: matint</div>
<div class="line"><a name="l07314"></a><span class="lineno"> 7314</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: vecfileInfo</div>
<div class="line"><a name="l07315"></a><span class="lineno"> 7315</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: tempArray</div>
<div class="line"><a name="l07316"></a><span class="lineno"> 7316</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: rows</div>
<div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: cols</div>
<div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: newcols</div>
<div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: length</div>
<div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160; </div>
<div class="line"><a name="l07321"></a><span class="lineno"> 7321</span>&#160;    <span class="keywordtype">CHARACTER (LEN=1024)</span> :: text</div>
<div class="line"><a name="l07322"></a><span class="lineno"> 7322</span>&#160;    <span class="keywordtype">CHARACTER (LEN=1024)</span> :: fname</div>
<div class="line"><a name="l07323"></a><span class="lineno"> 7323</span>&#160;    <span class="keywordtype">CHARACTER (LEN=14)</span> :: bite(3)</div>
<div class="line"><a name="l07324"></a><span class="lineno"> 7324</span>&#160;    <span class="keywordtype">CHARACTER (LEN=32)</span> :: keystx</div>
<div class="line"><a name="l07325"></a><span class="lineno"> 7325</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: dnum(100)</div>
<div class="line"><a name="l07326"></a><span class="lineno"> 7326</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l07327"></a><span class="lineno"> 7327</span>&#160;    <span class="keyword">DATA</span> bite/<span class="stringliteral">&#39;C_binary&#39;</span>,<span class="stringliteral">&#39;text  &#39;</span>,<span class="stringliteral">&#39;Fortran_binary&#39;</span>/</div>
<div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9c76d03bc0e3c3a55898cf60cf1fbdcc">mstart</a>(<span class="stringliteral">&#39;FILETC/X&#39;</span>)</div>
<div class="line"><a name="l07330"></a><span class="lineno"> 7330</span>&#160; </div>
<div class="line"><a name="l07331"></a><span class="lineno"> 7331</span>&#160;    nuf=1  <span class="comment">! C binary is default</span></div>
<div class="line"><a name="l07332"></a><span class="lineno"> 7332</span>&#160;    <span class="keywordflow">DO</span> i=1,8</div>
<div class="line"><a name="l07333"></a><span class="lineno"> 7333</span>&#160;        <a class="code" href="namespacempmod.html#a5f983528b5d86943f47bbe7921fa4db2">times</a>(i)=0.0</div>
<div class="line"><a name="l07334"></a><span class="lineno"> 7334</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07335"></a><span class="lineno"> 7335</span>&#160; </div>
<div class="line"><a name="l07336"></a><span class="lineno"> 7336</span>&#160;    <span class="comment">!     read command line options ----------------------------------------</span></div>
<div class="line"><a name="l07337"></a><span class="lineno"> 7337</span>&#160; </div>
<div class="line"><a name="l07338"></a><span class="lineno"> 7338</span>&#160;    <a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a>=<span class="stringliteral">&#39; &#39;</span>   <span class="comment">! print command line options and find steering file</span></div>
<div class="line"><a name="l07339"></a><span class="lineno"> 7339</span>&#160;    <span class="keywordflow">DO</span> i=1,iargc()</div>
<div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160;        <span class="keywordflow">IF</span>(i == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07342"></a><span class="lineno"> 7342</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Command line options: &#39;</span></div>
<div class="line"><a name="l07343"></a><span class="lineno"> 7343</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;--------------------- &#39;</span></div>
<div class="line"><a name="l07344"></a><span class="lineno"> 7344</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07345"></a><span class="lineno"> 7345</span>&#160;        <span class="keyword">CALL </span>getarg(i,text)         <span class="comment">! get I.th text from command line</span></div>
<div class="line"><a name="l07346"></a><span class="lineno"> 7346</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#af6e4dfef4c87d0f39a54dab2f6b210d3">rltext</a>(text,ia,ib,nab) <span class="comment">! return indices for non-blank area</span></div>
<div class="line"><a name="l07347"></a><span class="lineno"> 7347</span>&#160;        <span class="keyword">WRITE</span>(*,101) i,text(1:nab)  <span class="comment">! echo print</span></div>
<div class="line"><a name="l07348"></a><span class="lineno"> 7348</span>&#160;        <span class="keywordflow">IF</span>(text(ia:ia) /= <span class="stringliteral">&#39;-&#39;</span>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07349"></a><span class="lineno"> 7349</span>&#160;            nu=<a class="code" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a>(text(ia:ib))   <span class="comment">! inquire on file existence</span></div>
<div class="line"><a name="l07350"></a><span class="lineno"> 7350</span>&#160;            <span class="keywordflow">IF</span>(nu == 2) <span class="keywordflow">THEN</span>         <span class="comment">! existing text file</span></div>
<div class="line"><a name="l07351"></a><span class="lineno"> 7351</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a> /= <span class="stringliteral">&#39; &#39;</span>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07352"></a><span class="lineno"> 7352</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Second text file in command line - stop&#39;</span></div>
<div class="line"><a name="l07353"></a><span class="lineno"> 7353</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(12,<span class="stringliteral">&#39;Aborted, second text file in command line&#39;</span>)</div>
<div class="line"><a name="l07354"></a><span class="lineno"> 7354</span>&#160;                    stop</div>
<div class="line"><a name="l07355"></a><span class="lineno"> 7355</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07356"></a><span class="lineno"> 7356</span>&#160;                    <a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a>=text</div>
<div class="line"><a name="l07357"></a><span class="lineno"> 7357</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l07358"></a><span class="lineno"> 7358</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07359"></a><span class="lineno"> 7359</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Open error for file:&#39;</span>,text(ia:ib),<span class="stringliteral">&#39; - stop&#39;</span></div>
<div class="line"><a name="l07360"></a><span class="lineno"> 7360</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(16,<span class="stringliteral">&#39;Aborted, open error for file&#39;</span>)</div>
<div class="line"><a name="l07361"></a><span class="lineno"> 7361</span>&#160;                stop</div>
<div class="line"><a name="l07362"></a><span class="lineno"> 7362</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07363"></a><span class="lineno"> 7363</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07364"></a><span class="lineno"> 7364</span>&#160;            <span class="keywordflow">IF</span>(index(text(ia:ib),<span class="stringliteral">&#39;b&#39;</span>) /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07365"></a><span class="lineno"> 7365</span>&#160;                <a class="code" href="namespacempmod.html#a2d27f879e65ac6d07b201c81c8cdf122">mdebug</a>=3 <span class="comment">! debug flag</span></div>
<div class="line"><a name="l07366"></a><span class="lineno"> 7366</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Debugging requested&#39;</span></div>
<div class="line"><a name="l07367"></a><span class="lineno"> 7367</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07368"></a><span class="lineno"> 7368</span>&#160;            it=index(text(ia:ib),<span class="stringliteral">&#39;t&#39;</span>)</div>
<div class="line"><a name="l07369"></a><span class="lineno"> 7369</span>&#160;            <span class="keywordflow">IF</span>(it /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07370"></a><span class="lineno"> 7370</span>&#160;                <a class="code" href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">ictest</a>=1  <span class="comment">! internal test files</span></div>
<div class="line"><a name="l07371"></a><span class="lineno"> 7371</span>&#160;                ieq=index(text(ia+it:ib),<span class="stringliteral">&#39;=&#39;</span>)+it</div>
<div class="line"><a name="l07372"></a><span class="lineno"> 7372</span>&#160;                <span class="keywordflow">IF</span> (it /= ieq) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07373"></a><span class="lineno"> 7373</span>&#160;                    <span class="keywordflow">IF</span> (index(text(ia+ieq:ib),<span class="stringliteral">&#39;SL0&#39;</span> ) /= 0) <a class="code" href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">ictest</a>=2</div>
<div class="line"><a name="l07374"></a><span class="lineno"> 7374</span>&#160;                    <span class="keywordflow">IF</span> (index(text(ia+ieq:ib),<span class="stringliteral">&#39;SLE&#39;</span> ) /= 0) <a class="code" href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">ictest</a>=3</div>
<div class="line"><a name="l07375"></a><span class="lineno"> 7375</span>&#160;                    <span class="keywordflow">IF</span> (index(text(ia+ieq:ib),<span class="stringliteral">&#39;BP&#39;</span>  ) /= 0) <a class="code" href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">ictest</a>=4</div>
<div class="line"><a name="l07376"></a><span class="lineno"> 7376</span>&#160;                    <span class="keywordflow">IF</span> (index(text(ia+ieq:ib),<span class="stringliteral">&#39;BRLF&#39;</span>) /= 0) <a class="code" href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">ictest</a>=5</div>
<div class="line"><a name="l07377"></a><span class="lineno"> 7377</span>&#160;                    <span class="keywordflow">IF</span> (index(text(ia+ieq:ib),<span class="stringliteral">&#39;BRLC&#39;</span>) /= 0) <a class="code" href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">ictest</a>=6</div>
<div class="line"><a name="l07378"></a><span class="lineno"> 7378</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l07379"></a><span class="lineno"> 7379</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07380"></a><span class="lineno"> 7380</span>&#160;            <span class="keywordflow">IF</span>(index(text(ia:ib),<span class="stringliteral">&#39;s&#39;</span>) /= 0) <a class="code" href="namespacempmod.html#ab949b3b527978632aa8cf4dd409d94af">isubit</a>=1  <span class="comment">! like &quot;subito&quot;</span></div>
<div class="line"><a name="l07381"></a><span class="lineno"> 7381</span>&#160;            <span class="keywordflow">IF</span>(index(text(ia:ib),<span class="stringliteral">&#39;f&#39;</span>) /= 0) <a class="code" href="namespacempmod.html#a9da797a9827200adb3f0bc7f66769ec8">iforce</a>=1  <span class="comment">! like &quot;force&quot;</span></div>
<div class="line"><a name="l07382"></a><span class="lineno"> 7382</span>&#160;            <span class="keywordflow">IF</span>(index(text(ia:ib),<span class="stringliteral">&#39;c&#39;</span>) /= 0) <a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a>=1  <span class="comment">! like &quot;checkinput&quot;</span></div>
<div class="line"><a name="l07383"></a><span class="lineno"> 7383</span>&#160;            <span class="keywordflow">IF</span>(index(text(ia:ib),<span class="stringliteral">&#39;C&#39;</span>) /= 0) <a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a>=2  <span class="comment">! like &quot;checkinput 2&quot;</span></div>
<div class="line"><a name="l07384"></a><span class="lineno"> 7384</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07385"></a><span class="lineno"> 7385</span>&#160;        <span class="keywordflow">IF</span>(i == iargc()) <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;--------------------- &#39;</span></div>
<div class="line"><a name="l07386"></a><span class="lineno"> 7386</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07387"></a><span class="lineno"> 7387</span>&#160; </div>
<div class="line"><a name="l07388"></a><span class="lineno"> 7388</span>&#160; </div>
<div class="line"><a name="l07389"></a><span class="lineno"> 7389</span>&#160;    <span class="comment">!     create test files for option -t ----------------------------------</span></div>
<div class="line"><a name="l07390"></a><span class="lineno"> 7390</span>&#160; </div>
<div class="line"><a name="l07391"></a><span class="lineno"> 7391</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">ictest</a> &gt;= 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07392"></a><span class="lineno"> 7392</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07393"></a><span class="lineno"> 7393</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">ictest</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07394"></a><span class="lineno"> 7394</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mptest1_8f90.html#a8c5b9c098eff5b00bf89fa896b0d8d6d">mptest</a> <span class="comment">! &#39;wire chamber&#39;</span></div>
<div class="line"><a name="l07395"></a><span class="lineno"> 7395</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07396"></a><span class="lineno"> 7396</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mptest2_8f90.html#a23987ca5e0bf06d8b1325b9efddb4cc6">mptst2</a>(<a class="code" href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">ictest</a>-2) <span class="comment">! &#39;silicon tracker&#39;</span></div>
<div class="line"><a name="l07397"></a><span class="lineno"> 7397</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07398"></a><span class="lineno"> 7398</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a> == <span class="stringliteral">&#39; &#39;</span>) <a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a>=<span class="stringliteral">&#39;mp2str.txt&#39;</span></div>
<div class="line"><a name="l07399"></a><span class="lineno"> 7399</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07400"></a><span class="lineno"> 7400</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07401"></a><span class="lineno"> 7401</span>&#160; </div>
<div class="line"><a name="l07402"></a><span class="lineno"> 7402</span>&#160;    <span class="comment">!     check default steering file with file-name &quot;steerfile&quot; -----------</span></div>
<div class="line"><a name="l07403"></a><span class="lineno"> 7403</span>&#160; </div>
<div class="line"><a name="l07404"></a><span class="lineno"> 7404</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a> == <span class="stringliteral">&#39; &#39;</span>) <span class="keywordflow">THEN</span>  <span class="comment">! check default steering file</span></div>
<div class="line"><a name="l07405"></a><span class="lineno"> 7405</span>&#160;        text=<span class="stringliteral">&#39;steerfile&#39;</span></div>
<div class="line"><a name="l07406"></a><span class="lineno"> 7406</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#af6e4dfef4c87d0f39a54dab2f6b210d3">rltext</a>(text,ia,ib,nab) <span class="comment">! return indices for non-blank area</span></div>
<div class="line"><a name="l07407"></a><span class="lineno"> 7407</span>&#160;        nu=<a class="code" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a>(text(ia:ib))      <span class="comment">! inquire on file existence and type</span></div>
<div class="line"><a name="l07408"></a><span class="lineno"> 7408</span>&#160;        <span class="keywordflow">IF</span>(nu &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07409"></a><span class="lineno"> 7409</span>&#160;            <a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a>=text</div>
<div class="line"><a name="l07410"></a><span class="lineno"> 7410</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07411"></a><span class="lineno"> 7411</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(10,<span class="stringliteral">&#39;Aborted, no steering file&#39;</span>)</div>
<div class="line"><a name="l07412"></a><span class="lineno"> 7412</span>&#160;            stop <span class="stringliteral">&#39;in FILETC: no steering file.                      .&#39;</span></div>
<div class="line"><a name="l07413"></a><span class="lineno"> 7413</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07414"></a><span class="lineno"> 7414</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07415"></a><span class="lineno"> 7415</span>&#160; </div>
<div class="line"><a name="l07416"></a><span class="lineno"> 7416</span>&#160; </div>
<div class="line"><a name="l07417"></a><span class="lineno"> 7417</span>&#160;    <span class="comment">!     open, read steering file:</span></div>
<div class="line"><a name="l07418"></a><span class="lineno"> 7418</span>&#160;    <span class="comment">!                               end</span></div>
<div class="line"><a name="l07419"></a><span class="lineno"> 7419</span>&#160;    <span class="comment">!                               fortranfiles</span></div>
<div class="line"><a name="l07420"></a><span class="lineno"> 7420</span>&#160;    <span class="comment">!                               cfiles</span></div>
<div class="line"><a name="l07421"></a><span class="lineno"> 7421</span>&#160; </div>
<div class="line"><a name="l07422"></a><span class="lineno"> 7422</span>&#160; </div>
<div class="line"><a name="l07423"></a><span class="lineno"> 7423</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#af6e4dfef4c87d0f39a54dab2f6b210d3">rltext</a>(<a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a>,ia,ib,<a class="code" href="namespacempmod.html#a9bf11710d618bc5b79694b3221961dd1">nfnam</a>) <span class="comment">! return indices for non-blank area</span></div>
<div class="line"><a name="l07424"></a><span class="lineno"> 7424</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07425"></a><span class="lineno"> 7425</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Listing of steering file: &#39;</span>,<a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a>(1:<a class="code" href="namespacempmod.html#a9bf11710d618bc5b79694b3221961dd1">nfnam</a>)</div>
<div class="line"><a name="l07426"></a><span class="lineno"> 7426</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;-------------------------&#39;</span></div>
<div class="line"><a name="l07427"></a><span class="lineno"> 7427</span>&#160;    <span class="keyword">OPEN</span>(10,file=<a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a>(1:<a class="code" href="namespacempmod.html#a9bf11710d618bc5b79694b3221961dd1">nfnam</a>),iostat=ios)</div>
<div class="line"><a name="l07428"></a><span class="lineno"> 7428</span>&#160;    <span class="keywordflow">IF</span>(ios /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07429"></a><span class="lineno"> 7429</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Open error for steering file - stop&#39;</span></div>
<div class="line"><a name="l07430"></a><span class="lineno"> 7430</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(11,<span class="stringliteral">&#39;Aborted, open error for steering file&#39;</span>)</div>
<div class="line"><a name="l07431"></a><span class="lineno"> 7431</span>&#160;        stop</div>
<div class="line"><a name="l07432"></a><span class="lineno"> 7432</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07433"></a><span class="lineno"> 7433</span>&#160;    <a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a> =0</div>
<div class="line"><a name="l07434"></a><span class="lineno"> 7434</span>&#160;    <a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>=0</div>
<div class="line"><a name="l07435"></a><span class="lineno"> 7435</span>&#160; </div>
<div class="line"><a name="l07436"></a><span class="lineno"> 7436</span>&#160;    lenfileinfo=2</div>
<div class="line"><a name="l07437"></a><span class="lineno"> 7437</span>&#160;    lenfilenames=0</div>
<div class="line"><a name="l07438"></a><span class="lineno"> 7438</span>&#160;    rows=6; cols=lenfileinfo</div>
<div class="line"><a name="l07439"></a><span class="lineno"> 7439</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(vecfileinfo,rows,cols,<span class="stringliteral">&#39;file info from steering&#39;</span>)</div>
<div class="line"><a name="l07440"></a><span class="lineno"> 7440</span>&#160;    nline=0</div>
<div class="line"><a name="l07441"></a><span class="lineno"> 7441</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l07442"></a><span class="lineno"> 7442</span>&#160;        <span class="keyword">READ</span>(10,102,iostat=ierrf) text        <span class="comment">! read steering file</span></div>
<div class="line"><a name="l07443"></a><span class="lineno"> 7443</span>&#160;        <span class="keywordflow">IF</span> (ierrf &lt; 0) <span class="keywordflow">EXIT</span> <span class="comment">! eof</span></div>
<div class="line"><a name="l07444"></a><span class="lineno"> 7444</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#af6e4dfef4c87d0f39a54dab2f6b210d3">rltext</a>(text,ia,ib,nab)     <span class="comment">! return indices for non-blank area</span></div>
<div class="line"><a name="l07445"></a><span class="lineno"> 7445</span>&#160;        nline=nline+1</div>
<div class="line"><a name="l07446"></a><span class="lineno"> 7446</span>&#160;        <span class="keywordflow">IF</span>(nline &lt;= 50) <span class="keywordflow">THEN</span>   <span class="comment">! print up to 50 lines</span></div>
<div class="line"><a name="l07447"></a><span class="lineno"> 7447</span>&#160;            <span class="keyword">WRITE</span>(*,101) nline,text(1:nab)</div>
<div class="line"><a name="l07448"></a><span class="lineno"> 7448</span>&#160;            <span class="keywordflow">IF</span>(nline == 50)  <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;     ...&#39;</span></div>
<div class="line"><a name="l07449"></a><span class="lineno"> 7449</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07450"></a><span class="lineno"> 7450</span>&#160; </div>
<div class="line"><a name="l07451"></a><span class="lineno"> 7451</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#af6e4dfef4c87d0f39a54dab2f6b210d3">rltext</a>(text,ia,ib,nab)        <span class="comment">! test content   &#39;end&#39;</span></div>
<div class="line"><a name="l07452"></a><span class="lineno"> 7452</span>&#160;        <span class="keywordflow">IF</span>(ib == ia+2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07453"></a><span class="lineno"> 7453</span>&#160;            mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(ia:ib),<span class="stringliteral">&#39;end&#39;</span>,npat,ntext)</div>
<div class="line"><a name="l07454"></a><span class="lineno"> 7454</span>&#160;            <span class="keywordflow">IF</span>(mat == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07455"></a><span class="lineno"> 7455</span>&#160;                text=<span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07456"></a><span class="lineno"> 7456</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a4c6bb3934f236ccdcc76e03883b379a8">intext</a>(text,nline)</div>
<div class="line"><a name="l07457"></a><span class="lineno"> 7457</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;    end-statement after&#39;</span>,nline,<span class="stringliteral">&#39; text lines&#39;</span></div>
<div class="line"><a name="l07458"></a><span class="lineno"> 7458</span>&#160;                <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l07459"></a><span class="lineno"> 7459</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07460"></a><span class="lineno"> 7460</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07461"></a><span class="lineno"> 7461</span>&#160; </div>
<div class="line"><a name="l07462"></a><span class="lineno"> 7462</span>&#160;        keystx=<span class="stringliteral">&#39;fortranfiles&#39;</span></div>
<div class="line"><a name="l07463"></a><span class="lineno"> 7463</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(ia:ib),keystx,npat,ntext)</div>
<div class="line"><a name="l07464"></a><span class="lineno"> 7464</span>&#160;        <span class="keywordflow">IF</span>(mat == ntext) <span class="keywordflow">THEN</span> <span class="comment">! exact matching</span></div>
<div class="line"><a name="l07465"></a><span class="lineno"> 7465</span>&#160;            nuf=3</div>
<div class="line"><a name="l07466"></a><span class="lineno"> 7466</span>&#160;            <span class="comment">!         WRITE(*,*) &#39;Fortran files&#39;</span></div>
<div class="line"><a name="l07467"></a><span class="lineno"> 7467</span>&#160;            cycle</div>
<div class="line"><a name="l07468"></a><span class="lineno"> 7468</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07469"></a><span class="lineno"> 7469</span>&#160; </div>
<div class="line"><a name="l07470"></a><span class="lineno"> 7470</span>&#160;        keystx=<span class="stringliteral">&#39;Cfiles&#39;</span></div>
<div class="line"><a name="l07471"></a><span class="lineno"> 7471</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(ia:ib),keystx,npat,ntext)</div>
<div class="line"><a name="l07472"></a><span class="lineno"> 7472</span>&#160;        <span class="keywordflow">IF</span>(mat == ntext) <span class="keywordflow">THEN</span> <span class="comment">! exact matching</span></div>
<div class="line"><a name="l07473"></a><span class="lineno"> 7473</span>&#160;            nuf=1</div>
<div class="line"><a name="l07474"></a><span class="lineno"> 7474</span>&#160;            <span class="comment">!         WRITE(*,*) &#39;Cfiles&#39;</span></div>
<div class="line"><a name="l07475"></a><span class="lineno"> 7475</span>&#160;            cycle</div>
<div class="line"><a name="l07476"></a><span class="lineno"> 7476</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07477"></a><span class="lineno"> 7477</span>&#160; </div>
<div class="line"><a name="l07478"></a><span class="lineno"> 7478</span>&#160;        keystx=<span class="stringliteral">&#39;closeandreopen&#39;</span> <span class="comment">! don&#39;t keep binary files open</span></div>
<div class="line"><a name="l07479"></a><span class="lineno"> 7479</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(ia:ib),keystx,npat,ntext)</div>
<div class="line"><a name="l07480"></a><span class="lineno"> 7480</span>&#160;        <span class="keywordflow">IF</span>(mat == ntext) <span class="keywordflow">THEN</span> <span class="comment">! exact matching</span></div>
<div class="line"><a name="l07481"></a><span class="lineno"> 7481</span>&#160;            <a class="code" href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">keepopen</a>=0</div>
<div class="line"><a name="l07482"></a><span class="lineno"> 7482</span>&#160;            cycle</div>
<div class="line"><a name="l07483"></a><span class="lineno"> 7483</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07484"></a><span class="lineno"> 7484</span>&#160; </div>
<div class="line"><a name="l07485"></a><span class="lineno"> 7485</span>&#160;        <span class="comment">! file names</span></div>
<div class="line"><a name="l07486"></a><span class="lineno"> 7486</span>&#160;        <span class="comment">!     check for file options (&#39; -- &#39;)</span></div>
<div class="line"><a name="l07487"></a><span class="lineno"> 7487</span>&#160;        ie=ib</div>
<div class="line"><a name="l07488"></a><span class="lineno"> 7488</span>&#160;        iopt=index(text(ia:ib),<span class="stringliteral">&#39; -- &#39;</span>)</div>
<div class="line"><a name="l07489"></a><span class="lineno"> 7489</span>&#160;        <span class="keywordflow">IF</span> (iopt &gt; 0) ie=iopt-1</div>
<div class="line"><a name="l07490"></a><span class="lineno"> 7490</span>&#160; </div>
<div class="line"><a name="l07491"></a><span class="lineno"> 7491</span>&#160;        <span class="keywordflow">IF</span>(nab == 0) cycle</div>
<div class="line"><a name="l07492"></a><span class="lineno"> 7492</span>&#160;        nu=<a class="code" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a>(text(ia:ie))           <span class="comment">! inquire on file existence</span></div>
<div class="line"><a name="l07493"></a><span class="lineno"> 7493</span>&#160;        <span class="keywordflow">IF</span>(nu &gt; 0) <span class="keywordflow">THEN</span>                  <span class="comment">! existing file</span></div>
<div class="line"><a name="l07494"></a><span class="lineno"> 7494</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a> == lenfileinfo) <span class="keywordflow">THEN</span> <span class="comment">! increase length</span></div>
<div class="line"><a name="l07495"></a><span class="lineno"> 7495</span>&#160;                <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(temparray,rows,cols,<span class="stringliteral">&#39;temp file info from steering&#39;</span>)</div>
<div class="line"><a name="l07496"></a><span class="lineno"> 7496</span>&#160;                temparray=vecfileinfo</div>
<div class="line"><a name="l07497"></a><span class="lineno"> 7497</span>&#160;                <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(vecfileinfo)</div>
<div class="line"><a name="l07498"></a><span class="lineno"> 7498</span>&#160;                lenfileinfo=lenfileinfo*2</div>
<div class="line"><a name="l07499"></a><span class="lineno"> 7499</span>&#160;                newcols=lenfileinfo</div>
<div class="line"><a name="l07500"></a><span class="lineno"> 7500</span>&#160;                <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(vecfileinfo,rows,newcols,<span class="stringliteral">&#39;file info from steering&#39;</span>)</div>
<div class="line"><a name="l07501"></a><span class="lineno"> 7501</span>&#160;                vecfileinfo(:,1:cols)=temparray(:,1:cols)</div>
<div class="line"><a name="l07502"></a><span class="lineno"> 7502</span>&#160;                <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(temparray)</div>
<div class="line"><a name="l07503"></a><span class="lineno"> 7503</span>&#160;                cols=newcols</div>
<div class="line"><a name="l07504"></a><span class="lineno"> 7504</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l07505"></a><span class="lineno"> 7505</span>&#160;            <a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>=<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>+1              <span class="comment">! count number of files</span></div>
<div class="line"><a name="l07506"></a><span class="lineno"> 7506</span>&#160;            <span class="keywordflow">IF</span>(nu == 1) nu=nuf           <span class="comment">!</span></div>
<div class="line"><a name="l07507"></a><span class="lineno"> 7507</span>&#160;            lenfilenames=lenfilenames+ie-ia+1 <span class="comment">! total length of file names</span></div>
<div class="line"><a name="l07508"></a><span class="lineno"> 7508</span>&#160;            vecfileinfo(1,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>)=nline  <span class="comment">! line number</span></div>
<div class="line"><a name="l07509"></a><span class="lineno"> 7509</span>&#160;            vecfileinfo(2,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>)=nu     <span class="comment">! cbinary =1, text =2, fbinary=3</span></div>
<div class="line"><a name="l07510"></a><span class="lineno"> 7510</span>&#160;            vecfileinfo(3,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>)=ia     <span class="comment">! file name start</span></div>
<div class="line"><a name="l07511"></a><span class="lineno"> 7511</span>&#160;            vecfileinfo(4,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>)=ie     <span class="comment">! file name end</span></div>
<div class="line"><a name="l07512"></a><span class="lineno"> 7512</span>&#160;            vecfileinfo(5,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>)=iopt   <span class="comment">! option start</span></div>
<div class="line"><a name="l07513"></a><span class="lineno"> 7513</span>&#160;            vecfileinfo(6,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>)=ib     <span class="comment">! option end</span></div>
<div class="line"><a name="l07514"></a><span class="lineno"> 7514</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07515"></a><span class="lineno"> 7515</span>&#160;        <span class="comment">!         WRITE(*,*) &#39;Open error for file &#39;,TEXT(IA:IB)</span></div>
<div class="line"><a name="l07516"></a><span class="lineno"> 7516</span>&#160;        <span class="comment">!         STOP</span></div>
<div class="line"><a name="l07517"></a><span class="lineno"> 7517</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07518"></a><span class="lineno"> 7518</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07519"></a><span class="lineno"> 7519</span>&#160;    rewind 10</div>
<div class="line"><a name="l07520"></a><span class="lineno"> 7520</span>&#160;    <span class="comment">! read again to fill dynamic arrays with file info</span></div>
<div class="line"><a name="l07521"></a><span class="lineno"> 7521</span>&#160;    length=<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a></div>
<div class="line"><a name="l07522"></a><span class="lineno"> 7522</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ad5a01a98e1724b716c52ab248a29811d">mfd</a>,length,<span class="stringliteral">&#39;file type&#39;</span>)</div>
<div class="line"><a name="l07523"></a><span class="lineno"> 7523</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#acd04929ac53adbddcec1f839e7053811">nfd</a>,length,<span class="stringliteral">&#39;file line (in steering)&#39;</span>)</div>
<div class="line"><a name="l07524"></a><span class="lineno"> 7524</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>,length,<span class="stringliteral">&#39;file name length&#39;</span>)</div>
<div class="line"><a name="l07525"></a><span class="lineno"> 7525</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#aad7fb90fb498a93781b446baf571e7dd">ofd</a>,length,<span class="stringliteral">&#39;file option&#39;</span>)</div>
<div class="line"><a name="l07526"></a><span class="lineno"> 7526</span>&#160;    length=lenfilenames</div>
<div class="line"><a name="l07527"></a><span class="lineno"> 7527</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#aa4038b57cc5133652599ccafef6ab2c9">tfd</a>,length,<span class="stringliteral">&#39;file name&#39;</span>)</div>
<div class="line"><a name="l07528"></a><span class="lineno"> 7528</span>&#160;    nline=0</div>
<div class="line"><a name="l07529"></a><span class="lineno"> 7529</span>&#160;    i=1</div>
<div class="line"><a name="l07530"></a><span class="lineno"> 7530</span>&#160;    ioff=0</div>
<div class="line"><a name="l07531"></a><span class="lineno"> 7531</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l07532"></a><span class="lineno"> 7532</span>&#160;        <span class="keyword">READ</span>(10,102,iostat=ierrf) text        <span class="comment">! read steering file</span></div>
<div class="line"><a name="l07533"></a><span class="lineno"> 7533</span>&#160;        <span class="keywordflow">IF</span> (ierrf &lt; 0) <span class="keywordflow">EXIT</span> <span class="comment">! eof</span></div>
<div class="line"><a name="l07534"></a><span class="lineno"> 7534</span>&#160;        nline=nline+1</div>
<div class="line"><a name="l07535"></a><span class="lineno"> 7535</span>&#160;        <span class="keywordflow">IF</span> (nline == vecfileinfo(1,i)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07536"></a><span class="lineno"> 7536</span>&#160;            <a class="code" href="namespacempmod.html#acd04929ac53adbddcec1f839e7053811">nfd</a>(i)=vecfileinfo(1,i)</div>
<div class="line"><a name="l07537"></a><span class="lineno"> 7537</span>&#160;            <a class="code" href="namespacempmod.html#ad5a01a98e1724b716c52ab248a29811d">mfd</a>(i)=vecfileinfo(2,i)</div>
<div class="line"><a name="l07538"></a><span class="lineno"> 7538</span>&#160;            ia=vecfileinfo(3,i)-1</div>
<div class="line"><a name="l07539"></a><span class="lineno"> 7539</span>&#160;            <a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)=vecfileinfo(4,i)-ia <span class="comment">! length file name</span></div>
<div class="line"><a name="l07540"></a><span class="lineno"> 7540</span>&#160;            <span class="keywordflow">FORALL</span> (k=1:<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)) <a class="code" href="namespacempmod.html#aa4038b57cc5133652599ccafef6ab2c9">tfd</a>(ioff+k)=text(ia+k:ia+k)</div>
<div class="line"><a name="l07541"></a><span class="lineno"> 7541</span>&#160;            <span class="comment">!            tfd(i)=text(vecFileInfo(3,i):vecFileInfo(4,i))      ! file name</span></div>
<div class="line"><a name="l07542"></a><span class="lineno"> 7542</span>&#160;            ioff=ioff+<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)</div>
<div class="line"><a name="l07543"></a><span class="lineno"> 7543</span>&#160;            <a class="code" href="namespacempmod.html#aad7fb90fb498a93781b446baf571e7dd">ofd</a>(i)=1.0              <span class="comment">! option for file</span></div>
<div class="line"><a name="l07544"></a><span class="lineno"> 7544</span>&#160;            <span class="keywordflow">IF</span> (vecfileinfo(5,i) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07545"></a><span class="lineno"> 7545</span>&#160;                <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#ac707e6fabcc93cc4eb04b7acc1abbafa">ratext</a>(text(vecfileinfo(5,i)+4:vecfileinfo(6,i)),nums,dnum) <span class="comment">! translate text to DP numbers</span></div>
<div class="line"><a name="l07546"></a><span class="lineno"> 7546</span>&#160;                <span class="keywordflow">IF</span> (nums &gt; 0) <a class="code" href="namespacempmod.html#aad7fb90fb498a93781b446baf571e7dd">ofd</a>(i)=real(dnum(1),mps)</div>
<div class="line"><a name="l07547"></a><span class="lineno"> 7547</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07548"></a><span class="lineno"> 7548</span>&#160;            i=i+1</div>
<div class="line"><a name="l07549"></a><span class="lineno"> 7549</span>&#160;            <span class="keywordflow">IF</span> (i &gt; <a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l07550"></a><span class="lineno"> 7550</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l07551"></a><span class="lineno"> 7551</span>&#160;<span class="keywordflow">    ENDDO</span></div>
<div class="line"><a name="l07552"></a><span class="lineno"> 7552</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(vecfileinfo)</div>
<div class="line"><a name="l07553"></a><span class="lineno"> 7553</span>&#160;    rewind 10</div>
<div class="line"><a name="l07554"></a><span class="lineno"> 7554</span>&#160;    <span class="comment">! additional info for binary files</span></div>
<div class="line"><a name="l07555"></a><span class="lineno"> 7555</span>&#160;    length=<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>; rows=2</div>
<div class="line"><a name="l07556"></a><span class="lineno"> 7556</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a96612c6c1900e9c644f8c112ee6597be">ifd</a>,length,<span class="stringliteral">&#39;integrated record numbers (=offset)&#39;</span>)</div>
<div class="line"><a name="l07557"></a><span class="lineno"> 7557</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a3b9c63124b62fe44ecd96e9de7c2ce5a">jfd</a>,length,<span class="stringliteral">&#39;number of accepted records&#39;</span>)</div>
<div class="line"><a name="l07558"></a><span class="lineno"> 7558</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>,rows,length,<span class="stringliteral">&#39;number of records in file, file order&#39;</span>)</div>
<div class="line"><a name="l07559"></a><span class="lineno"> 7559</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#afacae0ada58a38cc14417f2f7de549f5">dfd</a>,length,<span class="stringliteral">&#39;ndf sum&#39;</span>)</div>
<div class="line"><a name="l07560"></a><span class="lineno"> 7560</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ae87541b854b0ad82a402f5285b2f8226">xfd</a>,length,<span class="stringliteral">&#39;max. record size&#39;</span>)</div>
<div class="line"><a name="l07561"></a><span class="lineno"> 7561</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a6ff460b472eb064eb6eb5604c0ac94af">wfd</a>,length,<span class="stringliteral">&#39;file weight&#39;</span>)</div>
<div class="line"><a name="l07562"></a><span class="lineno"> 7562</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a4d6db74bc42c797522a81deff648d1a9">cfd</a>,length,<span class="stringliteral">&#39;chi2 sum&#39;</span>)</div>
<div class="line"><a name="l07563"></a><span class="lineno"> 7563</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a8d6f6c1c345293acfc79f34f94c78e1f">sfd</a>,rows,length,<span class="stringliteral">&#39;start, end of file name in TFD&#39;</span>)</div>
<div class="line"><a name="l07564"></a><span class="lineno"> 7564</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a2f93ff0ba78ec3d0cf2040a624913a19">yfd</a>,length,<span class="stringliteral">&#39;modification date&#39;</span>)</div>
<div class="line"><a name="l07565"></a><span class="lineno"> 7565</span>&#160;    <a class="code" href="namespacempmod.html#a2f93ff0ba78ec3d0cf2040a624913a19">yfd</a>=0</div>
<div class="line"><a name="l07566"></a><span class="lineno"> 7566</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07567"></a><span class="lineno"> 7567</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;-------------------------&#39;</span></div>
<div class="line"><a name="l07568"></a><span class="lineno"> 7568</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07569"></a><span class="lineno"> 7569</span>&#160; </div>
<div class="line"><a name="l07570"></a><span class="lineno"> 7570</span>&#160;    <span class="comment">!     print table of files ---------------------------------------------</span></div>
<div class="line"><a name="l07571"></a><span class="lineno"> 7571</span>&#160; </div>
<div class="line"><a name="l07572"></a><span class="lineno"> 7572</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07573"></a><span class="lineno"> 7573</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Table of files:&#39;</span></div>
<div class="line"><a name="l07574"></a><span class="lineno"> 7574</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;---------------&#39;</span></div>
<div class="line"><a name="l07575"></a><span class="lineno"> 7575</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07576"></a><span class="lineno"> 7576</span>&#160;    <span class="keyword">WRITE</span>(8,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07577"></a><span class="lineno"> 7577</span>&#160;    <span class="keyword">WRITE</span>(8,*) <span class="stringliteral">&#39;Text and data files:&#39;</span></div>
<div class="line"><a name="l07578"></a><span class="lineno"> 7578</span>&#160;    ioff=0</div>
<div class="line"><a name="l07579"></a><span class="lineno"> 7579</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a></div>
<div class="line"><a name="l07580"></a><span class="lineno"> 7580</span>&#160;        <span class="keywordflow">FORALL</span> (k=1:<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)) fname(k:k)=<a class="code" href="namespacempmod.html#aa4038b57cc5133652599ccafef6ab2c9">tfd</a>(ioff+k)</div>
<div class="line"><a name="l07581"></a><span class="lineno"> 7581</span>&#160;        <span class="comment">!        fname=tfd(i)(1:lfd(i))</span></div>
<div class="line"><a name="l07582"></a><span class="lineno"> 7582</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 1) <span class="keyword">WRITE</span>(*,103) i,bite(<a class="code" href="namespacempmod.html#ad5a01a98e1724b716c52ab248a29811d">mfd</a>(i)),fname(1:<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i))</div>
<div class="line"><a name="l07583"></a><span class="lineno"> 7583</span>&#160;        <span class="keyword">WRITE</span>(8,103) i,bite(<a class="code" href="namespacempmod.html#ad5a01a98e1724b716c52ab248a29811d">mfd</a>(i)),fname(1:<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i))</div>
<div class="line"><a name="l07584"></a><span class="lineno"> 7584</span>&#160;        ioff=ioff+<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)</div>
<div class="line"><a name="l07585"></a><span class="lineno"> 7585</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07586"></a><span class="lineno"> 7586</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07587"></a><span class="lineno"> 7587</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;---------------&#39;</span></div>
<div class="line"><a name="l07588"></a><span class="lineno"> 7588</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07589"></a><span class="lineno"> 7589</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07590"></a><span class="lineno"> 7590</span>&#160; </div>
<div class="line"><a name="l07591"></a><span class="lineno"> 7591</span>&#160;    <span class="comment">!     open the binary Fortran (data) files on unit 11, 12, ...</span></div>
<div class="line"><a name="l07592"></a><span class="lineno"> 7592</span>&#160; </div>
<div class="line"><a name="l07593"></a><span class="lineno"> 7593</span>&#160;    iosum=0</div>
<div class="line"><a name="l07594"></a><span class="lineno"> 7594</span>&#160;    <a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a>=0</div>
<div class="line"><a name="l07595"></a><span class="lineno"> 7595</span>&#160;    <a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>=0</div>
<div class="line"><a name="l07596"></a><span class="lineno"> 7596</span>&#160;    <a class="code" href="namespacempmod.html#a458c83043d826c318e19efc0a43af555">nfilw</a>=0</div>
<div class="line"><a name="l07597"></a><span class="lineno"> 7597</span>&#160;    ioff=0</div>
<div class="line"><a name="l07598"></a><span class="lineno"> 7598</span>&#160;    ifilb=0</div>
<div class="line"><a name="l07599"></a><span class="lineno"> 7599</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">keepopen</a> &lt; 1) ifilb=1</div>
<div class="line"><a name="l07600"></a><span class="lineno"> 7600</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a></div>
<div class="line"><a name="l07601"></a><span class="lineno"> 7601</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad5a01a98e1724b716c52ab248a29811d">mfd</a>(i) == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07602"></a><span class="lineno"> 7602</span>&#160;            <a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a>=<a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a>+1</div>
<div class="line"><a name="l07603"></a><span class="lineno"> 7603</span>&#160;            <a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>=<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>+1</div>
<div class="line"><a name="l07604"></a><span class="lineno"> 7604</span>&#160;            <span class="comment">! next file name</span></div>
<div class="line"><a name="l07605"></a><span class="lineno"> 7605</span>&#160;            <a class="code" href="namespacempmod.html#a8d6f6c1c345293acfc79f34f94c78e1f">sfd</a>(1,<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>)=ioff</div>
<div class="line"><a name="l07606"></a><span class="lineno"> 7606</span>&#160;            <a class="code" href="namespacempmod.html#a8d6f6c1c345293acfc79f34f94c78e1f">sfd</a>(2,<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>)=<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)</div>
<div class="line"><a name="l07607"></a><span class="lineno"> 7607</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aba466fbf4e152b7b0367a5cf63e8311c">binopn</a>(<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>,ifilb,ios)</div>
<div class="line"><a name="l07608"></a><span class="lineno"> 7608</span>&#160;            <span class="keywordflow">IF</span>(ios == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07609"></a><span class="lineno"> 7609</span>&#160;                <a class="code" href="namespacempmod.html#a6ff460b472eb064eb6eb5604c0ac94af">wfd</a>(<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>)=<a class="code" href="namespacempmod.html#aad7fb90fb498a93781b446baf571e7dd">ofd</a>(i)</div>
<div class="line"><a name="l07610"></a><span class="lineno"> 7610</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">keepopen</a> &lt; 1) <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a050daae79bead3c51481f24efcd9be87">bincls</a>(<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>,ifilb)  </div>
<div class="line"><a name="l07611"></a><span class="lineno"> 7611</span>&#160;            <span class="keywordflow">ELSE</span> <span class="comment">! failure</span></div>
<div class="line"><a name="l07612"></a><span class="lineno"> 7612</span>&#160;                iosum=iosum+1</div>
<div class="line"><a name="l07613"></a><span class="lineno"> 7613</span>&#160;                <a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a>=<a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a>-1</div>
<div class="line"><a name="l07614"></a><span class="lineno"> 7614</span>&#160;                <a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>=<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>-1 </div>
<div class="line"><a name="l07615"></a><span class="lineno"> 7615</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07616"></a><span class="lineno"> 7616</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07617"></a><span class="lineno"> 7617</span>&#160;        ioff=ioff+<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)</div>
<div class="line"><a name="l07618"></a><span class="lineno"> 7618</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07619"></a><span class="lineno"> 7619</span>&#160; </div>
<div class="line"><a name="l07620"></a><span class="lineno"> 7620</span>&#160;    <span class="comment">!     open the binary C files</span></div>
<div class="line"><a name="l07621"></a><span class="lineno"> 7621</span>&#160; </div>
<div class="line"><a name="l07622"></a><span class="lineno"> 7622</span>&#160;    <a class="code" href="namespacempmod.html#a4f85e2ed8eed19d183f4b6137f4b5928">nfilc</a>=-1</div>
<div class="line"><a name="l07623"></a><span class="lineno"> 7623</span>&#160;    ioff=0</div>
<div class="line"><a name="l07624"></a><span class="lineno"> 7624</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>                                 <span class="comment">! Cfiles</span></div>
<div class="line"><a name="l07625"></a><span class="lineno"> 7625</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad5a01a98e1724b716c52ab248a29811d">mfd</a>(i) == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07626"></a><span class="lineno"> 7626</span>&#160;<span class="preprocessor">#ifdef READ_C_FILES</span></div>
<div class="line"><a name="l07627"></a><span class="lineno"> 7627</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4f85e2ed8eed19d183f4b6137f4b5928">nfilc</a> &lt; 0) <span class="keywordflow">THEN</span> <span class="comment">! initialize</span></div>
<div class="line"><a name="l07628"></a><span class="lineno"> 7628</span>&#160;                <span class="keyword">CALL </span>initc(max(<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>,<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a>)) <span class="comment">! uncommented by GF</span></div>
<div class="line"><a name="l07629"></a><span class="lineno"> 7629</span>&#160;                <a class="code" href="namespacempmod.html#a4f85e2ed8eed19d183f4b6137f4b5928">nfilc</a>=0</div>
<div class="line"><a name="l07630"></a><span class="lineno"> 7630</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07631"></a><span class="lineno"> 7631</span>&#160;            <a class="code" href="namespacempmod.html#a4f85e2ed8eed19d183f4b6137f4b5928">nfilc</a>=<a class="code" href="namespacempmod.html#a4f85e2ed8eed19d183f4b6137f4b5928">nfilc</a>+1</div>
<div class="line"><a name="l07632"></a><span class="lineno"> 7632</span>&#160;            <a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>=<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>+1</div>
<div class="line"><a name="l07633"></a><span class="lineno"> 7633</span>&#160;            <span class="comment">! next file name</span></div>
<div class="line"><a name="l07634"></a><span class="lineno"> 7634</span>&#160;            <a class="code" href="namespacempmod.html#a8d6f6c1c345293acfc79f34f94c78e1f">sfd</a>(1,<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>)=ioff</div>
<div class="line"><a name="l07635"></a><span class="lineno"> 7635</span>&#160;            <a class="code" href="namespacempmod.html#a8d6f6c1c345293acfc79f34f94c78e1f">sfd</a>(2,<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>)=<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)</div>
<div class="line"><a name="l07636"></a><span class="lineno"> 7636</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aba466fbf4e152b7b0367a5cf63e8311c">binopn</a>(<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>,ifilb,ios)</div>
<div class="line"><a name="l07637"></a><span class="lineno"> 7637</span>&#160;            <span class="keywordflow">IF</span>(ios == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07638"></a><span class="lineno"> 7638</span>&#160;                <a class="code" href="namespacempmod.html#a6ff460b472eb064eb6eb5604c0ac94af">wfd</a>(<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>)=<a class="code" href="namespacempmod.html#aad7fb90fb498a93781b446baf571e7dd">ofd</a>(i)</div>
<div class="line"><a name="l07639"></a><span class="lineno"> 7639</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">keepopen</a> &lt; 1) <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a050daae79bead3c51481f24efcd9be87">bincls</a>(<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>,ifilb)</div>
<div class="line"><a name="l07640"></a><span class="lineno"> 7640</span>&#160;            <span class="keywordflow">ELSE</span> <span class="comment">! failure</span></div>
<div class="line"><a name="l07641"></a><span class="lineno"> 7641</span>&#160;                iosum=iosum+1</div>
<div class="line"><a name="l07642"></a><span class="lineno"> 7642</span>&#160;                <a class="code" href="namespacempmod.html#a4f85e2ed8eed19d183f4b6137f4b5928">nfilc</a>=<a class="code" href="namespacempmod.html#a4f85e2ed8eed19d183f4b6137f4b5928">nfilc</a>-1</div>
<div class="line"><a name="l07643"></a><span class="lineno"> 7643</span>&#160;                <a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>=<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>-1                     </div>
<div class="line"><a name="l07644"></a><span class="lineno"> 7644</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07645"></a><span class="lineno"> 7645</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l07646"></a><span class="lineno"> 7646</span>&#160;<span class="preprocessor"></span>            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Opening of C-files not supported.&#39;</span></div>
<div class="line"><a name="l07647"></a><span class="lineno"> 7647</span>&#160;            <span class="comment">! GF add</span></div>
<div class="line"><a name="l07648"></a><span class="lineno"> 7648</span>&#160;            iosum=iosum+1</div>
<div class="line"><a name="l07649"></a><span class="lineno"> 7649</span>&#160;            <span class="comment">! GF add end</span></div>
<div class="line"><a name="l07650"></a><span class="lineno"> 7650</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07651"></a><span class="lineno"> 7651</span>&#160;<span class="preprocessor"></span><span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07652"></a><span class="lineno"> 7652</span>&#160;        ioff=ioff+<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)</div>
<div class="line"><a name="l07653"></a><span class="lineno"> 7653</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07654"></a><span class="lineno"> 7654</span>&#160; </div>
<div class="line"><a name="l07655"></a><span class="lineno"> 7655</span>&#160;    <span class="keywordflow">DO</span> k=1,<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a></div>
<div class="line"><a name="l07656"></a><span class="lineno"> 7656</span>&#160;        <a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(1,k)=1   <span class="comment">! reset (negated) record counters</span></div>
<div class="line"><a name="l07657"></a><span class="lineno"> 7657</span>&#160;        <a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(2,k)=k   <span class="comment">! set file number</span></div>
<div class="line"><a name="l07658"></a><span class="lineno"> 7658</span>&#160;        <a class="code" href="namespacempmod.html#a96612c6c1900e9c644f8c112ee6597be">ifd</a>(k)=0     <span class="comment">! reset integrated record numbers</span></div>
<div class="line"><a name="l07659"></a><span class="lineno"> 7659</span>&#160;        <a class="code" href="namespacempmod.html#ae87541b854b0ad82a402f5285b2f8226">xfd</a>(k)=0     <span class="comment">! reset max record size</span></div>
<div class="line"><a name="l07660"></a><span class="lineno"> 7660</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07661"></a><span class="lineno"> 7661</span>&#160; </div>
<div class="line"><a name="l07662"></a><span class="lineno"> 7662</span>&#160;    <span class="keywordflow">IF</span>(iosum /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07663"></a><span class="lineno"> 7663</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(15,<span class="stringliteral">&#39;Aborted, open error(s) for binary files&#39;</span>)</div>
<div class="line"><a name="l07664"></a><span class="lineno"> 7664</span>&#160;        stop <span class="stringliteral">&#39;FILETC: open error                                      &#39;</span></div>
<div class="line"><a name="l07665"></a><span class="lineno"> 7665</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07666"></a><span class="lineno"> 7666</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07667"></a><span class="lineno"> 7667</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(14,<span class="stringliteral">&#39;Aborted, no binary files&#39;</span>)</div>
<div class="line"><a name="l07668"></a><span class="lineno"> 7668</span>&#160;        stop <span class="stringliteral">&#39;FILETC: no binary files                                 &#39;</span></div>
<div class="line"><a name="l07669"></a><span class="lineno"> 7669</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07670"></a><span class="lineno"> 7670</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">keepopen</a> &gt; 0) <span class="keywordflow">THEN</span> </div>
<div class="line"><a name="l07671"></a><span class="lineno"> 7671</span>&#160;        <span class="keyword">WRITE</span>(*,*) <a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>,<span class="stringliteral">&#39; binary files opened&#39;</span> <span class="comment">! corrected by GF</span></div>
<div class="line"><a name="l07672"></a><span class="lineno"> 7672</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07673"></a><span class="lineno"> 7673</span>&#160;        <span class="keyword">WRITE</span>(*,*) <a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>,<span class="stringliteral">&#39; binary files opened and closed&#39;</span> <span class="comment">! corrected by GF</span></div>
<div class="line"><a name="l07674"></a><span class="lineno"> 7674</span>&#160;<span class="keywordflow">    END IF</span>     </div>
<div class="line"><a name="l07675"></a><span class="lineno"> 7675</span>&#160;101 <span class="keyword">FORMAT</span>(i3,2x,a)</div>
<div class="line"><a name="l07676"></a><span class="lineno"> 7676</span>&#160;102 <span class="keyword">FORMAT</span>(a)</div>
<div class="line"><a name="l07677"></a><span class="lineno"> 7677</span>&#160;103 <span class="keyword">FORMAT</span>(i3,2x,a14,3x,a)</div>
<div class="line"><a name="l07678"></a><span class="lineno"> 7678</span>&#160;    <span class="comment">!    CALL mend</span></div>
<div class="line"><a name="l07679"></a><span class="lineno"> 7679</span>&#160;    <span class="keywordflow">RETURN</span></div>
<div class="ttc" id="amptest1_8f90_html_a8c5b9c098eff5b00bf89fa896b0d8d6d"><div class="ttname"><a href="mptest1_8f90.html#a8c5b9c098eff5b00bf89fa896b0d8d6d">mptest</a></div><div class="ttdeci">subroutine mptest</div><div class="ttdoc">Generate test files.</div><div class="ttdef"><b>Definition:</b> <a href="mptest1_8f90_source.html#l00078">mptest1.f90:79</a></div></div>
<div class="ttc" id="amptest2_8f90_html_a23987ca5e0bf06d8b1325b9efddb4cc6"><div class="ttname"><a href="mptest2_8f90.html#a23987ca5e0bf06d8b1325b9efddb4cc6">mptst2</a></div><div class="ttdeci">subroutine mptst2(imodel)</div><div class="ttdoc">Generate test files.</div><div class="ttdef"><b>Definition:</b> <a href="mptest2_8f90_source.html#l00110">mptest2.f90:111</a></div></div>
<div class="ttc" id="amptext_8f90_html_a2caf7b022af31e22cf09e7f587f2237a"><div class="ttname"><a href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a></div><div class="ttdeci">integer(mpi) function matint(pat, text, npat, ntext)</div><div class="ttdoc">Approximate string matching.</div><div class="ttdef"><b>Definition:</b> <a href="mptext_8f90_source.html#l00289">mptext.f90:290</a></div></div>
<div class="ttc" id="amptext_8f90_html_ac707e6fabcc93cc4eb04b7acc1abbafa"><div class="ttname"><a href="mptext_8f90.html#ac707e6fabcc93cc4eb04b7acc1abbafa">ratext</a></div><div class="ttdeci">subroutine ratext(text, nums, dnum)</div><div class="ttdoc">Translate text.</div><div class="ttdef"><b>Definition:</b> <a href="mptext_8f90_source.html#l00048">mptext.f90:49</a></div></div>
<div class="ttc" id="amptext_8f90_html_af6e4dfef4c87d0f39a54dab2f6b210d3"><div class="ttname"><a href="mptext_8f90.html#af6e4dfef4c87d0f39a54dab2f6b210d3">rltext</a></div><div class="ttdeci">subroutine rltext(text, ia, ib, nab)</div><div class="ttdoc">Analyse text range.</div><div class="ttdef"><b>Definition:</b> <a href="mptext_8f90_source.html#l00236">mptext.f90:237</a></div></div>
<div class="ttc" id="anamespacempmod_html_a2d27f879e65ac6d07b201c81c8cdf122"><div class="ttname"><a href="namespacempmod.html#a2d27f879e65ac6d07b201c81c8cdf122">mpmod::mdebug</a></div><div class="ttdeci">integer(mpi) mdebug</div><div class="ttdoc">debug flag (number of records to print)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00037">mpmod.f90:37</a></div></div>
<div class="ttc" id="anamespacempmod_html_a3852011c11e76a7c89c7932e1d5b506f"><div class="ttname"><a href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">mpmod::kfd</a></div><div class="ttdeci">integer(mpi), dimension(:,:), allocatable kfd</div><div class="ttdoc">(1,.)= number of records in file, (2,..)= file order</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00285">mpmod.f90:285</a></div></div>
<div class="ttc" id="anamespacempmod_html_a3b9c63124b62fe44ecd96e9de7c2ce5a"><div class="ttname"><a href="namespacempmod.html#a3b9c63124b62fe44ecd96e9de7c2ce5a">mpmod::jfd</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable jfd</div><div class="ttdoc">file: number of accepted records</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00287">mpmod.f90:287</a></div></div>
<div class="ttc" id="anamespacempmod_html_a458c83043d826c318e19efc0a43af555"><div class="ttname"><a href="namespacempmod.html#a458c83043d826c318e19efc0a43af555">mpmod::nfilw</a></div><div class="ttdeci">integer(mpi) nfilw</div><div class="ttdoc">number of weighted binary files</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00303">mpmod.f90:303</a></div></div>
<div class="ttc" id="anamespacempmod_html_a4d6db74bc42c797522a81deff648d1a9"><div class="ttname"><a href="namespacempmod.html#a4d6db74bc42c797522a81deff648d1a9">mpmod::cfd</a></div><div class="ttdeci">real(mps), dimension(:), allocatable cfd</div><div class="ttdoc">file: chi2 sum</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00290">mpmod.f90:290</a></div></div>
<div class="ttc" id="anamespacempmod_html_a4f85e2ed8eed19d183f4b6137f4b5928"><div class="ttname"><a href="namespacempmod.html#a4f85e2ed8eed19d183f4b6137f4b5928">mpmod::nfilc</a></div><div class="ttdeci">integer(mpi) nfilc</div><div class="ttdoc">number of C binary files</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00302">mpmod.f90:302</a></div></div>
<div class="ttc" id="anamespacempmod_html_a5f983528b5d86943f47bbe7921fa4db2"><div class="ttname"><a href="namespacempmod.html#a5f983528b5d86943f47bbe7921fa4db2">mpmod::times</a></div><div class="ttdeci">real(mps), dimension(0:8) times</div><div class="ttdoc">cpu time counters</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00134">mpmod.f90:134</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6458e61b82e3761bd069c0370c843575"><div class="ttname"><a href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">mpmod::nfilb</a></div><div class="ttdeci">integer(mpi) nfilb</div><div class="ttdoc">number of binary files</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00300">mpmod.f90:300</a></div></div>
<div class="ttc" id="anamespacempmod_html_a66842cd967780ad5b802f3a2f1edbb96"><div class="ttname"><a href="namespacempmod.html#a66842cd967780ad5b802f3a2f1edbb96">mpmod::ictest</a></div><div class="ttdeci">integer(mpi) ictest</div><div class="ttdoc">test mode '-t'</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00033">mpmod.f90:33</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6c7f0eaa3bff73c3975cc1bcd197e335"><div class="ttname"><a href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">mpmod::nfiles</a></div><div class="ttdeci">integer(mpi) nfiles</div><div class="ttdoc">number of files</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00299">mpmod.f90:299</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6db3c468e271deb9fcc570f614c33182"><div class="ttname"><a href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">mpmod::keepopen</a></div><div class="ttdeci">integer(mpi) keepopen</div><div class="ttdoc">flag for keeping binary files open</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00111">mpmod.f90:111</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6ff460b472eb064eb6eb5604c0ac94af"><div class="ttname"><a href="namespacempmod.html#a6ff460b472eb064eb6eb5604c0ac94af">mpmod::wfd</a></div><div class="ttdeci">real(mps), dimension(:), allocatable wfd</div><div class="ttdoc">binary file: weight</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00292">mpmod.f90:292</a></div></div>
<div class="ttc" id="anamespacempmod_html_a77e02ad9f8ae7931e1d6ba63ea2450e8"><div class="ttname"><a href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mpmod::mthrdr</a></div><div class="ttdeci">integer(mpi) mthrdr</div><div class="ttdoc">number of threads for reading binary files</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00092">mpmod.f90:92</a></div></div>
<div class="ttc" id="anamespacempmod_html_a7d8e53f24520a9472684d74dbce2e1ee"><div class="ttname"><a href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">mpmod::filnam</a></div><div class="ttdeci">character(len=1024) filnam</div><div class="ttdoc">name of steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00295">mpmod.f90:295</a></div></div>
<div class="ttc" id="anamespacempmod_html_a96612c6c1900e9c644f8c112ee6597be"><div class="ttname"><a href="namespacempmod.html#a96612c6c1900e9c644f8c112ee6597be">mpmod::ifd</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable ifd</div><div class="ttdoc">file: integrated record numbers (=offset)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00286">mpmod.f90:286</a></div></div>
<div class="ttc" id="anamespacempmod_html_a9bf11710d618bc5b79694b3221961dd1"><div class="ttname"><a href="namespacempmod.html#a9bf11710d618bc5b79694b3221961dd1">mpmod::nfnam</a></div><div class="ttdeci">integer(mpi) nfnam</div><div class="ttdoc">length of sterring file name</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00296">mpmod.f90:296</a></div></div>
<div class="ttc" id="anamespacempmod_html_aa2f928b84ca88200d764fb129af56df3"><div class="ttname"><a href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">mpmod::lfd</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable lfd</div><div class="ttdoc">length of file name</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00283">mpmod.f90:283</a></div></div>
<div class="ttc" id="anamespacempmod_html_aa764c242afe782137d163ff94e47fdfa"><div class="ttname"><a href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mpmod::mprint</a></div><div class="ttdeci">integer(mpi) mprint</div><div class="ttdoc">print flag (0: minimal, 1: normal, &gt;1: more)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00036">mpmod.f90:36</a></div></div>
<div class="ttc" id="anamespacempmod_html_aad7fb90fb498a93781b446baf571e7dd"><div class="ttname"><a href="namespacempmod.html#aad7fb90fb498a93781b446baf571e7dd">mpmod::ofd</a></div><div class="ttdeci">real(mps), dimension(:), allocatable ofd</div><div class="ttdoc">file: option</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00291">mpmod.f90:291</a></div></div>
<div class="ttc" id="anamespacempmod_html_aaf3638261c09dfeedd95fd4e0306d130"><div class="ttname"><a href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">mpmod::ifile</a></div><div class="ttdeci">integer(mpi) ifile</div><div class="ttdoc">current file (index)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00298">mpmod.f90:298</a></div></div>
<div class="ttc" id="anamespacempmod_html_acd04929ac53adbddcec1f839e7053811"><div class="ttname"><a href="namespacempmod.html#acd04929ac53adbddcec1f839e7053811">mpmod::nfd</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable nfd</div><div class="ttdoc">index (line) in (steering) file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00284">mpmod.f90:284</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad5a01a98e1724b716c52ab248a29811d"><div class="ttname"><a href="namespacempmod.html#ad5a01a98e1724b716c52ab248a29811d">mpmod::mfd</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable mfd</div><div class="ttdoc">file mode: cbinary =1, text =2, fbinary=3</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00282">mpmod.f90:282</a></div></div>
<div class="ttc" id="anamespacempmod_html_ae87541b854b0ad82a402f5285b2f8226"><div class="ttname"><a href="namespacempmod.html#ae87541b854b0ad82a402f5285b2f8226">mpmod::xfd</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable xfd</div><div class="ttdoc">file: max. record size</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00289">mpmod.f90:289</a></div></div>
<div class="ttc" id="anamespacempmod_html_afacae0ada58a38cc14417f2f7de549f5"><div class="ttname"><a href="namespacempmod.html#afacae0ada58a38cc14417f2f7de549f5">mpmod::dfd</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable dfd</div><div class="ttdoc">file: ndf sum</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00288">mpmod.f90:288</a></div></div>
<div class="ttc" id="apede_8f90_html_a050daae79bead3c51481f24efcd9be87"><div class="ttname"><a href="pede_8f90.html#a050daae79bead3c51481f24efcd9be87">bincls</a></div><div class="ttdeci">subroutine bincls(kfile, ithr)</div><div class="ttdoc">Close binary file.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l08987">pede.f90:8988</a></div></div>
<div class="ttc" id="apede_8f90_html_a4c6bb3934f236ccdcc76e03883b379a8"><div class="ttname"><a href="pede_8f90.html#a4c6bb3934f236ccdcc76e03883b379a8">intext</a></div><div class="ttdeci">subroutine intext(text, nline)</div><div class="ttdoc">Interprete text.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l08019">pede.f90:8020</a></div></div>
<div class="ttc" id="apede_8f90_html_a9c76d03bc0e3c3a55898cf60cf1fbdcc"><div class="ttname"><a href="pede_8f90.html#a9c76d03bc0e3c3a55898cf60cf1fbdcc">mstart</a></div><div class="ttdeci">subroutine mstart(text)</div><div class="ttdoc">Start of 'module' printout.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l08749">pede.f90:8750</a></div></div>
<div class="ttc" id="apede_8f90_html_aba466fbf4e152b7b0367a5cf63e8311c"><div class="ttname"><a href="pede_8f90.html#aba466fbf4e152b7b0367a5cf63e8311c">binopn</a></div><div class="ttdeci">subroutine binopn(kfile, ithr, ierr)</div><div class="ttdoc">Open binary file.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l08909">pede.f90:8910</a></div></div>
<div class="ttc" id="apede_8f90_html_af8565eccdb9c88b8593d9584b2797261"><div class="ttname"><a href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a></div><div class="ttdeci">integer(mpi) function nufile(fname)</div><div class="ttdoc">Inquire on file.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l07965">pede.f90:7966</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79cbeadbb6d7ba1b17db5588ad706199"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79cbeadbb6d7ba1b17db5588ad706199">&#9670;&nbsp;</a></span>filetx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine filetx</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interprete text files. </p>
<p>Reset flags and read steering and all other text files. Print some lines from each file.</p>
<p>Store parameter values, constraints and measurements.</p>
<p>Check flags METSOL (method of solution) and MATSTO (matrix storage mode). Set default values for flags, which are undefined.</p>
<p>Parameter values, format: </p><pre class="fragment">  1  label
  2  (initial) parameter value
  3  pre-sigma
  4  label
  5  (initial) parameter value
  6  pre-sigma
  7  label
...  ...
(number of words is multiple of 3)
</pre><p> Constraint data, format: </p><pre class="fragment">  1  0                 ! constraint header of four words:
  2  right-hand-side   ! 0 and -1 ...
  3  -1; -2            ! ... indicate (weighting) ...
  4  sigma             ! ... header
  5  label
  6  factor
  7  label
  8  factor
  9  ...
...  ...
(number of words is multiple of 2, at least 6)
</pre><p> Measured data, format: </p><pre class="fragment">  1  0                 ! constraint header of four words:
  2  right-hand-side   ! 0 and -1 ...
  3  -1                ! ... indicate ...
  4  sigma             ! ... header
  5  label
  6  factor
  7  label
  8  factor
  9  ...
...  ...
(number of words is multiple of 2, at least 6)
</pre> 
<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l07733">7733</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l07734"></a><span class="lineno"> 7734</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l07735"></a><span class="lineno"> 7735</span>&#160; </div>
<div class="line"><a name="l07736"></a><span class="lineno"> 7736</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l07737"></a><span class="lineno"> 7737</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l07738"></a><span class="lineno"> 7738</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ia</div>
<div class="line"><a name="l07739"></a><span class="lineno"> 7739</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ib</div>
<div class="line"><a name="l07740"></a><span class="lineno"> 7740</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ierrf</div>
<div class="line"><a name="l07741"></a><span class="lineno"> 7741</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioff</div>
<div class="line"><a name="l07742"></a><span class="lineno"> 7742</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ios</div>
<div class="line"><a name="l07743"></a><span class="lineno"> 7743</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iosum</div>
<div class="line"><a name="l07744"></a><span class="lineno"> 7744</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l07745"></a><span class="lineno"> 7745</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: mat</div>
<div class="line"><a name="l07746"></a><span class="lineno"> 7746</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nab</div>
<div class="line"><a name="l07747"></a><span class="lineno"> 7747</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nfiln</div>
<div class="line"><a name="l07748"></a><span class="lineno"> 7748</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nline</div>
<div class="line"><a name="l07749"></a><span class="lineno"> 7749</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nlinmx</div>
<div class="line"><a name="l07750"></a><span class="lineno"> 7750</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: npat</div>
<div class="line"><a name="l07751"></a><span class="lineno"> 7751</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ntext</div>
<div class="line"><a name="l07752"></a><span class="lineno"> 7752</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: matint</div>
<div class="line"><a name="l07753"></a><span class="lineno"> 7753</span>&#160; </div>
<div class="line"><a name="l07754"></a><span class="lineno"> 7754</span>&#160;    <span class="comment">!      CALL MSTART(&#39;FILETX&#39;)</span></div>
<div class="line"><a name="l07755"></a><span class="lineno"> 7755</span>&#160; </div>
<div class="line"><a name="l07756"></a><span class="lineno"> 7756</span>&#160;    <span class="keywordtype">CHARACTER (LEN=1024)</span> :: text</div>
<div class="line"><a name="l07757"></a><span class="lineno"> 7757</span>&#160;    <span class="keywordtype">CHARACTER (LEN=1024)</span> :: fname</div>
<div class="line"><a name="l07758"></a><span class="lineno"> 7758</span>&#160; </div>
<div class="line"><a name="l07759"></a><span class="lineno"> 7759</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07760"></a><span class="lineno"> 7760</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Processing text files ...&#39;</span></div>
<div class="line"><a name="l07761"></a><span class="lineno"> 7761</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07762"></a><span class="lineno"> 7762</span>&#160; </div>
<div class="line"><a name="l07763"></a><span class="lineno"> 7763</span>&#160;    iosum=0</div>
<div class="line"><a name="l07764"></a><span class="lineno"> 7764</span>&#160;    ioff=0</div>
<div class="line"><a name="l07765"></a><span class="lineno"> 7765</span>&#160;    <span class="keywordflow">DO</span> i=0,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a></div>
<div class="line"><a name="l07766"></a><span class="lineno"> 7766</span>&#160;        <span class="keywordflow">IF</span>(i == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07767"></a><span class="lineno"> 7767</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;File &#39;</span>,<a class="code" href="namespacempmod.html#a7d8e53f24520a9472684d74dbce2e1ee">filnam</a>(1:<a class="code" href="namespacempmod.html#a9bf11710d618bc5b79694b3221961dd1">nfnam</a>)</div>
<div class="line"><a name="l07768"></a><span class="lineno"> 7768</span>&#160;            nlinmx=100</div>
<div class="line"><a name="l07769"></a><span class="lineno"> 7769</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07770"></a><span class="lineno"> 7770</span>&#160;            nlinmx=10</div>
<div class="line"><a name="l07771"></a><span class="lineno"> 7771</span>&#160;            ia=ioff</div>
<div class="line"><a name="l07772"></a><span class="lineno"> 7772</span>&#160;            ioff=ioff+<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)</div>
<div class="line"><a name="l07773"></a><span class="lineno"> 7773</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad5a01a98e1724b716c52ab248a29811d">mfd</a>(i) /= 2) cycle <span class="comment">! exclude binary files</span></div>
<div class="line"><a name="l07774"></a><span class="lineno"> 7774</span>&#160;            <span class="keywordflow">FORALL</span> (k=1:<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)) fname(k:k)=<a class="code" href="namespacempmod.html#aa4038b57cc5133652599ccafef6ab2c9">tfd</a>(ia+k)</div>
<div class="line"><a name="l07775"></a><span class="lineno"> 7775</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;File &#39;</span>,fname(1:<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i))</div>
<div class="line"><a name="l07776"></a><span class="lineno"> 7776</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 1) <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07777"></a><span class="lineno"> 7777</span>&#160;            <span class="keyword">OPEN</span>(10,file=fname(1:<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i)),iostat=ios,form=<span class="stringliteral">&#39;FORMATTED&#39;</span>)</div>
<div class="line"><a name="l07778"></a><span class="lineno"> 7778</span>&#160;            <span class="keywordflow">IF</span>(ios /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07779"></a><span class="lineno"> 7779</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Open error for file &#39;</span>,fname(1:<a class="code" href="namespacempmod.html#aa2f928b84ca88200d764fb129af56df3">lfd</a>(i))</div>
<div class="line"><a name="l07780"></a><span class="lineno"> 7780</span>&#160;                iosum=iosum+1</div>
<div class="line"><a name="l07781"></a><span class="lineno"> 7781</span>&#160;                cycle</div>
<div class="line"><a name="l07782"></a><span class="lineno"> 7782</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07783"></a><span class="lineno"> 7783</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07784"></a><span class="lineno"> 7784</span>&#160;  </div>
<div class="line"><a name="l07785"></a><span class="lineno"> 7785</span>&#160;        nline=0</div>
<div class="line"><a name="l07786"></a><span class="lineno"> 7786</span>&#160;        nfiln=1</div>
<div class="line"><a name="l07787"></a><span class="lineno"> 7787</span>&#160;        <span class="comment">!      read text file</span></div>
<div class="line"><a name="l07788"></a><span class="lineno"> 7788</span>&#160;        <span class="keywordflow">DO</span></div>
<div class="line"><a name="l07789"></a><span class="lineno"> 7789</span>&#160;            <span class="keyword">READ</span>(10,102,iostat=ierrf) text</div>
<div class="line"><a name="l07790"></a><span class="lineno"> 7790</span>&#160;            <span class="keywordflow">IF</span> (ierrf &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07791"></a><span class="lineno"> 7791</span>&#160;                text=<span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07792"></a><span class="lineno"> 7792</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a4c6bb3934f236ccdcc76e03883b379a8">intext</a>(text,nline)</div>
<div class="line"><a name="l07793"></a><span class="lineno"> 7793</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;    end-of-file after&#39;</span>,nline,<span class="stringliteral">&#39; text lines&#39;</span></div>
<div class="line"><a name="l07794"></a><span class="lineno"> 7794</span>&#160;                <span class="keywordflow">EXIT</span> <span class="comment">! eof</span></div>
<div class="line"><a name="l07795"></a><span class="lineno"> 7795</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l07796"></a><span class="lineno"> 7796</span>&#160;            nline=nline+1</div>
<div class="line"><a name="l07797"></a><span class="lineno"> 7797</span>&#160;            <span class="keywordflow">IF</span>(nline &lt;= nlinmx.AND.<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 1) <span class="keywordflow">THEN</span> <span class="comment">! print first 10 lines of every text fiLE</span></div>
<div class="line"><a name="l07798"></a><span class="lineno"> 7798</span>&#160;                <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#af6e4dfef4c87d0f39a54dab2f6b210d3">rltext</a>(text,ia,ib,nab)</div>
<div class="line"><a name="l07799"></a><span class="lineno"> 7799</span>&#160;                nab=max(1,nab)</div>
<div class="line"><a name="l07800"></a><span class="lineno"> 7800</span>&#160;                <span class="keyword">WRITE</span>(*,101) nline,text(1:nab)</div>
<div class="line"><a name="l07801"></a><span class="lineno"> 7801</span>&#160;                <span class="keywordflow">IF</span>(nline == nlinmx) <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;    ...&#39;</span></div>
<div class="line"><a name="l07802"></a><span class="lineno"> 7802</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07803"></a><span class="lineno"> 7803</span>&#160;  </div>
<div class="line"><a name="l07804"></a><span class="lineno"> 7804</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#af6e4dfef4c87d0f39a54dab2f6b210d3">rltext</a>(text,ia,ib,nab)        <span class="comment">! test content   &#39;end&#39;</span></div>
<div class="line"><a name="l07805"></a><span class="lineno"> 7805</span>&#160;            <span class="keywordflow">IF</span>(ib == ia+2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07806"></a><span class="lineno"> 7806</span>&#160;                mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(ia:ib),<span class="stringliteral">&#39;end&#39;</span>,npat,ntext)</div>
<div class="line"><a name="l07807"></a><span class="lineno"> 7807</span>&#160;                <span class="keywordflow">IF</span>(mat == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07808"></a><span class="lineno"> 7808</span>&#160;                    text=<span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07809"></a><span class="lineno"> 7809</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a4c6bb3934f236ccdcc76e03883b379a8">intext</a>(text,nline)</div>
<div class="line"><a name="l07810"></a><span class="lineno"> 7810</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;    end-statement after&#39;</span>,nline,<span class="stringliteral">&#39; text lines&#39;</span></div>
<div class="line"><a name="l07811"></a><span class="lineno"> 7811</span>&#160;                    <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l07812"></a><span class="lineno"> 7812</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l07813"></a><span class="lineno"> 7813</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07814"></a><span class="lineno"> 7814</span>&#160;  </div>
<div class="line"><a name="l07815"></a><span class="lineno"> 7815</span>&#160;            <span class="keywordflow">IF</span>(i == 0) <span class="keywordflow">THEN</span> <span class="comment">! first text file - exclude lines with file names</span></div>
<div class="line"><a name="l07816"></a><span class="lineno"> 7816</span>&#160;                <span class="keywordflow">IF</span>(nfiln &lt;= <a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>.AND.nline == <a class="code" href="namespacempmod.html#acd04929ac53adbddcec1f839e7053811">nfd</a>(nfiln)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07817"></a><span class="lineno"> 7817</span>&#160;                    nfiln=nfiln+1</div>
<div class="line"><a name="l07818"></a><span class="lineno"> 7818</span>&#160;                    text=<span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07819"></a><span class="lineno"> 7819</span>&#160;                <span class="comment">!             WRITE(*,*) &#39;line is excluded &#39;,TEXT(1:10)</span></div>
<div class="line"><a name="l07820"></a><span class="lineno"> 7820</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l07821"></a><span class="lineno"> 7821</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l07822"></a><span class="lineno"> 7822</span>&#160;            <span class="comment">!       WRITE(*,*) TEXT(1:40),&#39;  &lt; interprete text&#39;</span></div>
<div class="line"><a name="l07823"></a><span class="lineno"> 7823</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a4c6bb3934f236ccdcc76e03883b379a8">intext</a>(text,nline)   <span class="comment">! interprete text</span></div>
<div class="line"><a name="l07824"></a><span class="lineno"> 7824</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l07825"></a><span class="lineno"> 7825</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07826"></a><span class="lineno"> 7826</span>&#160;        rewind 10</div>
<div class="line"><a name="l07827"></a><span class="lineno"> 7827</span>&#160;        <span class="keyword">CLOSE</span>(unit=10)</div>
<div class="line"><a name="l07828"></a><span class="lineno"> 7828</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07829"></a><span class="lineno"> 7829</span>&#160; </div>
<div class="line"><a name="l07830"></a><span class="lineno"> 7830</span>&#160;    <span class="keywordflow">IF</span>(iosum /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07831"></a><span class="lineno"> 7831</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(16,<span class="stringliteral">&#39;Aborted, open error(s) for text files&#39;</span>)</div>
<div class="line"><a name="l07832"></a><span class="lineno"> 7832</span>&#160;        stop <span class="stringliteral">&#39;FILETX: open error(s) in text files                     &#39;</span></div>
<div class="line"><a name="l07833"></a><span class="lineno"> 7833</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07834"></a><span class="lineno"> 7834</span>&#160; </div>
<div class="line"><a name="l07835"></a><span class="lineno"> 7835</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;... end of text file processing.&#39;</span></div>
<div class="line"><a name="l07836"></a><span class="lineno"> 7836</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07837"></a><span class="lineno"> 7837</span>&#160; </div>
<div class="line"><a name="l07838"></a><span class="lineno"> 7838</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a287c246782de25addce912cde6d81762">lunkno</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07839"></a><span class="lineno"> 7839</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07840"></a><span class="lineno"> 7840</span>&#160;        <span class="keyword">WRITE</span>(*,*) <a class="code" href="namespacempmod.html#a287c246782de25addce912cde6d81762">lunkno</a>,<span class="stringliteral">&#39; unknown keywords in steering files, &#39;</span>,  &amp;</div>
<div class="line"><a name="l07841"></a><span class="lineno"> 7841</span>&#160;            <span class="stringliteral">&#39;or file non-existing,&#39;</span></div>
<div class="line"><a name="l07842"></a><span class="lineno"> 7842</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;   see above!&#39;</span></div>
<div class="line"><a name="l07843"></a><span class="lineno"> 7843</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;------------&gt;    stop&#39;</span></div>
<div class="line"><a name="l07844"></a><span class="lineno"> 7844</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07845"></a><span class="lineno"> 7845</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(13,<span class="stringliteral">&#39;Aborted, unknown keywords in steering file&#39;</span>)</div>
<div class="line"><a name="l07846"></a><span class="lineno"> 7846</span>&#160;        stop</div>
<div class="line"><a name="l07847"></a><span class="lineno"> 7847</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07848"></a><span class="lineno"> 7848</span>&#160; </div>
<div class="line"><a name="l07849"></a><span class="lineno"> 7849</span>&#160;    <span class="comment">!     check methods</span></div>
<div class="line"><a name="l07850"></a><span class="lineno"> 7850</span>&#160; </div>
<div class="line"><a name="l07851"></a><span class="lineno"> 7851</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 0) <span class="keywordflow">THEN</span>        <span class="comment">! if undefined</span></div>
<div class="line"><a name="l07852"></a><span class="lineno"> 7852</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 0) <span class="keywordflow">THEN</span>     <span class="comment">! if undefined</span></div>
<div class="line"><a name="l07853"></a><span class="lineno"> 7853</span>&#160;        <span class="comment">!            METSOL=1 ! default is matrix inversion</span></div>
<div class="line"><a name="l07854"></a><span class="lineno"> 7854</span>&#160;        <span class="comment">!            MATSTO=1 ! default is symmetric matrix</span></div>
<div class="line"><a name="l07855"></a><span class="lineno"> 7855</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 1) <span class="keywordflow">THEN</span> <span class="comment">! if symmetric</span></div>
<div class="line"><a name="l07856"></a><span class="lineno"> 7856</span>&#160;            <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=3 <span class="comment">! MINRES</span></div>
<div class="line"><a name="l07857"></a><span class="lineno"> 7857</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span> <span class="comment">! if sparse</span></div>
<div class="line"><a name="l07858"></a><span class="lineno"> 7858</span>&#160;            <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=3 <span class="comment">! MINRES</span></div>
<div class="line"><a name="l07859"></a><span class="lineno"> 7859</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07860"></a><span class="lineno"> 7860</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1) <span class="keywordflow">THEN</span>   <span class="comment">! if inversion</span></div>
<div class="line"><a name="l07861"></a><span class="lineno"> 7861</span>&#160;        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=1    <span class="comment">!</span></div>
<div class="line"><a name="l07862"></a><span class="lineno"> 7862</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span>   <span class="comment">! if diagonalization</span></div>
<div class="line"><a name="l07863"></a><span class="lineno"> 7863</span>&#160;        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=1</div>
<div class="line"><a name="l07864"></a><span class="lineno"> 7864</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3) <span class="keywordflow">THEN</span>   <span class="comment">! if MINRES</span></div>
<div class="line"><a name="l07865"></a><span class="lineno"> 7865</span>&#160;    <span class="comment">!        MATSTO=2 or 1</span></div>
<div class="line"><a name="l07866"></a><span class="lineno"> 7866</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span>   <span class="comment">! if MINRES-QLP</span></div>
<div class="line"><a name="l07867"></a><span class="lineno"> 7867</span>&#160;    <span class="comment">!        MATSTO=2 or 1</span></div>
<div class="line"><a name="l07868"></a><span class="lineno"> 7868</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 5) <span class="keywordflow">THEN</span>   <span class="comment">! if GMRES</span></div>
<div class="line"><a name="l07869"></a><span class="lineno"> 7869</span>&#160;    <span class="comment">!        MATSTO=2 or 1</span></div>
<div class="line"><a name="l07870"></a><span class="lineno"> 7870</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07871"></a><span class="lineno"> 7871</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;MINRES forced with sparse matrix!&#39;</span></div>
<div class="line"><a name="l07872"></a><span class="lineno"> 7872</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07873"></a><span class="lineno"> 7873</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;MINRES forced with sparse matrix!&#39;</span></div>
<div class="line"><a name="l07874"></a><span class="lineno"> 7874</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07875"></a><span class="lineno"> 7875</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;MINRES forced with sparse matrix!&#39;</span></div>
<div class="line"><a name="l07876"></a><span class="lineno"> 7876</span>&#160;        <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=3 <span class="comment">! forced</span></div>
<div class="line"><a name="l07877"></a><span class="lineno"> 7877</span>&#160;        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=2 <span class="comment">! forced</span></div>
<div class="line"><a name="l07878"></a><span class="lineno"> 7878</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07879"></a><span class="lineno"> 7879</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> &gt; 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07880"></a><span class="lineno"> 7880</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;MINRES forced with sparse matrix!&#39;</span></div>
<div class="line"><a name="l07881"></a><span class="lineno"> 7881</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07882"></a><span class="lineno"> 7882</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;MINRES forced with sparse matrix!&#39;</span></div>
<div class="line"><a name="l07883"></a><span class="lineno"> 7883</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07884"></a><span class="lineno"> 7884</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;MINRES forced with sparse matrix!&#39;</span></div>
<div class="line"><a name="l07885"></a><span class="lineno"> 7885</span>&#160;        <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=3 <span class="comment">! forced</span></div>
<div class="line"><a name="l07886"></a><span class="lineno"> 7886</span>&#160;        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=2 <span class="comment">! forced</span></div>
<div class="line"><a name="l07887"></a><span class="lineno"> 7887</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07888"></a><span class="lineno"> 7888</span>&#160; </div>
<div class="line"><a name="l07889"></a><span class="lineno"> 7889</span>&#160;    <span class="comment">!     print information about methods and matrix storage modes</span></div>
<div class="line"><a name="l07890"></a><span class="lineno"> 7890</span>&#160; </div>
<div class="line"><a name="l07891"></a><span class="lineno"> 7891</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07892"></a><span class="lineno"> 7892</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Solution method and matrix-storage mode:&#39;</span></div>
<div class="line"><a name="l07893"></a><span class="lineno"> 7893</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07894"></a><span class="lineno"> 7894</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;     METSOL = 1:  matrix inversion&#39;</span></div>
<div class="line"><a name="l07895"></a><span class="lineno"> 7895</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07896"></a><span class="lineno"> 7896</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;     METSOL = 2:  diagonalization&#39;</span></div>
<div class="line"><a name="l07897"></a><span class="lineno"> 7897</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07898"></a><span class="lineno"> 7898</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;     METSOL = 3:  MINRES&#39;</span></div>
<div class="line"><a name="l07899"></a><span class="lineno"> 7899</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07900"></a><span class="lineno"> 7900</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;     METSOL = 4:  MINRES-QLP&#39;</span></div>
<div class="line"><a name="l07901"></a><span class="lineno"> 7901</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 5) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07902"></a><span class="lineno"> 7902</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;     METSOL = 5:  GMRES (-&gt; MINRES)&#39;</span></div>
<div class="line"><a name="l07903"></a><span class="lineno"> 7903</span>&#160;  </div>
<div class="line"><a name="l07904"></a><span class="lineno"> 7904</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07905"></a><span class="lineno"> 7905</span>&#160; </div>
<div class="line"><a name="l07906"></a><span class="lineno"> 7906</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;                  with&#39;</span>,<a class="code" href="namespacempmod.html#a880fa8e41c4e97b22457dd7d5948085d">mitera</a>,<span class="stringliteral">&#39; iterations&#39;</span></div>
<div class="line"><a name="l07907"></a><span class="lineno"> 7907</span>&#160; </div>
<div class="line"><a name="l07908"></a><span class="lineno"> 7908</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07909"></a><span class="lineno"> 7909</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;     MATSTO = 1:  symmetric matrix, &#39;</span>, <span class="stringliteral">&#39;(n*n+n)/2 elements&#39;</span></div>
<div class="line"><a name="l07910"></a><span class="lineno"> 7910</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07911"></a><span class="lineno"> 7911</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;     MATSTO = 2:  sparse matrix&#39;</span></div>
<div class="line"><a name="l07912"></a><span class="lineno"> 7912</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07913"></a><span class="lineno"> 7913</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07914"></a><span class="lineno"> 7914</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;                  and band matrix, width&#39;</span>,<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a></div>
<div class="line"><a name="l07915"></a><span class="lineno"> 7915</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07916"></a><span class="lineno"> 7916</span>&#160; </div>
<div class="line"><a name="l07917"></a><span class="lineno"> 7917</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> /= 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07918"></a><span class="lineno"> 7918</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Chi square cut equiv 3 st.dev applied ...&#39;</span></div>
<div class="line"><a name="l07919"></a><span class="lineno"> 7919</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; in  first iteration with factor&#39;</span>,<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a></div>
<div class="line"><a name="l07920"></a><span class="lineno"> 7920</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; in second iteration with factor&#39;</span>,<a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a></div>
<div class="line"><a name="l07921"></a><span class="lineno"> 7921</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; (reduced by sqrt in next iterations)&#39;</span></div>
<div class="line"><a name="l07922"></a><span class="lineno"> 7922</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07923"></a><span class="lineno"> 7923</span>&#160; </div>
<div class="line"><a name="l07924"></a><span class="lineno"> 7924</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07925"></a><span class="lineno"> 7925</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;   Down-weighting of outliers in&#39;</span>, <a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a>,<span class="stringliteral">&#39; iterations&#39;</span></div>
<div class="line"><a name="l07926"></a><span class="lineno"> 7926</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;   Cut on downweight fraction&#39;</span>,<a class="code" href="namespacempmod.html#a5e0286590b4d042e8d883ffa7aa82726">dwcut</a></div>
<div class="line"><a name="l07927"></a><span class="lineno"> 7927</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07928"></a><span class="lineno"> 7928</span>&#160; </div>
<div class="line"><a name="l07929"></a><span class="lineno"> 7929</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Iterations (solutions) with line search:&#39;</span></div>
<div class="line"><a name="l07930"></a><span class="lineno"> 7930</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#af9c19a04780821443ac195c341a4e678">lsearch</a> &gt; 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07931"></a><span class="lineno"> 7931</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; All&#39;</span></div>
<div class="line"><a name="l07932"></a><span class="lineno"> 7932</span>&#160;    <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacempmod.html#af9c19a04780821443ac195c341a4e678">lsearch</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07933"></a><span class="lineno"> 7933</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; Last&#39;</span></div>
<div class="line"><a name="l07934"></a><span class="lineno"> 7934</span>&#160;    <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacempmod.html#af9c19a04780821443ac195c341a4e678">lsearch</a> &lt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07935"></a><span class="lineno"> 7935</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; None&#39;</span></div>
<div class="line"><a name="l07936"></a><span class="lineno"> 7936</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07937"></a><span class="lineno"> 7937</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> /= 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07938"></a><span class="lineno"> 7938</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; All with Chi square cut scaling factor &lt;= 1.&#39;</span></div>
<div class="line"><a name="l07939"></a><span class="lineno"> 7939</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07940"></a><span class="lineno"> 7940</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; All&#39;</span></div>
<div class="line"><a name="l07941"></a><span class="lineno"> 7941</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l07942"></a><span class="lineno"> 7942</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l07943"></a><span class="lineno"> 7943</span>&#160; </div>
<div class="line"><a name="l07944"></a><span class="lineno"> 7944</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a46fe780b490c7ebf29ce9beaca53f4b6">nummeasurements</a>&gt;0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07945"></a><span class="lineno"> 7945</span>&#160;        <span class="keyword">WRITE</span>(*,*) </div>
<div class="line"><a name="l07946"></a><span class="lineno"> 7946</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; Number of external measurements &#39;</span>, <a class="code" href="namespacempmod.html#a46fe780b490c7ebf29ce9beaca53f4b6">nummeasurements</a></div>
<div class="line"><a name="l07947"></a><span class="lineno"> 7947</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l07948"></a><span class="lineno"> 7948</span>&#160;    </div>
<div class="line"><a name="l07949"></a><span class="lineno"> 7949</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9f1cf38841260b60fa064f16b1f06cbc">mend</a></div>
<div class="line"><a name="l07950"></a><span class="lineno"> 7950</span>&#160; </div>
<div class="line"><a name="l07951"></a><span class="lineno"> 7951</span>&#160;101 <span class="keyword">FORMAT</span>(i3,2x,a)</div>
<div class="line"><a name="l07952"></a><span class="lineno"> 7952</span>&#160;102 <span class="keyword">FORMAT</span>(a)</div>
<div class="ttc" id="anamespacempmod_html_a287c246782de25addce912cde6d81762"><div class="ttname"><a href="namespacempmod.html#a287c246782de25addce912cde6d81762">mpmod::lunkno</a></div><div class="ttdeci">integer(mpi) lunkno</div><div class="ttdoc">flag for unkown keywords</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00045">mpmod.f90:45</a></div></div>
<div class="ttc" id="anamespacempmod_html_a35bd9aa2a4c5b99227310b10bf934cc3"><div class="ttname"><a href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">mpmod::chirem</a></div><div class="ttdeci">real(mps) chirem</div><div class="ttdoc">cut in terms of 3-sigma cut, other iterations, approaching 1.</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00048">mpmod.f90:48</a></div></div>
<div class="ttc" id="anamespacempmod_html_a46fe780b490c7ebf29ce9beaca53f4b6"><div class="ttname"><a href="namespacempmod.html#a46fe780b490c7ebf29ce9beaca53f4b6">mpmod::nummeasurements</a></div><div class="ttdeci">integer(mpi) nummeasurements</div><div class="ttdoc">number of (external) measurements from steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00277">mpmod.f90:277</a></div></div>
<div class="ttc" id="anamespacempmod_html_a5c18a685730f9b6f5e79316ffb84dd56"><div class="ttname"><a href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mpmod::mbandw</a></div><div class="ttdeci">integer(mpi) mbandw</div><div class="ttdoc">band width of preconditioner matrix</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00043">mpmod.f90:43</a></div></div>
<div class="ttc" id="anamespacempmod_html_a5e0286590b4d042e8d883ffa7aa82726"><div class="ttname"><a href="namespacempmod.html#a5e0286590b4d042e8d883ffa7aa82726">mpmod::dwcut</a></div><div class="ttdeci">real(mps) dwcut</div><div class="ttdoc">down-weight fraction cut</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00056">mpmod.f90:56</a></div></div>
<div class="ttc" id="anamespacempmod_html_a880fa8e41c4e97b22457dd7d5948085d"><div class="ttname"><a href="namespacempmod.html#a880fa8e41c4e97b22457dd7d5948085d">mpmod::mitera</a></div><div class="ttdeci">integer(mpi) mitera</div><div class="ttdoc">number of iterations</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00041">mpmod.f90:41</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad21dcfeb0abe011282d736f16516c81e"><div class="ttname"><a href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">mpmod::lhuber</a></div><div class="ttdeci">integer(mpi) lhuber</div><div class="ttdoc">Huber down-weighting flag.</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00046">mpmod.f90:46</a></div></div>
<div class="ttc" id="anamespacempmod_html_af9c19a04780821443ac195c341a4e678"><div class="ttname"><a href="namespacempmod.html#af9c19a04780821443ac195c341a4e678">mpmod::lsearch</a></div><div class="ttdeci">integer(mpi) lsearch</div><div class="ttdoc">iterations (solutions) with line search: &gt;2: all, =2: all with (next) Chi2 cut scaling factor =1....</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00098">mpmod.f90:98</a></div></div>
<div class="ttc" id="anamespacempmod_html_afec212accc825c6969fc5160ca45d5e7"><div class="ttname"><a href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">mpmod::chicut</a></div><div class="ttdeci">real(mps) chicut</div><div class="ttdoc">cut in terms of 3-sigma cut, first iteration</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00047">mpmod.f90:47</a></div></div>
<div class="ttc" id="apede_8f90_html_a9f1cf38841260b60fa064f16b1f06cbc"><div class="ttname"><a href="pede_8f90.html#a9f1cf38841260b60fa064f16b1f06cbc">mend</a></div><div class="ttdeci">subroutine mend</div><div class="ttdoc">End of 'module' printout.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l08785">pede.f90:8786</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6aec1171868141ca383a49764641bd7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6aec1171868141ca383a49764641bd7f">&#9670;&nbsp;</a></span>getsum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine getsum </td>
          <td>(</td>
          <td class="paramtype">real(mpd), intent(out)&#160;</td>
          <td class="paramname"><em>asum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get accurate sum. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">asum</td><td>accurate sum </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l09066">9066</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l09067"></a><span class="lineno"> 9067</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l09068"></a><span class="lineno"> 9068</span>&#160; </div>
<div class="line"><a name="l09069"></a><span class="lineno"> 9069</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l09070"></a><span class="lineno"> 9070</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(OUT)</span> ::asum</div>
<div class="line"><a name="l09071"></a><span class="lineno"> 9071</span>&#160;    asum=(<a class="code" href="namespacempmod.html#a820f63d630792597c41780dd2a6d1e55">accuratedsum</a>+real(<a class="code" href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">accuratensum</a>,mpd))+real(<a class="code" href="namespacempmod.html#a721d239daf81dac3252383b72467d705">accuratenexp</a>,mpd)*real(<a class="code" href="namespacempmod.html#a3b047e81c0b40b59237660cf09ffb1d3">nexp20</a>,mpd)</div>
<div class="line"><a name="l09072"></a><span class="lineno"> 9072</span>&#160;    <a class="code" href="namespacempmod.html#a820f63d630792597c41780dd2a6d1e55">accuratedsum</a>=0.0_mpd</div>
<div class="line"><a name="l09073"></a><span class="lineno"> 9073</span>&#160;    <a class="code" href="namespacempmod.html#acc78106d0f44a814ec8e7779001f28d6">accuratensum</a>=0</div>
<div class="line"><a name="l09074"></a><span class="lineno"> 9074</span>&#160;    <a class="code" href="namespacempmod.html#a721d239daf81dac3252383b72467d705">accuratenexp</a>=0</div>
<div class="line"><a name="l09075"></a><span class="lineno"> 9075</span>&#160;    <span class="keywordflow">RETURN</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a50f66d2e4734adbf982eb00fd98b4765"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50f66d2e4734adbf982eb00fd98b4765">&#9670;&nbsp;</a></span>ijadd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(mpl) function ijadd </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>itema</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>itemb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Index for sparse storage. </p>
<p>In case of (compressed) sparse storage calculate index for off-diagonal matrix element.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">itema</td><td>row number </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">itemb</td><td>column number </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>index (&gt;(&lt;) 0: double(single) precision element, =0: not existing) </dd></dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04432">4432</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160; </div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iencdb</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iencdm</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isgn</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ispc</div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: item2</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jtem</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jtemc</div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jtemn</div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160; </div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: itema</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: itemb</div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160; </div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ijadd</div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: k</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: kk</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: kl</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ku</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: indid</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: nd</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ll</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: k8</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: item1</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;    <a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>=0</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;    nd=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(2,1)-1   <span class="comment">! dimension of matrix</span></div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;    item1=max(itema,itemb)          <span class="comment">! larger index</span></div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;    item2=min(itema,itemb)          <span class="comment">! smaller index</span></div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;    <span class="keywordflow">IF</span>(item2 &lt;= 0.OR.item1 &gt; nd) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;    <span class="keywordflow">IF</span>(item1 == item2) <span class="keywordflow">THEN</span>         <span class="comment">! diagonal element</span></div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;        <a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>=item1</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;        <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;    <span class="comment">!                                   ! off-diagonal element</span></div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;    iencdb=<a class="code" href="namespacempmod.html#ad7d459edc90892891995ccb3ac96b6f3">nencdb</a>                       <span class="comment">! encoding info</span></div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;    iencdm=ishft(1,iencdb)-1</div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;    isgn=-1</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;    outer: <span class="keywordflow">DO</span> ispc=1,<a class="code" href="namespacempmod.html#a4ef9f014f98a92d810584e67f14f40ec">nspc</a></div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;        kk=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(1,item1) <span class="comment">! offset in &#39;d&#39; (column lists)</span></div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;        ll=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(2,item1) <span class="comment">! offset in &#39;j&#39; (matrix)</span></div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;        kl=0</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;        ku=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(1,item1+1)-1-kk</div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;        indid=kk</div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;        item1=item1+nd+1</div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;        isgn=-isgn</div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid) == 0) <span class="keywordflow">THEN</span>     <span class="comment">! compression ?</span></div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;    </div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;            ku=((ku+1)*8)/9-1        <span class="comment">! number of regions (-1)</span></div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;            indid=indid+ku/8+1       <span class="comment">! skip group offsets</span></div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;            kl=0</div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;            <span class="keywordflow">IF</span>(ku &lt; kl) cycle outer  <span class="comment">! not found</span></div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;            <span class="keywordflow">DO</span></div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;                k=(kl+ku)/2                    <span class="comment">! binary search</span></div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;                jtemc=<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+k)              <span class="comment">! compressed information</span></div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;                jtem =ishft(jtemc,-iencdb)     <span class="comment">! first column of region</span></div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;                jtemn=jtem+iand(jtemc,iencdm)  <span class="comment">! first column after region</span></div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;                <span class="keywordflow">IF</span>(item2 &gt;= jtem.AND.item2 &lt; jtemn) <span class="keywordflow">EXIT</span> <span class="comment">! found</span></div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;                <span class="keywordflow">IF</span>(item2 &lt; jtem) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;                    ku=k-1</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(item2 &gt;= jtemn) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;                    kl=k+1</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;                <span class="keywordflow">IF</span>(kl &lt;= ku) cycle</div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;                cycle outer <span class="comment">! not found</span></div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;            k8=k/8                            <span class="comment">! region group (-1)</span></div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;            ll=ll+<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(kk+k8)  <span class="comment">! offset for group of (8) regions</span></div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;            <span class="keywordflow">DO</span> kl=k8*8,k-1</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;                ll=ll+iand(<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+kl),iencdm) <span class="comment">! add region lengths</span></div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;            <a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>=ll+item2-jtem</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;    </div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;    </div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;            <span class="keywordflow">IF</span>(ku &lt; kl) cycle outer <span class="comment">! not found</span></div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;            <span class="keywordflow">DO</span></div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;                k=(kl+ku)/2                  <span class="comment">! binary search</span></div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;                jtem=<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+k)</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;                jtemn=jtem</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;                <span class="keywordflow">IF</span>(item2 == jtem) <span class="keywordflow">EXIT</span> <span class="comment">! found</span></div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;                <span class="keywordflow">IF</span>(item2 &lt; jtem) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;                    ku=k-1</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(item2 &gt; jtem) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;                    kl=k+1</div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;                <span class="keywordflow">IF</span>(kl &lt;= ku) cycle</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;                cycle outer  <span class="comment">! not found</span></div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;            <a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>=ll+k</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160; </div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;        <a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>=<a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>*isgn</div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;        <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;<span class="keywordflow">    END DO</span> outer</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160; </div>
<div class="ttc" id="apede_8f90_html_a50f66d2e4734adbf982eb00fd98b4765"><div class="ttname"><a href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a></div><div class="ttdeci">integer(mpl) function ijadd(itema, itemb)</div><div class="ttdoc">Index for sparse storage.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l04432">pede.f90:4433</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad3441582f1e3d1880efd14bb86c592aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3441582f1e3d1880efd14bb86c592aa">&#9670;&nbsp;</a></span>inone()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(mpi) function inone </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>item</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Translate labels to indices (for global parameters). </p>
<p>Functions INONE and subroutine UPONE are used to collect items, i.e. labels, and to order and translate them.</p>
<p>In the first phase items are collected and stored by calling <code>IRES=INONE(ITEM)</code>.</p>
<p>At the first entry the two sub-arrays "a" (globalParLabelIndex) and "b" (globalParHashTable) of length 2N are generated with a start length for N=128 entries. In array "a" two words are reserved for each item: (ITEM, count). The function INONE(ITEM) returns the number of the item. At each entry the argument is compared with the already stored items, new items are stored. Search for entries is done using hash-indices, stored in sub-array "b". The initial hash-index is </p><pre class="fragment">   j = 1 + mod(ITEM, n_prime) + N
</pre><p> where n_prime is the largest prime number less than N. At each entry the count is increased by one. If N items are stored, the size of the sub-arrays is increased by calling <code>CALL UPONE</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">item</td><td>label </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>index </dd></dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04662">4662</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160; </div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: item</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iprime</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: length</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>, <span class="keywordtype">PARAMETER</span> :: two = 2</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160; </div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;    <a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>=0</div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;    <span class="keywordflow">IF</span>(item &lt;= 0) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1) == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;        length=128                   <span class="comment">! initial number</span></div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>,two,length,<span class="stringliteral">&#39;INONE: label &amp; index&#39;</span>)</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">globalparhashtable</a>,2*length,<span class="stringliteral">&#39;INONE: hash pointer&#39;</span>)</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;        <a class="code" href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">globalparhashtable</a> = 0</div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-0)=int(length,mpi)       <span class="comment">! length of labels/indices</span></div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)=0                 <span class="comment">! number of stored items</span></div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-2)=0                 <span class="comment">! =0 during build-up</span></div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-3)=int(length,mpi)       <span class="comment">! next number</span></div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-4)=<a class="code" href="pede_8f90.html#a7aa3f7f61de11f6e0d2a7dced6d3f69a">iprime</a>(<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-0))    <span class="comment">! prime number</span></div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-5)=0                 <span class="comment">! number of overflows</span></div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-6)=0                 <span class="comment">! nr of variable parameters</span></div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;    outer: <span class="keywordflow">DO</span></div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;        j=1+mod(item,<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-4))+<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-0)</div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;        inner: <span class="keywordflow">DO</span> <span class="comment">! normal case: find item</span></div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;            k=j</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;            j=<a class="code" href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">globalparhashtable</a>(k)</div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;            <span class="keywordflow">IF</span>(j == 0) <span class="keywordflow">EXIT</span> inner    <span class="comment">! unused hash code</span></div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;            <span class="keywordflow">IF</span>(item == <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,j)) <span class="keywordflow">EXIT</span> outer <span class="comment">! found</span></div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;<span class="keywordflow">        END DO</span> inner</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;        <span class="comment">! not found</span></div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1) == <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-0).OR.<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-2) /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;            <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-5)=<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-5)+1 <span class="comment">! overflow</span></div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;            j=0</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)=<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)+1      <span class="comment">! increase number of elements</span></div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-3)=<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;        j=<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;        <a class="code" href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">globalparhashtable</a>(k)=j                <span class="comment">! hash index</span></div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;        <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,j)=item          <span class="comment">! add new item</span></div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;        <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,j)=0             <span class="comment">! reset counter</span></div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1) /= <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-0)) <span class="keywordflow">EXIT</span> outer</div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;        <span class="comment">! update with larger dimension and redefine index</span></div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-3)=<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-3)*2</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a44d814f6965ac4c5b4ff7bbcd2cd2a81">upone</a></div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aaa30cb56ca934b418737a68984572a94">lvllog</a> &gt; 1) <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;INONE: array increased to&#39;</span>,  &amp;</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;            <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-3),<span class="stringliteral">&#39; words&#39;</span></div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;<span class="keywordflow">    END DO</span> outer</div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160; </div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-2) == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;        <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,j)=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,j)+1 <span class="comment">! increase counter</span></div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;        <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-7)=<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-7)+1</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;    <a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>=j</div>
<div class="ttc" id="anamespacempmod_html_a4488f6309fa46c9530700bc3a0cfded1"><div class="ttname"><a href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">mpmod::globalparheader</a></div><div class="ttdeci">integer(mpi), dimension(-7:0) globalparheader</div><div class="ttdoc">global parameters (mapping) header</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00217">mpmod.f90:217</a></div></div>
<div class="ttc" id="anamespacempmod_html_a523a4554452c5d2f3701b32fa121569e"><div class="ttname"><a href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">mpmod::globalparhashtable</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable globalparhashtable</div><div class="ttdoc">global parameters hash table</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00215">mpmod.f90:215</a></div></div>
<div class="ttc" id="anamespacempmod_html_a7e5f04f69ce192eab3da3c6adef45544"><div class="ttname"><a href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">mpmod::lunlog</a></div><div class="ttdeci">integer(mpi) lunlog</div><div class="ttdoc">unit for logfile</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00115">mpmod.f90:115</a></div></div>
<div class="ttc" id="anamespacempmod_html_aaa30cb56ca934b418737a68984572a94"><div class="ttname"><a href="namespacempmod.html#aaa30cb56ca934b418737a68984572a94">mpmod::lvllog</a></div><div class="ttdeci">integer(mpi) lvllog</div><div class="ttdoc">log level</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00116">mpmod.f90:116</a></div></div>
<div class="ttc" id="apede_8f90_html_a44d814f6965ac4c5b4ff7bbcd2cd2a81"><div class="ttname"><a href="pede_8f90.html#a44d814f6965ac4c5b4ff7bbcd2cd2a81">upone</a></div><div class="ttdeci">subroutine upone</div><div class="ttdoc">Update, redefine hash indices.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l04725">pede.f90:4726</a></div></div>
<div class="ttc" id="apede_8f90_html_a7aa3f7f61de11f6e0d2a7dced6d3f69a"><div class="ttname"><a href="pede_8f90.html#a7aa3f7f61de11f6e0d2a7dced6d3f69a">iprime</a></div><div class="ttdeci">integer(mpi) function iprime(n)</div><div class="ttdoc">largest prime number &lt; N.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l04789">pede.f90:4790</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4c6bb3934f236ccdcc76e03883b379a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c6bb3934f236ccdcc76e03883b379a8">&#9670;&nbsp;</a></span>intext()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine intext </td>
          <td>(</td>
          <td class="paramtype">character (len=*), intent(in)&#160;</td>
          <td class="paramname"><em>text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>nline</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interprete text. </p>
<p>Look for keywords and argument in text line.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">text</td><td>text </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nline</td><td>line number </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l08019">8019</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l08020"></a><span class="lineno"> 8020</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l08021"></a><span class="lineno"> 8021</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacemptext.html">mptext</a></div>
<div class="line"><a name="l08022"></a><span class="lineno"> 8022</span>&#160; </div>
<div class="line"><a name="l08023"></a><span class="lineno"> 8023</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l08024"></a><span class="lineno"> 8024</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l08025"></a><span class="lineno"> 8025</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ia</div>
<div class="line"><a name="l08026"></a><span class="lineno"> 8026</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ib</div>
<div class="line"><a name="l08027"></a><span class="lineno"> 8027</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ier</div>
<div class="line"><a name="l08028"></a><span class="lineno"> 8028</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iomp</div>
<div class="line"><a name="l08029"></a><span class="lineno"> 8029</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l08030"></a><span class="lineno"> 8030</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: kkey</div>
<div class="line"><a name="l08031"></a><span class="lineno"> 8031</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: label</div>
<div class="line"><a name="l08032"></a><span class="lineno"> 8032</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lkey</div>
<div class="line"><a name="l08033"></a><span class="lineno"> 8033</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: mat</div>
<div class="line"><a name="l08034"></a><span class="lineno"> 8034</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: miter</div>
<div class="line"><a name="l08035"></a><span class="lineno"> 8035</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nab</div>
<div class="line"><a name="l08036"></a><span class="lineno"> 8036</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nkey</div>
<div class="line"><a name="l08037"></a><span class="lineno"> 8037</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nkeys</div>
<div class="line"><a name="l08038"></a><span class="lineno"> 8038</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nl</div>
<div class="line"><a name="l08039"></a><span class="lineno"> 8039</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nmeth</div>
<div class="line"><a name="l08040"></a><span class="lineno"> 8040</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: npat</div>
<div class="line"><a name="l08041"></a><span class="lineno"> 8041</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ntext</div>
<div class="line"><a name="l08042"></a><span class="lineno"> 8042</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nums</div>
<div class="line"><a name="l08043"></a><span class="lineno"> 8043</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: matint</div>
<div class="line"><a name="l08044"></a><span class="lineno"> 8044</span>&#160; </div>
<div class="line"><a name="l08045"></a><span class="lineno"> 8045</span>&#160;    <span class="keywordtype">CHARACTER (LEN=*)</span>, <span class="keywordtype">INTENT(IN)</span> :: text</div>
<div class="line"><a name="l08046"></a><span class="lineno"> 8046</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: nline</div>
<div class="line"><a name="l08047"></a><span class="lineno"> 8047</span>&#160; </div>
<div class="line"><a name="l08048"></a><span class="lineno"> 8048</span>&#160;    parameter(nkeys=5,nmeth=6)</div>
<div class="line"><a name="l08049"></a><span class="lineno"> 8049</span>&#160;    <span class="keywordtype">CHARACTER (LEN=16)</span> :: methxt(nmeth)</div>
<div class="line"><a name="l08050"></a><span class="lineno"> 8050</span>&#160;    <span class="keywordtype">CHARACTER (LEN=16)</span> :: keylst(nkeys)</div>
<div class="line"><a name="l08051"></a><span class="lineno"> 8051</span>&#160;    <span class="keywordtype">CHARACTER (LEN=32)</span> :: keywrd</div>
<div class="line"><a name="l08052"></a><span class="lineno"> 8052</span>&#160;    <span class="keywordtype">CHARACTER (LEN=32)</span> :: keystx</div>
<div class="line"><a name="l08053"></a><span class="lineno"> 8053</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: dnum(100)</div>
<div class="line"><a name="l08054"></a><span class="lineno"> 8054</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lpvs    <span class="comment">! ... integer</span></div>
<div class="line"><a name="l08055"></a><span class="lineno"> 8055</span>&#160;<span class="keywordtype">    REAL</span>(mpd)    :: plvs    <span class="comment">! ... float</span></div>
<div class="line"><a name="l08056"></a><span class="lineno"> 8056</span>&#160; </div>
<div class="line"><a name="l08057"></a><span class="lineno"> 8057</span>&#160;    <span class="keyword">INTERFACE</span></div>
<div class="line"><a name="l08058"></a><span class="lineno"> 8058</span>&#160;        <span class="keyword">SUBROUTINE </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(length,list,label,value)</div>
<div class="line"><a name="l08059"></a><span class="lineno"> 8059</span>&#160;            <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l08060"></a><span class="lineno"> 8060</span>&#160;            <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN OUT)</span> :: length</div>
<div class="line"><a name="l08061"></a><span class="lineno"> 8061</span>&#160;            <span class="keywordtype">TYPE</span>(listItem), <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">INTENT(IN OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: list</div>
<div class="line"><a name="l08062"></a><span class="lineno"> 8062</span>&#160;            <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: label</div>
<div class="line"><a name="l08063"></a><span class="lineno"> 8063</span>&#160;<span class="keywordtype">            REAL</span>(mpd), <span class="keywordtype">INTENT(IN)</span> :: value</div>
<div class="line"><a name="l08064"></a><span class="lineno"> 8064</span>&#160;        <span class="keyword">END SUBROUTINE </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a></div>
<div class="line"><a name="l08065"></a><span class="lineno"> 8065</span>&#160;    <span class="keyword">END INTERFACE</span></div>
<div class="line"><a name="l08066"></a><span class="lineno"> 8066</span>&#160; </div>
<div class="line"><a name="l08067"></a><span class="lineno"> 8067</span>&#160;    <span class="keyword">DATA</span> keylst/<span class="stringliteral">&#39;unknown&#39;</span>,<span class="stringliteral">&#39;parameter&#39;</span>,<span class="stringliteral">&#39;constraint&#39;</span>,<span class="stringliteral">&#39;measurement&#39;</span>,<span class="stringliteral">&#39;method&#39;</span>/</div>
<div class="line"><a name="l08068"></a><span class="lineno"> 8068</span>&#160; </div>
<div class="line"><a name="l08069"></a><span class="lineno"> 8069</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l08070"></a><span class="lineno"> 8070</span>&#160;    <span class="keyword">DATA</span> methxt/<span class="stringliteral">&#39;diagonalization&#39;</span>,<span class="stringliteral">&#39;inversion&#39;</span>,<span class="stringliteral">&#39;fullMINRES&#39;</span>, <span class="stringliteral">&#39;sparseMINRES&#39;</span>, &amp;</div>
<div class="line"><a name="l08071"></a><span class="lineno"> 8071</span>&#160;        <span class="stringliteral">&#39;fullMINRES-QLP&#39;</span>, <span class="stringliteral">&#39;sparseMINRES-QLP&#39;</span>/</div>
<div class="line"><a name="l08072"></a><span class="lineno"> 8072</span>&#160;    <span class="keyword">DATA</span> lkey/-1/                 <span class="comment">! last keyword</span></div>
<div class="line"><a name="l08073"></a><span class="lineno"> 8073</span>&#160; </div>
<div class="line"><a name="l08074"></a><span class="lineno"> 8074</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l08075"></a><span class="lineno"> 8075</span>&#160;    nkey=-1                       <span class="comment">! new keyword</span></div>
<div class="line"><a name="l08076"></a><span class="lineno"> 8076</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#af6e4dfef4c87d0f39a54dab2f6b210d3">rltext</a>(text,ia,ib,nab)   <span class="comment">! return indices for non-blank area</span></div>
<div class="line"><a name="l08077"></a><span class="lineno"> 8077</span>&#160;    <span class="keywordflow">IF</span>(nab == 0) <span class="keywordflow">GOTO</span> 10</div>
<div class="line"><a name="l08078"></a><span class="lineno"> 8078</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mptext_8f90.html#ac707e6fabcc93cc4eb04b7acc1abbafa">ratext</a>(text(1:nab),nums,dnum) <span class="comment">! translate text to DP numbers</span></div>
<div class="line"><a name="l08079"></a><span class="lineno"> 8079</span>&#160; </div>
<div class="line"><a name="l08080"></a><span class="lineno"> 8080</span>&#160;    <span class="keywordflow">IF</span>(nums /= 0) nkey=0</div>
<div class="line"><a name="l08081"></a><span class="lineno"> 8081</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08082"></a><span class="lineno"> 8082</span>&#160;        keywrd=text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>) <span class="comment">!          text is TEXT(KEYA)...TEXT(KEYB)</span></div>
<div class="line"><a name="l08083"></a><span class="lineno"> 8083</span>&#160;        <span class="comment">!         WRITE(*,*) &#39;Keyword is &#39;,KEYWRD</span></div>
<div class="line"><a name="l08084"></a><span class="lineno"> 8084</span>&#160;  </div>
<div class="line"><a name="l08085"></a><span class="lineno"> 8085</span>&#160;        <span class="comment">!        compare keywords</span></div>
<div class="line"><a name="l08086"></a><span class="lineno"> 8086</span>&#160;  </div>
<div class="line"><a name="l08087"></a><span class="lineno"> 8087</span>&#160;        <span class="keywordflow">DO</span> nkey=2,nkeys           <span class="comment">! loop over all pede keywords</span></div>
<div class="line"><a name="l08088"></a><span class="lineno"> 8088</span>&#160;            keystx=keylst(nkey)   <span class="comment">! copy NKEY.th pede keyword</span></div>
<div class="line"><a name="l08089"></a><span class="lineno"> 8089</span>&#160;            mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08090"></a><span class="lineno"> 8090</span>&#160;            <span class="keywordflow">IF</span>(mat &gt;= ntext-ntext/5) <span class="keywordflow">GO TO</span> 10</div>
<div class="line"><a name="l08091"></a><span class="lineno"> 8091</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l08092"></a><span class="lineno"> 8092</span>&#160;  </div>
<div class="line"><a name="l08093"></a><span class="lineno"> 8093</span>&#160;        <span class="comment">!        more comparisons</span></div>
<div class="line"><a name="l08094"></a><span class="lineno"> 8094</span>&#160;  </div>
<div class="line"><a name="l08095"></a><span class="lineno"> 8095</span>&#160;        keystx=<span class="stringliteral">&#39;print&#39;</span></div>
<div class="line"><a name="l08096"></a><span class="lineno"> 8096</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08097"></a><span class="lineno"> 8097</span>&#160;        <span class="comment">!         WRITE(*,*) KEYSTX,MAT,NTEXT</span></div>
<div class="line"><a name="l08098"></a><span class="lineno"> 8098</span>&#160;        <span class="comment">!         IF(MAT.GE.NTEXT) THEN</span></div>
<div class="line"><a name="l08099"></a><span class="lineno"> 8099</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08100"></a><span class="lineno"> 8100</span>&#160;            <span class="comment">!         IF(MAT.GE.(NTEXT+NTEXT+3)/3) THEN</span></div>
<div class="line"><a name="l08101"></a><span class="lineno"> 8101</span>&#160;            <a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a>=1</div>
<div class="line"><a name="l08102"></a><span class="lineno"> 8102</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0) <a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08103"></a><span class="lineno"> 8103</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08104"></a><span class="lineno"> 8104</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08105"></a><span class="lineno"> 8105</span>&#160;  </div>
<div class="line"><a name="l08106"></a><span class="lineno"> 8106</span>&#160;        keystx=<span class="stringliteral">&#39;debug&#39;</span></div>
<div class="line"><a name="l08107"></a><span class="lineno"> 8107</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08108"></a><span class="lineno"> 8108</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08109"></a><span class="lineno"> 8109</span>&#160;            <span class="comment">!         IF(MAT.GE.(NTEXT+NTEXT+3)/3) THEN</span></div>
<div class="line"><a name="l08110"></a><span class="lineno"> 8110</span>&#160;            <a class="code" href="namespacempmod.html#a2d27f879e65ac6d07b201c81c8cdf122">mdebug</a>=3</div>
<div class="line"><a name="l08111"></a><span class="lineno"> 8111</span>&#160;            <span class="comment">! GF            IF(NUMS.GT.0) MPRINT=DNUM(1)</span></div>
<div class="line"><a name="l08112"></a><span class="lineno"> 8112</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0) <a class="code" href="namespacempmod.html#a2d27f879e65ac6d07b201c81c8cdf122">mdebug</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08113"></a><span class="lineno"> 8113</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 1) <a class="code" href="namespacempmod.html#a66e80bef0f5a1e805bb364c8ab9d4ef9">mdebg2</a>=nint(dnum(2),mpi)</div>
<div class="line"><a name="l08114"></a><span class="lineno"> 8114</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08115"></a><span class="lineno"> 8115</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08116"></a><span class="lineno"> 8116</span>&#160; </div>
<div class="line"><a name="l08117"></a><span class="lineno"> 8117</span>&#160;        keystx=<span class="stringliteral">&#39;entries&#39;</span></div>
<div class="line"><a name="l08118"></a><span class="lineno"> 8118</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08119"></a><span class="lineno"> 8119</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08120"></a><span class="lineno"> 8120</span>&#160;            <span class="comment">!         IF(MAT.GE.(NTEXT+NTEXT+3)/3) THEN</span></div>
<div class="line"><a name="l08121"></a><span class="lineno"> 8121</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0 .AND. dnum(1) &gt; 0.5) <a class="code" href="namespacempmod.html#aabad99e1ca6e9001ab80694e02146303">mreqenf</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08122"></a><span class="lineno"> 8122</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 1 .AND. dnum(2) &gt; 0.5) <a class="code" href="namespacempmod.html#ae936dc93a37b86e747dc3ea21a18aa0d">mreqena</a>=nint(dnum(2),mpi)</div>
<div class="line"><a name="l08123"></a><span class="lineno"> 8123</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 2 .AND. dnum(3) &gt; 0.5) <a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a>=nint(dnum(1)*dnum(3),mpi)</div>
<div class="line"><a name="l08124"></a><span class="lineno"> 8124</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08125"></a><span class="lineno"> 8125</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08126"></a><span class="lineno"> 8126</span>&#160; </div>
<div class="line"><a name="l08127"></a><span class="lineno"> 8127</span>&#160;        keystx=<span class="stringliteral">&#39;printrecord&#39;</span></div>
<div class="line"><a name="l08128"></a><span class="lineno"> 8128</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08129"></a><span class="lineno"> 8129</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08130"></a><span class="lineno"> 8130</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0) <a class="code" href="namespacempmod.html#a31ed3022f8cd8aede6f4d869cf3ca045">nrecpr</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08131"></a><span class="lineno"> 8131</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 1) <a class="code" href="namespacempmod.html#a2a8b9736839a9a3145b13f0646c681c2">nrecp2</a>=nint(dnum(2),mpi)</div>
<div class="line"><a name="l08132"></a><span class="lineno"> 8132</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08133"></a><span class="lineno"> 8133</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08134"></a><span class="lineno"> 8134</span>&#160; </div>
<div class="line"><a name="l08135"></a><span class="lineno"> 8135</span>&#160;        keystx=<span class="stringliteral">&#39;maxrecord&#39;</span></div>
<div class="line"><a name="l08136"></a><span class="lineno"> 8136</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08137"></a><span class="lineno"> 8137</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08138"></a><span class="lineno"> 8138</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0.AND.dnum(1) &gt; 0.) <a class="code" href="namespacempmod.html#abebbe378eaef934cd254dbb758556e27">mxrec</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08139"></a><span class="lineno"> 8139</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08140"></a><span class="lineno"> 8140</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08141"></a><span class="lineno"> 8141</span>&#160;  </div>
<div class="line"><a name="l08142"></a><span class="lineno"> 8142</span>&#160;        keystx=<span class="stringliteral">&#39;cache&#39;</span></div>
<div class="line"><a name="l08143"></a><span class="lineno"> 8143</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08144"></a><span class="lineno"> 8144</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08145"></a><span class="lineno"> 8145</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0.AND.dnum(1) &gt;= 0.) <a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a>=nint(dnum(1),mpi) <span class="comment">! cache size, &lt;0 keeps default</span></div>
<div class="line"><a name="l08146"></a><span class="lineno"> 8146</span>&#160;            <span class="keywordflow">IF</span> (nums == 2.AND.dnum(2) &gt; 0..AND.dnum(2) &lt;= 1.0)  &amp;  <span class="comment">! read cache fill level</span></div>
<div class="line"><a name="l08147"></a><span class="lineno"> 8147</span>&#160;                <a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(1)=real(dnum(2),mps)</div>
<div class="line"><a name="l08148"></a><span class="lineno"> 8148</span>&#160;            <span class="keywordflow">IF</span> (nums &gt;= 4) <span class="keywordflow">THEN</span>                                    <span class="comment">! explicit cache splitting</span></div>
<div class="line"><a name="l08149"></a><span class="lineno"> 8149</span>&#160;                <span class="keywordflow">DO</span> k=1,3</div>
<div class="line"><a name="l08150"></a><span class="lineno"> 8150</span>&#160;                    <a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(k)=real(dnum(k+1),mps)</div>
<div class="line"><a name="l08151"></a><span class="lineno"> 8151</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l08152"></a><span class="lineno"> 8152</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08153"></a><span class="lineno"> 8153</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08154"></a><span class="lineno"> 8154</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08155"></a><span class="lineno"> 8155</span>&#160;  </div>
<div class="line"><a name="l08156"></a><span class="lineno"> 8156</span>&#160;        keystx=<span class="stringliteral">&#39;chisqcut&#39;</span></div>
<div class="line"><a name="l08157"></a><span class="lineno"> 8157</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08158"></a><span class="lineno"> 8158</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08159"></a><span class="lineno"> 8159</span>&#160;            <span class="keywordflow">IF</span>(nums == 0) <span class="keywordflow">THEN</span> <span class="comment">! always 3-sigma cut</span></div>
<div class="line"><a name="l08160"></a><span class="lineno"> 8160</span>&#160;                <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>=1.0</div>
<div class="line"><a name="l08161"></a><span class="lineno"> 8161</span>&#160;                <a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a>=1.0</div>
<div class="line"><a name="l08162"></a><span class="lineno"> 8162</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08163"></a><span class="lineno"> 8163</span>&#160;                <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>=real(dnum(1),mps)</div>
<div class="line"><a name="l08164"></a><span class="lineno"> 8164</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> &lt; 1.0) <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>=-1.0</div>
<div class="line"><a name="l08165"></a><span class="lineno"> 8165</span>&#160;                <span class="keywordflow">IF</span>(nums == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08166"></a><span class="lineno"> 8166</span>&#160;                    <a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a>=1.0  <span class="comment">! 3-sigma cut, if not specified</span></div>
<div class="line"><a name="l08167"></a><span class="lineno"> 8167</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08168"></a><span class="lineno"> 8168</span>&#160;                    <a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a>=real(dnum(2),mps)</div>
<div class="line"><a name="l08169"></a><span class="lineno"> 8169</span>&#160;                    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a> &lt; 1.0) <a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a>=1.0</div>
<div class="line"><a name="l08170"></a><span class="lineno"> 8170</span>&#160;                    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> &gt;= 1.0) <a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a>=min(<a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a>,<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>)</div>
<div class="line"><a name="l08171"></a><span class="lineno"> 8171</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l08172"></a><span class="lineno"> 8172</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08173"></a><span class="lineno"> 8173</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08174"></a><span class="lineno"> 8174</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08175"></a><span class="lineno"> 8175</span>&#160;  </div>
<div class="line"><a name="l08176"></a><span class="lineno"> 8176</span>&#160;        <span class="comment">! GF added:</span></div>
<div class="line"><a name="l08177"></a><span class="lineno"> 8177</span>&#160;        keystx=<span class="stringliteral">&#39;hugecut&#39;</span></div>
<div class="line"><a name="l08178"></a><span class="lineno"> 8178</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08179"></a><span class="lineno"> 8179</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08180"></a><span class="lineno"> 8180</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0) <a class="code" href="namespacempmod.html#a2528af2f8eb6c45348125529c5926bee">chhuge</a>=real(dnum(1),mps)</div>
<div class="line"><a name="l08181"></a><span class="lineno"> 8181</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a2528af2f8eb6c45348125529c5926bee">chhuge</a> &lt; 1.0) <a class="code" href="namespacempmod.html#a2528af2f8eb6c45348125529c5926bee">chhuge</a>=1.0 <span class="comment">! at least (!!) 3-sigma</span></div>
<div class="line"><a name="l08182"></a><span class="lineno"> 8182</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08183"></a><span class="lineno"> 8183</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08184"></a><span class="lineno"> 8184</span>&#160;        <span class="comment">! GF added end</span></div>
<div class="line"><a name="l08185"></a><span class="lineno"> 8185</span>&#160;  </div>
<div class="line"><a name="l08186"></a><span class="lineno"> 8186</span>&#160;        keystx=<span class="stringliteral">&#39;linesearch&#39;</span></div>
<div class="line"><a name="l08187"></a><span class="lineno"> 8187</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08188"></a><span class="lineno"> 8188</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08189"></a><span class="lineno"> 8189</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0) <a class="code" href="namespacempmod.html#af9c19a04780821443ac195c341a4e678">lsearch</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08190"></a><span class="lineno"> 8190</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08191"></a><span class="lineno"> 8191</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08192"></a><span class="lineno"> 8192</span>&#160; </div>
<div class="line"><a name="l08193"></a><span class="lineno"> 8193</span>&#160;        keystx=<span class="stringliteral">&#39;localfit&#39;</span></div>
<div class="line"><a name="l08194"></a><span class="lineno"> 8194</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08195"></a><span class="lineno"> 8195</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08196"></a><span class="lineno"> 8196</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0) <a class="code" href="namespacempmod.html#ac13777d4115b495604ad6df7507ebef0">lfitnp</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08197"></a><span class="lineno"> 8197</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 1) <a class="code" href="namespacempmod.html#af9b7c1c75febef400cd6f988d1b47db2">lfitbb</a>=nint(dnum(2),mpi)</div>
<div class="line"><a name="l08198"></a><span class="lineno"> 8198</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08199"></a><span class="lineno"> 8199</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08200"></a><span class="lineno"> 8200</span>&#160; </div>
<div class="line"><a name="l08201"></a><span class="lineno"> 8201</span>&#160;        keystx=<span class="stringliteral">&#39;regularization&#39;</span></div>
<div class="line"><a name="l08202"></a><span class="lineno"> 8202</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08203"></a><span class="lineno"> 8203</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08204"></a><span class="lineno"> 8204</span>&#160;            <a class="code" href="namespacempmod.html#a4472993490c1aa3dff36e977d033b16b">nregul</a>=1</div>
<div class="line"><a name="l08205"></a><span class="lineno"> 8205</span>&#160;            <a class="code" href="namespacempmod.html#a4e5959808432f81b874e1293d55c3f0a">regula</a>=real(dnum(1),mps)</div>
<div class="line"><a name="l08206"></a><span class="lineno"> 8206</span>&#160;            <span class="keywordflow">IF</span>(nums &gt;= 2) <a class="code" href="namespacempmod.html#a0f67e1561e3f56675b01c5c884f74c27">regpre</a>=real(dnum(2),mps)</div>
<div class="line"><a name="l08207"></a><span class="lineno"> 8207</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08208"></a><span class="lineno"> 8208</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08209"></a><span class="lineno"> 8209</span>&#160;  </div>
<div class="line"><a name="l08210"></a><span class="lineno"> 8210</span>&#160;        keystx=<span class="stringliteral">&#39;regularisation&#39;</span></div>
<div class="line"><a name="l08211"></a><span class="lineno"> 8211</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08212"></a><span class="lineno"> 8212</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08213"></a><span class="lineno"> 8213</span>&#160;            <a class="code" href="namespacempmod.html#a4472993490c1aa3dff36e977d033b16b">nregul</a>=1</div>
<div class="line"><a name="l08214"></a><span class="lineno"> 8214</span>&#160;            <a class="code" href="namespacempmod.html#a4e5959808432f81b874e1293d55c3f0a">regula</a>=real(dnum(1),mps)</div>
<div class="line"><a name="l08215"></a><span class="lineno"> 8215</span>&#160;            <span class="keywordflow">IF</span>(nums &gt;= 2) <a class="code" href="namespacempmod.html#a0f67e1561e3f56675b01c5c884f74c27">regpre</a>=real(dnum(2),mps)</div>
<div class="line"><a name="l08216"></a><span class="lineno"> 8216</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08217"></a><span class="lineno"> 8217</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08218"></a><span class="lineno"> 8218</span>&#160;  </div>
<div class="line"><a name="l08219"></a><span class="lineno"> 8219</span>&#160;        keystx=<span class="stringliteral">&#39;presigma&#39;</span></div>
<div class="line"><a name="l08220"></a><span class="lineno"> 8220</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08221"></a><span class="lineno"> 8221</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08222"></a><span class="lineno"> 8222</span>&#160;            <a class="code" href="namespacempmod.html#a0f67e1561e3f56675b01c5c884f74c27">regpre</a>=real(dnum(1),mps)</div>
<div class="line"><a name="l08223"></a><span class="lineno"> 8223</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08224"></a><span class="lineno"> 8224</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08225"></a><span class="lineno"> 8225</span>&#160;  </div>
<div class="line"><a name="l08226"></a><span class="lineno"> 8226</span>&#160;        keystx=<span class="stringliteral">&#39;matiter&#39;</span></div>
<div class="line"><a name="l08227"></a><span class="lineno"> 8227</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08228"></a><span class="lineno"> 8228</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08229"></a><span class="lineno"> 8229</span>&#160;            <a class="code" href="namespacempmod.html#af7338d32712bd5917c14fd665b022354">matrit</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08230"></a><span class="lineno"> 8230</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08231"></a><span class="lineno"> 8231</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08232"></a><span class="lineno"> 8232</span>&#160;  </div>
<div class="line"><a name="l08233"></a><span class="lineno"> 8233</span>&#160;        keystx=<span class="stringliteral">&#39;matmoni&#39;</span></div>
<div class="line"><a name="l08234"></a><span class="lineno"> 8234</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08235"></a><span class="lineno"> 8235</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08236"></a><span class="lineno"> 8236</span>&#160;            <a class="code" href="namespacempmod.html#a40b10ff9c38e0bc56415be23334c925c">matmon</a>=-1</div>
<div class="line"><a name="l08237"></a><span class="lineno"> 8237</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0.AND.dnum(1) &gt; 0.) <a class="code" href="namespacempmod.html#a40b10ff9c38e0bc56415be23334c925c">matmon</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08238"></a><span class="lineno"> 8238</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08239"></a><span class="lineno"> 8239</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08240"></a><span class="lineno"> 8240</span>&#160;  </div>
<div class="line"><a name="l08241"></a><span class="lineno"> 8241</span>&#160;        keystx=<span class="stringliteral">&#39;bandwidth&#39;</span></div>
<div class="line"><a name="l08242"></a><span class="lineno"> 8242</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08243"></a><span class="lineno"> 8243</span>&#160;        <span class="comment">!         IF(MAT.GE.(NTEXT+NTEXT+3)/3) THEN</span></div>
<div class="line"><a name="l08244"></a><span class="lineno"> 8244</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08245"></a><span class="lineno"> 8245</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0)   <a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08246"></a><span class="lineno"> 8246</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> &lt; 0) <a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a>=-1</div>
<div class="line"><a name="l08247"></a><span class="lineno"> 8247</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 1)   <a class="code" href="namespacempmod.html#a9189aeab6d135186cad819219868dbba">lprecm</a>=nint(dnum(2),mpi)</div>
<div class="line"><a name="l08248"></a><span class="lineno"> 8248</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08249"></a><span class="lineno"> 8249</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08250"></a><span class="lineno"> 8250</span>&#160;  </div>
<div class="line"><a name="l08251"></a><span class="lineno"> 8251</span>&#160;        <span class="comment">!         KEYSTX=&#39;outlierrejection&#39;</span></div>
<div class="line"><a name="l08252"></a><span class="lineno"> 8252</span>&#160;        <span class="comment">!         MAT=MATINT(TEXT(KEYA:KEYB),KEYSTX,NPAT,NTEXT) ! comparison</span></div>
<div class="line"><a name="l08253"></a><span class="lineno"> 8253</span>&#160;        <span class="comment">!         WRITE(*,*) KEYSTX,MAT,(NTEXT+NTEXT)/3</span></div>
<div class="line"><a name="l08254"></a><span class="lineno"> 8254</span>&#160;        <span class="comment">!         IF(MAT.GE.(NTEXT+NTEXT+NTEXT-2)/3) THEN</span></div>
<div class="line"><a name="l08255"></a><span class="lineno"> 8255</span>&#160;        <span class="comment">!         IF(MAT.GE.(NPAT-NPAT/5)) THEN</span></div>
<div class="line"><a name="l08256"></a><span class="lineno"> 8256</span>&#160;        <span class="comment">!            CHDFRJ=DNUM(1)</span></div>
<div class="line"><a name="l08257"></a><span class="lineno"> 8257</span>&#160;        <span class="comment">!            IF(CHDFRJ.LT.3.0) CHDFRJ=100.0</span></div>
<div class="line"><a name="l08258"></a><span class="lineno"> 8258</span>&#160;        <span class="comment">!            RETURN</span></div>
<div class="line"><a name="l08259"></a><span class="lineno"> 8259</span>&#160;        <span class="comment">!         END IF</span></div>
<div class="line"><a name="l08260"></a><span class="lineno"> 8260</span>&#160;  </div>
<div class="line"><a name="l08261"></a><span class="lineno"> 8261</span>&#160;        <span class="comment">!         KEYSTX=&#39;outliersuppression&#39;</span></div>
<div class="line"><a name="l08262"></a><span class="lineno"> 8262</span>&#160;        <span class="comment">!         MAT=MATINT(TEXT(KEYA:KEYB),KEYSTX,NPAT,NTEXT) ! comparison</span></div>
<div class="line"><a name="l08263"></a><span class="lineno"> 8263</span>&#160;        <span class="comment">!         WRITE(*,*) KEYSTX,MAT,(NTEXT+NTEXT)/3</span></div>
<div class="line"><a name="l08264"></a><span class="lineno"> 8264</span>&#160;        <span class="comment">!         IF(MAT.GE.(NTEXT+NTEXT+NTEXT-2)/3) THEN</span></div>
<div class="line"><a name="l08265"></a><span class="lineno"> 8265</span>&#160;        <span class="comment">!         IF(MAT.GE.(NPAT-NPAT/5)) THEN</span></div>
<div class="line"><a name="l08266"></a><span class="lineno"> 8266</span>&#160;        <span class="comment">!            LHUBER=DNUM(1)</span></div>
<div class="line"><a name="l08267"></a><span class="lineno"> 8267</span>&#160;        <span class="comment">!            IF(LHUBER.LE.2) LHUBER=2 ! at least 2 Huber iterations</span></div>
<div class="line"><a name="l08268"></a><span class="lineno"> 8268</span>&#160;        <span class="comment">!            RETURN</span></div>
<div class="line"><a name="l08269"></a><span class="lineno"> 8269</span>&#160;        <span class="comment">!         END IF</span></div>
<div class="line"><a name="l08270"></a><span class="lineno"> 8270</span>&#160;  </div>
<div class="line"><a name="l08271"></a><span class="lineno"> 8271</span>&#160;        keystx=<span class="stringliteral">&#39;outlierdownweighting&#39;</span></div>
<div class="line"><a name="l08272"></a><span class="lineno"> 8272</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08273"></a><span class="lineno"> 8273</span>&#160;        <span class="comment">!         WRITE(*,*) KEYSTX,MAT,(NTEXT+NTEXT)/3</span></div>
<div class="line"><a name="l08274"></a><span class="lineno"> 8274</span>&#160;        <span class="comment">!         IF(MAT.GE.(NTEXT+NTEXT+NTEXT-2)/3) THEN</span></div>
<div class="line"><a name="l08275"></a><span class="lineno"> 8275</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08276"></a><span class="lineno"> 8276</span>&#160;            <a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08277"></a><span class="lineno"> 8277</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> &gt; 0.AND.<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> &lt;= 2) <a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a>=2 <span class="comment">! at least 2 Huber iterations (if any)</span></div>
<div class="line"><a name="l08278"></a><span class="lineno"> 8278</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08279"></a><span class="lineno"> 8279</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08280"></a><span class="lineno"> 8280</span>&#160;  </div>
<div class="line"><a name="l08281"></a><span class="lineno"> 8281</span>&#160;        keystx=<span class="stringliteral">&#39;dwfractioncut&#39;</span></div>
<div class="line"><a name="l08282"></a><span class="lineno"> 8282</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08283"></a><span class="lineno"> 8283</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08284"></a><span class="lineno"> 8284</span>&#160;            <a class="code" href="namespacempmod.html#a5e0286590b4d042e8d883ffa7aa82726">dwcut</a>=real(dnum(1),mps)</div>
<div class="line"><a name="l08285"></a><span class="lineno"> 8285</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5e0286590b4d042e8d883ffa7aa82726">dwcut</a> &gt; 0.5) <a class="code" href="namespacempmod.html#a5e0286590b4d042e8d883ffa7aa82726">dwcut</a>=0.5</div>
<div class="line"><a name="l08286"></a><span class="lineno"> 8286</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08287"></a><span class="lineno"> 8287</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08288"></a><span class="lineno"> 8288</span>&#160;  </div>
<div class="line"><a name="l08289"></a><span class="lineno"> 8289</span>&#160;        keystx=<span class="stringliteral">&#39;pullrange&#39;</span></div>
<div class="line"><a name="l08290"></a><span class="lineno"> 8290</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08291"></a><span class="lineno"> 8291</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08292"></a><span class="lineno"> 8292</span>&#160;            <a class="code" href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">prange</a>=abs(real(dnum(1),mps))</div>
<div class="line"><a name="l08293"></a><span class="lineno"> 8293</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08294"></a><span class="lineno"> 8294</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08295"></a><span class="lineno"> 8295</span>&#160;  </div>
<div class="line"><a name="l08296"></a><span class="lineno"> 8296</span>&#160;        keystx=<span class="stringliteral">&#39;subito&#39;</span></div>
<div class="line"><a name="l08297"></a><span class="lineno"> 8297</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08298"></a><span class="lineno"> 8298</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08299"></a><span class="lineno"> 8299</span>&#160;            <a class="code" href="namespacempmod.html#ab949b3b527978632aa8cf4dd409d94af">isubit</a>=1</div>
<div class="line"><a name="l08300"></a><span class="lineno"> 8300</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08301"></a><span class="lineno"> 8301</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08302"></a><span class="lineno"> 8302</span>&#160;  </div>
<div class="line"><a name="l08303"></a><span class="lineno"> 8303</span>&#160;        keystx=<span class="stringliteral">&#39;force&#39;</span></div>
<div class="line"><a name="l08304"></a><span class="lineno"> 8304</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08305"></a><span class="lineno"> 8305</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08306"></a><span class="lineno"> 8306</span>&#160;            <a class="code" href="namespacempmod.html#a9da797a9827200adb3f0bc7f66769ec8">iforce</a>=1</div>
<div class="line"><a name="l08307"></a><span class="lineno"> 8307</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08308"></a><span class="lineno"> 8308</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08309"></a><span class="lineno"> 8309</span>&#160; </div>
<div class="line"><a name="l08310"></a><span class="lineno"> 8310</span>&#160;        keystx=<span class="stringliteral">&#39;memorydebug&#39;</span></div>
<div class="line"><a name="l08311"></a><span class="lineno"> 8311</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08312"></a><span class="lineno"> 8312</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08313"></a><span class="lineno"> 8313</span>&#160;            <a class="code" href="namespacempmod.html#a1625a00fbd2e9f9b40d8a03a39ecfbfd">memdbg</a>=1</div>
<div class="line"><a name="l08314"></a><span class="lineno"> 8314</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0.AND.dnum(1) &gt; 0.0) <a class="code" href="namespacempmod.html#a1625a00fbd2e9f9b40d8a03a39ecfbfd">memdbg</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08315"></a><span class="lineno"> 8315</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08316"></a><span class="lineno"> 8316</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08317"></a><span class="lineno"> 8317</span>&#160;  </div>
<div class="line"><a name="l08318"></a><span class="lineno"> 8318</span>&#160;        keystx=<span class="stringliteral">&#39;globalcorr&#39;</span></div>
<div class="line"><a name="l08319"></a><span class="lineno"> 8319</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08320"></a><span class="lineno"> 8320</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08321"></a><span class="lineno"> 8321</span>&#160;            <a class="code" href="namespacempmod.html#a69e637868d9cc0b9cadb29e82502df9c">igcorr</a>=1</div>
<div class="line"><a name="l08322"></a><span class="lineno"> 8322</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08323"></a><span class="lineno"> 8323</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08324"></a><span class="lineno"> 8324</span>&#160; </div>
<div class="line"><a name="l08325"></a><span class="lineno"> 8325</span>&#160;        keystx=<span class="stringliteral">&#39;printcounts&#39;</span></div>
<div class="line"><a name="l08326"></a><span class="lineno"> 8326</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08327"></a><span class="lineno"> 8327</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08328"></a><span class="lineno"> 8328</span>&#160;            <a class="code" href="namespacempmod.html#a6ce41cb56c2f370937da667f23b91628">ipcntr</a>=1</div>
<div class="line"><a name="l08329"></a><span class="lineno"> 8329</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0.AND.dnum(1) &gt; 0.0) <a class="code" href="namespacempmod.html#a6ce41cb56c2f370937da667f23b91628">ipcntr</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08330"></a><span class="lineno"> 8330</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08331"></a><span class="lineno"> 8331</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08332"></a><span class="lineno"> 8332</span>&#160; </div>
<div class="line"><a name="l08333"></a><span class="lineno"> 8333</span>&#160;        keystx=<span class="stringliteral">&#39;weightedcons&#39;</span></div>
<div class="line"><a name="l08334"></a><span class="lineno"> 8334</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08335"></a><span class="lineno"> 8335</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08336"></a><span class="lineno"> 8336</span>&#160;            <a class="code" href="namespacempmod.html#ad465bd4fde8cb5757ee9b44e3d92fdaa">iwcons</a>=1</div>
<div class="line"><a name="l08337"></a><span class="lineno"> 8337</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0) <a class="code" href="namespacempmod.html#ad465bd4fde8cb5757ee9b44e3d92fdaa">iwcons</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08338"></a><span class="lineno"> 8338</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08339"></a><span class="lineno"> 8339</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08340"></a><span class="lineno"> 8340</span>&#160; </div>
<div class="line"><a name="l08341"></a><span class="lineno"> 8341</span>&#160;        keystx=<span class="stringliteral">&#39;skipemptycons&#39;</span></div>
<div class="line"><a name="l08342"></a><span class="lineno"> 8342</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08343"></a><span class="lineno"> 8343</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08344"></a><span class="lineno"> 8344</span>&#160;            <a class="code" href="namespacempmod.html#a0da38225092e2c44fe754ce2177a38e6">iskpec</a>=1</div>
<div class="line"><a name="l08345"></a><span class="lineno"> 8345</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08346"></a><span class="lineno"> 8346</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08347"></a><span class="lineno"> 8347</span>&#160; </div>
<div class="line"><a name="l08348"></a><span class="lineno"> 8348</span>&#160;        keystx=<span class="stringliteral">&#39;withelimination&#39;</span></div>
<div class="line"><a name="l08349"></a><span class="lineno"> 8349</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08350"></a><span class="lineno"> 8350</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08351"></a><span class="lineno"> 8351</span>&#160;            <a class="code" href="namespacempmod.html#a87fa6b2b85b22edf417e4c663c28424d">icelim</a>=1</div>
<div class="line"><a name="l08352"></a><span class="lineno"> 8352</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08353"></a><span class="lineno"> 8353</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08354"></a><span class="lineno"> 8354</span>&#160; </div>
<div class="line"><a name="l08355"></a><span class="lineno"> 8355</span>&#160;        keystx=<span class="stringliteral">&#39;withmultipliers&#39;</span></div>
<div class="line"><a name="l08356"></a><span class="lineno"> 8356</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08357"></a><span class="lineno"> 8357</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08358"></a><span class="lineno"> 8358</span>&#160;            <a class="code" href="namespacempmod.html#a87fa6b2b85b22edf417e4c663c28424d">icelim</a>=0</div>
<div class="line"><a name="l08359"></a><span class="lineno"> 8359</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08360"></a><span class="lineno"> 8360</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08361"></a><span class="lineno"> 8361</span>&#160; </div>
<div class="line"><a name="l08362"></a><span class="lineno"> 8362</span>&#160;        keystx=<span class="stringliteral">&#39;checkinput&#39;</span></div>
<div class="line"><a name="l08363"></a><span class="lineno"> 8363</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08364"></a><span class="lineno"> 8364</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08365"></a><span class="lineno"> 8365</span>&#160;            <a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a>=1</div>
<div class="line"><a name="l08366"></a><span class="lineno"> 8366</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0) <a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a>=nint(dnum(1),mpi)            </div>
<div class="line"><a name="l08367"></a><span class="lineno"> 8367</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08368"></a><span class="lineno"> 8368</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08369"></a><span class="lineno"> 8369</span>&#160; </div>
<div class="line"><a name="l08370"></a><span class="lineno"> 8370</span>&#160;        keystx=<span class="stringliteral">&#39;monitorresiduals&#39;</span></div>
<div class="line"><a name="l08371"></a><span class="lineno"> 8371</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08372"></a><span class="lineno"> 8372</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08373"></a><span class="lineno"> 8373</span>&#160;            <a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a>=3</div>
<div class="line"><a name="l08374"></a><span class="lineno"> 8374</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0) <a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08375"></a><span class="lineno"> 8375</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 1) <a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>=max(<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>,nint(dnum(2),mpi))</div>
<div class="line"><a name="l08376"></a><span class="lineno"> 8376</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08377"></a><span class="lineno"> 8377</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08378"></a><span class="lineno"> 8378</span>&#160; </div>
<div class="line"><a name="l08379"></a><span class="lineno"> 8379</span>&#160;        keystx=<span class="stringliteral">&#39;monitorpulls&#39;</span></div>
<div class="line"><a name="l08380"></a><span class="lineno"> 8380</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08381"></a><span class="lineno"> 8381</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08382"></a><span class="lineno"> 8382</span>&#160;            <a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a>=3</div>
<div class="line"><a name="l08383"></a><span class="lineno"> 8383</span>&#160;            <a class="code" href="namespacempmod.html#a7d7b32a3675926c99ecd59c27ee2a57a">imonmd</a>=1</div>
<div class="line"><a name="l08384"></a><span class="lineno"> 8384</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0) <a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08385"></a><span class="lineno"> 8385</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 1) <a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>=max(<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>,nint(dnum(2),mpi))</div>
<div class="line"><a name="l08386"></a><span class="lineno"> 8386</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08387"></a><span class="lineno"> 8387</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08388"></a><span class="lineno"> 8388</span>&#160;        </div>
<div class="line"><a name="l08389"></a><span class="lineno"> 8389</span>&#160;        keystx=<span class="stringliteral">&#39;scaleerrors&#39;</span></div>
<div class="line"><a name="l08390"></a><span class="lineno"> 8390</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08391"></a><span class="lineno"> 8391</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08392"></a><span class="lineno"> 8392</span>&#160;            <a class="code" href="namespacempmod.html#a533455573ccf4370eb5abae3534d4479">iscerr</a>=1</div>
<div class="line"><a name="l08393"></a><span class="lineno"> 8393</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0) <a class="code" href="namespacempmod.html#a236e2be4ee4bcc945c1fa56101af9ef6">dscerr</a>(1:2)=dnum(1)</div>
<div class="line"><a name="l08394"></a><span class="lineno"> 8394</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 1) <a class="code" href="namespacempmod.html#a236e2be4ee4bcc945c1fa56101af9ef6">dscerr</a>(2)=dnum(2)</div>
<div class="line"><a name="l08395"></a><span class="lineno"> 8395</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08396"></a><span class="lineno"> 8396</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08397"></a><span class="lineno"> 8397</span>&#160;        </div>
<div class="line"><a name="l08398"></a><span class="lineno"> 8398</span>&#160;        keystx=<span class="stringliteral">&#39;iterateentries&#39;</span></div>
<div class="line"><a name="l08399"></a><span class="lineno"> 8399</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08400"></a><span class="lineno"> 8400</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08401"></a><span class="lineno"> 8401</span>&#160;            <a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a>=huge(<a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a>)</div>
<div class="line"><a name="l08402"></a><span class="lineno"> 8402</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0) <a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08403"></a><span class="lineno"> 8403</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08404"></a><span class="lineno"> 8404</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08405"></a><span class="lineno"> 8405</span>&#160; </div>
<div class="line"><a name="l08406"></a><span class="lineno"> 8406</span>&#160;        keystx=<span class="stringliteral">&#39;threads&#39;</span></div>
<div class="line"><a name="l08407"></a><span class="lineno"> 8407</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08408"></a><span class="lineno"> 8408</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08409"></a><span class="lineno"> 8409</span>&#160;            iomp=0</div>
<div class="line"><a name="l08410"></a><span class="lineno"> 8410</span>&#160;            <span class="comment">!$          IOMP=1</span></div>
<div class="line"><a name="l08411"></a><span class="lineno"> 8411</span>&#160;            <span class="comment">!$          IF (IOMP.GT.0) THEN</span></div>
<div class="line"><a name="l08412"></a><span class="lineno"> 8412</span>&#160;            <span class="comment">!$             IF (NUMS.GE.1.AND.DNUM(1).GT.0.) MTHRD =NINT(dnum(1),mpi)</span></div>
<div class="line"><a name="l08413"></a><span class="lineno"> 8413</span>&#160;            <span class="comment">!$             IF (NUMS.GE.2) THEN</span></div>
<div class="line"><a name="l08414"></a><span class="lineno"> 8414</span>&#160;            <span class="comment">!$                MTHRDR=MTHRD</span></div>
<div class="line"><a name="l08415"></a><span class="lineno"> 8415</span>&#160;            <span class="comment">!$                IF (DNUM(2).GT.0.) MTHRDR=NINT(dnum(2),mpi)</span></div>
<div class="line"><a name="l08416"></a><span class="lineno"> 8416</span>&#160;            <span class="comment">!$             ENDIF</span></div>
<div class="line"><a name="l08417"></a><span class="lineno"> 8417</span>&#160;            <span class="comment">!$          ELSE</span></div>
<div class="line"><a name="l08418"></a><span class="lineno"> 8418</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;WARNING: multithreading not available&#39;</span></div>
<div class="line"><a name="l08419"></a><span class="lineno"> 8419</span>&#160;            <span class="comment">!$          ENDIF</span></div>
<div class="line"><a name="l08420"></a><span class="lineno"> 8420</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08421"></a><span class="lineno"> 8421</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08422"></a><span class="lineno"> 8422</span>&#160;  </div>
<div class="line"><a name="l08423"></a><span class="lineno"> 8423</span>&#160;        keystx=<span class="stringliteral">&#39;compress&#39;</span></div>
<div class="line"><a name="l08424"></a><span class="lineno"> 8424</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08425"></a><span class="lineno"> 8425</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08426"></a><span class="lineno"> 8426</span>&#160;            <a class="code" href="namespacempmod.html#a8f7f1c338a822386f968060f63c49161">mcmprs</a>=1</div>
<div class="line"><a name="l08427"></a><span class="lineno"> 8427</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08428"></a><span class="lineno"> 8428</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08429"></a><span class="lineno"> 8429</span>&#160;        </div>
<div class="line"><a name="l08430"></a><span class="lineno"> 8430</span>&#160;        <span class="comment">! still experimental</span></div>
<div class="line"><a name="l08431"></a><span class="lineno"> 8431</span>&#160;        <span class="comment">!keystx=&#39;extendedStorage&#39;</span></div>
<div class="line"><a name="l08432"></a><span class="lineno"> 8432</span>&#160;        <span class="comment">!mat=matint(text(keya:keyb),keystx,npat,ntext) ! comparison</span></div>
<div class="line"><a name="l08433"></a><span class="lineno"> 8433</span>&#160;        <span class="comment">!IF(mat &gt;= (npat-npat/5)) THEN</span></div>
<div class="line"><a name="l08434"></a><span class="lineno"> 8434</span>&#160;        <span class="comment">!    mextnd=1</span></div>
<div class="line"><a name="l08435"></a><span class="lineno"> 8435</span>&#160;        <span class="comment">!    ! compression enforced for extended storage (in mpbits)</span></div>
<div class="line"><a name="l08436"></a><span class="lineno"> 8436</span>&#160;        <span class="comment">!    RETURN</span></div>
<div class="line"><a name="l08437"></a><span class="lineno"> 8437</span>&#160;        <span class="comment">!END IF</span></div>
<div class="line"><a name="l08438"></a><span class="lineno"> 8438</span>&#160;          </div>
<div class="line"><a name="l08439"></a><span class="lineno"> 8439</span>&#160;        keystx=<span class="stringliteral">&#39;errlabels&#39;</span></div>
<div class="line"><a name="l08440"></a><span class="lineno"> 8440</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08441"></a><span class="lineno"> 8441</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5).AND.<a class="code" href="namespacempmod.html#a0db3baa2b317f4fa930d474ff9e289ed">mnrsel</a> &lt; 100) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08442"></a><span class="lineno"> 8442</span>&#160;            nl=min(nums,100-<a class="code" href="namespacempmod.html#a0db3baa2b317f4fa930d474ff9e289ed">mnrsel</a>)</div>
<div class="line"><a name="l08443"></a><span class="lineno"> 8443</span>&#160;            <span class="keywordflow">DO</span> k=1,nl</div>
<div class="line"><a name="l08444"></a><span class="lineno"> 8444</span>&#160;                <a class="code" href="namespacempmod.html#a16e4025d654964cf8a2eccdbd65a6318">lbmnrs</a>(<a class="code" href="namespacempmod.html#a0db3baa2b317f4fa930d474ff9e289ed">mnrsel</a>+k)=nint(dnum(k),mpi)</div>
<div class="line"><a name="l08445"></a><span class="lineno"> 8445</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l08446"></a><span class="lineno"> 8446</span>&#160;            <a class="code" href="namespacempmod.html#a0db3baa2b317f4fa930d474ff9e289ed">mnrsel</a>=<a class="code" href="namespacempmod.html#a0db3baa2b317f4fa930d474ff9e289ed">mnrsel</a>+nl</div>
<div class="line"><a name="l08447"></a><span class="lineno"> 8447</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08448"></a><span class="lineno"> 8448</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08449"></a><span class="lineno"> 8449</span>&#160;  </div>
<div class="line"><a name="l08450"></a><span class="lineno"> 8450</span>&#160;        keystx=<span class="stringliteral">&#39;pairentries&#39;</span></div>
<div class="line"><a name="l08451"></a><span class="lineno"> 8451</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08452"></a><span class="lineno"> 8452</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08453"></a><span class="lineno"> 8453</span>&#160;            <span class="comment">!     This option could be implemented to get rid of parameter pairs</span></div>
<div class="line"><a name="l08454"></a><span class="lineno"> 8454</span>&#160;            <span class="comment">!     that have very few entries - to save matrix memory size.</span></div>
<div class="line"><a name="l08455"></a><span class="lineno"> 8455</span>&#160;            <span class="keywordflow">IF</span> (nums &gt; 0.AND.dnum(1) &gt; 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08456"></a><span class="lineno"> 8456</span>&#160;                <a class="code" href="namespacempmod.html#a15fe65fce01067a005dad004bbfcdbb9">mreqpe</a>=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08457"></a><span class="lineno"> 8457</span>&#160;                <span class="keywordflow">IF</span> (nums &gt;= 2.AND.dnum(2) &gt;= dnum(1)) <a class="code" href="namespacempmod.html#a36a3d618536d1c68b83256502a3f91b8">mhispe</a>=nint(dnum(2),mpi)</div>
<div class="line"><a name="l08458"></a><span class="lineno"> 8458</span>&#160;                <span class="keywordflow">IF</span> (nums &gt;= 3.AND.dnum(3) &gt;= dnum(1)) <a class="code" href="namespacempmod.html#af12576a4e467472322cac1ddd2212d8c">msngpe</a>=nint(dnum(3),mpi)</div>
<div class="line"><a name="l08459"></a><span class="lineno"> 8459</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08460"></a><span class="lineno"> 8460</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08461"></a><span class="lineno"> 8461</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08462"></a><span class="lineno"> 8462</span>&#160;  </div>
<div class="line"><a name="l08463"></a><span class="lineno"> 8463</span>&#160;        keystx=<span class="stringliteral">&#39;wolfe&#39;</span></div>
<div class="line"><a name="l08464"></a><span class="lineno"> 8464</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08465"></a><span class="lineno"> 8465</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08466"></a><span class="lineno"> 8466</span>&#160;            <a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a>=real(dnum(1),mps)</div>
<div class="line"><a name="l08467"></a><span class="lineno"> 8467</span>&#160;            <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=real(dnum(2),mps)</div>
<div class="line"><a name="l08468"></a><span class="lineno"> 8468</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08469"></a><span class="lineno"> 8469</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08470"></a><span class="lineno"> 8470</span>&#160;  </div>
<div class="line"><a name="l08471"></a><span class="lineno"> 8471</span>&#160;        <span class="comment">! GF added:</span></div>
<div class="line"><a name="l08472"></a><span class="lineno"> 8472</span>&#160;        <span class="comment">! convergence tolerance for minres:</span></div>
<div class="line"><a name="l08473"></a><span class="lineno"> 8473</span>&#160;        keystx=<span class="stringliteral">&#39;mrestol&#39;</span></div>
<div class="line"><a name="l08474"></a><span class="lineno"> 8474</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08475"></a><span class="lineno"> 8475</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08476"></a><span class="lineno"> 8476</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08477"></a><span class="lineno"> 8477</span>&#160;                <span class="keywordflow">IF</span> (dnum(1) &lt; 1.0e-10_mpd.OR.dnum(1) &gt; 1.0e-04_mpd) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08478"></a><span class="lineno"> 8478</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;ERROR: need 1.0D-10 &lt;= MRESTL &#39;</span>,  &amp;</div>
<div class="line"><a name="l08479"></a><span class="lineno"> 8479</span>&#160;                        <span class="stringliteral">&#39;&lt;= 1.0D-04, but get &#39;</span>, dnum(1)</div>
<div class="line"><a name="l08480"></a><span class="lineno"> 8480</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08481"></a><span class="lineno"> 8481</span>&#160;                    <a class="code" href="namespacempmod.html#a83a4e54644058ec927f693131a6cc78e">mrestl</a>=dnum(1)</div>
<div class="line"><a name="l08482"></a><span class="lineno"> 8482</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l08483"></a><span class="lineno"> 8483</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08484"></a><span class="lineno"> 8484</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08485"></a><span class="lineno"> 8485</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08486"></a><span class="lineno"> 8486</span>&#160;        <span class="comment">! GF added end</span></div>
<div class="line"><a name="l08487"></a><span class="lineno"> 8487</span>&#160; </div>
<div class="line"><a name="l08488"></a><span class="lineno"> 8488</span>&#160;        keystx=<span class="stringliteral">&#39;mrestranscond&#39;</span></div>
<div class="line"><a name="l08489"></a><span class="lineno"> 8489</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08490"></a><span class="lineno"> 8490</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08491"></a><span class="lineno"> 8491</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08492"></a><span class="lineno"> 8492</span>&#160;                <a class="code" href="namespacempmod.html#a180dbe1de7f777ca5046d679db34c607">mrtcnd</a> = dnum(1)</div>
<div class="line"><a name="l08493"></a><span class="lineno"> 8493</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08494"></a><span class="lineno"> 8494</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08495"></a><span class="lineno"> 8495</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08496"></a><span class="lineno"> 8496</span>&#160; </div>
<div class="line"><a name="l08497"></a><span class="lineno"> 8497</span>&#160;        keystx=<span class="stringliteral">&#39;mresmode&#39;</span></div>
<div class="line"><a name="l08498"></a><span class="lineno"> 8498</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08499"></a><span class="lineno"> 8499</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08500"></a><span class="lineno"> 8500</span>&#160;            <span class="keywordflow">IF</span>(nums &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08501"></a><span class="lineno"> 8501</span>&#160;                <a class="code" href="namespacempmod.html#afe95475aa68062b3b36a6f2355b70583">mrmode</a> = int(dnum(1),mpi)</div>
<div class="line"><a name="l08502"></a><span class="lineno"> 8502</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08503"></a><span class="lineno"> 8503</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08504"></a><span class="lineno"> 8504</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08505"></a><span class="lineno"> 8505</span>&#160; </div>
<div class="line"><a name="l08506"></a><span class="lineno"> 8506</span>&#160;        keystx=<span class="stringliteral">&#39;nofeasiblestart&#39;</span></div>
<div class="line"><a name="l08507"></a><span class="lineno"> 8507</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08508"></a><span class="lineno"> 8508</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= (npat-npat/5)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08509"></a><span class="lineno"> 8509</span>&#160;            <a class="code" href="namespacempmod.html#a9adc153c089b03a0bf78f856c789e830">nofeas</a>=1 <span class="comment">! do not make parameters feasible at start</span></div>
<div class="line"><a name="l08510"></a><span class="lineno"> 8510</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08511"></a><span class="lineno"> 8511</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08512"></a><span class="lineno"> 8512</span>&#160;  </div>
<div class="line"><a name="l08513"></a><span class="lineno"> 8513</span>&#160;        keystx=<span class="stringliteral">&#39;histprint&#39;</span></div>
<div class="line"><a name="l08514"></a><span class="lineno"> 8514</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08515"></a><span class="lineno"> 8515</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= ntext-ntext/10) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08516"></a><span class="lineno"> 8516</span>&#160;            <span class="comment">!         IF(MAT.GE.(NPAT-NPAT/5)) THEN</span></div>
<div class="line"><a name="l08517"></a><span class="lineno"> 8517</span>&#160;            <a class="code" href="namespacempmod.html#a2010ded48e128ac616720dd5a8bc68da">nhistp</a>=1 <span class="comment">! print histograms</span></div>
<div class="line"><a name="l08518"></a><span class="lineno"> 8518</span>&#160;            <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08519"></a><span class="lineno"> 8519</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08520"></a><span class="lineno"> 8520</span>&#160;  </div>
<div class="line"><a name="l08521"></a><span class="lineno"> 8521</span>&#160;        keystx=<span class="stringliteral">&#39;fortranfiles&#39;</span></div>
<div class="line"><a name="l08522"></a><span class="lineno"> 8522</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(ia:ib),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08523"></a><span class="lineno"> 8523</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= ntext-ntext/10) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08524"></a><span class="lineno"> 8524</span>&#160;  </div>
<div class="line"><a name="l08525"></a><span class="lineno"> 8525</span>&#160;        keystx=<span class="stringliteral">&#39;Cfiles&#39;</span></div>
<div class="line"><a name="l08526"></a><span class="lineno"> 8526</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(ia:ib),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08527"></a><span class="lineno"> 8527</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= ntext-ntext/10) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08528"></a><span class="lineno"> 8528</span>&#160; </div>
<div class="line"><a name="l08529"></a><span class="lineno"> 8529</span>&#160;        keystx=<span class="stringliteral">&#39;closeandreopen&#39;</span></div>
<div class="line"><a name="l08530"></a><span class="lineno"> 8530</span>&#160;        mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(ia:ib),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08531"></a><span class="lineno"> 8531</span>&#160;        <span class="keywordflow">IF</span>(mat &gt;= ntext-ntext/10) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08532"></a><span class="lineno"> 8532</span>&#160;          </div>
<div class="line"><a name="l08533"></a><span class="lineno"> 8533</span>&#160;        keystx=keylst(1)</div>
<div class="line"><a name="l08534"></a><span class="lineno"> 8534</span>&#160;        nkey=1                 <span class="comment">! unknown keyword</span></div>
<div class="line"><a name="l08535"></a><span class="lineno"> 8535</span>&#160;        <span class="keywordflow">IF</span>(nums /= 0) nkey=0</div>
<div class="line"><a name="l08536"></a><span class="lineno"> 8536</span>&#160;  </div>
<div class="line"><a name="l08537"></a><span class="lineno"> 8537</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l08538"></a><span class="lineno"> 8538</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;**************************************************&#39;</span></div>
<div class="line"><a name="l08539"></a><span class="lineno"> 8539</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l08540"></a><span class="lineno"> 8540</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Unknown keyword(s): &#39;</span>,text(1:min(nab,50))</div>
<div class="line"><a name="l08541"></a><span class="lineno"> 8541</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l08542"></a><span class="lineno"> 8542</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;**************************************************&#39;</span></div>
<div class="line"><a name="l08543"></a><span class="lineno"> 8543</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l08544"></a><span class="lineno"> 8544</span>&#160;        <a class="code" href="namespacempmod.html#a287c246782de25addce912cde6d81762">lunkno</a>=<a class="code" href="namespacempmod.html#a287c246782de25addce912cde6d81762">lunkno</a>+1</div>
<div class="line"><a name="l08545"></a><span class="lineno"> 8545</span>&#160;  </div>
<div class="line"><a name="l08546"></a><span class="lineno"> 8546</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l08547"></a><span class="lineno"> 8547</span>&#160;    <span class="comment">!     result: NKEY = -1    blank</span></div>
<div class="line"><a name="l08548"></a><span class="lineno"> 8548</span>&#160;    <span class="comment">!             NKEY =  0    numerical data, no text keyword or unknown</span></div>
<div class="line"><a name="l08549"></a><span class="lineno"> 8549</span>&#160;    <span class="comment">!             NKEY &gt;  0    keyword NKEY from list, keyword = KEYSTX</span></div>
<div class="line"><a name="l08550"></a><span class="lineno"> 8550</span>&#160; </div>
<div class="line"><a name="l08551"></a><span class="lineno"> 8551</span>&#160; </div>
<div class="line"><a name="l08552"></a><span class="lineno"> 8552</span>&#160;    <span class="comment">!     content/lastcontent</span></div>
<div class="line"><a name="l08553"></a><span class="lineno"> 8553</span>&#160;    <span class="comment">!     -------------------</span></div>
<div class="line"><a name="l08554"></a><span class="lineno"> 8554</span>&#160;    <span class="comment">!     blank            -1</span></div>
<div class="line"><a name="l08555"></a><span class="lineno"> 8555</span>&#160;    <span class="comment">!     data              0</span></div>
<div class="line"><a name="l08556"></a><span class="lineno"> 8556</span>&#160;    <span class="comment">!     keyword</span></div>
<div class="line"><a name="l08557"></a><span class="lineno"> 8557</span>&#160;    <span class="comment">!      unknown          1</span></div>
<div class="line"><a name="l08558"></a><span class="lineno"> 8558</span>&#160;    <span class="comment">!      parameter        2</span></div>
<div class="line"><a name="l08559"></a><span class="lineno"> 8559</span>&#160;    <span class="comment">!      constraint       3</span></div>
<div class="line"><a name="l08560"></a><span class="lineno"> 8560</span>&#160;    <span class="comment">!      measurement      4 </span></div>
<div class="line"><a name="l08561"></a><span class="lineno"> 8561</span>&#160;    <span class="comment">!      method           5</span></div>
<div class="line"><a name="l08562"></a><span class="lineno"> 8562</span>&#160; </div>
<div class="line"><a name="l08563"></a><span class="lineno"> 8563</span>&#160; </div>
<div class="line"><a name="l08564"></a><span class="lineno"> 8564</span>&#160;10  <span class="keywordflow">IF</span>(nkey &gt; 0) <span class="keywordflow">THEN</span>     <span class="comment">! new keyword</span></div>
<div class="line"><a name="l08565"></a><span class="lineno"> 8565</span>&#160;        lkey=nkey</div>
<div class="line"><a name="l08566"></a><span class="lineno"> 8566</span>&#160;        <span class="keywordflow">IF</span>(lkey == 2) <span class="keywordflow">THEN</span>              <span class="comment">! parameter</span></div>
<div class="line"><a name="l08567"></a><span class="lineno"> 8567</span>&#160;            <span class="keywordflow">IF</span>(nums == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08568"></a><span class="lineno"> 8568</span>&#160;                lpvs=nint(dnum(1),mpi)  <span class="comment">! label</span></div>
<div class="line"><a name="l08569"></a><span class="lineno"> 8569</span>&#160;                <span class="keywordflow">IF</span>(lpvs /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08570"></a><span class="lineno"> 8570</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#a9139a336d4b929ab8dc55c961ea7a1ba">lenparameters</a>,<a class="code" href="namespacempmod.html#a052833ffee9b412901fa833d1ec2bd79">listparameters</a>,lpvs,dnum(2)) <span class="comment">! start value</span></div>
<div class="line"><a name="l08571"></a><span class="lineno"> 8571</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#ae27349eb825bb377751c09b652f5386b">lenpresigmas</a>,<a class="code" href="namespacempmod.html#afc0797e3f8ca882d33a8028ee07a5417">listpresigmas</a>,lpvs,dnum(3))   <span class="comment">! pre-sigma</span></div>
<div class="line"><a name="l08572"></a><span class="lineno"> 8572</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08573"></a><span class="lineno"> 8573</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Line&#39;</span>,nline,<span class="stringliteral">&#39; error, label=&#39;</span>,lpvs</div>
<div class="line"><a name="l08574"></a><span class="lineno"> 8574</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l08575"></a><span class="lineno"> 8575</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(nums /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08576"></a><span class="lineno"> 8576</span>&#160;                kkey=1   <span class="comment">! switch to &quot;unknown&quot;  ?</span></div>
<div class="line"><a name="l08577"></a><span class="lineno"> 8577</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Wrong text in line&#39;</span>,nline</div>
<div class="line"><a name="l08578"></a><span class="lineno"> 8578</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Status: new parameter&#39;</span></div>
<div class="line"><a name="l08579"></a><span class="lineno"> 8579</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;&gt; &#39;</span>,text(1:nab)</div>
<div class="line"><a name="l08580"></a><span class="lineno"> 8580</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08581"></a><span class="lineno"> 8581</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(lkey == 3) <span class="keywordflow">THEN</span>         <span class="comment">! constraint</span></div>
<div class="line"><a name="l08582"></a><span class="lineno"> 8582</span>&#160;            <span class="comment">!            WRITE(*,*) &#39;Keyword is constraint!&#39;,NUMS,&#39; numerical data&#39;</span></div>
<div class="line"><a name="l08583"></a><span class="lineno"> 8583</span>&#160;            <span class="keywordflow">IF</span>(nums &gt;= 1.AND.nums &lt;= 2) <span class="keywordflow">THEN</span> <span class="comment">! start constraint</span></div>
<div class="line"><a name="l08584"></a><span class="lineno"> 8584</span>&#160;                lpvs=0   <span class="comment">! r = r.h.s. value</span></div>
<div class="line"><a name="l08585"></a><span class="lineno"> 8585</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a>,<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>,lpvs,dnum(1))</div>
<div class="line"><a name="l08586"></a><span class="lineno"> 8586</span>&#160;                lpvs=-1                    <span class="comment">! constraint</span></div>
<div class="line"><a name="l08587"></a><span class="lineno"> 8587</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad465bd4fde8cb5757ee9b44e3d92fdaa">iwcons</a> &gt; 0) lpvs=-2     <span class="comment">! weighted constraint </span></div>
<div class="line"><a name="l08588"></a><span class="lineno"> 8588</span>&#160;                plvs=0.0</div>
<div class="line"><a name="l08589"></a><span class="lineno"> 8589</span>&#160;                <span class="keywordflow">IF</span>(nums == 2) plvs=dnum(2) <span class="comment">! sigma</span></div>
<div class="line"><a name="l08590"></a><span class="lineno"> 8590</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a>,<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>,lpvs,plvs)</div>
<div class="line"><a name="l08591"></a><span class="lineno"> 8591</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08592"></a><span class="lineno"> 8592</span>&#160;                kkey=1   <span class="comment">! switch to &quot;unknown&quot;</span></div>
<div class="line"><a name="l08593"></a><span class="lineno"> 8593</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Wrong text in line&#39;</span>,nline</div>
<div class="line"><a name="l08594"></a><span class="lineno"> 8594</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Status: new keyword constraint&#39;</span></div>
<div class="line"><a name="l08595"></a><span class="lineno"> 8595</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;&gt; &#39;</span>,text(1:nab)</div>
<div class="line"><a name="l08596"></a><span class="lineno"> 8596</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08597"></a><span class="lineno"> 8597</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(lkey == 4) <span class="keywordflow">THEN</span>         <span class="comment">! measurement</span></div>
<div class="line"><a name="l08598"></a><span class="lineno"> 8598</span>&#160;            <span class="keywordflow">IF</span>(nums == 2) <span class="keywordflow">THEN</span> <span class="comment">! start measurement</span></div>
<div class="line"><a name="l08599"></a><span class="lineno"> 8599</span>&#160;                <a class="code" href="namespacempmod.html#a46fe780b490c7ebf29ce9beaca53f4b6">nummeasurements</a>=<a class="code" href="namespacempmod.html#a46fe780b490c7ebf29ce9beaca53f4b6">nummeasurements</a>+1</div>
<div class="line"><a name="l08600"></a><span class="lineno"> 8600</span>&#160;                lpvs=0   <span class="comment">! r = r.h.s. value</span></div>
<div class="line"><a name="l08601"></a><span class="lineno"> 8601</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#ab2fc85b092d025d708c3278d253a49ac">lenmeasurements</a>,<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>,lpvs,dnum(1))</div>
<div class="line"><a name="l08602"></a><span class="lineno"> 8602</span>&#160;                lpvs=-1  <span class="comment">! sigma</span></div>
<div class="line"><a name="l08603"></a><span class="lineno"> 8603</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#ab2fc85b092d025d708c3278d253a49ac">lenmeasurements</a>,<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>,lpvs,dnum(2))</div>
<div class="line"><a name="l08604"></a><span class="lineno"> 8604</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08605"></a><span class="lineno"> 8605</span>&#160;                kkey=1   <span class="comment">! switch to &quot;unknown&quot;</span></div>
<div class="line"><a name="l08606"></a><span class="lineno"> 8606</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Wrong text in line&#39;</span>,nline</div>
<div class="line"><a name="l08607"></a><span class="lineno"> 8607</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Status: new keyword measurement&#39;</span></div>
<div class="line"><a name="l08608"></a><span class="lineno"> 8608</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;&gt; &#39;</span>,text(1:nab)</div>
<div class="line"><a name="l08609"></a><span class="lineno"> 8609</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08610"></a><span class="lineno"> 8610</span>&#160;    </div>
<div class="line"><a name="l08611"></a><span class="lineno"> 8611</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(lkey == 5) <span class="keywordflow">THEN</span>         <span class="comment">! method</span></div>
<div class="line"><a name="l08612"></a><span class="lineno"> 8612</span>&#160;            miter=<a class="code" href="namespacempmod.html#a880fa8e41c4e97b22457dd7d5948085d">mitera</a></div>
<div class="line"><a name="l08613"></a><span class="lineno"> 8613</span>&#160;            <span class="keywordflow">IF</span>(nums &gt;= 1) miter=nint(dnum(1),mpi)</div>
<div class="line"><a name="l08614"></a><span class="lineno"> 8614</span>&#160;            <span class="keywordflow">IF</span>(miter &gt;= 1) <a class="code" href="namespacempmod.html#a880fa8e41c4e97b22457dd7d5948085d">mitera</a>=miter</div>
<div class="line"><a name="l08615"></a><span class="lineno"> 8615</span>&#160;            <a class="code" href="namespacempmod.html#abdfc0236851e1d21ba3276e22f9e6b7b">dflim</a>=real(dnum(2),mps)</div>
<div class="line"><a name="l08616"></a><span class="lineno"> 8616</span>&#160;            lkey=0</div>
<div class="line"><a name="l08617"></a><span class="lineno"> 8617</span>&#160;            <span class="keywordflow">DO</span> i=1,nmeth</div>
<div class="line"><a name="l08618"></a><span class="lineno"> 8618</span>&#160;                keystx=methxt(i)</div>
<div class="line"><a name="l08619"></a><span class="lineno"> 8619</span>&#160;                mat=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(text(<a class="code" href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">keya</a>:<a class="code" href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">keyb</a>),keystx,npat,ntext) <span class="comment">! comparison</span></div>
<div class="line"><a name="l08620"></a><span class="lineno"> 8620</span>&#160;                <span class="keywordflow">IF</span>(mat &gt;= ntext-ntext/5) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08621"></a><span class="lineno"> 8621</span>&#160;                    <span class="keywordflow">IF</span>(i == 1) <span class="keywordflow">THEN</span>            <span class="comment">! diagonalization</span></div>
<div class="line"><a name="l08622"></a><span class="lineno"> 8622</span>&#160;                        <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=2</div>
<div class="line"><a name="l08623"></a><span class="lineno"> 8623</span>&#160;                        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=1</div>
<div class="line"><a name="l08624"></a><span class="lineno"> 8624</span>&#160;                    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(i == 2) <span class="keywordflow">THEN</span>       <span class="comment">! inversion</span></div>
<div class="line"><a name="l08625"></a><span class="lineno"> 8625</span>&#160;                        <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=1</div>
<div class="line"><a name="l08626"></a><span class="lineno"> 8626</span>&#160;                        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=1</div>
<div class="line"><a name="l08627"></a><span class="lineno"> 8627</span>&#160;                    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(i == 3) <span class="keywordflow">THEN</span>       <span class="comment">! fullMINRES</span></div>
<div class="line"><a name="l08628"></a><span class="lineno"> 8628</span>&#160;                        <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=3</div>
<div class="line"><a name="l08629"></a><span class="lineno"> 8629</span>&#160;                        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=1</div>
<div class="line"><a name="l08630"></a><span class="lineno"> 8630</span>&#160;                    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(i == 4) <span class="keywordflow">THEN</span>       <span class="comment">! sparseMINRES</span></div>
<div class="line"><a name="l08631"></a><span class="lineno"> 8631</span>&#160;                        <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=3</div>
<div class="line"><a name="l08632"></a><span class="lineno"> 8632</span>&#160;                        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=2</div>
<div class="line"><a name="l08633"></a><span class="lineno"> 8633</span>&#160;                    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(i == 5) <span class="keywordflow">THEN</span>       <span class="comment">! fullMINRES-QLP</span></div>
<div class="line"><a name="l08634"></a><span class="lineno"> 8634</span>&#160;                        <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=4</div>
<div class="line"><a name="l08635"></a><span class="lineno"> 8635</span>&#160;                        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=1</div>
<div class="line"><a name="l08636"></a><span class="lineno"> 8636</span>&#160;                    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(i == 6) <span class="keywordflow">THEN</span>       <span class="comment">! sparseMINRES-QLP</span></div>
<div class="line"><a name="l08637"></a><span class="lineno"> 8637</span>&#160;                        <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a>=4</div>
<div class="line"><a name="l08638"></a><span class="lineno"> 8638</span>&#160;                        <a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a>=2</div>
<div class="line"><a name="l08639"></a><span class="lineno"> 8639</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l08640"></a><span class="lineno"> 8640</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l08641"></a><span class="lineno"> 8641</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l08642"></a><span class="lineno"> 8642</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08643"></a><span class="lineno"> 8643</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(nkey == 0) <span class="keywordflow">THEN</span>  <span class="comment">! data for continuation</span></div>
<div class="line"><a name="l08644"></a><span class="lineno"> 8644</span>&#160;        <span class="keywordflow">IF</span>(lkey == 2) <span class="keywordflow">THEN</span>              <span class="comment">! parameter</span></div>
<div class="line"><a name="l08645"></a><span class="lineno"> 8645</span>&#160;            <span class="keywordflow">IF</span>(nums &gt;= 3) <span class="keywordflow">THEN</span>   <span class="comment">! store data from this line</span></div>
<div class="line"><a name="l08646"></a><span class="lineno"> 8646</span>&#160;                lpvs=nint(dnum(1),mpi) <span class="comment">! label</span></div>
<div class="line"><a name="l08647"></a><span class="lineno"> 8647</span>&#160;                <span class="keywordflow">IF</span>(lpvs /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08648"></a><span class="lineno"> 8648</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#a9139a336d4b929ab8dc55c961ea7a1ba">lenparameters</a>,<a class="code" href="namespacempmod.html#a052833ffee9b412901fa833d1ec2bd79">listparameters</a>,lpvs,dnum(2))  <span class="comment">! start value</span></div>
<div class="line"><a name="l08649"></a><span class="lineno"> 8649</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#ae27349eb825bb377751c09b652f5386b">lenpresigmas</a>,<a class="code" href="namespacempmod.html#afc0797e3f8ca882d33a8028ee07a5417">listpresigmas</a>,lpvs,dnum(3))    <span class="comment">! pre-sigma</span></div>
<div class="line"><a name="l08650"></a><span class="lineno"> 8650</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08651"></a><span class="lineno"> 8651</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Line&#39;</span>,nline,<span class="stringliteral">&#39; error, label=&#39;</span>,lpvs</div>
<div class="line"><a name="l08652"></a><span class="lineno"> 8652</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l08653"></a><span class="lineno"> 8653</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(nums &gt; 1.AND.nums &lt; 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08654"></a><span class="lineno"> 8654</span>&#160;                kkey=1   <span class="comment">! switch to &quot;unknown&quot;  ?</span></div>
<div class="line"><a name="l08655"></a><span class="lineno"> 8655</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Wrong text in line&#39;</span>,nline</div>
<div class="line"><a name="l08656"></a><span class="lineno"> 8656</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Status continuation parameter&#39;</span></div>
<div class="line"><a name="l08657"></a><span class="lineno"> 8657</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;&gt; &#39;</span>,text(1:nab)</div>
<div class="line"><a name="l08658"></a><span class="lineno"> 8658</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08659"></a><span class="lineno"> 8659</span>&#160;    </div>
<div class="line"><a name="l08660"></a><span class="lineno"> 8660</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(lkey == 3) <span class="keywordflow">THEN</span>         <span class="comment">! constraint</span></div>
<div class="line"><a name="l08661"></a><span class="lineno"> 8661</span>&#160;            ier=0</div>
<div class="line"><a name="l08662"></a><span class="lineno"> 8662</span>&#160;            <span class="keywordflow">DO</span> i=1,nums,2</div>
<div class="line"><a name="l08663"></a><span class="lineno"> 8663</span>&#160;                label=nint(dnum(i),mpi)</div>
<div class="line"><a name="l08664"></a><span class="lineno"> 8664</span>&#160;                <span class="keywordflow">IF</span>(label &lt;= 0) ier=1</div>
<div class="line"><a name="l08665"></a><span class="lineno"> 8665</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l08666"></a><span class="lineno"> 8666</span>&#160;            <span class="keywordflow">IF</span>(mod(nums,2) /= 0) ier=1 <span class="comment">! reject odd number</span></div>
<div class="line"><a name="l08667"></a><span class="lineno"> 8667</span>&#160;            <span class="keywordflow">IF</span>(ier == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08668"></a><span class="lineno"> 8668</span>&#160;                <span class="keywordflow">DO</span> i=1,nums,2</div>
<div class="line"><a name="l08669"></a><span class="lineno"> 8669</span>&#160;                    lpvs=nint(dnum(i),mpi) <span class="comment">! label</span></div>
<div class="line"><a name="l08670"></a><span class="lineno"> 8670</span>&#160;                    plvs=dnum(i+1)         <span class="comment">! factor</span></div>
<div class="line"><a name="l08671"></a><span class="lineno"> 8671</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a>,<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>,lpvs,plvs)</div>
<div class="line"><a name="l08672"></a><span class="lineno"> 8672</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l08673"></a><span class="lineno"> 8673</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08674"></a><span class="lineno"> 8674</span>&#160;                kkey=0</div>
<div class="line"><a name="l08675"></a><span class="lineno"> 8675</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Wrong text in line&#39;</span>,nline</div>
<div class="line"><a name="l08676"></a><span class="lineno"> 8676</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Status continuation constraint&#39;</span></div>
<div class="line"><a name="l08677"></a><span class="lineno"> 8677</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;&gt; &#39;</span>,text(1:nab)</div>
<div class="line"><a name="l08678"></a><span class="lineno"> 8678</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08679"></a><span class="lineno"> 8679</span>&#160;    </div>
<div class="line"><a name="l08680"></a><span class="lineno"> 8680</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(lkey == 4) <span class="keywordflow">THEN</span>         <span class="comment">! measurement</span></div>
<div class="line"><a name="l08681"></a><span class="lineno"> 8681</span>&#160;            <span class="comment">!            WRITE(*,*) &#39;continuation                          &lt; &#39;,NUMS</span></div>
<div class="line"><a name="l08682"></a><span class="lineno"> 8682</span>&#160;            ier=0</div>
<div class="line"><a name="l08683"></a><span class="lineno"> 8683</span>&#160;            <span class="keywordflow">DO</span> i=1,nums,2</div>
<div class="line"><a name="l08684"></a><span class="lineno"> 8684</span>&#160;                label=nint(dnum(i),mpi)</div>
<div class="line"><a name="l08685"></a><span class="lineno"> 8685</span>&#160;                <span class="keywordflow">IF</span>(label &lt;= 0) ier=1</div>
<div class="line"><a name="l08686"></a><span class="lineno"> 8686</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l08687"></a><span class="lineno"> 8687</span>&#160;            <span class="keywordflow">IF</span>(mod(nums,2) /= 0) ier=1 <span class="comment">! reject odd number</span></div>
<div class="line"><a name="l08688"></a><span class="lineno"> 8688</span>&#160;            <span class="comment">!            WRITE(*,*) &#39;IER NUMS &#39;,IER,NUMS</span></div>
<div class="line"><a name="l08689"></a><span class="lineno"> 8689</span>&#160;            <span class="keywordflow">IF</span>(ier == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08690"></a><span class="lineno"> 8690</span>&#160;                <span class="keywordflow">DO</span> i=1,nums,2</div>
<div class="line"><a name="l08691"></a><span class="lineno"> 8691</span>&#160;                    lpvs=nint(dnum(i),mpi) <span class="comment">! label</span></div>
<div class="line"><a name="l08692"></a><span class="lineno"> 8692</span>&#160;                    plvs=dnum(i+1)         <span class="comment">! factor</span></div>
<div class="line"><a name="l08693"></a><span class="lineno"> 8693</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a>(<a class="code" href="namespacempmod.html#ab2fc85b092d025d708c3278d253a49ac">lenmeasurements</a>,<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>,lpvs,plvs)</div>
<div class="line"><a name="l08694"></a><span class="lineno"> 8694</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l08695"></a><span class="lineno"> 8695</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l08696"></a><span class="lineno"> 8696</span>&#160;                kkey=0</div>
<div class="line"><a name="l08697"></a><span class="lineno"> 8697</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Wrong text in line&#39;</span>,nline</div>
<div class="line"><a name="l08698"></a><span class="lineno"> 8698</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Status continuation measurement&#39;</span></div>
<div class="line"><a name="l08699"></a><span class="lineno"> 8699</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;&gt; &#39;</span>,text(1:nab)</div>
<div class="line"><a name="l08700"></a><span class="lineno"> 8700</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l08701"></a><span class="lineno"> 8701</span>&#160;    </div>
<div class="line"><a name="l08702"></a><span class="lineno"> 8702</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08703"></a><span class="lineno"> 8703</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="ttc" id="anamespacempmod_html_a052833ffee9b412901fa833d1ec2bd79"><div class="ttname"><a href="namespacempmod.html#a052833ffee9b412901fa833d1ec2bd79">mpmod::listparameters</a></div><div class="ttdeci">type(listitem), dimension(:), allocatable listparameters</div><div class="ttdoc">list of parameters from steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00272">mpmod.f90:272</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0da38225092e2c44fe754ce2177a38e6"><div class="ttname"><a href="namespacempmod.html#a0da38225092e2c44fe754ce2177a38e6">mpmod::iskpec</a></div><div class="ttdeci">integer(mpi) iskpec</div><div class="ttdoc">flag for skipping empty constraints (no variable parameters)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00105">mpmod.f90:105</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0db3baa2b317f4fa930d474ff9e289ed"><div class="ttname"><a href="namespacempmod.html#a0db3baa2b317f4fa930d474ff9e289ed">mpmod::mnrsel</a></div><div class="ttdeci">integer(mpi) mnrsel</div><div class="ttdoc">number of MINRES error labels in LBMNRS (calc err, corr with SOLGLO)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00089">mpmod.f90:89</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0f67e1561e3f56675b01c5c884f74c27"><div class="ttname"><a href="namespacempmod.html#a0f67e1561e3f56675b01c5c884f74c27">mpmod::regpre</a></div><div class="ttdeci">real(mps) regpre</div><div class="ttdoc">default presigma</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00071">mpmod.f90:71</a></div></div>
<div class="ttc" id="anamespacempmod_html_a15fe65fce01067a005dad004bbfcdbb9"><div class="ttname"><a href="namespacempmod.html#a15fe65fce01067a005dad004bbfcdbb9">mpmod::mreqpe</a></div><div class="ttdeci">integer(mpi) mreqpe</div><div class="ttdoc">min number of pair entries</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00079">mpmod.f90:79</a></div></div>
<div class="ttc" id="anamespacempmod_html_a1625a00fbd2e9f9b40d8a03a39ecfbfd"><div class="ttname"><a href="namespacempmod.html#a1625a00fbd2e9f9b40d8a03a39ecfbfd">mpmod::memdbg</a></div><div class="ttdeci">integer(mpi) memdbg</div><div class="ttdoc">debug flag for memory management</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00096">mpmod.f90:96</a></div></div>
<div class="ttc" id="anamespacempmod_html_a16e4025d654964cf8a2eccdbd65a6318"><div class="ttname"><a href="namespacempmod.html#a16e4025d654964cf8a2eccdbd65a6318">mpmod::lbmnrs</a></div><div class="ttdeci">integer(mpi), dimension(100) lbmnrs</div><div class="ttdoc">MINRES error labels.</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00154">mpmod.f90:154</a></div></div>
<div class="ttc" id="anamespacempmod_html_a180dbe1de7f777ca5046d679db34c607"><div class="ttname"><a href="namespacempmod.html#a180dbe1de7f777ca5046d679db34c607">mpmod::mrtcnd</a></div><div class="ttdeci">real(mpd) mrtcnd</div><div class="ttdoc">transition (QR -&gt; QLP) (matrix) condition for MINRES-QLP</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00061">mpmod.f90:61</a></div></div>
<div class="ttc" id="anamespacempmod_html_a192239aafc622bfaf974605f454125ca"><div class="ttname"><a href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">mpmod::prange</a></div><div class="ttdeci">real(mps) prange</div><div class="ttdoc">range (-PRANGE..PRANGE) for histograms of pulls, norm. residuals</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00097">mpmod.f90:97</a></div></div>
<div class="ttc" id="anamespacempmod_html_a2010ded48e128ac616720dd5a8bc68da"><div class="ttname"><a href="namespacempmod.html#a2010ded48e128ac616720dd5a8bc68da">mpmod::nhistp</a></div><div class="ttdeci">integer(mpi) nhistp</div><div class="ttdoc">flag for histogram printout</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00064">mpmod.f90:64</a></div></div>
<div class="ttc" id="anamespacempmod_html_a236e2be4ee4bcc945c1fa56101af9ef6"><div class="ttname"><a href="namespacempmod.html#a236e2be4ee4bcc945c1fa56101af9ef6">mpmod::dscerr</a></div><div class="ttdeci">real(mpd), dimension(2) dscerr</div><div class="ttdoc">scaling factors for errors of 'global' and 'local' measurement</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00110">mpmod.f90:110</a></div></div>
<div class="ttc" id="anamespacempmod_html_a2528af2f8eb6c45348125529c5926bee"><div class="ttname"><a href="namespacempmod.html#a2528af2f8eb6c45348125529c5926bee">mpmod::chhuge</a></div><div class="ttdeci">real(mps) chhuge</div><div class="ttdoc">cut in terms of 3-sigma for unreasonable data, all iterations</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00049">mpmod.f90:49</a></div></div>
<div class="ttc" id="anamespacempmod_html_a280a03a7d185dee969a6300126ee3354"><div class="ttname"><a href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">mpmod::iteren</a></div><div class="ttdeci">integer(mpi) iteren</div><div class="ttdoc">entries cut is iterated for parameters with less entries (if &gt; mreqenf)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00104">mpmod.f90:104</a></div></div>
<div class="ttc" id="anamespacempmod_html_a2a8b9736839a9a3145b13f0646c681c2"><div class="ttname"><a href="namespacempmod.html#a2a8b9736839a9a3145b13f0646c681c2">mpmod::nrecp2</a></div><div class="ttdeci">integer(mpi) nrecp2</div><div class="ttdoc">record number with printout</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00051">mpmod.f90:51</a></div></div>
<div class="ttc" id="anamespacempmod_html_a31ed3022f8cd8aede6f4d869cf3ca045"><div class="ttname"><a href="namespacempmod.html#a31ed3022f8cd8aede6f4d869cf3ca045">mpmod::nrecpr</a></div><div class="ttdeci">integer(mpi) nrecpr</div><div class="ttdoc">record number with printout</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00050">mpmod.f90:50</a></div></div>
<div class="ttc" id="anamespacempmod_html_a36a3d618536d1c68b83256502a3f91b8"><div class="ttname"><a href="namespacempmod.html#a36a3d618536d1c68b83256502a3f91b8">mpmod::mhispe</a></div><div class="ttdeci">integer(mpi) mhispe</div><div class="ttdoc">upper bound for pair entry histogrammimg</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00080">mpmod.f90:80</a></div></div>
<div class="ttc" id="anamespacempmod_html_a40b10ff9c38e0bc56415be23334c925c"><div class="ttname"><a href="namespacempmod.html#a40b10ff9c38e0bc56415be23334c925c">mpmod::matmon</a></div><div class="ttdeci">integer(mpi) matmon</div><div class="ttdoc">record interval for monitoring of (sparse) matrix construction</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00086">mpmod.f90:86</a></div></div>
<div class="ttc" id="anamespacempmod_html_a4317659a48fe17852caee09327224a52"><div class="ttname"><a href="namespacempmod.html#a4317659a48fe17852caee09327224a52">mpmod::listmeasurements</a></div><div class="ttdeci">type(listitem), dimension(:), allocatable listmeasurements</div><div class="ttdoc">list of (external) measurements from steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00279">mpmod.f90:279</a></div></div>
<div class="ttc" id="anamespacempmod_html_a4472993490c1aa3dff36e977d033b16b"><div class="ttname"><a href="namespacempmod.html#a4472993490c1aa3dff36e977d033b16b">mpmod::nregul</a></div><div class="ttdeci">integer(mpi) nregul</div><div class="ttdoc">regularization flag</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00069">mpmod.f90:69</a></div></div>
<div class="ttc" id="anamespacempmod_html_a4e5959808432f81b874e1293d55c3f0a"><div class="ttname"><a href="namespacempmod.html#a4e5959808432f81b874e1293d55c3f0a">mpmod::regula</a></div><div class="ttdeci">real(mps) regula</div><div class="ttdoc">regularization parameter, add regula * norm(global par.) to objective function</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00070">mpmod.f90:70</a></div></div>
<div class="ttc" id="anamespacempmod_html_a533455573ccf4370eb5abae3534d4479"><div class="ttname"><a href="namespacempmod.html#a533455573ccf4370eb5abae3534d4479">mpmod::iscerr</a></div><div class="ttdeci">integer(mpi) iscerr</div><div class="ttdoc">flag for scaling of errors</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00109">mpmod.f90:109</a></div></div>
<div class="ttc" id="anamespacempmod_html_a66e80bef0f5a1e805bb364c8ab9d4ef9"><div class="ttname"><a href="namespacempmod.html#a66e80bef0f5a1e805bb364c8ab9d4ef9">mpmod::mdebg2</a></div><div class="ttdeci">integer(mpi) mdebg2</div><div class="ttdoc">number of measurements for record debug printout</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00038">mpmod.f90:38</a></div></div>
<div class="ttc" id="anamespacempmod_html_a69e637868d9cc0b9cadb29e82502df9c"><div class="ttname"><a href="namespacempmod.html#a69e637868d9cc0b9cadb29e82502df9c">mpmod::igcorr</a></div><div class="ttdeci">integer(mpi) igcorr</div><div class="ttdoc">flag for output of global correlations for inversion, =0: none</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00095">mpmod.f90:95</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6ce41cb56c2f370937da667f23b91628"><div class="ttname"><a href="namespacempmod.html#a6ce41cb56c2f370937da667f23b91628">mpmod::ipcntr</a></div><div class="ttdeci">integer(mpi) ipcntr</div><div class="ttdoc">flag for output of global parameter counts (entries), =0: none, =1: local fits, &gt;1: binary files</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00100">mpmod.f90:100</a></div></div>
<div class="ttc" id="anamespacempmod_html_a7d7b32a3675926c99ecd59c27ee2a57a"><div class="ttname"><a href="namespacempmod.html#a7d7b32a3675926c99ecd59c27ee2a57a">mpmod::imonmd</a></div><div class="ttdeci">integer(mpi) imonmd</div><div class="ttdoc">monitoring mode: 0:residuals (normalized to average error), 1:pulls</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00108">mpmod.f90:108</a></div></div>
<div class="ttc" id="anamespacempmod_html_a7f451453d802274aac97e237b71b0620"><div class="ttname"><a href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">mpmod::fcache</a></div><div class="ttdeci">real(mps), dimension(3) fcache</div><div class="ttdoc">read cache, average fill level; write cache; dynamic size</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00091">mpmod.f90:91</a></div></div>
<div class="ttc" id="anamespacempmod_html_a80dff2cc33740f10589c0a3740915c43"><div class="ttname"><a href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">mpmod::wolfc2</a></div><div class="ttdeci">real(mps) wolfc2</div><div class="ttdoc">C_2 of strong Wolfe condition.</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00059">mpmod.f90:59</a></div></div>
<div class="ttc" id="anamespacempmod_html_a83a4e54644058ec927f693131a6cc78e"><div class="ttname"><a href="namespacempmod.html#a83a4e54644058ec927f693131a6cc78e">mpmod::mrestl</a></div><div class="ttdeci">real(mpd) mrestl</div><div class="ttdoc">tolerance criterion for MINRES-QLP</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00060">mpmod.f90:60</a></div></div>
<div class="ttc" id="anamespacempmod_html_a87fa6b2b85b22edf417e4c663c28424d"><div class="ttname"><a href="namespacempmod.html#a87fa6b2b85b22edf417e4c663c28424d">mpmod::icelim</a></div><div class="ttdeci">integer(mpi) icelim</div><div class="ttdoc">flag for using elimination (instead of multipliers) for constraints</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00102">mpmod.f90:102</a></div></div>
<div class="ttc" id="anamespacempmod_html_a8f7f1c338a822386f968060f63c49161"><div class="ttname"><a href="namespacempmod.html#a8f7f1c338a822386f968060f63c49161">mpmod::mcmprs</a></div><div class="ttdeci">integer(mpi) mcmprs</div><div class="ttdoc">compression flag for sparsity (column indices)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00082">mpmod.f90:82</a></div></div>
<div class="ttc" id="anamespacempmod_html_a9139a336d4b929ab8dc55c961ea7a1ba"><div class="ttname"><a href="namespacempmod.html#a9139a336d4b929ab8dc55c961ea7a1ba">mpmod::lenparameters</a></div><div class="ttdeci">integer(mpi) lenparameters</div><div class="ttdoc">list items from steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00271">mpmod.f90:271</a></div></div>
<div class="ttc" id="anamespacempmod_html_a9189aeab6d135186cad819219868dbba"><div class="ttname"><a href="namespacempmod.html#a9189aeab6d135186cad819219868dbba">mpmod::lprecm</a></div><div class="ttdeci">integer(mpi) lprecm</div><div class="ttdoc">additional flag for preconditioner (band) matrix (&gt;0: preserve rank by skyline matrix)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00044">mpmod.f90:44</a></div></div>
<div class="ttc" id="anamespacempmod_html_a9adc153c089b03a0bf78f856c789e830"><div class="ttname"><a href="namespacempmod.html#a9adc153c089b03a0bf78f856c789e830">mpmod::nofeas</a></div><div class="ttdeci">integer(mpi) nofeas</div><div class="ttdoc">flag for skipping making parameters feasible</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00063">mpmod.f90:63</a></div></div>
<div class="ttc" id="anamespacempmod_html_aabad99e1ca6e9001ab80694e02146303"><div class="ttname"><a href="namespacempmod.html#aabad99e1ca6e9001ab80694e02146303">mpmod::mreqenf</a></div><div class="ttdeci">integer(mpi) mreqenf</div><div class="ttdoc">required number of entries (for variable global parameter from binary Files)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00039">mpmod.f90:39</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab2fc85b092d025d708c3278d253a49ac"><div class="ttname"><a href="namespacempmod.html#ab2fc85b092d025d708c3278d253a49ac">mpmod::lenmeasurements</a></div><div class="ttdeci">integer(mpi) lenmeasurements</div><div class="ttdoc">length of list of (external) measurements from steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00278">mpmod.f90:278</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab33979acfa3529dad79bb8d04bd950ad"><div class="ttname"><a href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">mpmod::wolfc1</a></div><div class="ttdeci">real(mps) wolfc1</div><div class="ttdoc">C_1 of strong Wolfe condition.</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00058">mpmod.f90:58</a></div></div>
<div class="ttc" id="anamespacempmod_html_abdfc0236851e1d21ba3276e22f9e6b7b"><div class="ttname"><a href="namespacempmod.html#abdfc0236851e1d21ba3276e22f9e6b7b">mpmod::dflim</a></div><div class="ttdeci">real(mps) dflim</div><div class="ttdoc">convergence limit</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00132">mpmod.f90:132</a></div></div>
<div class="ttc" id="anamespacempmod_html_abe14a8df50c6aa08d3de9f0d74875d2f"><div class="ttname"><a href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">mpmod::ncache</a></div><div class="ttdeci">integer(mpi) ncache</div><div class="ttdoc">buffer size for caching (default 100MB per thread)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00090">mpmod.f90:90</a></div></div>
<div class="ttc" id="anamespacempmod_html_abebbe378eaef934cd254dbb758556e27"><div class="ttname"><a href="namespacempmod.html#abebbe378eaef934cd254dbb758556e27">mpmod::mxrec</a></div><div class="ttdeci">integer(mpi) mxrec</div><div class="ttdoc">max number of records</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00085">mpmod.f90:85</a></div></div>
<div class="ttc" id="anamespacempmod_html_ac13777d4115b495604ad6df7507ebef0"><div class="ttname"><a href="namespacempmod.html#ac13777d4115b495604ad6df7507ebef0">mpmod::lfitnp</a></div><div class="ttdeci">integer(mpi) lfitnp</div><div class="ttdoc">local fit: number of iteration to calculate pulls</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00087">mpmod.f90:87</a></div></div>
<div class="ttc" id="anamespacempmod_html_ac7f7ad5a42a202807247e85e4c92f0dd"><div class="ttname"><a href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">mpmod::measbins</a></div><div class="ttdeci">integer(mpi) measbins</div><div class="ttdoc">number of bins per measurement for monitoring</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00107">mpmod.f90:107</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad465bd4fde8cb5757ee9b44e3d92fdaa"><div class="ttname"><a href="namespacempmod.html#ad465bd4fde8cb5757ee9b44e3d92fdaa">mpmod::iwcons</a></div><div class="ttdeci">integer(mpi) iwcons</div><div class="ttdoc">flag for weighting of constraints (&gt;0: weighting with globalParCounts, else: none)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00101">mpmod.f90:101</a></div></div>
<div class="ttc" id="anamespacempmod_html_ae27349eb825bb377751c09b652f5386b"><div class="ttname"><a href="namespacempmod.html#ae27349eb825bb377751c09b652f5386b">mpmod::lenpresigmas</a></div><div class="ttdeci">integer(mpi) lenpresigmas</div><div class="ttdoc">length of list of pre-sigmas from steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00273">mpmod.f90:273</a></div></div>
<div class="ttc" id="anamespacempmod_html_ae936dc93a37b86e747dc3ea21a18aa0d"><div class="ttname"><a href="namespacempmod.html#ae936dc93a37b86e747dc3ea21a18aa0d">mpmod::mreqena</a></div><div class="ttdeci">integer(mpi) mreqena</div><div class="ttdoc">required number of entries (for variable global parameter from Accepted local fits)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00040">mpmod.f90:40</a></div></div>
<div class="ttc" id="anamespacempmod_html_af12576a4e467472322cac1ddd2212d8c"><div class="ttname"><a href="namespacempmod.html#af12576a4e467472322cac1ddd2212d8c">mpmod::msngpe</a></div><div class="ttdeci">integer(mpi) msngpe</div><div class="ttdoc">upper bound for pair entry single precision storage</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00081">mpmod.f90:81</a></div></div>
<div class="ttc" id="anamespacempmod_html_af7338d32712bd5917c14fd665b022354"><div class="ttname"><a href="namespacempmod.html#af7338d32712bd5917c14fd665b022354">mpmod::matrit</a></div><div class="ttdeci">integer(mpi) matrit</div><div class="ttdoc">matrix calculation up to iteration MATRIT</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00072">mpmod.f90:72</a></div></div>
<div class="ttc" id="anamespacempmod_html_af9b7c1c75febef400cd6f988d1b47db2"><div class="ttname"><a href="namespacempmod.html#af9b7c1c75febef400cd6f988d1b47db2">mpmod::lfitbb</a></div><div class="ttdeci">integer(mpi) lfitbb</div><div class="ttdoc">local fit: check for bordered band matrix (if &gt;0)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00088">mpmod.f90:88</a></div></div>
<div class="ttc" id="anamespacempmod_html_afc0797e3f8ca882d33a8028ee07a5417"><div class="ttname"><a href="namespacempmod.html#afc0797e3f8ca882d33a8028ee07a5417">mpmod::listpresigmas</a></div><div class="ttdeci">type(listitem), dimension(:), allocatable listpresigmas</div><div class="ttdoc">list of pre-sgmas from steering file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00274">mpmod.f90:274</a></div></div>
<div class="ttc" id="anamespacempmod_html_afe95475aa68062b3b36a6f2355b70583"><div class="ttname"><a href="namespacempmod.html#afe95475aa68062b3b36a6f2355b70583">mpmod::mrmode</a></div><div class="ttdeci">integer(mpi) mrmode</div><div class="ttdoc">MINRES-QLP mode (0: QR+QLP, 1: only QR, 2: only QLP factorization)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00062">mpmod.f90:62</a></div></div>
<div class="ttc" id="anamespacempmod_html_affc38d07d26b8dc7faf3938e57d6cfdc"><div class="ttname"><a href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">mpmod::imonit</a></div><div class="ttdeci">integer(mpi) imonit</div><div class="ttdoc">flag for monitoring residuals per local fit cycle (=0: none, &lt;0: all, bit 0: first,...</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00106">mpmod.f90:106</a></div></div>
<div class="ttc" id="anamespacemptext_html"><div class="ttname"><a href="namespacemptext.html">mptext</a></div><div class="ttdoc">Keyword position.</div><div class="ttdef"><b>Definition:</b> <a href="mptext_8f90_source.html#l00029">mptext.f90:29</a></div></div>
<div class="ttc" id="anamespacemptext_html_a0b8b9be380072379b1ab5e04d9c8c55e"><div class="ttname"><a href="namespacemptext.html#a0b8b9be380072379b1ab5e04d9c8c55e">mptext::keyb</a></div><div class="ttdeci">integer(mpi) keyb</div><div class="ttdoc">end (position) of keyword</div><div class="ttdef"><b>Definition:</b> <a href="mptext_8f90_source.html#l00035">mptext.f90:35</a></div></div>
<div class="ttc" id="anamespacemptext_html_a5a15cd59193f031a1b4d5a21f4678795"><div class="ttname"><a href="namespacemptext.html#a5a15cd59193f031a1b4d5a21f4678795">mptext::keya</a></div><div class="ttdeci">integer(mpi) keya</div><div class="ttdoc">start (position) of keyword</div><div class="ttdef"><b>Definition:</b> <a href="mptext_8f90_source.html#l00034">mptext.f90:34</a></div></div>
<div class="ttc" id="apede_8f90_html_a2fa6a026403e457dbb3e7f554ffd5dca"><div class="ttname"><a href="pede_8f90.html#a2fa6a026403e457dbb3e7f554ffd5dca">additem</a></div><div class="ttdeci">subroutine additem(length, list, label, value)</div><div class="ttdoc">add item to list</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l08713">pede.f90:8714</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7aa3f7f61de11f6e0d2a7dced6d3f69a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7aa3f7f61de11f6e0d2a7dced6d3f69a">&#9670;&nbsp;</a></span>iprime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(mpi) function iprime </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>largest prime number &lt; N. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>N </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>largest prime number &lt; N </dd></dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04789">4789</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160; </div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: n</div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nprime</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nsqrt</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;    nprime=n                               <span class="comment">! max number</span></div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;    <span class="keywordflow">IF</span>(mod(nprime,2) == 0) nprime=nprime+1 <span class="comment">! ... odd number</span></div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;    outer: <span class="keywordflow">DO</span></div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;        nprime=nprime-2                        <span class="comment">! next lower odd number</span></div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;        nsqrt=int(sqrt(real(nprime,<a class="code" href="namespacempdef.html#aeda146bde2da88d0f6940fc9be01e963">mps</a>)),<a class="code" href="namespacempdef.html#a3fc26af88c2fce97882db26de5535606">mpi</a>)</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;        <span class="keywordflow">DO</span> i=3,nsqrt,2                         <span class="comment">!</span></div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;            <span class="keywordflow">IF</span>(i*(nprime/i) == nprime) cycle outer   <span class="comment">! test prime number</span></div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;        <span class="keywordflow">EXIT</span> outer <span class="comment">! found</span></div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;<span class="keywordflow">    END DO</span> outer</div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;    <a class="code" href="pede_8f90.html#a7aa3f7f61de11f6e0d2a7dced6d3f69a">iprime</a>=nprime</div>
<div class="ttc" id="anamespacempdef_html_a3fc26af88c2fce97882db26de5535606"><div class="ttname"><a href="namespacempdef.html#a3fc26af88c2fce97882db26de5535606">mpdef::mpi</a></div><div class="ttdeci">integer, parameter mpi</div><div class="ttdef"><b>Definition:</b> <a href="mpdef_8f90_source.html#l00034">mpdef.f90:34</a></div></div>
<div class="ttc" id="anamespacempdef_html_aeda146bde2da88d0f6940fc9be01e963"><div class="ttname"><a href="namespacempdef.html#aeda146bde2da88d0f6940fc9be01e963">mpdef::mps</a></div><div class="ttdeci">integer, parameter mps</div><div class="ttdef"><b>Definition:</b> <a href="mpdef_8f90_source.html#l00037">mpdef.f90:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2660e9144b1f62e900d2d8e2e1e6ba12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2660e9144b1f62e900d2d8e2e1e6ba12">&#9670;&nbsp;</a></span>isjajb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine isjajb </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>nst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(inout)&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(out)&#160;</td>
          <td class="paramname"><em>ja</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(out)&#160;</td>
          <td class="paramname"><em>jb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(out)&#160;</td>
          <td class="paramname"><em>jsp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode Millepede record. </p>
<p>Get indices JA, JB, IS for next measurement within record:</p><ul>
<li>Measurement is: <code>GLDER(JA)</code></li>
<li>Local derivatives are: <code>(INDER(JA+J),GLDER(JA+J),J=1,JB-JA-1)</code> i.e. JB-JA-1 derivatives</li>
<li>Standard deviation is: <code>GLDER(JB)</code></li>
<li>Global derivatives are: <code>(INDER(JB+J),GLDER(JB+J),J=1,IS-JB)</code> i.e. IST-JB derivatives</li>
</ul>
<p>End_of_data is indicated by returned values JA=0 and JB=0 Special data are ignored. At end_of_data the info to the special data is returned: IS = pointer to special data; number of words is <code>NSP=-GLDER(IS)</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nst</td><td>index of last word of record </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">is</td><td>index of last global derivative (index of first word of record at the first call) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ja</td><td>index of measured value (=0 at end), = pointer to local derivatives </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">jb</td><td>index of standard deviation (=0 at end), = pointer to global derivatives </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">jsp</td><td>index to special data </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02259">2259</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160; </div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;<span class="keywordtype">    REAL</span>(mpr8) :: glder</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inder</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160; </div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                      :: nst</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN OUT)</span>                  :: is</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(OUT)</span>                     :: ja</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(OUT)</span>                     :: jb</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(OUT)</span>                     :: jsp</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    inder(i)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(i)</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    glder(i)=<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(i)</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160; </div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    jsp=0</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        ja=0</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        jb=0</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        <span class="keywordflow">IF</span>(is &gt;= nst) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        <span class="keywordflow">DO</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;            is=is+1</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;            <span class="keywordflow">IF</span>(inder(is) == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        ja=is</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;        <span class="keywordflow">DO</span></div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;            is=is+1</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;            <span class="keywordflow">IF</span>(inder(is) == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;        jb=is</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="keywordflow">IF</span>(ja+1 == jb.AND.glder(jb) &lt; 0.0_mpr8) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;            <span class="comment">!  special data</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;            jsp=jb <span class="comment">! pointer to special data</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;            is=is+nint(-glder(jb),mpi) <span class="comment">! skip NSP words</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;            cycle</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="keywordflow">        END IF</span>     </div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span>(inder(is+1) /= 0.AND.is &lt; nst)</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;            is=is+1</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160; </div>
<div class="ttc" id="anamespacempmod_html_a41d697fdc7162d788f2f6a2cd7036163"><div class="ttname"><a href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">mpmod::readbufferdatad</a></div><div class="ttdeci">real(mpr8), dimension(:), allocatable readbufferdatad</div><div class="ttdoc">double data</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00237">mpmod.f90:237</a></div></div>
<div class="ttc" id="anamespacempmod_html_a8c24e8f929def2780a39d61958f944c0"><div class="ttname"><a href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">mpmod::readbufferdatai</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable readbufferdatai</div><div class="ttdoc">integer data</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00235">mpmod.f90:235</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1b511d5f8e1ab4fd3f856d4f44d69baa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b511d5f8e1ab4fd3f856d4f44d69baa">&#9670;&nbsp;</a></span>loop1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine loop1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>First data loop (get global labels). </p>
<p>Read all data files and add all labels to global labels table, add labels from parameters, constraints and measurements (from text files).</p>
<p>Define variable and fixed global parameters (depending on entries and pre-sigma).</p>
<p>Iterate if records had been skipped due to too small read buffer size. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04821">4821</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160; </div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: idum</div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: in</div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: indab</div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbl</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbi</div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: mqi</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nc31</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nr</div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nwrd</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inone</div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: param</div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: presg</div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: prewt</div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160; </div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: length</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1: starting&#39;</span></div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9c76d03bc0e3c3a55898cf60cf1fbdcc">mstart</a>(<span class="stringliteral">&#39;LOOP1&#39;</span>)</div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;    <span class="comment">!     add labels from parameter, constraints, measurements -------------</span></div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;    <span class="keywordflow">DO</span> i=1, <a class="code" href="namespacempmod.html#a9139a336d4b929ab8dc55c961ea7a1ba">lenparameters</a></div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;        idum=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#a052833ffee9b412901fa833d1ec2bd79">listparameters</a>(i)%label)</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;    <span class="keywordflow">DO</span> i=1, <a class="code" href="namespacempmod.html#ae27349eb825bb377751c09b652f5386b">lenpresigmas</a></div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;        idum=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#afc0797e3f8ca882d33a8028ee07a5417">listpresigmas</a>(i)%label)</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;    <span class="keywordflow">DO</span> i=1, <a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a></div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;        idum=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i)%label)</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;    <span class="keywordflow">DO</span> i=1, <a class="code" href="namespacempmod.html#ab2fc85b092d025d708c3278d253a49ac">lenmeasurements</a></div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;        idum=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(i)%label)</div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160; </div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1) /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;        <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1:&#39;</span>,<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1), <span class="stringliteral">&#39; labels from txt data stored&#39;</span></div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1: reading data files&#39;</span></div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160; </div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;        <span class="keywordflow">DO</span> j=1,<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)</div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;            <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,j)=0   <span class="comment">! reset count</span></div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160; </div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;        <span class="comment">!     read all data files and add all labels to global labels table ----</span></div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160; </div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Read all binary data files:&#39;</span></div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;        <span class="keyword">CALL </span>hmpldf(1,<span class="stringliteral">&#39;Number of words/record in binary file&#39;</span>)</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(8,0.0,60.0,<span class="stringliteral">&#39;not_stored data per record&#39;</span>)</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;        <span class="comment">!     define read buffer</span></div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;        nc31=<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a>/(31*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a>) <span class="comment">! split read cache 1 : 10 : 10*2 for pointers, ints, floats</span></div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;        nwrd=nc31+1</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;        length=nwrd*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>,length,<span class="stringliteral">&#39;read buffer, pointer&#39;</span>)</div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;        nwrd=nc31*10+2+<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a></div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;        length=nwrd*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>,length,<span class="stringliteral">&#39;read buffer, integer&#39;</span>)</div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>,length,<span class="stringliteral">&#39;read buffer, double&#39;</span>)</div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;        <span class="comment">! to read (old) float binary files</span></div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;        length=(<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a>+2)*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>,length,<span class="stringliteral">&#39;read buffer, float&#39;</span>)</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160; </div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;        <span class="keywordflow">DO</span></div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a781f6fc2bdd91639f9a943c2b7801d4e">peread</a>(nr)  <span class="comment">! read records</span></div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ab5a8c50ef7c6456fd7f4811f22bcb3fc">skippedrecords</a> == 0) <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aacd49a512bb96f75b566fa8f2aee605b">peprep</a>(0)   <span class="comment">! prepare records</span></div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;            <span class="keywordflow">IF</span>(nr &lt;= 0) <span class="keywordflow">EXIT</span> <span class="comment">! end of data?</span></div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;        <span class="comment">!     release read buffer</span></div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>)</div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>)</div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>)</div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>)</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ab5a8c50ef7c6456fd7f4811f22bcb3fc">skippedrecords</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;            <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;            <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1: reading data files again&#39;</span></div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160; </div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a2010ded48e128ac616720dd5a8bc68da">nhistp</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;        <span class="keyword">CALL </span>hmprnt(1)</div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;        <span class="keyword">CALL </span>hmprnt(8)</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;    <span class="keyword">CALL </span>hmpwrt(1)</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;    <span class="keyword">CALL </span>hmpwrt(8)</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;    <a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a> = <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)     <span class="comment">! total number of labels/parameters</span></div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(21,<span class="stringliteral">&#39;Aborted, no labels/parameters defined&#39;</span>)</div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;        stop <span class="stringliteral">&#39;LOOP1: no labels/parameters defined&#39;</span></div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a44d814f6965ac4c5b4ff7bbcd2cd2a81">upone</a> <span class="comment">! finalize the global label table</span></div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1:&#39;</span>,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a>,  &amp;</div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;        <span class="stringliteral">&#39; is total number NTGB of labels/parameters&#39;</span></div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;    <span class="comment">!     histogram number of entries per label ----------------------------</span></div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;    <span class="keyword">CALL </span>hmpldf(2,<span class="stringliteral">&#39;Number of entries per label&#39;</span>)</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;    <span class="keywordflow">DO</span> j=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;        <span class="keyword">CALL </span>hmplnt(2,<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,j))</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a2010ded48e128ac616720dd5a8bc68da">nhistp</a> /= 0) <span class="keyword">CALL </span>hmprnt(2) <span class="comment">! print histogram</span></div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;    <span class="keyword">CALL </span>hmpwrt(2) <span class="comment">! write to his file</span></div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160; </div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;    <span class="comment">!     three subarrays for all global parameters ------------------------</span></div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;    length=<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>,length,<span class="stringliteral">&#39;global parameters&#39;</span>)</div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;    <a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>=0.0_mpd</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>,length,<span class="stringliteral">&#39;pre-sigmas&#39;</span>) <span class="comment">! presigmas</span></div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;    <a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>=0.</div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ade9e2f7c5771cc50bf7aa563f636d46f">globalparstart</a>,length,<span class="stringliteral">&#39;global parameters at start&#39;</span>)</div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;    <a class="code" href="namespacempmod.html#ade9e2f7c5771cc50bf7aa563f636d46f">globalparstart</a>=0.</div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a21163abbb7c516b63ca1f338881a4083">globalparcopy</a>,length,<span class="stringliteral">&#39;copy of global parameters&#39;</span>)</div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ab83ffab12b6a35c57e98c88dc4829934">globalparcounts</a>,length,<span class="stringliteral">&#39;global parameter counts&#39;</span>)</div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af4b661118569bdd0c6776a5f76dbf8c0">globalparcons</a>,length,<span class="stringliteral">&#39;global parameter constraints&#39;</span>)</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;    <a class="code" href="namespacempmod.html#af4b661118569bdd0c6776a5f76dbf8c0">globalparcons</a>=0</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160; </div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a9139a336d4b929ab8dc55c961ea7a1ba">lenparameters</a>                  <span class="comment">! parameter start values</span></div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;        param=<a class="code" href="namespacempmod.html#a052833ffee9b412901fa833d1ec2bd79">listparameters</a>(i)%value</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;        in=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#a052833ffee9b412901fa833d1ec2bd79">listparameters</a>(i)%label)</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;        <span class="keywordflow">IF</span>(in /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;            <a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(in)=param</div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;            <a class="code" href="namespacempmod.html#ade9e2f7c5771cc50bf7aa563f636d46f">globalparstart</a>(in)=param</div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160; </div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;    <a class="code" href="namespacempmod.html#ae3b172f60491ca00efdcfd53f982e9c7">npresg</a>=0</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#ae27349eb825bb377751c09b652f5386b">lenpresigmas</a>                 <span class="comment">! pre-sigma values</span></div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;        presg=<a class="code" href="namespacempmod.html#afc0797e3f8ca882d33a8028ee07a5417">listpresigmas</a>(i)%value</div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;        in=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#afc0797e3f8ca882d33a8028ee07a5417">listpresigmas</a>(i)%label)</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;        <span class="keywordflow">IF</span>(in /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;            <span class="keywordflow">IF</span>(presg &gt; 0.0) <a class="code" href="namespacempmod.html#ae3b172f60491ca00efdcfd53f982e9c7">npresg</a>=<a class="code" href="namespacempmod.html#ae3b172f60491ca00efdcfd53f982e9c7">npresg</a>+1 <span class="comment">! FIXME: check if enough &#39;entries&#39;?</span></div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;            <a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(in)=presg     <span class="comment">! insert pre-sigma 0 or &gt; 0</span></div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1:&#39;</span>,<a class="code" href="namespacempmod.html#ae3b172f60491ca00efdcfd53f982e9c7">npresg</a>,<span class="stringliteral">&#39; is number of pre-sigmas&#39;</span></div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;LOOP1:&#39;</span>,<a class="code" href="namespacempmod.html#ae3b172f60491ca00efdcfd53f982e9c7">npresg</a>,<span class="stringliteral">&#39; is number of pre-sigmas&#39;</span></div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ae3b172f60491ca00efdcfd53f982e9c7">npresg</a> == 0) <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Warning: no pre-sigmas defined&#39;</span></div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160; </div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;    <span class="comment">!     determine flag variable (active) or fixed (inactive) -------------</span></div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160; </div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;    indab=0</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;        <a class="code" href="namespacempmod.html#ab83ffab12b6a35c57e98c88dc4829934">globalparcounts</a>(i) = <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i)</div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(i) &lt; 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;            <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i)=-1     <span class="comment">! fixed (pre-sigma), not used in matrix (not active)</span></div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ab83ffab12b6a35c57e98c88dc4829934">globalparcounts</a>(i) &lt; <a class="code" href="namespacempmod.html#aabad99e1ca6e9001ab80694e02146303">mreqenf</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;            <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i)=-2     <span class="comment">! fixed (entries cut), not used in matrix (not active)        </span></div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;            indab=indab+1</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;            <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i)=indab  <span class="comment">! variable, used in matrix (active)        </span></div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;    <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-6)=indab <span class="comment">! counted variable</span></div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;    <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>=indab  <span class="comment">! nr of variable parameters</span></div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1:&#39;</span>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>, <span class="stringliteral">&#39; is number NVGB of variable parameters&#39;</span></div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a> &gt; <a class="code" href="namespacempmod.html#aabad99e1ca6e9001ab80694e02146303">mreqenf</a>) <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#ada59c18037976f20c1de59572134c38e">loop1i</a> <span class="comment">! iterate entries cut</span></div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160; </div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;    <span class="comment">!     translation table of length NVGB of total global indices ---------</span></div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;    length=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>,length,<span class="stringliteral">&#39;translation table  var -&gt; total&#39;</span>)</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;    indab=0</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;            indab=indab+1</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;            <a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(indab)=i</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160; </div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;    <span class="comment">!     regularization ---------------------------------------------------</span></div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a6627f321f4027818d9a70faaeff3a296">globalparpreweight</a>,length,<span class="stringliteral">&#39;pre-sigmas weights&#39;</span>) <span class="comment">! presigma weights</span></div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;    <span class="keyword">WRITE</span>(*,112) <span class="stringliteral">&#39; Default pre-sigma =&#39;</span>,<a class="code" href="namespacempmod.html#a0f67e1561e3f56675b01c5c884f74c27">regpre</a>,  &amp;</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;        <span class="stringliteral">&#39; (if no individual pre-sigma defined)&#39;</span></div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;    <span class="keyword">WRITE</span>(*,*)   <span class="stringliteral">&#39;Pre-sigma factor is&#39;</span>,<a class="code" href="namespacempmod.html#a4e5959808432f81b874e1293d55c3f0a">regula</a></div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160; </div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4472993490c1aa3dff36e977d033b16b">nregul</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;No regularization will be done&#39;</span></div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Regularization will be done, using factor&#39;</span>,<a class="code" href="namespacempmod.html#a4e5959808432f81b874e1293d55c3f0a">regula</a></div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;112 <span class="keyword">FORMAT</span>(a,e9.2,a)</div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a> &lt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(22,<span class="stringliteral">&#39;Aborted, no variable global parameters&#39;</span>)</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;        stop <span class="stringliteral">&#39;... no variable global parameters&#39;</span></div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160; </div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;    <span class="keywordflow">DO</span> ivgbi=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>         <span class="comment">! IVGBI     = variable parameter index</span></div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;        itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(ivgbi)     <span class="comment">! ITGBI = global parameter index</span></div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;        presg=<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi)   <span class="comment">! get pre-sigma</span></div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;        prewt=0.0              <span class="comment">! pre-weight</span></div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;        <span class="keywordflow">IF</span>(presg &gt; 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;            prewt=1.0/presg**2            <span class="comment">! 1/presigma^2</span></div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(presg == 0.0.AND.<a class="code" href="namespacempmod.html#a0f67e1561e3f56675b01c5c884f74c27">regpre</a> &gt; 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;            prewt=1.0/real(<a class="code" href="namespacempmod.html#a0f67e1561e3f56675b01c5c884f74c27">regpre</a>**2,mpd) <span class="comment">! default 1/presigma^2</span></div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;        <a class="code" href="namespacempmod.html#a6627f321f4027818d9a70faaeff3a296">globalparpreweight</a>(ivgbi)=<a class="code" href="namespacempmod.html#a4e5959808432f81b874e1293d55c3f0a">regula</a>*prewt    <span class="comment">! weight = factor / presigma^2</span></div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160; </div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;    <span class="comment">!      WRITE(*,*) &#39;GlPa_index  GlPa_label  array1 array6&#39;</span></div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;        itgbl=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,i)</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;        ivgbi=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i)</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;        <span class="keywordflow">IF</span>(ivgbi &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;        <span class="comment">!          WRITE(*,111) I,ITGBL,QM(IND1+I),QM(IND6+IVGBI)</span></div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;        <span class="comment">!          WRITE(*,111) I,ITGBL,QM(IND1+I)</span></div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;    <span class="comment">! 111  FORMAT(I5,I10,F10.5,E12.4)</span></div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;    <span class="keyword">WRITE</span>(*,101) <span class="stringliteral">&#39;NTGB&#39;</span>,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a>,<span class="stringliteral">&#39;total number of parameters&#39;</span></div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;    <span class="keyword">WRITE</span>(*,101) <span class="stringliteral">&#39;NVGB&#39;</span>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,<span class="stringliteral">&#39;number of variable parameters&#39;</span></div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160; </div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;    <span class="comment">!     print overview over important numbers ----------------------------</span></div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160; </div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;    <a class="code" href="namespacempmod.html#ab4defd4786d68de426cd2bce457f42f7">nrecal</a>=<a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a></div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;        <span class="keyword">WRITE</span>(*,101) <span class="stringliteral">&#39;  NREC&#39;</span>,<a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>,<span class="stringliteral">&#39;number of records&#39;</span></div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#abee6ce994385c39f2092df791a95802a">nrecd</a> &gt; 0) <span class="keyword">WRITE</span>(*,101) <span class="stringliteral">&#39; NRECD&#39;</span>,<a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>,<span class="stringliteral">&#39;number of records containing doubles&#39;</span></div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;        <span class="keyword">WRITE</span>(*,101) <span class="stringliteral">&#39;MREQENF&#39;</span>,<a class="code" href="namespacempmod.html#aabad99e1ca6e9001ab80694e02146303">mreqenf</a>,<span class="stringliteral">&#39;required number of entries (from binary files)&#39;</span></div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a> &gt; <a class="code" href="namespacempmod.html#aabad99e1ca6e9001ab80694e02146303">mreqenf</a>) &amp;</div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;            <span class="keyword">WRITE</span>(*,101) <span class="stringliteral">&#39;ITEREN&#39;</span>,<a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a>,<span class="stringliteral">&#39;iterate cut for parameters with less entries&#39;</span></div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;        <span class="keyword">WRITE</span>(*,101) <span class="stringliteral">&#39;MREQENA&#39;</span>,<a class="code" href="namespacempmod.html#ae936dc93a37b86e747dc3ea21a18aa0d">mreqena</a>,<span class="stringliteral">&#39;required number of entries (from accepted fits)&#39;</span>            </div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a15fe65fce01067a005dad004bbfcdbb9">mreqpe</a> &gt; 1) <span class="keyword">WRITE</span>(*,101)  &amp;</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;            <span class="stringliteral">&#39;MREQPE&#39;</span>,<a class="code" href="namespacempmod.html#a15fe65fce01067a005dad004bbfcdbb9">mreqpe</a>,<span class="stringliteral">&#39;required number of pair entries&#39;</span></div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#af12576a4e467472322cac1ddd2212d8c">msngpe</a> &gt;= 1) <span class="keyword">WRITE</span>(*,101)  &amp;</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;            <span class="stringliteral">&#39;MSNGPE&#39;</span>,<a class="code" href="namespacempmod.html#af12576a4e467472322cac1ddd2212d8c">msngpe</a>,<span class="stringliteral">&#39;max pair entries single prec. storage&#39;</span></div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;        <span class="keyword">WRITE</span>(*,101) <span class="stringliteral">&#39;NTGB&#39;</span>,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a>,<span class="stringliteral">&#39;total number of parameters&#39;</span></div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;        <span class="keyword">WRITE</span>(*,101) <span class="stringliteral">&#39;NVGB&#39;</span>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,<span class="stringliteral">&#39;number of variable parameters&#39;</span></div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Global parameter labels:&#39;</span></div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;            mqi=<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;            <span class="keywordflow">IF</span>(mqi &lt;= 100) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;                <span class="keyword">WRITE</span>(*,*) (<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i),i=1,mqi)</div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;                <span class="keyword">WRITE</span>(*,*) (<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i),i=1,30)</div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; ...&#39;</span></div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;                mqi=((mqi-20)/20)*20+1</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;                <span class="keyword">WRITE</span>(*,*) (<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i),i=mqi,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a>)</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;    <span class="keyword">WRITE</span>(8,*)   <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;    <span class="keyword">WRITE</span>(8,101) <span class="stringliteral">&#39;  NREC&#39;</span>,<a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>,<span class="stringliteral">&#39;number of records&#39;</span></div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#abee6ce994385c39f2092df791a95802a">nrecd</a> &gt; 0) <span class="keyword">WRITE</span>(8,101) <span class="stringliteral">&#39; NRECD&#39;</span>,<a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>,<span class="stringliteral">&#39;number of records containing doubles&#39;</span></div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;    <span class="keyword">WRITE</span>(8,101) <span class="stringliteral">&#39;MREQENF&#39;</span>,<a class="code" href="namespacempmod.html#aabad99e1ca6e9001ab80694e02146303">mreqenf</a>,<span class="stringliteral">&#39;required number of entries (from binary files)&#39;</span></div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a> &gt; <a class="code" href="namespacempmod.html#aabad99e1ca6e9001ab80694e02146303">mreqenf</a>) &amp;</div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;        <span class="keyword">WRITE</span>(8,101) <span class="stringliteral">&#39;ITEREN&#39;</span>,<a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a>,<span class="stringliteral">&#39;iterate cut for parameters with less entries&#39;</span></div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;    <span class="keyword">WRITE</span>(8,101) <span class="stringliteral">&#39;MREQENA&#39;</span>,<a class="code" href="namespacempmod.html#ae936dc93a37b86e747dc3ea21a18aa0d">mreqena</a>,<span class="stringliteral">&#39;required number of entries (from accepted fits)&#39;</span></div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160; </div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1: ending&#39;</span></div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9f1cf38841260b60fa064f16b1f06cbc">mend</a></div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160; </div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;101 <span class="keyword">FORMAT</span>(1x,a8,<span class="stringliteral">&#39; =&#39;</span>,i10,<span class="stringliteral">&#39; = &#39;</span>,a)</div>
<div class="ttc" id="amphistab_8f90_html_a3f3455d53e876e4fa06564306a0aeba9"><div class="ttname"><a href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a></div><div class="ttdeci">subroutine hmpdef(ih, xa, xb, text)</div><div class="ttdef"><b>Definition:</b> <a href="mphistab_8f90_source.html#l00092">mphistab.f90:93</a></div></div>
<div class="ttc" id="anamespacempmod_html_a21163abbb7c516b63ca1f338881a4083"><div class="ttname"><a href="namespacempmod.html#a21163abbb7c516b63ca1f338881a4083">mpmod::globalparcopy</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable globalparcopy</div><div class="ttdoc">copy of global parameters</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00175">mpmod.f90:175</a></div></div>
<div class="ttc" id="anamespacempmod_html_a4984f1c03a4dbe4fc004e0fe4cae6793"><div class="ttname"><a href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">mpmod::ndimbuf</a></div><div class="ttdeci">integer(mpi) ndimbuf</div><div class="ttdoc">default read buffer size (I/F words, half record length)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00304">mpmod.f90:304</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6627f321f4027818d9a70faaeff3a296"><div class="ttname"><a href="namespacempmod.html#a6627f321f4027818d9a70faaeff3a296">mpmod::globalparpreweight</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable globalparpreweight</div><div class="ttdoc">weight from pre-sigma</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00179">mpmod.f90:179</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6f741969fa404307697fa4c882036251"><div class="ttname"><a href="namespacempmod.html#a6f741969fa404307697fa4c882036251">mpmod::nrec</a></div><div class="ttdeci">integer(mpi) nrec</div><div class="ttdoc">number of records read</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00130">mpmod.f90:130</a></div></div>
<div class="ttc" id="anamespacempmod_html_a750f7431a207d867d6bc87919933e86d"><div class="ttname"><a href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">mpmod::ntgb</a></div><div class="ttdeci">integer(mpi) ntgb</div><div class="ttdoc">total number of global parameters</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00117">mpmod.f90:117</a></div></div>
<div class="ttc" id="anamespacempmod_html_a86837eb66ab98086bb5dfcc2bdcf31f5"><div class="ttname"><a href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">mpmod::globalparpresigma</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable globalparpresigma</div><div class="ttdoc">pre-sigma for global parameters</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00178">mpmod.f90:178</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab4defd4786d68de426cd2bce457f42f7"><div class="ttname"><a href="namespacempmod.html#ab4defd4786d68de426cd2bce457f42f7">mpmod::nrecal</a></div><div class="ttdeci">integer(mpi) nrecal</div><div class="ttdoc">number of records</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00145">mpmod.f90:145</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab5a8c50ef7c6456fd7f4811f22bcb3fc"><div class="ttname"><a href="namespacempmod.html#ab5a8c50ef7c6456fd7f4811f22bcb3fc">mpmod::skippedrecords</a></div><div class="ttdeci">integer(mpi) skippedrecords</div><div class="ttdoc">number of skipped records (buffer too small)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00162">mpmod.f90:162</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab83ffab12b6a35c57e98c88dc4829934"><div class="ttname"><a href="namespacempmod.html#ab83ffab12b6a35c57e98c88dc4829934">mpmod::globalparcounts</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable globalparcounts</div><div class="ttdoc">global parameters counts (from binary files)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00180">mpmod.f90:180</a></div></div>
<div class="ttc" id="anamespacempmod_html_abee6ce994385c39f2092df791a95802a"><div class="ttname"><a href="namespacempmod.html#abee6ce994385c39f2092df791a95802a">mpmod::nrecd</a></div><div class="ttdeci">integer(mpi) nrecd</div><div class="ttdoc">number of records read containing doubles</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00131">mpmod.f90:131</a></div></div>
<div class="ttc" id="anamespacempmod_html_ade9e2f7c5771cc50bf7aa563f636d46f"><div class="ttname"><a href="namespacempmod.html#ade9e2f7c5771cc50bf7aa563f636d46f">mpmod::globalparstart</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable globalparstart</div><div class="ttdoc">start value for global parameters</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00177">mpmod.f90:177</a></div></div>
<div class="ttc" id="anamespacempmod_html_ae3b172f60491ca00efdcfd53f982e9c7"><div class="ttname"><a href="namespacempmod.html#ae3b172f60491ca00efdcfd53f982e9c7">mpmod::npresg</a></div><div class="ttdeci">integer(mpi) npresg</div><div class="ttdoc">number of pre-sigmas</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00144">mpmod.f90:144</a></div></div>
<div class="ttc" id="anamespacempmod_html_af3ba16780eb459de8bc936aa70d022dd"><div class="ttname"><a href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">mpmod::readbufferpointer</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable readbufferpointer</div><div class="ttdoc">pointer to used buffers</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00234">mpmod.f90:234</a></div></div>
<div class="ttc" id="anamespacempmod_html_af8b1de9d0e46f662b0f521cffd946954"><div class="ttname"><a href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">mpmod::readbufferdataf</a></div><div class="ttdeci">real(mpr4), dimension(:), allocatable readbufferdataf</div><div class="ttdoc">float data</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00236">mpmod.f90:236</a></div></div>
<div class="ttc" id="apede_8f90_html_a781f6fc2bdd91639f9a943c2b7801d4e"><div class="ttname"><a href="pede_8f90.html#a781f6fc2bdd91639f9a943c2b7801d4e">peread</a></div><div class="ttdeci">subroutine peread(more)</div><div class="ttdoc">Read (block of) records from binary files.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l01737">pede.f90:1738</a></div></div>
<div class="ttc" id="apede_8f90_html_aacd49a512bb96f75b566fa8f2aee605b"><div class="ttname"><a href="pede_8f90.html#aacd49a512bb96f75b566fa8f2aee605b">peprep</a></div><div class="ttdeci">subroutine peprep(mode)</div><div class="ttdoc">Prepare records.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l02066">pede.f90:2067</a></div></div>
<div class="ttc" id="apede_8f90_html_ada59c18037976f20c1de59572134c38e"><div class="ttname"><a href="pede_8f90.html#ada59c18037976f20c1de59572134c38e">loop1i</a></div><div class="ttdeci">subroutine loop1i</div><div class="ttdoc">Iteration of first data loop.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l05095">pede.f90:5096</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada59c18037976f20c1de59572134c38e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada59c18037976f20c1de59572134c38e">&#9670;&nbsp;</a></span>loop1i()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine loop1i</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iteration of first data loop. </p>
<p>Read all data files again skipping measurements with any parameter below the entries cut to update the number of entries.</p>
<p>Redefine variable and fixed global parameters (depending on updated entries). </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l05095">5095</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160; </div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ibuf</div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ij</div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: indab</div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inder</div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isfrst</div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: islast</div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ist</div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ja</div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jb</div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jsp</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nc31</div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nr</div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nlow</div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nst</div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nwrd</div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;<span class="keywordtype">    REAL</span>(mpr8) :: glder</div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160; </div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: length</div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: newCounter</div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160; </div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;    isfrst(ibuf)=<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf)+1</div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;    islast(ibuf)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf))</div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;    inder(i)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(i)</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;    glder(i)=<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(i)</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1: iterating&#39;</span></div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;LOOP1: iterating&#39;</span></div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160; </div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;    length=<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(newcounter,length,<span class="stringliteral">&#39;new entries counter&#39;</span>)</div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;    newcounter=0</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160; </div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;    <span class="comment">!     define read buffer</span></div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;    nc31=<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a>/(31*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a>) <span class="comment">! split read cache 1 : 10 : 10*2 for pointers, ints, floats</span></div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;    nwrd=nc31+1</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;    length=nwrd*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>,length,<span class="stringliteral">&#39;read buffer, pointer&#39;</span>)</div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;    nwrd=nc31*10+2+<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a></div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;    length=nwrd*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>,length,<span class="stringliteral">&#39;read buffer, integer&#39;</span>)</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>,length,<span class="stringliteral">&#39;read buffer, double&#39;</span>)</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;    <span class="comment">! to read (old) float binary files</span></div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;    length=(<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a>+2)*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>,length,<span class="stringliteral">&#39;read buffer, float&#39;</span>)</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160; </div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a781f6fc2bdd91639f9a943c2b7801d4e">peread</a>(nr)  <span class="comment">! read records</span></div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aacd49a512bb96f75b566fa8f2aee605b">peprep</a>(1)  <span class="comment">! prepare records</span></div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;        <span class="keywordflow">DO</span> ibuf=1,<a class="code" href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">numreadbuffer</a>           <span class="comment">! buffer for current record        </span></div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;            ist=isfrst(ibuf)</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;            nst=islast(ibuf)</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;            nwrd=nst-ist+1</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;            <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;                <span class="keywordflow">IF</span>(ja == 0.AND.jb == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;                <span class="keywordflow">IF</span>(ja /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;                    nlow=0</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;                    <span class="keywordflow">DO</span> j=1,ist-jb</div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;                        ij=inder(jb+j)                      <span class="comment">! index of global parameter</span></div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;                        ij=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,ij)        <span class="comment">! change to variable parameter</span></div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;                        <span class="keywordflow">IF</span>(ij == -2) nlow=nlow+1            <span class="comment">! fixed by entries cut</span></div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;                    <span class="keywordflow">IF</span>(nlow == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;                        <span class="keywordflow">DO</span> j=1,ist-jb</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;                            ij=inder(jb+j)                  <span class="comment">! index of global parameter</span></div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;                            newcounter(ij)=newcounter(ij)+1 <span class="comment">! count again</span></div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;<span class="keywordflow">                        END DO</span></div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;<span class="keywordflow">                    ENDIF</span></div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;            <span class="comment">! end-of-event  </span></div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;        <span class="keywordflow">IF</span>(nr &lt;= 0) <span class="keywordflow">EXIT</span> <span class="comment">! end of data?</span></div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160; </div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;    <span class="comment">!     release read buffer</span></div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>)</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>)</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>)</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>)</div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160; </div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;    indab=0</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;            <span class="keywordflow">IF</span>(newcounter(i) &gt;= <a class="code" href="namespacempmod.html#aabad99e1ca6e9001ab80694e02146303">mreqenf</a> .OR. <a class="code" href="namespacempmod.html#ab83ffab12b6a35c57e98c88dc4829934">globalparcounts</a>(i) &gt;= <a class="code" href="namespacempmod.html#a280a03a7d185dee969a6300126ee3354">iteren</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;                indab=indab+1</div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;                <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i)=indab  <span class="comment">! variable, used in matrix (active)</span></div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;                <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,i)=-3     <span class="comment">! fixed (iterated entries cut), not used in matrix (not active)</span></div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;    <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-6)=indab <span class="comment">! counted variable</span></div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;    <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>=indab  <span class="comment">! nr of variable parameters</span></div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP1:&#39;</span>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>, <span class="stringliteral">&#39; is number NVGB of variable parameters&#39;</span></div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(newcounter)</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160; </div>
<div class="ttc" id="anamespacempmod_html_a7943c808f797a0e0955edf388eccefd7"><div class="ttname"><a href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">mpmod::numreadbuffer</a></div><div class="ttdeci">integer(mpi) numreadbuffer</div><div class="ttdoc">number of buffers (records) in (read) block</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00159">mpmod.f90:159</a></div></div>
<div class="ttc" id="apede_8f90_html_a2660e9144b1f62e900d2d8e2e1e6ba12"><div class="ttname"><a href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a></div><div class="ttdeci">subroutine isjajb(nst, is, ja, jb, jsp)</div><div class="ttdoc">Decode Millepede record.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l02259">pede.f90:2260</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af70347dcf7288f096af64b5bca459d61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af70347dcf7288f096af64b5bca459d61">&#9670;&nbsp;</a></span>loop2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine loop2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Second data loop (number of derivatives, global label pairs). </p>
<p>Calculate maximum number of local, global derivatives and equations per record.</p>
<p>For sparse storage count index pairs with bit (field) counters to construct sparsity structure (row offsets, (compressed) column lists).</p>
<p>Determine read/write cache splitting from average record values (length, global par. vector/matrix).</p>
<p>Check constraints for rank deficit. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l05215">5215</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160; </div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: chin2</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: chin3</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: cpr</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: fsum</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: gbc</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: gbu</div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;<span class="keywordtype">    REAL</span>(mpr8) :: glder</div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ia</div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ib</div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ibuf</div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: icgb</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iext</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ihis</div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ij</div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ijn</div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inder</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioff</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iproc</div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: irecmm</div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isfrst</div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: islast</div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ist</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbij</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbik</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbij</div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbik</div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ja</div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jb</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jext</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jcgb</div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jsp</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: joff</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: kfile</div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: l</div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: label</div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lu</div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: maeqnf</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: naeqna</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: naeqnf</div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: naeqng</div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nc31</div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncachd</div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncachi</div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncachr</div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nda</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ndf</div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ndfmax</div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nfixed</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nggd</div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nggi</div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nmatmo</div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: noff</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nr</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrecf</div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrecmm</div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nst</div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nwrd</div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inone</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inc</div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: wgh</div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: wolfc3</div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: wrec</div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: chindl</div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160; </div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::dstat(3)</div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::rerr</div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: noff8</div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: ndimbi</div>
<div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: ndimsa(4)</div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: ndgn</div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: matsiz(2)</div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: matwords</div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: length</div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: rows</div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: cols</div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>, <span class="keywordtype">PARAMETER</span> :: two=2</div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: maxGlobalPar = 0</div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: maxLocalPar = 0</div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: maxEquations = 0</div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160; </div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;    <span class="keyword">INTERFACE</span> <span class="comment">! needed for assumed-shape dummy arguments</span></div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;        <span class="keyword">SUBROUTINE </span><a class="code" href="mpbits_8f90.html#afc3196af7a116ae0050f96c940c03ba3">ndbits</a>(ndims,ncmprs,nsparr,ihst)</div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;            <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;            <span class="keywordtype">INTEGER(mpl)</span>, <span class="keywordtype">DIMENSION(4)</span>, <span class="keywordtype">INTENT(OUT)</span> :: ndims</div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;            <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">INTENT(OUT)</span> :: ncmprs</div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;            <span class="keywordtype">INTEGER(mpl)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">INTENT(OUT)</span> :: nsparr</div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;            <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: ihst</div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;        <span class="keyword">END SUBROUTINE </span><a class="code" href="mpbits_8f90.html#afc3196af7a116ae0050f96c940c03ba3">ndbits</a></div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;        <span class="keyword">SUBROUTINE </span><a class="code" href="mpbits_8f90.html#a76f1a5c5e332b0acd9a036edf977c4fe">spbits</a>(nsparr,nsparc,ncmprs)</div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;            <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;            <span class="keywordtype">INTEGER(mpl)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">INTENT(IN)</span> :: nsparr</div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;            <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">INTENT(OUT)</span> :: nsparc</div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;            <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">INTENT(IN)</span> :: ncmprs</div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;        <span class="keyword">END SUBROUTINE </span><a class="code" href="mpbits_8f90.html#a76f1a5c5e332b0acd9a036edf977c4fe">spbits</a></div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;        <span class="keyword">SUBROUTINE </span><a class="code" href="mpbits_8f90.html#a30b4437f48cf9ea35a26f75b2e6c2a9a">gpbmap</a>(npair)</div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;            <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;            <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">INTENT(OUT)</span> :: npair</div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;        <span class="keyword">END SUBROUTINE </span><a class="code" href="mpbits_8f90.html#a30b4437f48cf9ea35a26f75b2e6c2a9a">gpbmap</a></div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;    <span class="keyword">END INTERFACE</span></div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;    </div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160; </div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;    <span class="comment">!$ INTEGER(mpi) :: OMP_GET_THREAD_NUM</span></div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160; </div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;    isfrst(ibuf)=<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf)+1</div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;    islast(ibuf)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf))</div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;    inder(i)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(i)</div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;    glder(i)=<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(i)</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP2: starting&#39;</span></div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9c76d03bc0e3c3a55898cf60cf1fbdcc">mstart</a>(<span class="stringliteral">&#39;LOOP2&#39;</span>)</div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160; </div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;    <span class="comment">!     two subarrays to get the global parameter indices, used in an event</span></div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;    length=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>,length,<span class="stringliteral">&#39;global index&#39;</span>)</div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>,length,<span class="stringliteral">&#39;back index&#39;</span>)</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;    <a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>=0</div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160; </div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;    <span class="comment">! prepare constraints - determine number of constraints NCGB</span></div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;    <span class="comment">!                     - sort and split into blocks</span></div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a05b5198a853192b0d4af53dcade84ae4">prpcon</a></div>
<div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160; </div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a87fa6b2b85b22edf417e4c663c28424d">icelim</a> &gt; 0) <span class="keywordflow">THEN</span> <span class="comment">! elimination</span></div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;        <a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>         <span class="comment">! total number of parameters</span></div>
<div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;        <a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>-<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>    <span class="comment">! number of fit parameters</span></div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;        <a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1)=0     <span class="comment">! number of constraints for preconditioner</span></div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;        <a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2)=<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>  <span class="comment">! matrix size for preconditioner</span></div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;    <span class="keywordflow">ELSE</span>                 <span class="comment">! Lagrange multipliers</span></div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;        <a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>    <span class="comment">! total number of parameters</span></div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;        <a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>         <span class="comment">! number of fit parameters</span></div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;        <a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1)=<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>  <span class="comment">! number of constraints for preconditioner</span></div>
<div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;        <a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2)=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>  <span class="comment">! matrix size for preconditioner</span></div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;    noff8=int8(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>)*int8(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>-1)/2</div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160; </div>
<div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;    <span class="comment">!     read all data files and add all variable index pairs -------------</span></div>
<div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160; </div>
<div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 1) <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#a8ee45ed456a58bf46d0b55ac62d04c0e">clbmap</a>(<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a>)</div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160; </div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#a15637ecbbc501e760f3d4f7d687a8a6a">clbits</a>(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,<a class="code" href="namespacempmod.html#a15fe65fce01067a005dad004bbfcdbb9">mreqpe</a>,<a class="code" href="namespacempmod.html#a36a3d618536d1c68b83256502a3f91b8">mhispe</a>,<a class="code" href="namespacempmod.html#af12576a4e467472322cac1ddd2212d8c">msngpe</a>,<a class="code" href="namespacempmod.html#a8f7f1c338a822386f968060f63c49161">mcmprs</a>,<a class="code" href="namespacempmod.html#a8d3078659555c21fda8d43de37c311de">mextnd</a>,ndimbi,<a class="code" href="namespacempmod.html#ad7d459edc90892891995ccb3ac96b6f3">nencdb</a>,<a class="code" href="namespacempmod.html#a4ef9f014f98a92d810584e67f14f40ec">nspc</a>) <span class="comment">! get dimension for bit storage, encoding, precision info</span></div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;    </div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;        length=<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">measindex</a>,length,<span class="stringliteral">&#39;measurement counter/index&#39;</span>)</div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;        <a class="code" href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">measindex</a>=0</div>
<div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#add5d6ee87f88e926424677b1728576f8">measres</a>,length,<span class="stringliteral">&#39;measurement resolution&#39;</span>)</div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;        <a class="code" href="namespacempmod.html#add5d6ee87f88e926424677b1728576f8">measres</a>=0.0_mps</div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;        <a class="code" href="namespacempmod.html#a0ba5f44eb369bc3a679cf14f47bbfb80">lunmon</a>=9</div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a7ee8fc712707e7a8cafaf374b4a4e348">mvopen</a>(<a class="code" href="namespacempmod.html#a0ba5f44eb369bc3a679cf14f47bbfb80">lunmon</a>,<span class="stringliteral">&#39;millepede.mon&#39;</span>)</div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160; </div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;    <span class="comment">!     reading events===reading events===reading events===reading events=</span></div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;    nrecf =0  <span class="comment">! records with fixed global parameters</span></div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;    naeqng=0  <span class="comment">! count number of equations (with global der.)</span></div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;    naeqnf=0  <span class="comment">! count number of equations ( &quot; , fixed)</span></div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;    naeqna=0  <span class="comment">! all</span></div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP2: start event reading&#39;</span></div>
<div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;    <span class="comment">!     monitoring for sparse matrix?</span></div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;    irecmm=0</div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2.AND.<a class="code" href="namespacempmod.html#a40b10ff9c38e0bc56415be23334c925c">matmon</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;        nmatmo=0</div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a40b10ff9c38e0bc56415be23334c925c">matmon</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;            nrecmm=<a class="code" href="namespacempmod.html#a40b10ff9c38e0bc56415be23334c925c">matmon</a></div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;            nrecmm=1</div>
<div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;    <span class="keywordflow">DO</span> k=1,3</div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;        dstat(k)=0.0_mpd</div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;    <span class="comment">!     define read buffer</span></div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;    nc31=<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a>/(31*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a>) <span class="comment">! split read cache 1 : 10 : 10*2 for pointers, ints, floats</span></div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;    nwrd=nc31+1</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;    length=nwrd*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>,length,<span class="stringliteral">&#39;read buffer, pointer&#39;</span>)</div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;    nwrd=nc31*10+2+<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a></div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;    length=nwrd*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>,length,<span class="stringliteral">&#39;read buffer, integer&#39;</span>)</div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>,length,<span class="stringliteral">&#39;read buffer, real&#39;</span>)</div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;    <span class="comment">! to read (old) float binary files</span></div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;    length=(<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a>+2)*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>,length,<span class="stringliteral">&#39;read buffer, float&#39;</span>)</div>
<div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;    </div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;    <span class="comment">! for checking appearance </span></div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;        length=5*<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>,length,<span class="stringliteral">&#39;appearance statistics&#39;</span>)</div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;        <a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>=0</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;        length=<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a46bd7a6037c5d52224f22143b1f0ee02">paircounter</a>,length,<span class="stringliteral">&#39;pair statistics&#39;</span>)</div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;        <a class="code" href="namespacempmod.html#a46bd7a6037c5d52224f22143b1f0ee02">paircounter</a>=0</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160; </div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a781f6fc2bdd91639f9a943c2b7801d4e">peread</a>(nr) <span class="comment">! read records</span></div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aacd49a512bb96f75b566fa8f2aee605b">peprep</a>(1)  <span class="comment">! prepare records</span></div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;        ioff=0</div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;        <span class="keywordflow">DO</span> ibuf=1,<a class="code" href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">numreadbuffer</a>           <span class="comment">! buffer for current record</span></div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;            <a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(isfrst(ibuf)-2)   <span class="comment">! record</span></div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;            <span class="comment">!     Printout for DEBUG</span></div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a> &lt;= <a class="code" href="namespacempmod.html#a2d27f879e65ac6d07b201c81c8cdf122">mdebug</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;                nda=0</div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;                kfile=nint(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(isfrst(ibuf)-1),mpi) <span class="comment">! file</span></div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;                wrec =real(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(isfrst(ibuf)-2),mps) <span class="comment">! weight</span></div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Record number &#39;</span>,<a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>,<span class="stringliteral">&#39; from file &#39;</span>,kfile</div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;                <span class="keywordflow">IF</span> (wgh /= 1.0) <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;       weight &#39;</span>,wrec</div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;                ist=isfrst(ibuf)</div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;                nst=islast(ibuf)</div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;                <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;                    <span class="keywordflow">IF</span>(ja == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;                    nda=nda+1</div>
<div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;                    <span class="keywordflow">IF</span>(nda &gt; <a class="code" href="namespacempmod.html#a66e80bef0f5a1e805bb364c8ab9d4ef9">mdebg2</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;                        <span class="keywordflow">IF</span>(nda == <a class="code" href="namespacempmod.html#a66e80bef0f5a1e805bb364c8ab9d4ef9">mdebg2</a>+1)  <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;... and more data&#39;</span></div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;                        cycle</div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;                    <span class="keyword">WRITE</span>(*,*) nda, <span class="stringliteral">&#39; Measured value =&#39;</span>,glder(ja),<span class="stringliteral">&#39; +- &#39;</span>,glder(jb)</div>
<div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Local derivatives:&#39;</span></div>
<div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;                    <span class="keyword">WRITE</span>(*,107) (inder(ja+j),glder(ja+j),j=1,jb-ja-1)</div>
<div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;107                 <span class="keyword">FORMAT</span>(6(i3,g12.4))</div>
<div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;                    <span class="keywordflow">IF</span> (jb &lt; ist) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;                        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Global derivatives:&#39;</span></div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;                        <span class="keyword">WRITE</span>(*,108) (<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,inder(jb+j)),inder(jb+j),  &amp;</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;                            <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,inder(jb+j)),glder(jb+j),j=1,ist-jb)</div>
<div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;108                     <span class="keyword">FORMAT</span>(3i11,g12.4)</div>
<div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;                    <span class="keywordflow">IF</span>(nda == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;                        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;total_par_label  __label__   var_par_index   derivative&#39;</span></div>
<div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;  </div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;            <a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a> =0                     <span class="comment">! count number of global derivatives</span></div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;            <a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a> =0                     <span class="comment">! count number of local  derivatives</span></div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;            <a class="code" href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">naeqn</a> =0                     <span class="comment">! count number of equations</span></div>
<div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;            maeqnf=naeqnf</div>
<div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;            ist=isfrst(ibuf)</div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;            nst=islast(ibuf)</div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;            nwrd=nst-ist+1</div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;            <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;                <span class="keywordflow">IF</span>(ja == 0.AND.jb == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;                <a class="code" href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">naeqn</a>=<a class="code" href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">naeqn</a>+1</div>
<div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;                naeqna=naeqna+1</div>
<div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;                <span class="keywordflow">IF</span>(ja /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;                    <span class="keywordflow">IF</span> (ist &gt; jb) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;                        naeqng=naeqng+1</div>
<div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;                        <span class="comment">! monitoring, group measurements, sum up entries and errors</span></div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;                            rerr =real(glder(jb),mpd)     <span class="comment">! the error</span></div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;                            ij=inder(jb+1)               <span class="comment">! index of first global parameter, used to group measurements</span></div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;                            <a class="code" href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">measindex</a>(ij)=<a class="code" href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">measindex</a>(ij)+1</div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;                            <a class="code" href="namespacempmod.html#add5d6ee87f88e926424677b1728576f8">measres</a>(ij)=<a class="code" href="namespacempmod.html#add5d6ee87f88e926424677b1728576f8">measres</a>(ij)+rerr</div>
<div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;<span class="keywordflow">                    END IF</span>    </div>
<div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;                    nfixed=0</div>
<div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;                    <span class="keywordflow">DO</span> j=1,ist-jb</div>
<div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;                        ij=inder(jb+j)                     <span class="comment">! index of global parameter</span></div>
<div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;                        <span class="comment">! check appearance </span></div>
<div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;                            joff = 5*(ij-1)</div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;                            kfile=nint(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(isfrst(ibuf)-1),mpi) <span class="comment">! file</span></div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>(joff+1) == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;                                <a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>(joff+1) = kfile</div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;                                <a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>(joff+2) = <a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>-<a class="code" href="namespacempmod.html#a96612c6c1900e9c644f8c112ee6597be">ifd</a>(kfile) <span class="comment">! (local) record number</span></div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;<span class="keywordflow">                            END IF</span></div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>(joff+3) /= kfile) <a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>(joff+5)=<a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>(joff+5)+1</div>
<div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;                            <a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>(joff+3) = kfile</div>
<div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;                            <a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>(joff+4) = <a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>-<a class="code" href="namespacempmod.html#a96612c6c1900e9c644f8c112ee6597be">ifd</a>(kfile) <span class="comment">! (local) record number</span></div>
<div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;                            <span class="comment">! count pairs</span></div>
<div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;                            <span class="keywordflow">DO</span> k=1,j</div>
<div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;                                <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#a9fcf35f8796ff738209a4634577f8769">inbmap</a>(ij,inder(jb+k))</div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;<span class="keywordflow">                            END DO</span></div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;                        </div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;                        ij=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,ij)       <span class="comment">! change to variable parameter</span></div>
<div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;                        <span class="keywordflow">IF</span>(ij &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;                            ijn=<a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(ij)         <span class="comment">! get index of index</span></div>
<div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;                            <span class="keywordflow">IF</span>(ijn == 0) <span class="keywordflow">THEN</span>              <span class="comment">! not yet included</span></div>
<div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;                                <a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>=<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>+1              <span class="comment">! count</span></div>
<div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;                                <a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>(<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>)=ij <span class="comment">! store variable index</span></div>
<div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;                                <a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(ij)=<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>   <span class="comment">! store back index</span></div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;<span class="keywordflow">                            END IF</span></div>
<div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;                        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;                            nfixed=nfixed+1</div>
<div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;                    <span class="keywordflow">IF</span> (nfixed &gt; 0) naeqnf=naeqnf+1</div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;  </div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;                <span class="keywordflow">IF</span>(ja /= 0.AND.jb /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;                    <span class="keywordflow">DO</span> j=1,jb-ja-1           <span class="comment">! local parameters</span></div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;                        ij=inder(ja+j)</div>
<div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;                        <a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a>=max(<a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a>,ij)</div>
<div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;  </div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;            <span class="comment">! end-of-event</span></div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;            <span class="keywordflow">IF</span> (naeqnf &gt; maeqnf) nrecf=nrecf+1</div>
<div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;            irecmm=irecmm+1</div>
<div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;            <span class="comment">!     end-of-event-end-of-event-end-of-event-end-of-event-end-of-event-e</span></div>
<div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;  </div>
<div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;            maxglobalpar=max(<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>,maxglobalpar) <span class="comment">! maximum number of global parameters</span></div>
<div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;            maxlocalpar=max(<a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a>,maxlocalpar)   <span class="comment">! maximum number of local parameters</span></div>
<div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;            maxequations=max(<a class="code" href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">naeqn</a>,maxequations) <span class="comment">! maximum number of equations</span></div>
<div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;  </div>
<div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;            <span class="comment">!     sample statistics for caching</span></div>
<div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;            dstat(1)=dstat(1)+real((nwrd+2)*2,mpd)               <span class="comment">! record size</span></div>
<div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;            dstat(2)=dstat(2)+real(<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>+2,mpd)                  <span class="comment">! indices,</span></div>
<div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;            dstat(3)=dstat(3)+real(<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>*<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>+<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>,mpd)        <span class="comment">! data for MUPDAT</span></div>
<div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;  </div>
<div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a8750c46a189254239c8be1f5f9f25554">sort1k</a>(<a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>,<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>) <span class="comment">! sort global par.</span></div>
<div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;            <span class="comment">! overwrite read buffer with lists of global labels</span></div>
<div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;            ioff=ioff+1</div>
<div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;            <a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf)=ioff</div>
<div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;            <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(ioff)=ioff+<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a></div>
<div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;            <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>                  <span class="comment">! reset global index array</span></div>
<div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;                iext=<a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>(i)</div>
<div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;                <a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(iext)=0</div>
<div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;                <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(ioff+i)=iext</div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;            ioff=ioff+<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a></div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;  </div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;        ioff=0</div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160; </div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;            <span class="comment">!$OMP  PARALLEL &amp;</span></div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;            <span class="comment">!$OMP  DEFAULT(PRIVATE) &amp;</span></div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;            <span class="comment">!$OMP  SHARED(numReadBuffer,readBufferPointer,readBufferDataI,MTHRD)</span></div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;            iproc=0</div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;            <span class="comment">!$ IPROC=OMP_GET_THREAD_NUM()         ! thread number</span></div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;            <span class="keywordflow">DO</span> ibuf=1,<a class="code" href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">numreadbuffer</a></div>
<div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;                ist=isfrst(ibuf)</div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;                nst=islast(ibuf)</div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;                <span class="keywordflow">DO</span> i=ist,nst                 <span class="comment">! store all combinations</span></div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;                    iext=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(i)             <span class="comment">! variable global index</span></div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;                    <span class="comment">!$ IF (MOD(IEXT,MTHRD).EQ.IPROC) THEN  ! distinct rows per thread</span></div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;                    <span class="keywordflow">DO</span> l=ist,i</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;                        jext=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(l)</div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#afa57801baa6a34263fe5c2145a9ee5df">inbits</a>(iext,jext,1) <span class="comment">! save space</span></div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;                    <span class="comment">!$ ENDIF</span></div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;            <span class="comment">!$OMP END PARALLEL</span></div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;            <span class="comment">! monitoring</span></div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a40b10ff9c38e0bc56415be23334c925c">matmon</a> /= 0.AND.  &amp;</div>
<div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;                (irecmm &gt;= nrecmm.OR.irecmm == <a class="code" href="namespacempmod.html#abebbe378eaef934cd254dbb758556e27">mxrec</a>)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;                <span class="keywordflow">IF</span> (nmatmo == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;                    <span class="keyword">WRITE</span>(*,*)</div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Monitoring of sparse matrix construction&#39;</span></div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; records ........ off-diagonal elements &#39;</span>,  &amp;</div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;                        <span class="stringliteral">&#39;....... compression   memory&#39;</span></div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;             non-zero used(double)  used&#39;</span>,  &amp;</div>
<div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;                        <span class="stringliteral">&#39;(float)       [%]       [GB]&#39;</span></div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;                nmatmo=nmatmo+1</div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;                <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#a5565f05ff15ba9aba67b318aa2765c0c">ckbits</a>(ndimsa)</div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;                gbc=1.0e-9*real((mpi*ndimsa(2)+mpd*ndimsa(3)+mps*ndimsa(4))/mpi*(bit_size(1_mpi)/8),mps) <span class="comment">! GB compressed</span></div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;                gbu=1.0e-9*real(((mpi+mpd)*(ndimsa(3)+ndimsa(4)))/mpi*(bit_size(1_mpi)/8),mps)             <span class="comment">! GB uncompressed</span></div>
<div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;                cpr=100.0*gbc/gbu</div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;                <span class="keyword">WRITE</span>(*,1177) irecmm,ndimsa(1),ndimsa(3),ndimsa(4),cpr,gbc</div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;1177            <span class="keyword">FORMAT</span>(i9,3i13,f10.2,f11.6)</div>
<div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;                <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span>(irecmm &gt;= nrecmm)</div>
<div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a40b10ff9c38e0bc56415be23334c925c">matmon</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;                        nrecmm=nrecmm+<a class="code" href="namespacempmod.html#a40b10ff9c38e0bc56415be23334c925c">matmon</a></div>
<div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;                    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;                        nrecmm=nrecmm*2</div>
<div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160; </div>
<div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160; </div>
<div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;        <span class="keywordflow">IF</span> (nr &lt;= 0) <span class="keywordflow">EXIT</span> <span class="comment">! next block of events ?</span></div>
<div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;    <span class="comment">!     release read buffer</span></div>
<div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>)</div>
<div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>)</div>
<div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>)</div>
<div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>)</div>
<div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160; </div>
<div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP2: event reading ended - end of data&#39;</span></div>
<div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;    <span class="keywordflow">DO</span> k=1,3</div>
<div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;        dstat(k)=dstat(k)/real(<a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>,mpd)</div>
<div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;    <span class="comment">!     end=of=data=end=of=data=end=of=data=end=of=data=end=of=data=end=of</span></div>
<div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160; </div>
<div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#a30b4437f48cf9ea35a26f75b2e6c2a9a">gpbmap</a>(<a class="code" href="namespacempmod.html#a46bd7a6037c5d52224f22143b1f0ee02">paircounter</a>)</div>
<div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;<span class="keywordflow">    END IF</span>    </div>
<div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160; </div>
<div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;          </div>
<div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;        <span class="comment">!     constraints and index pairs with Lagrange multiplier</span></div>
<div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160; </div>
<div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160; </div>
<div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;        <span class="comment">!     constraints - determine number of constraints NCGB and index-pairs</span></div>
<div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;        <span class="comment">!        Lagrange multiplier and global parameters</span></div>
<div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160; </div>
<div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160; </div>
<div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;        inc=max(<a class="code" href="namespacempmod.html#a15fe65fce01067a005dad004bbfcdbb9">mreqpe</a>, <a class="code" href="namespacempmod.html#af12576a4e467472322cac1ddd2212d8c">msngpe</a>+1) <span class="comment">!  keep constraints in double precision</span></div>
<div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160; </div>
<div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;        <span class="comment">!  loop over (sorted) constraints</span></div>
<div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;        <span class="keywordflow">DO</span> jcgb=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;            icgb=<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(3,jcgb) <span class="comment">! unsorted constraint index</span></div>
<div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;            <span class="keywordflow">DO</span> i=<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb)+2,<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb+1)-1</div>
<div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;                label=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i)%label</div>
<div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;                itgbi=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(label)</div>
<div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;                ij=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi)         <span class="comment">! change to variable parameter</span></div>
<div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;                <span class="keywordflow">IF</span>(ij &gt; 0 .AND. <a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a> &gt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#afa57801baa6a34263fe5c2145a9ee5df">inbits</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+jcgb,ij,inc)</div>
<div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160; </div>
<div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;        <span class="comment">!     measurements - determine index-pairs</span></div>
<div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160; </div>
<div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;  </div>
<div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;        i=1</div>
<div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;        <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span> (i &lt;= <a class="code" href="namespacempmod.html#ab2fc85b092d025d708c3278d253a49ac">lenmeasurements</a>)</div>
<div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;            i=i+2</div>
<div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;            <span class="comment">!        loop over label/factor pairs</span></div>
<div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;            ia=i</div>
<div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;            <span class="keywordflow">DO</span></div>
<div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;                i=i+1</div>
<div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;                <span class="keywordflow">IF</span>(i &gt; <a class="code" href="namespacempmod.html#ab2fc85b092d025d708c3278d253a49ac">lenmeasurements</a>) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(i)%label == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;            ib=i-1</div>
<div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;  </div>
<div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;            <span class="keywordflow">DO</span> j=ia,ib</div>
<div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;                itgbij=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(j)%label) <span class="comment">! total parameter index</span></div>
<div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;                <span class="comment">!         first index</span></div>
<div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;                ivgbij=0</div>
<div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;                <span class="keywordflow">IF</span>(itgbij /= 0) ivgbij=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbij) <span class="comment">! variable-parameter index</span></div>
<div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;                <span class="keywordflow">DO</span> k=ia,j</div>
<div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;                    itgbik=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(k)%label) <span class="comment">! total parameter index</span></div>
<div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;                    <span class="comment">!         second index</span></div>
<div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;                    ivgbik=0</div>
<div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;                    <span class="keywordflow">IF</span>(itgbik /= 0) ivgbik=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbik) <span class="comment">! variable-parameter index</span></div>
<div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;                    <span class="keywordflow">IF</span>(ivgbij &gt; 0.AND.ivgbik &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#afa57801baa6a34263fe5c2145a9ee5df">inbits</a>(ivgbij,ivgbik,<a class="code" href="namespacempmod.html#a15fe65fce01067a005dad004bbfcdbb9">mreqpe</a>)</div>
<div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 1) <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;add index pair &#39;</span>,ivgbij,ivgbik</div>
<div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160; </div>
<div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160; </div>
<div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;    <a class="code" href="namespacempmod.html#aa9d3e269a0fe4f2a7d8a400e2f76d83e">nummeas</a>=0 <span class="comment">! number of measurement groups</span></div>
<div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;        <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">measindex</a>(i) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;                <a class="code" href="namespacempmod.html#aa9d3e269a0fe4f2a7d8a400e2f76d83e">nummeas</a>=<a class="code" href="namespacempmod.html#aa9d3e269a0fe4f2a7d8a400e2f76d83e">nummeas</a>+1</div>
<div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;                <a class="code" href="namespacempmod.html#add5d6ee87f88e926424677b1728576f8">measres</a>(i) = <a class="code" href="namespacempmod.html#add5d6ee87f88e926424677b1728576f8">measres</a>(i)/real(<a class="code" href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">measindex</a>(i),mpd)</div>
<div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;                <a class="code" href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">measindex</a>(i) = <a class="code" href="namespacempmod.html#aa9d3e269a0fe4f2a7d8a400e2f76d83e">nummeas</a></div>
<div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;        length=<a class="code" href="namespacempmod.html#aa9d3e269a0fe4f2a7d8a400e2f76d83e">nummeas</a>*<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>*<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a></div>
<div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>,length,<span class="stringliteral">&#39;measurement counter&#39;</span>)</div>
<div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;    <span class="comment">!     print numbers ----------------------------------------------------</span></div>
<div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160; </div>
<div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a> &gt;= 65536) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;        noff=int(noff8/1000,mpi)</div>
<div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;        noff=int(noff8,mpi)</div>
<div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;    ndgn=0</div>
<div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;    matwords=0</div>
<div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;        ihis=0</div>
<div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a36a3d618536d1c68b83256502a3f91b8">mhispe</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;            ihis=15</div>
<div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(ihis,0.0,real(<a class="code" href="namespacempmod.html#a36a3d618536d1c68b83256502a3f91b8">mhispe</a>,mps), <span class="stringliteral">&#39;NDBITS: #off-diagonal elements&#39;</span>)</div>
<div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;        length=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>*<a class="code" href="namespacempmod.html#a4ef9f014f98a92d810584e67f14f40ec">nspc</a></div>
<div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#afe0ea5bb9145eeb4c037e3938b76d427">sparsematrixcompression</a>,length, <span class="stringliteral">&#39;sparse matrix row compression&#39;</span>)</div>
<div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;        <a class="code" href="namespacempmod.html#afe0ea5bb9145eeb4c037e3938b76d427">sparsematrixcompression</a>=0</div>
<div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;        length=(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>+1)*<a class="code" href="namespacempmod.html#a4ef9f014f98a92d810584e67f14f40ec">nspc</a></div>
<div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>,two,length, <span class="stringliteral">&#39;sparse matrix row offsets&#39;</span>)</div>
<div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#afc3196af7a116ae0050f96c940c03ba3">ndbits</a>(ndimsa,<a class="code" href="namespacempmod.html#afe0ea5bb9145eeb4c037e3938b76d427">sparsematrixcompression</a>,<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>,ihis)</div>
<div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;        ndgn=ndimsa(3)+ndimsa(4) <span class="comment">! actual number of off-diagonal elements</span></div>
<div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;        matwords=ndimsa(2)+length <span class="comment">! size of sparsity structure</span></div>
<div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;    </div>
<div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a36a3d618536d1c68b83256502a3f91b8">mhispe</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a2010ded48e128ac616720dd5a8bc68da">nhistp</a> /= 0) <span class="keyword">CALL </span>hmprnt(ihis)</div>
<div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;            <span class="keyword">CALL </span>hmpwrt(ihis)</div>
<div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160; </div>
<div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;    <a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>=maxglobalpar <span class="comment">! max number of global parameters in one event</span></div>
<div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;    <a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a>=maxlocalpar  <span class="comment">! max number of local parameters in one event</span></div>
<div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;    <a class="code" href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">naeqn</a>=maxequations <span class="comment">! max number of equations in one event</span></div>
<div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>)</div>
<div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>)</div>
<div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;    <span class="comment">!     matrices for event matrices</span></div>
<div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;    <span class="comment">!       split up cache</span></div>
<div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(2) == 0.0) <span class="keywordflow">THEN</span> <span class="comment">! from data (DSTAT)</span></div>
<div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;        <a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(1)=real(dstat(1),mps)*<a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(1) <span class="comment">! leave some part free for fluctuations</span></div>
<div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;        <a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(2)=real(dstat(2),mps)</div>
<div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;        <a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(3)=real(dstat(3),mps)</div>
<div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;    fsum=<a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(1)+<a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(2)+<a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(3)</div>
<div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;    <span class="keywordflow">DO</span> k=1,3</div>
<div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;        <a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(k)=<a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(k)/fsum</div>
<div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;    ncachr=nint(real(<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a>,mps)*<a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(1),mpi) <span class="comment">! read cache</span></div>
<div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;    <span class="comment">!     define read buffer</span></div>
<div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;    nc31=ncachr/(31*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a>) <span class="comment">! split read cache 1 : 10 : 10*2 for pointers, ints, floats</span></div>
<div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;    nwrd=nc31+1</div>
<div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;    length=nwrd*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>,length,<span class="stringliteral">&#39;read buffer, pointer&#39;</span>)</div>
<div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;    nwrd=nc31*10+2+<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a></div>
<div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;    length=nwrd*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>,length,<span class="stringliteral">&#39;read buffer, integer&#39;</span>)</div>
<div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>,length,<span class="stringliteral">&#39;read buffer, real&#39;</span>)</div>
<div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;    <span class="comment">! to read (old) float binary files</span></div>
<div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;    length=(<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a>+2)*<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>,length,<span class="stringliteral">&#39;read buffer, float&#39;</span>)</div>
<div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160; </div>
<div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;    ncachi=nint(real(<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a>,mps)*<a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(2),mpi) <span class="comment">! index cache</span></div>
<div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;    ncachd=<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a>-ncachr-ncachi              <span class="comment">! data cache</span></div>
<div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;    nggd=(<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>*<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>+<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>)/2+ncachd/(2*<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>) <span class="comment">! number of double</span></div>
<div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;    nggi=2+<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>+ncachi/<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>                   <span class="comment">! number of ints</span></div>
<div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;    length=<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>*<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>,length, <span class="stringliteral">&#39;global parameters (dim =max/event)&#39;</span>)</div>
<div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;    length=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>*<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>,length,<span class="stringliteral">&#39;global variable-index array&#39;</span>)</div>
<div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;    <a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>=0</div>
<div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;    length=<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>*<a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a></div>
<div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a3688e8f65ab58bddfac03c3043166b24">localglobalmatrix</a>,length,<span class="stringliteral">&#39;local/global matrix&#39;</span>)</div>
<div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;    length=nggd*<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ac573f05a09f12bb6c00492f1d7374d9e">writebufferupdates</a>,length,<span class="stringliteral">&#39;symmetric update matrices&#39;</span>)</div>
<div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;    <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-1)=nggd                  <span class="comment">! number of words per thread</span></div>
<div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;    <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-2)=(<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>*<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>+<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>)/2 <span class="comment">! min free (double) words</span></div>
<div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;    length=nggi*<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>,length,<span class="stringliteral">&#39;symmetric update matrix indices&#39;</span>)</div>
<div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;    rows=7; cols=<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>,rows,cols,<span class="stringliteral">&#39;write buffer status (I)&#39;</span>)</div>
<div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;    rows=2; cols=<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>,rows,cols,<span class="stringliteral">&#39;write buffer status (F)&#39;</span>)</div>
<div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;    <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(1)=nggi                  <span class="comment">! number of words per thread</span></div>
<div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;    <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(2)=<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>+2               <span class="comment">! min free words</span></div>
<div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160; </div>
<div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;    <span class="comment">!     print all relevant dimension parameters</span></div>
<div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160; </div>
<div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;    <span class="keywordflow">DO</span> lu=6,8,2  <span class="comment">! unit 6 and 8</span></div>
<div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;  </div>
<div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;        <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NTGB&#39;</span>,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a>,<span class="stringliteral">&#39;total number of parameters&#39;</span></div>
<div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;        <span class="keyword">WRITE</span>(lu,102) <span class="stringliteral">&#39;(all parameters, appearing in binary files)&#39;</span></div>
<div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;        <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NVGB&#39;</span>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,<span class="stringliteral">&#39;number of variable parameters&#39;</span></div>
<div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;        <span class="keyword">WRITE</span>(lu,102) <span class="stringliteral">&#39;(appearing in fit matrix/vectors)&#39;</span></div>
<div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;        <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NAGB&#39;</span>,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,<span class="stringliteral">&#39;number of all parameters&#39;</span></div>
<div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;        <span class="keyword">WRITE</span>(lu,102) <span class="stringliteral">&#39;(including Lagrange multiplier or reduced)&#39;</span></div>
<div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;        <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NFGB&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<span class="stringliteral">&#39;number of fit parameters&#39;</span></div>
<div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;        <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;MBANDW&#39;</span>,<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a>,<span class="stringliteral">&#39;band width of band matrix&#39;</span></div>
<div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;        <span class="keyword">WRITE</span>(lu,102) <span class="stringliteral">&#39;(if =0, no band matrix)&#39;</span></div>
<div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a> &gt;= 65536) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;            <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NOFF/K&#39;</span>,noff,<span class="stringliteral">&#39;max number of off-diagonal elements&#39;</span></div>
<div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;            <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NOFF&#39;</span>,noff,<span class="stringliteral">&#39;max number of off-diagonal elements&#39;</span></div>
<div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;        <span class="keywordflow">IF</span>(ndgn /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a> &gt;= 65536) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;                <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NDGN/K&#39;</span>,ndgn/1000,<span class="stringliteral">&#39;actual number of off-diagonal elements&#39;</span></div>
<div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;                <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NDGN&#39;</span>,ndgn,<span class="stringliteral">&#39;actual number of off-diagonal elements&#39;</span></div>
<div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;        <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NCGB&#39;</span>,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>,<span class="stringliteral">&#39;number of constraints&#39;</span></div>
<div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;        <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NAGBN&#39;</span>,<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>,<span class="stringliteral">&#39;max number of global parameters in an event&#39;</span></div>
<div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;        <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NALCN&#39;</span>,<a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a>,<span class="stringliteral">&#39;max number of local parameters in an event&#39;</span></div>
<div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;        <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NAEQN&#39;</span>,<a class="code" href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">naeqn</a>,<span class="stringliteral">&#39;max number of equations in an event&#39;</span></div>
<div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;            <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NAEQNA&#39;</span>,naeqna,<span class="stringliteral">&#39;number of equations&#39;</span></div>
<div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;            <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NAEQNG&#39;</span>,naeqng,  &amp;</div>
<div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;                <span class="stringliteral">&#39;number of equations with       global derivatives&#39;</span></div>
<div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;            <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NAEQNF&#39;</span>,naeqnf,  &amp;</div>
<div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;                <span class="stringliteral">&#39;number of equations with fixed global derivatives&#39;</span></div>
<div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;            <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NRECF&#39;</span>,nrecf,  &amp;</div>
<div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;                <span class="stringliteral">&#39;number of records   with fixed global derivatives&#39;</span></div>
<div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;            <span class="keyword">WRITE</span>(lu,101) <span class="stringliteral">&#39;NCACHE&#39;</span>,<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a>,<span class="stringliteral">&#39;number of words for caching&#39;</span></div>
<div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;            <span class="keyword">WRITE</span>(lu,111) (<a class="code" href="namespacempmod.html#a7f451453d802274aac97e237b71b0620">fcache</a>(k)*100.0,k=1,3)</div>
<div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;111         <span class="keyword">FORMAT</span>(22x,<span class="stringliteral">&#39;cache splitting &#39;</span>,3(f6.1,<span class="stringliteral">&#39; %&#39;</span>))</div>
<div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;        <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;  </div>
<div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;        <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;        <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;Solution method and matrix-storage mode:&#39;</span></div>
<div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;            <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;     METSOL = 1:  matrix inversion&#39;</span></div>
<div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;            <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;     METSOL = 2:  diagonalization&#39;</span></div>
<div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;            <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;     METSOL = 3:  MINRES (rtol&#39;</span>, <a class="code" href="namespacempmod.html#a83a4e54644058ec927f693131a6cc78e">mrestl</a>,<span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;            <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;     METSOL = 4:  MINRES-QLP (rtol&#39;</span>, <a class="code" href="namespacempmod.html#a83a4e54644058ec927f693131a6cc78e">mrestl</a>,<span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 5) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;            <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;     METSOL = 5:  GMRES&#39;</span></div>
<div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;        <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;                  with&#39;</span>,<a class="code" href="namespacempmod.html#a880fa8e41c4e97b22457dd7d5948085d">mitera</a>,<span class="stringliteral">&#39; iterations&#39;</span></div>
<div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;            <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;     MATSTO = 1:  symmetric matrix, &#39;</span>, <span class="stringliteral">&#39;(n*n+n)/2 elements&#39;</span></div>
<div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;            <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;     MATSTO = 2:  sparse matrix&#39;</span></div>
<div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a8d3078659555c21fda8d43de37c311de">mextnd</a>&gt;0) <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;                  with extended storage&#39;</span></div>
<div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#abdfc0236851e1d21ba3276e22f9e6b7b">dflim</a> /= 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;            <span class="keyword">WRITE</span>(lu,103) <span class="stringliteral">&#39;Convergence assumed, if expected dF &lt;&#39;</span>,<a class="code" href="namespacempmod.html#abdfc0236851e1d21ba3276e22f9e6b7b">dflim</a></div>
<div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;                <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;Constraints handled by elimination&#39;</span></div>
<div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;                <span class="keyword">WRITE</span>(lu,*) <span class="stringliteral">&#39;Constraints handled by Lagrange multipliers&#39;</span></div>
<div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;  </div>
<div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;<span class="keywordflow">    END DO</span> <span class="comment">! print loop</span></div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160; </div>
<div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;    <span class="comment">!     Wolfe conditions</span></div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160; </div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;    <span class="keywordflow">IF</span>(0.0 &lt; <a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a>.AND.<a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a> &lt; <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>.AND.<a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a> &lt; 1.0) <span class="keywordflow">GO TO</span> 32</div>
<div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a> == 0.0) <a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a>=1.0e-4</div>
<div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a> == 0.0) <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.9</div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;    <span class="keywordflow">IF</span>(0.0 &lt; <a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a>.AND.<a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a> &lt; <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>.AND.<a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a> &lt; 1.0) <span class="keywordflow">GO TO</span> 32</div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a> &lt;= 0.0) <a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a>=1.0e-4</div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a> &gt;= 1.0) <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.9</div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a> &gt; <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>) <span class="keywordflow">THEN</span> <span class="comment">! exchange</span></div>
<div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;        wolfc3=<a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a></div>
<div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;        <a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a>=<a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a></div>
<div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;        <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=wolfc3</div>
<div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;        <a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a>=1.0e-4</div>
<div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;        <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.9</div>
<div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;    <span class="keyword">WRITE</span>(*,105) <a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a>,<a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a></div>
<div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;    <span class="keyword">WRITE</span>(lun,105) <a class="code" href="namespacempmod.html#ab33979acfa3529dad79bb8d04bd950ad">wolfc1</a>,<a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a></div>
<div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;105 <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; Constants C1, C2 for Wolfe conditions:&#39;</span>,g12.4,<span class="stringliteral">&#39;, &#39;</span>,g12.4)</div>
<div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160; </div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;    <span class="comment">!     prepare matrix and gradient storage ------------------------------</span></div>
<div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;    <span class="comment">!32 CONTINUE</span></div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;32  matsiz(1)=int8(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>)*int8(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>+1)/2 <span class="comment">! number of words for double precision storage &#39;j&#39;</span></div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;    matsiz(2)=0                         <span class="comment">! number of words for single precision storage &#39;.&#39;</span></div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span>     <span class="comment">! sparse matrix</span></div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;        matsiz(1)=ndimsa(3)+<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;        matsiz(2)=ndimsa(4)</div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>,ndimsa(2),<span class="stringliteral">&#39;sparse matrix column list&#39;</span>)</div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpbits_8f90.html#a76f1a5c5e332b0acd9a036edf977c4fe">spbits</a>(<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>,<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>,<a class="code" href="namespacempmod.html#afe0ea5bb9145eeb4c037e3938b76d427">sparsematrixcompression</a>)</div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;    matwords=matwords+matsiz(1)*2+matsiz(2) <span class="comment">! #words for matrix storage</span></div>
<div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160; </div>
<div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a1d4e59446f937fc13d1441c9af06b212">feasma</a>    <span class="comment">! prepare constraint matrices</span></div>
<div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160; </div>
<div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aeef08c1cf1a5fbab320c7e26af2322c7">vmprep</a>(matsiz)    <span class="comment">! prepare matrix and gradient storage</span></div>
<div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;    <span class="keywordflow">IF</span> (matwords &lt; 250000) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Size of global matrix: &lt; 1 MB&#39;</span></div>
<div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Size of global matrix:&#39;</span>,int(real(matwords,mps)*4.0e-6,mpi),<span class="stringliteral">&#39; MB&#39;</span></div>
<div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;    <span class="comment">!     print chi^2 cut tables</span></div>
<div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160; </div>
<div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;    ndfmax=<a class="code" href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">naeqn</a>-1</div>
<div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;   Cut values of Chi^2/Ndf and Chi2,&#39;</span></div>
<div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;   corresponding to 2 and 3 standard deviations&#39;</span></div>
<div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;   Ndf  Chi^2/Ndf(2)  Chi^2(2)   &#39;</span>,  &amp;</div>
<div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;        <span class="stringliteral">&#39;  Chi^2/Ndf(3)  Chi^2(3)&#39;</span></div>
<div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;    ndf=0</div>
<div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;        <span class="keywordflow">IF</span>(ndf &gt; <a class="code" href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">naeqn</a>) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;        <span class="keywordflow">IF</span>(ndf &lt; 10) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;            ndf=ndf+1</div>
<div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(ndf &lt; 20) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;            ndf=ndf+2</div>
<div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(ndf &lt; 100) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;            ndf=ndf+5</div>
<div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(ndf &lt; 200) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;            ndf=ndf+10</div>
<div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;            <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;        chin2=<a class="code" href="mpnum_8f90.html#ada9fefb711817245f72e5296fbbb28ff">chindl</a>(2,ndf)</div>
<div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;        chin3=<a class="code" href="mpnum_8f90.html#ada9fefb711817245f72e5296fbbb28ff">chindl</a>(3,ndf)</div>
<div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;        <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,106) ndf,chin2,chin2*real(ndf,mps),chin3, chin3*real(ndf,mps)</div>
<div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160; </div>
<div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;LOOP2: ending&#39;</span></div>
<div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;    <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9f1cf38841260b60fa064f16b1f06cbc">mend</a></div>
<div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;101 <span class="keyword">FORMAT</span>(1x,a8,<span class="stringliteral">&#39; =&#39;</span>,i10,<span class="stringliteral">&#39; = &#39;</span>,a)</div>
<div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;102 <span class="keyword">FORMAT</span>(22x,a)</div>
<div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;103 <span class="keyword">FORMAT</span>(1x,a,g12.4)</div>
<div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;106 <span class="keyword">FORMAT</span>(i6,2(3x,f9.3,f12.1,3x))</div>
<div class="ttc" id="ampbits_8f90_html_a15637ecbbc501e760f3d4f7d687a8a6a"><div class="ttname"><a href="mpbits_8f90.html#a15637ecbbc501e760f3d4f7d687a8a6a">clbits</a></div><div class="ttdeci">subroutine clbits(in, jreqpe, jhispe, jsngpe, jcmprs, jextnd, idimb, iencdb, ispc)</div><div class="ttdoc">Calculate bit (field) array size, encoding.</div><div class="ttdef"><b>Definition:</b> <a href="mpbits_8f90_source.html#l00147">mpbits.f90:148</a></div></div>
<div class="ttc" id="ampbits_8f90_html_a30b4437f48cf9ea35a26f75b2e6c2a9a"><div class="ttname"><a href="mpbits_8f90.html#a30b4437f48cf9ea35a26f75b2e6c2a9a">gpbmap</a></div><div class="ttdeci">subroutine gpbmap(npair)</div><div class="ttdoc">Get pairs (statistic) from map.</div><div class="ttdef"><b>Definition:</b> <a href="mpbits_8f90_source.html#l00791">mpbits.f90:792</a></div></div>
<div class="ttc" id="ampbits_8f90_html_a5565f05ff15ba9aba67b318aa2765c0c"><div class="ttname"><a href="mpbits_8f90.html#a5565f05ff15ba9aba67b318aa2765c0c">ckbits</a></div><div class="ttdeci">subroutine ckbits(ndims)</div><div class="ttdoc">Check sparsity of matrix.</div><div class="ttdef"><b>Definition:</b> <a href="mpbits_8f90_source.html#l00486">mpbits.f90:487</a></div></div>
<div class="ttc" id="ampbits_8f90_html_a76f1a5c5e332b0acd9a036edf977c4fe"><div class="ttname"><a href="mpbits_8f90.html#a76f1a5c5e332b0acd9a036edf977c4fe">spbits</a></div><div class="ttdeci">subroutine spbits(nsparr, nsparc, ncmprs)</div><div class="ttdoc">Create sparsity information.</div><div class="ttdef"><b>Definition:</b> <a href="mpbits_8f90_source.html#l00581">mpbits.f90:582</a></div></div>
<div class="ttc" id="ampbits_8f90_html_a8ee45ed456a58bf46d0b55ac62d04c0e"><div class="ttname"><a href="mpbits_8f90.html#a8ee45ed456a58bf46d0b55ac62d04c0e">clbmap</a></div><div class="ttdeci">subroutine clbmap(in)</div><div class="ttdoc">Clear (additional) bit map.</div><div class="ttdef"><b>Definition:</b> <a href="mpbits_8f90_source.html#l00729">mpbits.f90:730</a></div></div>
<div class="ttc" id="ampbits_8f90_html_a9fcf35f8796ff738209a4634577f8769"><div class="ttname"><a href="mpbits_8f90.html#a9fcf35f8796ff738209a4634577f8769">inbmap</a></div><div class="ttdeci">subroutine inbmap(im, jm)</div><div class="ttdoc">Fill bit map.</div><div class="ttdef"><b>Definition:</b> <a href="mpbits_8f90_source.html#l00760">mpbits.f90:761</a></div></div>
<div class="ttc" id="ampbits_8f90_html_afa57801baa6a34263fe5c2145a9ee5df"><div class="ttname"><a href="mpbits_8f90.html#afa57801baa6a34263fe5c2145a9ee5df">inbits</a></div><div class="ttdeci">subroutine inbits(im, jm, inc)</div><div class="ttdoc">Fill bit fields (counters).</div><div class="ttdef"><b>Definition:</b> <a href="mpbits_8f90_source.html#l00065">mpbits.f90:66</a></div></div>
<div class="ttc" id="ampbits_8f90_html_afc3196af7a116ae0050f96c940c03ba3"><div class="ttname"><a href="mpbits_8f90.html#afc3196af7a116ae0050f96c940c03ba3">ndbits</a></div><div class="ttdeci">subroutine ndbits(ndims, ncmprs, nsparr, ihst)</div><div class="ttdoc">Analyze bit fields.</div><div class="ttdef"><b>Definition:</b> <a href="mpbits_8f90_source.html#l00224">mpbits.f90:225</a></div></div>
<div class="ttc" id="ampnum_8f90_html_a8750c46a189254239c8be1f5f9f25554"><div class="ttname"><a href="mpnum_8f90.html#a8750c46a189254239c8be1f5f9f25554">sort1k</a></div><div class="ttdeci">subroutine sort1k(a, n)</div><div class="ttdoc">Quick sort 1.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l01522">mpnum.f90:1523</a></div></div>
<div class="ttc" id="ampnum_8f90_html_ada9fefb711817245f72e5296fbbb28ff"><div class="ttname"><a href="mpnum_8f90.html#ada9fefb711817245f72e5296fbbb28ff">chindl</a></div><div class="ttdeci">real(mps) function chindl(n, nd)</div><div class="ttdoc">Chi2/ndf cuts.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l01800">mpnum.f90:1801</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0ba5f44eb369bc3a679cf14f47bbfb80"><div class="ttname"><a href="namespacempmod.html#a0ba5f44eb369bc3a679cf14f47bbfb80">mpmod::lunmon</a></div><div class="ttdeci">integer(mpi) lunmon</div><div class="ttdoc">unit for monitoring output file</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00114">mpmod.f90:114</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0f3fb29788b538ef5aa1c133e1260c62"><div class="ttname"><a href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">mpmod::globalindexusage</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable globalindexusage</div><div class="ttdoc">indices of global par in record</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00239">mpmod.f90:239</a></div></div>
<div class="ttc" id="anamespacempmod_html_a11ab68136df24dc5de35b5fcb07fb070"><div class="ttname"><a href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">mpmod::nagbn</a></div><div class="ttdeci">integer(mpi) nagbn</div><div class="ttdoc">max number of global paramters per record</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00127">mpmod.f90:127</a></div></div>
<div class="ttc" id="anamespacempmod_html_a3688e8f65ab58bddfac03c3043166b24"><div class="ttname"><a href="namespacempmod.html#a3688e8f65ab58bddfac03c3043166b24">mpmod::localglobalmatrix</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable localglobalmatrix</div><div class="ttdoc">matrix correlating local and global par</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00256">mpmod.f90:256</a></div></div>
<div class="ttc" id="anamespacempmod_html_a46bd7a6037c5d52224f22143b1f0ee02"><div class="ttname"><a href="namespacempmod.html#a46bd7a6037c5d52224f22143b1f0ee02">mpmod::paircounter</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable paircounter</div><div class="ttdoc">number of paired parameters (in equations)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00242">mpmod.f90:242</a></div></div>
<div class="ttc" id="anamespacempmod_html_a5943384feedd0a3326d0e2921525b6fa"><div class="ttname"><a href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">mpmod::meashists</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable meashists</div><div class="ttdoc">measurement histograms (100 bins per thread)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00211">mpmod.f90:211</a></div></div>
<div class="ttc" id="anamespacempmod_html_a637ef67798bd4e1581b22a7a57fbeaba"><div class="ttname"><a href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">mpmod::naeqn</a></div><div class="ttdeci">integer(mpi) naeqn</div><div class="ttdoc">max number of equations (measurements) per record</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00129">mpmod.f90:129</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6c56088d848e1f4419e9f6c04cc343c6"><div class="ttname"><a href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">mpmod::nprecond</a></div><div class="ttdeci">integer(mpi), dimension(2) nprecond</div><div class="ttdoc">number of constraints, matrix size for preconditioner</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00126">mpmod.f90:126</a></div></div>
<div class="ttc" id="anamespacempmod_html_a9d32348eb1f9ae966bbf474db8d2c4f1"><div class="ttname"><a href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">mpmod::writebufferindices</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable writebufferindices</div><div class="ttdoc">write buffer for indices</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00260">mpmod.f90:260</a></div></div>
<div class="ttc" id="anamespacempmod_html_aa9d3e269a0fe4f2a7d8a400e2f76d83e"><div class="ttname"><a href="namespacempmod.html#aa9d3e269a0fe4f2a7d8a400e2f76d83e">mpmod::nummeas</a></div><div class="ttdeci">integer(mpi) nummeas</div><div class="ttdoc">number of measurement groups for monitoring</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00152">mpmod.f90:152</a></div></div>
<div class="ttc" id="anamespacempmod_html_aaaf5ac98d0ee925f1168ada4b459ec97"><div class="ttname"><a href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">mpmod::nalcn</a></div><div class="ttdeci">integer(mpi) nalcn</div><div class="ttdoc">max number of local paramters per record</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00128">mpmod.f90:128</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab7965c26694a67ecce5442856d724d2c"><div class="ttname"><a href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">mpmod::backindexusage</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable backindexusage</div><div class="ttdoc">list of global par in record</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00240">mpmod.f90:240</a></div></div>
<div class="ttc" id="anamespacempmod_html_ac573f05a09f12bb6c00492f1d7374d9e"><div class="ttname"><a href="namespacempmod.html#ac573f05a09f12bb6c00492f1d7374d9e">mpmod::writebufferupdates</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable writebufferupdates</div><div class="ttdoc">write buffer for update matrices</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00261">mpmod.f90:261</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad3d02cc546767024150d88e3ce56bc7e"><div class="ttname"><a href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">mpmod::measindex</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable measindex</div><div class="ttdoc">mapping of 1. global label to measurement index</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00210">mpmod.f90:210</a></div></div>
<div class="ttc" id="anamespacempmod_html_add5d6ee87f88e926424677b1728576f8"><div class="ttname"><a href="namespacempmod.html#add5d6ee87f88e926424677b1728576f8">mpmod::measres</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable measres</div><div class="ttdoc">average measurement error</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00212">mpmod.f90:212</a></div></div>
<div class="ttc" id="anamespacempmod_html_adee159837489a16915b8aba71ab24a2d"><div class="ttname"><a href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">mpmod::writebufferheader</a></div><div class="ttdeci">integer(mpi), dimension(-6:6) writebufferheader</div><div class="ttdoc">write buffer header (-6..-1: updates, 1..6: indices)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00262">mpmod.f90:262</a></div></div>
<div class="ttc" id="anamespacempmod_html_ae44d9ec64cc3d6783bf91e63e9f61435"><div class="ttname"><a href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">mpmod::appearancecounter</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable appearancecounter</div><div class="ttdoc">appearance statistics for global par (first/last file,record)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00241">mpmod.f90:241</a></div></div>
<div class="ttc" id="anamespacempmod_html_aeb12f4cce4b86cae1a7809399e48ff62"><div class="ttname"><a href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">mpmod::writebufferdata</a></div><div class="ttdeci">real(mps), dimension(:,:), allocatable writebufferdata</div><div class="ttdoc">write buffer data (largest residual, Chi2/ndf, per thread)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00259">mpmod.f90:259</a></div></div>
<div class="ttc" id="anamespacempmod_html_af5350cf7fe84eb75c5f10f8af37d0acc"><div class="ttname"><a href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">mpmod::writebufferinfo</a></div><div class="ttdeci">integer(mpi), dimension(:,:), allocatable writebufferinfo</div><div class="ttdoc">write buffer management (per thread)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00258">mpmod.f90:258</a></div></div>
<div class="ttc" id="anamespacempmod_html_afe0ea5bb9145eeb4c037e3938b76d427"><div class="ttname"><a href="namespacempmod.html#afe0ea5bb9145eeb4c037e3938b76d427">mpmod::sparsematrixcompression</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable sparsematrixcompression</div><div class="ttdoc">compression info (per row)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00229">mpmod.f90:229</a></div></div>
<div class="ttc" id="apede_8f90_html_a05b5198a853192b0d4af53dcade84ae4"><div class="ttname"><a href="pede_8f90.html#a05b5198a853192b0d4af53dcade84ae4">prpcon</a></div><div class="ttdeci">subroutine prpcon</div><div class="ttdoc">Prepare constraints.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l01243">pede.f90:1244</a></div></div>
<div class="ttc" id="apede_8f90_html_a1d4e59446f937fc13d1441c9af06b212"><div class="ttname"><a href="pede_8f90.html#a1d4e59446f937fc13d1441c9af06b212">feasma</a></div><div class="ttdeci">subroutine feasma</div><div class="ttdoc">Matrix for feasible solution.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l01427">pede.f90:1428</a></div></div>
<div class="ttc" id="apede_8f90_html_a7ee8fc712707e7a8cafaf374b4a4e348"><div class="ttname"><a href="pede_8f90.html#a7ee8fc712707e7a8cafaf374b4a4e348">mvopen</a></div><div class="ttdeci">subroutine mvopen(lun, fname)</div><div class="ttdoc">Open file.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l08802">pede.f90:8803</a></div></div>
<div class="ttc" id="apede_8f90_html_aeef08c1cf1a5fbab320c7e26af2322c7"><div class="ttname"><a href="pede_8f90.html#aeef08c1cf1a5fbab320c7e26af2322c7">vmprep</a></div><div class="ttdeci">subroutine vmprep(msize)</div><div class="ttdoc">Prepare storage for vectors and matrices.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l06034">pede.f90:6035</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeb76c893a1fbb54eb1e7c76ef189059a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb76c893a1fbb54eb1e7c76ef189059a">&#9670;&nbsp;</a></span>loopbf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine loopbf </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), dimension(0:3), intent(inout)&#160;</td>
          <td class="paramname"><em>nrej</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(inout)&#160;</td>
          <td class="paramname"><em>ndfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), intent(inout)&#160;</td>
          <td class="paramname"><em>sndf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), intent(inout)&#160;</td>
          <td class="paramname"><em>dchi2s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>numfil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), dimension(numfil), intent(inout)&#160;</td>
          <td class="paramname"><em>naccf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mps), dimension(numfil), intent(inout)&#160;</td>
          <td class="paramname"><em>chi2f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), dimension(numfil), intent(inout)&#160;</td>
          <td class="paramname"><em>ndff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loop over records in read buffer (block), fits and sums. </p>
<p>Loop over records in current read buffer block (with multiple threads). Perform local fits (optionally with outlier downweigthing) to calculate Chi2, ndf and r.h.s. 'b' of linear equation system A*x=b. In first iteration(s) fill global matrix A.</p>
<p>For the filling of the global matrix each thread creates from his share of local fits (small) udpdate matrices ( <img class="formulaInl" alt="$\Vek{\D C}_1+\Vek{\D C}_2$" src="form_16.png"/> from equations (15), (16)) stored in a write buffer. After all events in the read buffer block have been processed the global matrix is being updated from the matrices in the write buffer in parallel (each row by different thread).</p>
<p>The matrices of the local fits are checked for bordered band structure. For border size b and band width m all elements (i,j) are zero for min(i,j)&gt;b and abs(i-j)&gt;m. For sufficient small (b,m) a solution by <a class="el" href="Dbandmatrix_8f90.html#a7082e5556fcc5d9aa30386f057f1b668">root free Cholesky decomposition</a> and forward/backward substitution of the band part is much faster compared to inversion (see broken lines in references). Based on the expected computing cost the faster solution method is selected.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">nrej</td><td>number of rejected records </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ndfs</td><td>sum(ndf) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">sndf</td><td>sum(weighted ndf) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dchi2s</td><td>sum(weighted chi2) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numfil</td><td>number of binary files </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">naccf</td><td>number of accepted records per binary file </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">chi2f</td><td>sum(chi2/ndf) per binary file </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ndff</td><td>sum(ndf) per binary file </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l03063">3063</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160; </div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: cauchy</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: chichi</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: chlimt</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: chndf</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: chuber</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: down</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;<span class="keywordtype">    REAL</span>(mpr8) :: glder</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: pull</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: r1</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: r2</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: rec</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rerr</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: resid</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: resing</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: resmax</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rmeas</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rmloc</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: suwt</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: used</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: wght</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: chindl</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ia</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ib</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ibuf</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ichunk</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: icmn</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: icost</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: id</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: idiag</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iext</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ij</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ije</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ijn</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ijsym</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ik</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ike</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: im</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: imeas</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: in</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inder</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inv</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioffb</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioffc</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioffd</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioffe</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioffi</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iprdbg</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iproc</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: irbin</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: irow</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isfrst</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: islast</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ist</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iter</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbj</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbk</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ja</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jb</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jk</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jn</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: joffd</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: joffi</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jproc</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jsp</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: kbdr</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: kbdrx</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: kbnd</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: kfl</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: kx</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: mbdr</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: mbnd</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: mside</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nalc</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nalg</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nan</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nb</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ndf</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ndfsd</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ndown</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: neq</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nfred</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nfrei</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ngg</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nprdbg</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrank</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrc</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nst</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nter</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nweig</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160; </div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN OUT)</span>                     :: nrej(0:3)</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN OUT)</span>                     :: ndfs</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(IN OUT)</span>            :: sndf</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(IN OUT)</span>            :: dchi2s</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                         :: numfil</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN OUT)</span>                     :: naccf(numfil)</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;<span class="keywordtype">    REAL</span>(mps), <span class="keywordtype">INTENT(IN OUT)</span>                        :: chi2f(numfil)</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN OUT)</span>                     :: ndff(numfil)</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160; </div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;<span class="keywordtype">    REAL</span>(mpd):: dchi2</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::dvar</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;<span class="keywordtype">    REAL</span>(mpd):: dw1</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::dw2</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::summ</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160; </div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <span class="comment">!$    INTEGER(mpi) OMP_GET_THREAD_NUM</span></div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160; </div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    <span class="keywordtype">LOGICAL</span>:: lprnt</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    <span class="keywordtype">LOGICAL</span>::lhist</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    <span class="keywordtype">CHARACTER (LEN=3)</span>:: chast</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    <span class="keyword">DATA</span> chuber/1.345_mpd/  <span class="comment">! constant for Huber down-weighting</span></div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <span class="keyword">DATA</span> cauchy/2.3849_mpd/ <span class="comment">! constant for Cauchy down-weighting</span></div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;    <span class="keywordtype">SAVE</span> chuber,cauchy</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    ijsym(i,j)=min(i,j)+(max(i,j)*max(i,j)-max(i,j))/2</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    isfrst(ibuf)=<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf)+1</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;    islast(ibuf)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf))</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    inder(i)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(i)</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;    glder(i)=<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(i)</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160; </div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    ichunk=min((<a class="code" href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">numreadbuffer</a>+<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>-1)/<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>/32+1,256)</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;    <span class="comment">! reset header, 3 words per thread:</span></div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;    <span class="comment">!    number of entries, offset to data, indices</span></div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;    <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>=0</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;    <a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>=0.</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;    nprdbg=0</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;    iprdbg=-1</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160; </div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;    <span class="comment">! parallelize record loop</span></div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;    <span class="comment">! private copy of NDFS,.. for each thread, combined at end, init with 0.</span></div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;    <span class="comment">!$OMP  PARALLEL DO &amp;</span></div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;    <span class="comment">!$OMP   DEFAULT(PRIVATE) &amp;</span></div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    <span class="comment">!$OMP   SHARED(numReadBuffer,readBufferPointer,readBufferDataI, &amp;</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    <span class="comment">!$OMP      readBufferDataD,writeBufferHeader,writeBufferInfo, &amp;</span></div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    <span class="comment">!$OMP      writeBufferData,writeBufferIndices,writeBufferUpdates,globalVector,globalCounter, &amp;</span></div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;    <span class="comment">!$OMP      globalParameter,globalParLabelIndex,globalIndexUsage,backIndexUsage, &amp;</span></div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    <span class="comment">!$OMP      measBins,numMeas,measIndex,measRes,measHists, &amp;</span></div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    <span class="comment">!$OMP      NAGB,NVGB,NAGBN,ICALCM,ICHUNK,NLOOPN,NRECER,NPRDBG,IPRDBG, &amp;</span></div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    <span class="comment">!$OMP      NEWITE,CHICUT,LHUBER,CHUBER,ITERAT,NRECPR,MTHRD, &amp;</span></div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;    <span class="comment">!$OMP      DWCUT,CHHUGE,NRECP2,CAUCHY,LFITNP,LFITBB,IMONIT,IMONMD) &amp;</span></div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;    <span class="comment">!$OMP   REDUCTION(+:NDFS,SNDF,DCHI2S,NREJ,NBNDR,NACCF,CHI2F,NDFF) &amp;</span></div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;    <span class="comment">!$OMP   REDUCTION(MAX:NBNDX,NBDRX) &amp;</span></div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    <span class="comment">!$OMP   REDUCTION(MIN:NREC3) &amp;</span></div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    <span class="comment">!$OMP   SCHEDULE(DYNAMIC,ICHUNK)</span></div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    <span class="keywordflow">DO</span> ibuf=1,<a class="code" href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">numreadbuffer</a>                       <span class="comment">! buffer for current record</span></div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;        nrc=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(isfrst(ibuf)-2)       <span class="comment">! record</span></div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;        kfl=nint(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(isfrst(ibuf)-1),mpi) <span class="comment">! file</span></div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        dw1=real(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(isfrst(ibuf)-2),mpd) <span class="comment">! weight</span></div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        dw2=sqrt(dw1)</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;  </div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        iproc=0</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;        <span class="comment">!$       IPROC=OMP_GET_THREAD_NUM()         ! thread number</span></div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;        ioffb=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>*iproc                                  <span class="comment">! offset &#39;f&#39;.</span></div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;        ioffc=<a class="code" href="namespacempmod.html#a11ab68136df24dc5de35b5fcb07fb070">nagbn</a>*iproc                                 <span class="comment">! offset &#39;c&#39;.</span></div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;        ioffe=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>*iproc                                  <span class="comment">! offset &#39;e&#39;</span></div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;        ioffd=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-1)*iproc+<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(2,iproc+1)  <span class="comment">! offset data</span></div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;        ioffi=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(1)*iproc+<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(3,iproc+1)+2 <span class="comment">! offset indices</span></div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;        <span class="comment">!     ----- reset ------------------------------------------------------</span></div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;        lprnt=.false.</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;        lhist=(iproc == 0)</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;        rec=nrc            <span class="comment">! floating point value</span></div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 1.AND.mod(nrc,100000) == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Record&#39;</span>,nrc,<span class="stringliteral">&#39; ... still reading&#39;</span></div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;  </div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;        <span class="comment">!      printout/debug only for one thread at a time</span></div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;  </div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;  </div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;        <span class="comment">!      flag for record printout -----------------------------------------</span></div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;  </div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;        lprnt=.false.</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad8f302f2683255b7d258697ce3bd4c5f">newite</a>.AND.(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> == 1.OR.<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> == 3)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;            <span class="keywordflow">IF</span>(nrc == <a class="code" href="namespacempmod.html#a31ed3022f8cd8aede6f4d869cf3ca045">nrecpr</a>) lprnt=.true.</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;            <span class="keywordflow">IF</span>(nrc == <a class="code" href="namespacempmod.html#a2a8b9736839a9a3145b13f0646c681c2">nrecp2</a>) lprnt=.true.</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;            <span class="keywordflow">IF</span>(nrc == <a class="code" href="namespacempmod.html#a0e7012434383717ae81ed1a584cc12d6">nrecer</a>) lprnt=.true.</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        <span class="keywordflow">IF</span> (lprnt)<span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;            <span class="comment">!$OMP ATOMIC</span></div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            nprdbg=nprdbg+1               <span class="comment">! number of threads with debug</span></div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;            <span class="keywordflow">IF</span> (nprdbg == 1) iprdbg=iproc <span class="comment">! first thread with debug</span></div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;            <span class="keywordflow">IF</span> (iproc /= iprdbg) lprnt=.false.</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;        <span class="comment">!         print *, &#39; LPRNT &#39;, NRC, NPRDBG, IPRDBG, IPROC, LPRNT</span></div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;        <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;            <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;            <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;------------------ Loop&#39;</span>,<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>,  &amp;</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;                <span class="stringliteral">&#39;: Printout for record&#39;</span>,nrc,iproc</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;            <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;  </div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;        <span class="comment">!     ----- print data -------------------------------------------------</span></div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;  </div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;        <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;            imeas=0              <span class="comment">! local derivatives</span></div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;            ist=isfrst(ibuf)</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;            nst=islast(ibuf)</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;            <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;                <span class="keywordflow">IF</span>(ja == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;                <span class="keywordflow">IF</span>(imeas == 0) <span class="keyword">WRITE</span>(1,1121)</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;                imeas=imeas+1</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;                <span class="keyword">WRITE</span>(1,1122) imeas,glder(ja),glder(jb),  &amp;</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;                    (inder(ja+j),glder(ja+j),j=1,jb-ja-1)</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;1121        <span class="keyword">FORMAT</span>(/<span class="stringliteral">&#39;Measured value and local derivatives&#39;</span>/  &amp;</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;                <span class="stringliteral">&#39;  i measured std_dev  index...derivative ...&#39;</span>)</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;1122        <span class="keyword">FORMAT</span>(i3,2g12.4,3(i3,g12.4)/(27x,3(i3,g12.4)))</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;    </div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;            imeas=0              <span class="comment">! global derivatives</span></div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;            ist=isfrst(ibuf)</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;            nst=islast(ibuf)</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;            <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;                <span class="keywordflow">IF</span>(ja == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;                <span class="keywordflow">IF</span>(imeas == 0) <span class="keyword">WRITE</span>(1,1123)</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;                imeas=imeas+1</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;                <span class="keywordflow">IF</span> (jb &lt; ist) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;                    <span class="keywordflow">IF</span>(ist-jb &gt; 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                        <span class="keyword">WRITE</span>(1,1124) imeas,(<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,inder(jb+j)),inder(jb+j),  &amp;</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;                            <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,inder(jb+j)),glder(jb+j),j=1,ist-jb)</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                        <span class="keyword">WRITE</span>(1,1125) imeas,(<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,inder(jb+j)),inder(jb+j),  &amp;</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;                            <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,inder(jb+j)),glder(jb+j),j=1,ist-jb)</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;1123        <span class="keyword">FORMAT</span>(/<span class="stringliteral">&#39;Global derivatives&#39;</span>/  &amp;</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;                <span class="stringliteral">&#39;  i  label gindex vindex derivative ...&#39;</span>)</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;1124        <span class="keyword">FORMAT</span>(i3,2(i9,i7,i7,g12.4)/(3x,2(i9,i7,i7,g12.4)))</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;1125        <span class="keyword">FORMAT</span>(i3,2(i9,i7,i7,g12.4))</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;  </div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;        <span class="comment">!      ----- first loop -------------------------------------------------</span></div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;        <span class="comment">!       ------ prepare local fit ------</span></div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;        <span class="comment">!      count local and global derivates</span></div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;        <span class="comment">!      subtract actual alignment parameters from the measured data</span></div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;  </div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;        <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;            <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;            <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;Data corrections using values of global parameters&#39;</span></div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;            <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;==================================================&#39;</span></div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;            <span class="keyword">WRITE</span>(1,101)</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;        nalg=0                         <span class="comment">! count number of global derivatives</span></div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;        nalc=0                         <span class="comment">! count number of local derivatives</span></div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;        neq=0                          <span class="comment">! count number of equations</span></div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;        ist=isfrst(ibuf)</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;        nst=islast(ibuf)</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;        <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;            <span class="keywordflow">IF</span>(ja == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;            rmeas=real(glder(ja),mpd)     <span class="comment">! data</span></div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;            neq=neq+1                     <span class="comment">! count equation</span></div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;            <span class="comment">!         subtract global ... from measured value</span></div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;            <span class="keywordflow">DO</span> j=1,ist-jb                 <span class="comment">! global parameter loop</span></div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;                itgbi=inder(jb+j)            <span class="comment">! global parameter label</span></div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;                rmeas=rmeas-real(glder(jb+j),mpd)*<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi) <span class="comment">! subtract   !!! reversed</span></div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;                    ij=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi)         <span class="comment">! index of variable global parameter</span></div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;                    <span class="keywordflow">IF</span>(ij &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;                        ijn=<a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(ioffe+ij)        <span class="comment">! get index of index</span></div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;                        <span class="keywordflow">IF</span>(ijn == 0) <span class="keywordflow">THEN</span>                   <span class="comment">! not yet included</span></div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;                            nalg=nalg+1                     <span class="comment">! count</span></div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;                            <a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>(ioffc+nalg)=ij <span class="comment">! store global index</span></div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;                            <a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(ioffe+ij)=nalg   <span class="comment">! store back index</span></div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;                <span class="keywordflow">IF</span> (jb &lt; ist) <span class="keyword">WRITE</span>(1,102) neq,glder(ja),rmeas,glder(jb)</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;            <a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(ja)=real(rmeas,mpr8)   <span class="comment">! global contribution subtracted</span></div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;            <span class="keywordflow">DO</span> j=1,jb-ja-1              <span class="comment">! local parameter loop</span></div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;                ij=inder(ja+j)</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;                nalc=max(nalc,ij)       <span class="comment">! number of local parameters</span></div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;101     <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; index measvalue   corrvalue          sigma&#39;</span>)</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;102     <span class="keyword">FORMAT</span>(i6,2x,2g12.4,<span class="stringliteral">&#39; +-&#39;</span>,g12.4)</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;  </div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;        <span class="keywordflow">IF</span>(nalc &lt;= 0) <span class="keywordflow">GO TO</span> 90</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;  </div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;        ngg=(nalg*nalg+nalg)/2</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;            <span class="keywordflow">DO</span> k=1,nalg*nalc</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;                <a class="code" href="namespacempmod.html#a3688e8f65ab58bddfac03c3043166b24">localglobalmatrix</a>(k)=0.0_mpd <span class="comment">! reset global-local matrix</span></div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;            <a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(ioffi-1)=nrc       <span class="comment">! index header:</span></div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;            <a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(ioffi  )=nalg      <span class="comment">! event number, number of global par</span></div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a8750c46a189254239c8be1f5f9f25554">sort1k</a>(<a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>(ioffc+1),nalg) <span class="comment">! sort global par.</span></div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;            <span class="keywordflow">DO</span> k=1,nalg</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;                iext=<a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>(ioffc+k)</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;                <a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(ioffi+k)=iext    <span class="comment">! global par indices</span></div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;                <a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(ioffe+iext)=k    <span class="comment">! update back index</span></div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;            <span class="keywordflow">DO</span> k=1,ngg</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;                <a class="code" href="namespacempmod.html#ac573f05a09f12bb6c00492f1d7374d9e">writebufferupdates</a>(ioffd+k)=0.0_mpd <span class="comment">! reset global-global matrix</span></div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;        <span class="comment">!      ----- iteration start and check ---------------------------------</span></div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;  </div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        nter=1                         <span class="comment">! first loop without down-weighting</span></div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> /= 1.AND.<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> /= 0) nter=<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a></div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;        <a class="code" href="namespacempmod.html#a33e7585dc2943d8d4ed1022787a3f5a6">localcorrections</a>(1:neq) = 0._mpd</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;  </div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;        <span class="comment">!      check matrix for bordered band structure (MBDR+MBND+1 &lt;= NALC)</span></div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;        mbnd=-1</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;        mbdr=nalc</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;        mside=-1 <span class="comment">! side (1: upper/left border, 2: lower/right border)</span></div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;        <span class="keywordflow">DO</span> i=1, 2*nalc</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            <a class="code" href="namespacempmod.html#ab93460a465928ec3e6295ac3b9d45792">ibandh</a>(i)=0</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;        irow=1</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;        idiag=1</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;        ndfsd=0</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;  </div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;        iter=0</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;        resmax=0.0</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;        <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span>(iter &lt; nter)  <span class="comment">! outlier suppresssion iteration loop</span></div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;            iter=iter+1</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;            resmax=0.0</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;            <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;Outlier-suppression iteration&#39;</span>,iter,<span class="stringliteral">&#39; of&#39;</span>,nter</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;==========================================&#39;</span></div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;                imeas=0</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;  </div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;            <span class="comment">!      ----- second loop ------------------------------------------------</span></div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;            <span class="comment">!      accumulate normal equations for local fit and determine solution</span></div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;            <span class="keywordflow">DO</span> i=1,nalc</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;                <a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>(i)=0.0_mpd                  <span class="comment">! reset vector</span></div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;            <span class="keywordflow">DO</span> i=1,(nalc*nalc+nalc)/2 <span class="comment">! GF: FIXME - not really, local parameter number...</span></div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;                <a class="code" href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">clmat</a>(i)=0.0_mpd               <span class="comment">! (p)reset matrix</span></div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;            neq=0</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;            ndown=0</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;            nweig=0</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;            ist=isfrst(ibuf)</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;            nst=islast(ibuf)</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;            <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;                <span class="keywordflow">IF</span>(ja == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;                rmeas=real(glder(ja),mpd)     <span class="comment">! data</span></div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;                rerr =real(glder(jb),mpd)     <span class="comment">! ... and the error</span></div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;                wght =1.0_mpd/rerr**2         <span class="comment">! weight from error</span></div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;                neq=neq+1                     <span class="comment">! count equation</span></div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;                nweig=nweig+1</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;                resid=rmeas-<a class="code" href="namespacempmod.html#a33e7585dc2943d8d4ed1022787a3f5a6">localcorrections</a>(neq)           <span class="comment">! subtract previous fit</span></div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> /= 1.AND.iter /= 1.AND.<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;                    <span class="keywordflow">IF</span>(iter &lt;= 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;                        <span class="keywordflow">IF</span>(abs(resid) &gt; chuber*rerr) <span class="keywordflow">THEN</span>     <span class="comment">! down-weighting</span></div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;                            wght=wght*chuber*rerr/abs(resid)</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;                            ndown=ndown+1</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;                    <span class="keywordflow">ELSE</span>       <span class="comment">! Cauchy</span></div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;                        wght=wght/(1.0+(resid/rerr/cauchy)**2)</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160; </div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;                <span class="keywordflow">IF</span>(lprnt.AND.iter /= 1.AND.nter /= 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;                    chast=<span class="stringliteral">&#39;   &#39;</span></div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;                    <span class="keywordflow">IF</span>(abs(resid) &gt; chuber*rerr) chast=<span class="stringliteral">&#39;*  &#39;</span></div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;                    <span class="keywordflow">IF</span>(abs(resid) &gt; 3.0*rerr) chast=<span class="stringliteral">&#39;** &#39;</span></div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;                    <span class="keywordflow">IF</span>(abs(resid) &gt; 6.0*rerr) chast=<span class="stringliteral">&#39;***&#39;</span></div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;                    <span class="keywordflow">IF</span>(imeas == 0) <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;Second loop: accumulate&#39;</span></div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;                    <span class="keywordflow">IF</span>(imeas == 0) <span class="keyword">WRITE</span>(1,103)</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;                    imeas=imeas+1</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;                    down=1.0/sqrt(wght)</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;                    r1=resid/rerr</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;                    r2=resid/down</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;                    <span class="keyword">WRITE</span>(1,104) imeas,rmeas,resid,rerr,r1,chast,r2</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;103             <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; index corrvalue    residuum          sigma&#39;</span>,  &amp;</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;                    <span class="stringliteral">&#39;     nresid     cnresid&#39;</span>)</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;104             <span class="keyword">FORMAT</span>(i6,2x,2g12.4,<span class="stringliteral">&#39; +-&#39;</span>,g12.4,f7.2,1x,a3,f8.2)</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;    </div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;                <span class="keywordflow">DO</span> j=1,jb-ja-1 <span class="comment">! normal equations, local parameter loop</span></div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;                    ij=inder(ja+j)          <span class="comment">! local parameter index J</span></div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;                    <a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>(ij)=<a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>(ij)+wght*rmeas*real(glder(ja+j),mpd)</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;                    <span class="keywordflow">DO</span> k=1,j</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;                        ik=inder(ja+k)         <span class="comment">! local parameter index K</span></div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;                        jk=ijsym(ij,ik)        <span class="comment">! index in symmetric matrix</span></div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;                        <a class="code" href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">clmat</a>(jk)=<a class="code" href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">clmat</a>(jk) &amp;  <span class="comment">! force double precision</span></div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;                            +wght*real(glder(ja+j),mpd)*real(glder(ja+k),mpd)</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;                        <span class="comment">!           check for band matrix substructure</span></div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;                        <span class="keywordflow">IF</span> (iter == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;                            id=iabs(ij-ik)+1</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;                            im=min(ij,ik) <span class="comment">! upper/left border</span></div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;                            <a class="code" href="namespacempmod.html#ab93460a465928ec3e6295ac3b9d45792">ibandh</a>(id)=max(<a class="code" href="namespacempmod.html#ab93460a465928ec3e6295ac3b9d45792">ibandh</a>(id),im)</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;                            im=min(nalc+1-ij,nalc+1-ik) <span class="comment">! lower/rght border (mirrored)</span></div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;                            <a class="code" href="namespacempmod.html#ab93460a465928ec3e6295ac3b9d45792">ibandh</a>(nalc+id)=max(<a class="code" href="namespacempmod.html#ab93460a465928ec3e6295ac3b9d45792">ibandh</a>(nalc+id),im)</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;            <span class="comment">!      for non trivial fits check for bordered band matrix structure</span></div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;            <span class="keywordflow">IF</span> (iter == 1.AND.nalc &gt; 5.AND.<a class="code" href="namespacempmod.html#af9b7c1c75febef400cd6f988d1b47db2">lfitbb</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;                kx=-1</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;                kbdrx=0</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;                icmn=int(nalc,mpl)**3 <span class="comment">! cost (*6) should improve by at least factor 2</span></div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;                <span class="comment">! upper/left border ?</span></div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;                kbdr=0  </div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;                <span class="keywordflow">DO</span> k=nalc,2,-1</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                    kbnd=k-2</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;                    kbdr=max(kbdr,<a class="code" href="namespacempmod.html#ab93460a465928ec3e6295ac3b9d45792">ibandh</a>(k))</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;                    icost=6*int(nalc-kbdr,mpl)*int(kbnd+kbdr+1,mpl)**2+2*int(kbdr,mpl)**3</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;                    <span class="keywordflow">IF</span> (icost &lt; icmn) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;                        icmn=icost</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;                        kx=k</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;                        kbdrx=kbdr</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;                        mside=1</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;<span class="keywordflow">                END DO</span>    </div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;                <span class="keywordflow">IF</span> (kx &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;                    <span class="comment">! lower/right border instead?</span></div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                    kbdr=0  </div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                    <span class="keywordflow">DO</span> k=nalc,2,-1</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;                        kbnd=k-2</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;                        kbdr=max(kbdr,<a class="code" href="namespacempmod.html#ab93460a465928ec3e6295ac3b9d45792">ibandh</a>(k+nalc))</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;                        icost=6*int(nalc-kbdr,mpl)*int(kbnd+kbdr+1,mpl)**2+2*int(kbdr,mpl)**3</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;                        <span class="keywordflow">IF</span> (icost &lt; icmn) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;                            icmn=icost</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;                            kx=k</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;                            kbdrx=kbdr</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;                            mside=2</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;                <span class="keywordflow">IF</span> (kx &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;                    mbnd=kx-2</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;                    mbdr=kbdrx</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;  </div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;            <span class="keywordflow">IF</span> (mbnd &gt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;                <span class="comment">!      fast solution for border banded matrix (inverse for ICALCM&gt;0)</span></div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;                    <a class="code" href="namespacempmod.html#a55d73a7d752b965b5e38ede6b6bc3a40">nbndr</a>(mside)=<a class="code" href="namespacempmod.html#a55d73a7d752b965b5e38ede6b6bc3a40">nbndr</a>(mside)+1</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                    <a class="code" href="namespacempmod.html#a8a0b7f0bb1466fe16b03c5abc9fa134a">nbdrx</a>=max(<a class="code" href="namespacempmod.html#a8a0b7f0bb1466fe16b03c5abc9fa134a">nbdrx</a>,mbdr)</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;                    <a class="code" href="namespacempmod.html#a40caab8c79f0800ca8a83394a463cd83">nbndx</a>=max(<a class="code" href="namespacempmod.html#a40caab8c79f0800ca8a83394a463cd83">nbndx</a>,mbnd)</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160; </div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;                inv=0</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> &lt;= <a class="code" href="namespacempmod.html#ac13777d4115b495604ad6df7507ebef0">lfitnp</a>.AND.iter == 1) inv=1 <span class="comment">! band part of inverse (for pulls)</span></div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1.OR.lprnt) inv=2     <span class="comment">! complete inverse</span></div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;                <span class="keywordflow">IF</span> (mside == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a9723a1127567d1d778894b985a921286">sqmibb</a>(<a class="code" href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">clmat</a>,<a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>,nalc,mbdr,mbnd,inv,nrank,  &amp;</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;                        <a class="code" href="namespacempmod.html#af7d437f9a1210fa3b18c7a1ef5aa8872">vbnd</a>,<a class="code" href="namespacempmod.html#a66e389ec7e3ccbcdddec753a6c475f4e">vbdr</a>,<a class="code" href="namespacempmod.html#ab40ff975fc09d47aee1f14b1f4ffd31f">aux</a>,<a class="code" href="namespacempmod.html#a187fb71e280caea2fc638d5908cebd36">vbk</a>,<a class="code" href="namespacempmod.html#a6469f9da002e9aeb45812d77697b241b">vzru</a>,<a class="code" href="namespacempmod.html#a8b7034c842a76da7ffa767f2ca4d644a">scdiag</a>,<a class="code" href="namespacempmod.html#a289d1542245a5f6ea00ce0892d4f3dd7">scflag</a>)</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a019b639fffc7f6888d08ba3508f3451c">sqmibb2</a>(<a class="code" href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">clmat</a>,<a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>,nalc,mbdr,mbnd,inv,nrank,  &amp;</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;                        <a class="code" href="namespacempmod.html#af7d437f9a1210fa3b18c7a1ef5aa8872">vbnd</a>,<a class="code" href="namespacempmod.html#a66e389ec7e3ccbcdddec753a6c475f4e">vbdr</a>,<a class="code" href="namespacempmod.html#ab40ff975fc09d47aee1f14b1f4ffd31f">aux</a>,<a class="code" href="namespacempmod.html#a187fb71e280caea2fc638d5908cebd36">vbk</a>,<a class="code" href="namespacempmod.html#a6469f9da002e9aeb45812d77697b241b">vzru</a>,<a class="code" href="namespacempmod.html#a8b7034c842a76da7ffa767f2ca4d644a">scdiag</a>,<a class="code" href="namespacempmod.html#a289d1542245a5f6ea00ce0892d4f3dd7">scflag</a>)</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;<span class="keywordflow">                ENDIF</span>        </div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;                <span class="comment">!      full inversion and solution</span></div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;                inv=2</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;                <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a92f02ed4dc87864fa0b65cec04e4c9e3">sqminv</a>(<a class="code" href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">clmat</a>,<a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>,nalc,nrank,<a class="code" href="namespacempmod.html#a8b7034c842a76da7ffa767f2ca4d644a">scdiag</a>,<a class="code" href="namespacempmod.html#a289d1542245a5f6ea00ce0892d4f3dd7">scflag</a>)</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;            <span class="comment">!      check for NaNs</span></div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;            nan=0</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;            <span class="keywordflow">DO</span> k=1, nalc</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;                <span class="keywordflow">IF</span> ((.NOT.(<a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>(k) &lt;= 0.0_mpd)).AND. (.NOT.(<a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>(k) &gt; 0.0_mpd))) nan=nan+1</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160; </div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;            <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;Parameter determination:&#39;</span>,nalc,<span class="stringliteral">&#39; parameters,&#39;</span>, <span class="stringliteral">&#39; rank=&#39;</span>,nrank</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;-----------------------&#39;</span></div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;                <span class="keywordflow">IF</span>(ndown /= 0) <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;   &#39;</span>,ndown,<span class="stringliteral">&#39; data down-weighted&#39;</span></div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;  </div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;            <span class="comment">!      ----- third loop -------------------------------------------------</span></div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;            <span class="comment">!      calculate single residuals remaining after local fit and chi^2</span></div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;  </div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;            summ=0.0_mpd</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;            suwt=0.0</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;            neq=0</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;            imeas=0</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;            ist=isfrst(ibuf)</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;            nst=islast(ibuf)</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;            <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;                <span class="keywordflow">IF</span>(ja == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;                rmeas=real(glder(ja),mpd)     <span class="comment">! data (global contrib. subtracted)</span></div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;                rerr =real(glder(jb),mpd)     <span class="comment">! ... and the error</span></div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;                wght =1.0_mpd/rerr**2         <span class="comment">! weight from error</span></div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;                neq=neq+1                     <span class="comment">! count equation</span></div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;                rmloc=0.0                     <span class="comment">! local fit result reset</span></div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;                <span class="keywordflow">DO</span> j=1,jb-ja-1                <span class="comment">! local parameter loop</span></div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;                    ij=inder(ja+j)</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;                    rmloc=rmloc+real(glder(ja+j),mpd)*<a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>(ij) <span class="comment">! local fit result</span></div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;                <a class="code" href="namespacempmod.html#a33e7585dc2943d8d4ed1022787a3f5a6">localcorrections</a>(neq)=rmloc   <span class="comment">! save local fit result</span></div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;                rmeas=rmeas-rmloc             <span class="comment">! reduced to residual</span></div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    </div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;                <span class="comment">!         calculate pulls? (needs covariance matrix)</span></div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;                <span class="keywordflow">IF</span>(iter == 1.AND.inv &gt; 0.AND.<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> &lt;= <a class="code" href="namespacempmod.html#ac13777d4115b495604ad6df7507ebef0">lfitnp</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;                    dvar=0.0_mpd</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;                    <span class="keywordflow">DO</span> j=1,jb-ja-1</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;                        ij=inder(ja+j)</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;                        <span class="keywordflow">DO</span> k=1,jb-ja-1</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;                            ik=inder(ja+k)</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;                            jk=ijsym(ij,ik)</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;                            dvar=dvar+<a class="code" href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">clmat</a>(jk)*real(glder(ja+j),mpd)*real(glder(ja+k),mpd)</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;<span class="keywordflow">                        END DO</span></div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;                    <span class="comment">!          some variance left to define a pull?</span></div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                    <span class="keywordflow">IF</span> (0.999999_mpd/wght &gt; dvar) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;                        pull=rmeas/sqrt(1.0_mpd/wght-dvar)</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;                        <span class="keywordflow">IF</span> (lhist) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;                            <span class="keywordflow">IF</span> (jb &lt; ist) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;                                <span class="keyword">CALL </span>hmpent(13,real(pull,mps)) <span class="comment">! histogram pull</span></div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;                                <span class="keyword">CALL </span>gmpms(5,rec,real(pull,mps))</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;                            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;                                <span class="keyword">CALL </span>hmpent(14,real(pull,mps)) <span class="comment">! histogram pull</span></div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;<span class="keywordflow">                            END IF</span></div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;                        <span class="comment">!  monitoring</span></div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;                            <span class="keywordflow">IF</span> (jb &lt; ist) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;                                ij=inder(jb+1) <span class="comment">! group by first global label</span></div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="namespacempmod.html#a7d7b32a3675926c99ecd59c27ee2a57a">imonmd</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;                                    irbin=min(<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>,max(1,int(pull*rerr/<a class="code" href="namespacempmod.html#add5d6ee87f88e926424677b1728576f8">measres</a>(ij)/<a class="code" href="namespacempmod.html#a28b6187b715f1b20fe3feab43ec5c109">measbinsize</a>+0.5*real(<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>,mpd))))</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;                                <span class="keywordflow">ELSE</span>    </div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;                                    irbin=min(<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>,max(1,int(pull/<a class="code" href="namespacempmod.html#a28b6187b715f1b20fe3feab43ec5c109">measbinsize</a>+0.5*real(<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>,mpd))))</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;<span class="keywordflow">                                ENDIF</span></div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;                                irbin=irbin+<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>*(<a class="code" href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">measindex</a>(ij)-1+<a class="code" href="namespacempmod.html#aa9d3e269a0fe4f2a7d8a400e2f76d83e">nummeas</a>*iproc)</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;                                <a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>(irbin)=<a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>(irbin)+1</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;<span class="keywordflow">                            ENDIF</span></div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;<span class="keywordflow">                        ENDIF</span></div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;    </div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;                <span class="keywordflow">IF</span>(iter == 1.AND.jb &lt; ist.AND.lhist)  &amp;</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;                    <span class="keyword">CALL </span>gmpms(4,rec,real(rmeas/rerr,mps)) <span class="comment">! residual (with global deriv.)</span></div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;    </div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;                dchi2=wght*rmeas*rmeas</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;                <span class="comment">!          DCHIT=DCHI2</span></div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;                resid=rmeas</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> /= 1.AND.iter /= 1.AND.<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;                    <span class="keywordflow">IF</span>(iter &lt;= 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;                        <span class="keywordflow">IF</span>(abs(resid) &gt; chuber*rerr) <span class="keywordflow">THEN</span>     <span class="comment">! down-weighting</span></div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;                            wght=wght*chuber*rerr/abs(resid)</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;                            dchi2=2.0*chuber*(abs(resid)/rerr-0.5*chuber)</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;                    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;                        wght=wght/(1.0_mpd+(resid/rerr/cauchy)**2)</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;                        dchi2=log(1.0_mpd+(resid/rerr/cauchy)**2)*cauchy**2</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;    </div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;                down=1.0/sqrt(wght)</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160; </div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;                <span class="comment">!          SUWT=SUWT+DCHI2/DCHIT</span></div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;                suwt=suwt+rerr/down</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;                <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;                    chast=<span class="stringliteral">&#39;   &#39;</span></div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;                    <span class="keywordflow">IF</span>(abs(resid) &gt; chuber*rerr) chast=<span class="stringliteral">&#39;*  &#39;</span></div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;                    <span class="keywordflow">IF</span>(abs(resid) &gt; 3.0*rerr) chast=<span class="stringliteral">&#39;** &#39;</span></div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;                    <span class="keywordflow">IF</span>(abs(resid) &gt; 6.0*rerr) chast=<span class="stringliteral">&#39;***&#39;</span></div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;                    <span class="keywordflow">IF</span>(imeas == 0) <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;Third loop: single residuals&#39;</span></div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;                    <span class="keywordflow">IF</span>(imeas == 0) <span class="keyword">WRITE</span>(1,105)</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;                    imeas=imeas+1</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;                    r1=resid/rerr</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;                    r2=resid/down</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;                    <span class="keywordflow">IF</span>(resid &lt; 0.0) r1=-r1</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;                    <span class="keywordflow">IF</span>(resid &lt; 0.0) r2=-r2</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;                    <span class="keyword">WRITE</span>(1,106) imeas,glder(ja),rmeas,rerr,r1,chast,r2</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;105             <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; index corrvalue    residuum          sigma&#39;</span>,  &amp;</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;                    <span class="stringliteral">&#39;     nresid     cnresid&#39;</span>)</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;106             <span class="keyword">FORMAT</span>(i6,2x,2g12.4,<span class="stringliteral">&#39; +-&#39;</span>,g12.4,f7.2,1x,a3,f8.2)</div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160; </div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;                <span class="keywordflow">IF</span>(iter == nter) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;                    <a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(ja)=real(rmeas,mpr8) <span class="comment">! store remaining residual</span></div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;                    resmax=max(resmax,abs(rmeas)/rerr)</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160; </div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;                <span class="keywordflow">IF</span>(iter == 1.AND.lhist) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;                    <span class="keywordflow">IF</span> (jb &lt; ist) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;                        <span class="keyword">CALL </span>hmpent( 3,real(rmeas/rerr,mps)) <span class="comment">! histogram norm residual</span></div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;                    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;                        <span class="keyword">CALL </span>hmpent(12,real(rmeas/rerr,mps)) <span class="comment">! histogram norm residual</span></div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;                summ=summ+dchi2        <span class="comment">! accumulate chi-square sum</span></div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;            ndf=neq-nrank</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;            resing=(real(nweig,mps)-real(suwt,mps))/real(nweig,mps)</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;            <span class="keywordflow">IF</span> (lhist) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;                <span class="keywordflow">IF</span>(iter == 1) <span class="keyword">CALL </span>hmpent( 5,real(ndf,mps))  <span class="comment">! histogram Ndf</span></div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;                <span class="keywordflow">IF</span>(iter == 1) <span class="keyword">CALL </span>hmpent(11,real(nalc,mps)) <span class="comment">! histogram Nlocal</span></div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 2.AND.iter == nter) <span class="keyword">CALL </span>hmpent(6,resing)</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;            <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;Chi^2=&#39;</span>,summ,<span class="stringliteral">&#39; at&#39;</span>,ndf,<span class="stringliteral">&#39; degrees of freedom: &#39;</span>,  &amp;</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;                    <span class="stringliteral">&#39;3-sigma limit is&#39;</span>,<a class="code" href="mpnum_8f90.html#ada9fefb711817245f72e5296fbbb28ff">chindl</a>(3,ndf)*real(ndf,mps)</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;                <span class="keyword">WRITE</span>(1,*) suwt,<span class="stringliteral">&#39; is sum of factors, compared to&#39;</span>,nweig,  &amp;</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;                    <span class="stringliteral">&#39; Downweight fraction:&#39;</span>,resing</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;            <span class="keywordflow">IF</span>(nrank /= nalc.OR.nan &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;                nrej(0)=nrej(0)+1         <span class="comment">! count cases</span></div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3824f538ccd3ce24ae660346329e8ab6">nrec3</a> == huge(<a class="code" href="namespacempmod.html#a3824f538ccd3ce24ae660346329e8ab6">nrec3</a>)) <a class="code" href="namespacempmod.html#a3824f538ccd3ce24ae660346329e8ab6">nrec3</a>=nrc</div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;                <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;                    <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; rank deficit/NaN &#39;</span>, nalc, nrank, nan</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;                    <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;   ---&gt; rejected!&#39;</span></div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;                <span class="keywordflow">GO TO</span> 90</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;            <span class="keywordflow">IF</span>(ndf &lt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;                nrej(1)=nrej(1)+1         <span class="comment">! count cases</span></div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;                <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;                    <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;   ---&gt; rejected!&#39;</span></div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;                <span class="keywordflow">GO TO</span> 90</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;  </div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;            chndf=real(summ/real(ndf,mpd),mps)</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;  </div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;            <span class="keywordflow">IF</span>(iter == 1.AND.lhist) <span class="keyword">CALL </span>hmpent(4,chndf) <span class="comment">! histogram chi^2/Ndf</span></div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;<span class="keywordflow">        END DO</span>  <span class="comment">! outlier iteration loop</span></div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;  </div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;        ndfs=ndfs+ndf              <span class="comment">! (local) sum of Ndf</span></div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;        sndf=sndf+real(ndf,mpd)*dw1  <span class="comment">! (local) weighted sum of Ndf</span></div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;  </div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;        <span class="comment">!      ----- reject eventually ------------------------------------------</span></div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;  </div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad8f302f2683255b7d258697ce3bd4c5f">newite</a>.AND.<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> == 2) <span class="keywordflow">THEN</span> <span class="comment">! find record with largest Chi^2/Ndf</span></div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a2a8b9736839a9a3145b13f0646c681c2">nrecp2</a> &lt; 0.AND.chndf &gt; <a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>(2,iproc+1)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;                <a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>(2,iproc+1)=chndf</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;                <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(7,iproc+1)=nrc</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;  </div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;        chichi=<a class="code" href="mpnum_8f90.html#ada9fefb711817245f72e5296fbbb28ff">chindl</a>(3,ndf)*real(ndf,mps)</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;        <span class="comment">! GF       IF(SUMM.GT.50.0*CHICHI) THEN ! huge</span></div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;        <span class="comment">! CHK CHICUT&lt;0: NO cut (1st iteration)</span></div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> &gt;= 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;            <span class="keywordflow">IF</span>(summ &gt; <a class="code" href="namespacempmod.html#a2528af2f8eb6c45348125529c5926bee">chhuge</a>*chichi) <span class="keywordflow">THEN</span> <span class="comment">! huge</span></div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;                nrej(2)=nrej(2)+1    <span class="comment">! count cases with huge chi^2</span></div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;                <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;                    <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;   ---&gt; rejected!&#39;</span></div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;                <span class="keywordflow">GO TO</span> 90</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160; </div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> &gt; 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;                chlimt=<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>*chichi</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;                <span class="comment">!          WRITE(*,*) &#39;chi^2 &#39;,SUMM,CHLIMT,CHICUT,CHINDL(3,NDF),NDF</span></div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;                <span class="keywordflow">IF</span>(summ &gt; chlimt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;                    <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;                        <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;   ---&gt; rejected!&#39;</span></div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;                    <span class="comment">!              add to FVALUE</span></div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;                    dchi2=chlimt               <span class="comment">! total contribution limit</span></div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;                    dchi2s=dchi2s+dchi2*dw1    <span class="comment">! add total contribution</span></div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;                    nrej(3)=nrej(3)+1      <span class="comment">! count cases with large chi^2</span></div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;                    <span class="keywordflow">GO TO</span> 90</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;<span class="keywordflow">        END IF</span> </div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;  </div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> &gt; 1.AND.<a class="code" href="namespacempmod.html#a5e0286590b4d042e8d883ffa7aa82726">dwcut</a> /= 0.0.AND.resing &gt; <a class="code" href="namespacempmod.html#a5e0286590b4d042e8d883ffa7aa82726">dwcut</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;            <span class="comment">!         add to FVALUE</span></div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;            dchi2=summ                 <span class="comment">! total contribution</span></div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;            dchi2s=dchi2s+dchi2*dw1    <span class="comment">! add total contribution</span></div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;            nrej(3)=nrej(3)+1      <span class="comment">! count cases with large chi^2</span></div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;            <span class="comment">!          WRITE(*,*) &#39;Downweight fraction cut &#39;,RESING,DWCUT,SUMM</span></div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;            <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;                <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;   ---&gt; rejected!&#39;</span></div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;            <span class="keywordflow">GO TO</span> 90</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;  </div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad8f302f2683255b7d258697ce3bd4c5f">newite</a>.AND.<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> == 2) <span class="keywordflow">THEN</span> <span class="comment">! find record with largest residual</span></div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a31ed3022f8cd8aede6f4d869cf3ca045">nrecpr</a> &lt; 0.AND.resmax &gt; <a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>(1,iproc+1)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;                <a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>(1,iproc+1)=real(resmax,mps)</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;                <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(6,iproc+1)=nrc</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;        <span class="comment">!      &#39;track quality&#39; per binary file: accepted records</span></div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;        naccf(kfl)=naccf(kfl)+1</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;        ndff(kfl) =ndff(kfl) +ndf</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;        chi2f(kfl)=chi2f(kfl)+chndf</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;  </div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;        <span class="comment">!      ----- fourth loop ------------------------------------------------</span></div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;        <span class="comment">!      update of global matrix and vector according to the &quot;Millepede&quot;</span></div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;        <span class="comment">!      principle, from the global/local information</span></div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;    </div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;        ist=isfrst(ibuf)</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;        nst=islast(ibuf)</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;        <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;            <span class="keywordflow">IF</span>(ja &lt;= 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;    </div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;            rmeas=real(glder(ja),mpd)     <span class="comment">! data residual</span></div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;            rerr =real(glder(jb),mpd)     <span class="comment">! ... and the error</span></div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;            wght =1.0_mpd/rerr**2         <span class="comment">! weight from measurement error</span></div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;            dchi2=wght*rmeas*rmeas        <span class="comment">! least-square contribution</span></div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;    </div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> /= 1.AND.<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> /= 0) <span class="keywordflow">THEN</span>       <span class="comment">! check residual</span></div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;                resid=abs(rmeas)</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;                <span class="keywordflow">IF</span>(resid &gt; chuber*rerr) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;                    wght=wght*chuber*rerr/resid          <span class="comment">! down-weighting</span></div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;                    dchi2=2.0*chuber*(resid/rerr-0.5*chuber) <span class="comment">! modified contribution</span></div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;            dchi2s=dchi2s+dchi2*dw1    <span class="comment">! add to total objective function</span></div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;    </div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;            <span class="comment">!         global-global matrix contribution: add directly to gg-matrix</span></div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;    </div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;            <span class="keywordflow">DO</span> j=1,ist-jb</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;                ivgbj=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,inder(jb+j))     <span class="comment">! variable-parameter index</span></div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;                <span class="keywordflow">IF</span>(ivgbj &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;                    <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(ioffb+ivgbj)=<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(ioffb+ivgbj)  &amp;</div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;                        +dw1*wght*rmeas*real(glder(jb+j),mpd) <span class="comment">! vector  !!! reverse</span></div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;                    <a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(ioffb+ivgbj)=<a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(ioffb+ivgbj)+1    </div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;                    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;                        ije=<a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(ioffe+ivgbj)        <span class="comment">! get index of index, non-zero</span></div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;                        <span class="keywordflow">DO</span> k=1,j</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;                            ivgbk=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,inder(jb+k))</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;                            <span class="keywordflow">IF</span>(ivgbk &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;                                ike=<a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(ioffe+ivgbk)        <span class="comment">! get index of index, non-zero</span></div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;                                ia=max(ije,ike)          <span class="comment">! larger</span></div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;                                ib=min(ije,ike)          <span class="comment">! smaller</span></div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;                                ij=ib+(ia*ia-ia)/2</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;                                <a class="code" href="namespacempmod.html#ac573f05a09f12bb6c00492f1d7374d9e">writebufferupdates</a>(ioffd+ij)=<a class="code" href="namespacempmod.html#ac573f05a09f12bb6c00492f1d7374d9e">writebufferupdates</a>(ioffd+ij)  &amp;</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;                                    -dw1*wght*real(glder(jb+j),mpd)*real(glder(jb+k),mpd)</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;<span class="keywordflow">                            END IF</span></div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;<span class="keywordflow">                        END DO</span></div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160; </div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;            <span class="comment">!         normal equations - rectangular matrix for global/local pars</span></div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;            <span class="comment">!         global-local matrix contribution: accumulate rectangular matrix</span></div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> /= 1) cycle</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;            <span class="keywordflow">DO</span> j=1,ist-jb</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;                ivgbj=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,inder(jb+j))           <span class="comment">! variable-parameter index</span></div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;                <span class="keywordflow">IF</span>(ivgbj &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;                    ije=<a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(ioffe+ivgbj)        <span class="comment">! get index of index, non-zero</span></div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;                    <span class="keywordflow">DO</span> k=1,jb-ja-1</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;                        ik=inder(ja+k)           <span class="comment">! local index</span></div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;                        jk=ik+(ije-1)*nalc       <span class="comment">! matrix index</span></div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;                        <a class="code" href="namespacempmod.html#a3688e8f65ab58bddfac03c3043166b24">localglobalmatrix</a>(jk)=<a class="code" href="namespacempmod.html#a3688e8f65ab58bddfac03c3043166b24">localglobalmatrix</a>(jk)+dw2*wght*real(glder(jb+j),mpd)*real(glder(ja+k),mpd)</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;  </div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;  </div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;        <span class="comment">!      ----- final matrix update ----------------------------------------</span></div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;        <span class="comment">!      update global matrices and vectors</span></div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> /= 1) <span class="keywordflow">GO TO</span> 90 <span class="comment">! matrix update</span></div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;        <span class="comment">!      (inverse local matrix) * (rectang. matrix) -&gt; CORM</span></div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;        <span class="comment">!                                        T</span></div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;        <span class="comment">!      resulting symmetrix matrix  =   G   *   Gamma^{-1}   *   G</span></div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;  </div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#afd27e1fb8331bdff9e37afe376e54643">dbavat</a>(<a class="code" href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">clmat</a>,<a class="code" href="namespacempmod.html#a3688e8f65ab58bddfac03c3043166b24">localglobalmatrix</a>,<a class="code" href="namespacempmod.html#ac573f05a09f12bb6c00492f1d7374d9e">writebufferupdates</a>(ioffd+1),nalc,-nalg)</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;  </div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;        <span class="comment">!      (rectang. matrix) * (local param vector)   -&gt; CORV</span></div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;        <span class="comment">!      resulting vector = G * q (q = local parameter)</span></div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;        <span class="comment">!      CALL DBGAX(DQ(IGLMA/2+1),BLVEC,DQ(ICORV/2+1),NALG,NALC)  ! not done</span></div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;        <span class="comment">!      the vector update is not done, because after local fit it is zero!</span></div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160; </div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;        <span class="comment">!      update cache status</span></div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;        <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(1,iproc+1)=<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(1,iproc+1)+1</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;        <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(2,iproc+1)=<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(2,iproc+1)+ngg</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;        <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(3,iproc+1)=<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(3,iproc+1)+nalg+2</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;        <span class="comment">!      check free space</span></div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;        nfred=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-1)-<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(2,iproc+1)-<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-2)</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;        nfrei=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(1)-<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(3,iproc+1)-<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(2)</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;        <span class="keywordflow">IF</span> (nfred &lt; 0.OR.nfrei &lt; 0) <span class="keywordflow">THEN</span> <span class="comment">! need to flush</span></div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;            nb=<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(1,iproc+1)</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;            joffd=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-1)*iproc  <span class="comment">! offset data</span></div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;            joffi=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(1)*iproc+2 <span class="comment">! offset indices</span></div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;            used=real(<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(2,iproc+1),mps)/real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-1),mps)</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;            <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(4,iproc+1)=<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(4,iproc+1) +nint(1000.0*used,mpi)</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;            used=real(<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(3,iproc+1),mps)/real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(1),mps)</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;            <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(5,iproc+1)=<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(5,iproc+1) +nint(1000.0*used,mpi)</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;            <span class="comment">!$OMP CRITICAL</span></div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;            <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-4)=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-4)+1</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;            <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(4)=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(4)+1</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;    </div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;            <span class="keywordflow">DO</span> ib=1,nb</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;                ijn=0</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;                <span class="keywordflow">DO</span> in=1,<a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(joffi)</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;                    i=<a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(joffi+in)</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;                    <span class="comment">!         DQ(IGVEC/2+I)=DQ(IGVEC/2+I)+DQ(ICORV/2+IN)  ! not done: = zero</span></div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;                    <span class="keywordflow">DO</span> jn=1,in</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;                        ijn=ijn+1</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;                        j=<a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(joffi+jn)</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a13adb5e2fcb06863ccfc03d886edd121">mupdat</a>(i,j,-<a class="code" href="namespacempmod.html#ac573f05a09f12bb6c00492f1d7374d9e">writebufferupdates</a>(joffd+ijn))  <span class="comment">! matrix update</span></div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;                joffd=joffd+ijn</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;                joffi=joffi+<a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(joffi)+2</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;            <span class="comment">!$OMP END CRITICAL</span></div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;            <span class="comment">!       reset counter, pointers</span></div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;            <span class="keywordflow">DO</span> k=1,3</div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;                <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(k,iproc+1)=0</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160; </div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;90      <span class="keywordflow">IF</span>(lprnt) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;            <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;            <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39;------------------ End of printout for record&#39;</span>,nrc</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;            <span class="keyword">WRITE</span>(1,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;  </div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;        <span class="keywordflow">DO</span> i=1,nalg                 <span class="comment">! reset global index array</span></div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;            iext=<a class="code" href="namespacempmod.html#a0f3fb29788b538ef5aa1c133e1260c62">globalindexusage</a>(ioffc+i)</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;            <a class="code" href="namespacempmod.html#ab7965c26694a67ecce5442856d724d2c">backindexusage</a>(ioffe+iext)=0</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;  </div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;    <span class="comment">!$OMP END PARALLEL DO</span></div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160; </div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;        <span class="comment">!     flush remaining matrices</span></div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;        <span class="keywordflow">DO</span> k=1,<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a> <span class="comment">! update statistics</span></div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;            <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-3)=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-3)+1</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;            used=real(<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(2,k),mps)/real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-1),mps)</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;            <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(4,k)=<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(4,k)+nint(1000.0*used,mpi)</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;            <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-5)=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-5)+<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(4,k)</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;            <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-6)=max(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-6),<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(4,k))</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;            <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(4,k)=0</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;            <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(3)=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(3)+1</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;            used=real(<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(3,k),mps)/real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(1),mps)</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;            <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(5,k)=<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(5,k)+nint(1000.0*used,mpi)</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;            <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(5)=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(5)+<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(5,k)</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;            <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(6)=max(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(6),<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(5,k))</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;            <a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(5,k)=0</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;  </div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;        <span class="comment">!$OMP  PARALLEL &amp;</span></div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;        <span class="comment">!$OMP  DEFAULT(PRIVATE) &amp;</span></div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;        <span class="comment">!$OMP  SHARED(writeBufferHeader,writeBufferInfo,writeBufferIndices,writeBufferUpdates,MTHRD)</span></div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;        iproc=0</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;        <span class="comment">!$ IPROC=OMP_GET_THREAD_NUM()         ! thread number</span></div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;        <span class="keywordflow">DO</span> jproc=0,<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>-1</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;            nb=<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(1,jproc+1)</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;            <span class="comment">!        print *, &#39; flush end &#39;, JPROC, NRC, NB</span></div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;            joffd=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-1)*jproc  <span class="comment">! offset data</span></div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;            joffi=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(1)*jproc+2 <span class="comment">! offset indices</span></div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;            <span class="keywordflow">DO</span> ib=1,nb</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;                <span class="comment">!         print *, &#39;   buf end &#39;, JPROC,IB,writeBufferIndices(JOFFI-1),writeBufferIndices(JOFFI)</span></div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;                ijn=0</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;                <span class="keywordflow">DO</span> in=1,<a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(joffi)</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;                    i=<a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(joffi+in)</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;                    <span class="comment">!$        IF (MOD(I,MTHRD).EQ.IPROC) THEN</span></div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;                    <span class="keywordflow">DO</span> jn=1,in</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;                        ijn=ijn+1</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;                        j=<a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(joffi+jn)</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a13adb5e2fcb06863ccfc03d886edd121">mupdat</a>(i,j,-<a class="code" href="namespacempmod.html#ac573f05a09f12bb6c00492f1d7374d9e">writebufferupdates</a>(joffd+ijn))  <span class="comment">! matrix update</span></div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;                <span class="comment">!$        ELSE</span></div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;                <span class="comment">!$          IJN=IJN+IN</span></div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;                <span class="comment">!$        ENDIF</span></div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;                joffd=joffd+ijn</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;                joffi=joffi+<a class="code" href="namespacempmod.html#a9d32348eb1f9ae966bbf474db8d2c4f1">writebufferindices</a>(joffi)+2</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;    <span class="comment">!$OMP END PARALLEL</span></div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160; </div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad8f302f2683255b7d258697ce3bd4c5f">newite</a>.AND.<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> == 2) <span class="keywordflow">THEN</span> <span class="comment">! get worst records (for printrecord -1 -1)</span></div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a31ed3022f8cd8aede6f4d869cf3ca045">nrecpr</a> &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;            <span class="keywordflow">DO</span> k=1,<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>(1,k) &gt; <a class="code" href="namespacempmod.html#a326295fba843acf6f02d15618292c126">value1</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;                    <a class="code" href="namespacempmod.html#a326295fba843acf6f02d15618292c126">value1</a>=<a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>(1,k)</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;                    <a class="code" href="namespacempmod.html#a740fe4be0e801e4a988b543f74bee750">nrec1</a> =<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(6,k)</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a2a8b9736839a9a3145b13f0646c681c2">nrecp2</a> &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;            <span class="keywordflow">DO</span> k=1,<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>(2,k) &gt; <a class="code" href="namespacempmod.html#aac62f269565280c8025f7474bba86c9c">value2</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;                    <a class="code" href="namespacempmod.html#aac62f269565280c8025f7474bba86c9c">value2</a>=<a class="code" href="namespacempmod.html#aeb12f4cce4b86cae1a7809399e48ff62">writebufferdata</a>(2,k)</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;                    <a class="code" href="namespacempmod.html#ad6d384533ded7eae43c3275fb209161d">nrec2</a> =<a class="code" href="namespacempmod.html#af5350cf7fe84eb75c5f10f8af37d0acc">writebufferinfo</a>(7,k)</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160; </div>
<div class="ttc" id="ampnum_8f90_html_a019b639fffc7f6888d08ba3508f3451c"><div class="ttname"><a href="mpnum_8f90.html#a019b639fffc7f6888d08ba3508f3451c">sqmibb2</a></div><div class="ttdeci">subroutine sqmibb2(v, b, n, nbdr, nbnd, inv, nrank, vbnd, vbdr, aux, vbk, vzru, scdiag, scflag)</div><div class="ttdoc">Band bordered matrix.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l02610">mpnum.f90:2611</a></div></div>
<div class="ttc" id="ampnum_8f90_html_a9723a1127567d1d778894b985a921286"><div class="ttname"><a href="mpnum_8f90.html#a9723a1127567d1d778894b985a921286">sqmibb</a></div><div class="ttdeci">subroutine sqmibb(v, b, n, nbdr, nbnd, inv, nrank, vbnd, vbdr, aux, vbk, vzru, scdiag, scflag)</div><div class="ttdoc">Bordered band matrix.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l02354">mpnum.f90:2355</a></div></div>
<div class="ttc" id="ampnum_8f90_html_afd27e1fb8331bdff9e37afe376e54643"><div class="ttname"><a href="mpnum_8f90.html#afd27e1fb8331bdff9e37afe376e54643">dbavat</a></div><div class="ttdeci">subroutine dbavat(v, a, w, n, ms)</div><div class="ttdoc">A V AT product (similarity).</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l01276">mpnum.f90:1277</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0e7012434383717ae81ed1a584cc12d6"><div class="ttname"><a href="namespacempmod.html#a0e7012434383717ae81ed1a584cc12d6">mpmod::nrecer</a></div><div class="ttdeci">integer(mpi) nrecer</div><div class="ttdoc">record with error (rank deficit or Not-a-Number) for printout</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00077">mpmod.f90:77</a></div></div>
<div class="ttc" id="anamespacempmod_html_a1382c8f22d05b905d2f9268ad65843be"><div class="ttname"><a href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">mpmod::nloopn</a></div><div class="ttdeci">integer(mpi) nloopn</div><div class="ttdoc">number of data reading, fitting loops</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00042">mpmod.f90:42</a></div></div>
<div class="ttc" id="anamespacempmod_html_a187fb71e280caea2fc638d5908cebd36"><div class="ttname"><a href="namespacempmod.html#a187fb71e280caea2fc638d5908cebd36">mpmod::vbk</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable vbk</div><div class="ttdoc">local fit 'matrix for border solution'</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00251">mpmod.f90:251</a></div></div>
<div class="ttc" id="anamespacempmod_html_a289d1542245a5f6ea00ce0892d4f3dd7"><div class="ttname"><a href="namespacempmod.html#a289d1542245a5f6ea00ce0892d4f3dd7">mpmod::scflag</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable scflag</div><div class="ttdoc">local fit workspace (I)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00254">mpmod.f90:254</a></div></div>
<div class="ttc" id="anamespacempmod_html_a28b6187b715f1b20fe3feab43ec5c109"><div class="ttname"><a href="namespacempmod.html#a28b6187b715f1b20fe3feab43ec5c109">mpmod::measbinsize</a></div><div class="ttdeci">real(mpd), parameter measbinsize</div><div class="ttdoc">bins size for monitoring</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00153">mpmod.f90:153</a></div></div>
<div class="ttc" id="anamespacempmod_html_a326295fba843acf6f02d15618292c126"><div class="ttname"><a href="namespacempmod.html#a326295fba843acf6f02d15618292c126">mpmod::value1</a></div><div class="ttdeci">real(mps) value1</div><div class="ttdoc">largest residual</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00054">mpmod.f90:54</a></div></div>
<div class="ttc" id="anamespacempmod_html_a33e7585dc2943d8d4ed1022787a3f5a6"><div class="ttname"><a href="namespacempmod.html#a33e7585dc2943d8d4ed1022787a3f5a6">mpmod::localcorrections</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable localcorrections</div><div class="ttdoc">local fit corrections (to residuals)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00255">mpmod.f90:255</a></div></div>
<div class="ttc" id="anamespacempmod_html_a3824f538ccd3ce24ae660346329e8ab6"><div class="ttname"><a href="namespacempmod.html#a3824f538ccd3ce24ae660346329e8ab6">mpmod::nrec3</a></div><div class="ttdeci">integer(mpi) nrec3</div><div class="ttdoc">(1.) record number with error</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00078">mpmod.f90:78</a></div></div>
<div class="ttc" id="anamespacempmod_html_a40caab8c79f0800ca8a83394a463cd83"><div class="ttname"><a href="namespacempmod.html#a40caab8c79f0800ca8a83394a463cd83">mpmod::nbndx</a></div><div class="ttdeci">integer(mpi) nbndx</div><div class="ttdoc">max band width for local fit</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00076">mpmod.f90:76</a></div></div>
<div class="ttc" id="anamespacempmod_html_a53fec879e0d94b5a03d6069bfc6e75cf"><div class="ttname"><a href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">mpmod::globalcounter</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable globalcounter</div><div class="ttdoc">global counter (entries in 'x')</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00186">mpmod.f90:186</a></div></div>
<div class="ttc" id="anamespacempmod_html_a55d73a7d752b965b5e38ede6b6bc3a40"><div class="ttname"><a href="namespacempmod.html#a55d73a7d752b965b5e38ede6b6bc3a40">mpmod::nbndr</a></div><div class="ttdeci">integer(mpi), dimension(2) nbndr</div><div class="ttdoc">number of records with bordered band matrix for local fit (upper/left, lower/right)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00074">mpmod.f90:74</a></div></div>
<div class="ttc" id="anamespacempmod_html_a57697e5da0fafabbc104674a4bb453c5"><div class="ttname"><a href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">mpmod::iterat</a></div><div class="ttdeci">integer(mpi) iterat</div><div class="ttdoc">iterations in solution</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00068">mpmod.f90:68</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6469f9da002e9aeb45812d77697b241b"><div class="ttname"><a href="namespacempmod.html#a6469f9da002e9aeb45812d77697b241b">mpmod::vzru</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable vzru</div><div class="ttdoc">local fit 'border solution'</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00252">mpmod.f90:252</a></div></div>
<div class="ttc" id="anamespacempmod_html_a66e389ec7e3ccbcdddec753a6c475f4e"><div class="ttname"><a href="namespacempmod.html#a66e389ec7e3ccbcdddec753a6c475f4e">mpmod::vbdr</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable vbdr</div><div class="ttdoc">local fit border part of 'A'</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00249">mpmod.f90:249</a></div></div>
<div class="ttc" id="anamespacempmod_html_a740fe4be0e801e4a988b543f74bee750"><div class="ttname"><a href="namespacempmod.html#a740fe4be0e801e4a988b543f74bee750">mpmod::nrec1</a></div><div class="ttdeci">integer(mpi) nrec1</div><div class="ttdoc">record number with largest residual</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00052">mpmod.f90:52</a></div></div>
<div class="ttc" id="anamespacempmod_html_a8a0b7f0bb1466fe16b03c5abc9fa134a"><div class="ttname"><a href="namespacempmod.html#a8a0b7f0bb1466fe16b03c5abc9fa134a">mpmod::nbdrx</a></div><div class="ttdeci">integer(mpi) nbdrx</div><div class="ttdoc">max border size for local fit</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00075">mpmod.f90:75</a></div></div>
<div class="ttc" id="anamespacempmod_html_a8b7034c842a76da7ffa767f2ca4d644a"><div class="ttname"><a href="namespacempmod.html#a8b7034c842a76da7ffa767f2ca4d644a">mpmod::scdiag</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable scdiag</div><div class="ttdoc">local fit workspace (D)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00253">mpmod.f90:253</a></div></div>
<div class="ttc" id="anamespacempmod_html_aa0630265e6c1e7890d5ece82c0be46d3"><div class="ttname"><a href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">mpmod::clmat</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable clmat</div><div class="ttdoc">local fit matrix 'A' (in A*x=b)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00245">mpmod.f90:245</a></div></div>
<div class="ttc" id="anamespacempmod_html_aac62f269565280c8025f7474bba86c9c"><div class="ttname"><a href="namespacempmod.html#aac62f269565280c8025f7474bba86c9c">mpmod::value2</a></div><div class="ttdeci">real(mps) value2</div><div class="ttdoc">largest chi^2/Ndf</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00055">mpmod.f90:55</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab40ff975fc09d47aee1f14b1f4ffd31f"><div class="ttname"><a href="namespacempmod.html#ab40ff975fc09d47aee1f14b1f4ffd31f">mpmod::aux</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable aux</div><div class="ttdoc">local fit 'solutions for border rows'</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00250">mpmod.f90:250</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab93460a465928ec3e6295ac3b9d45792"><div class="ttname"><a href="namespacempmod.html#ab93460a465928ec3e6295ac3b9d45792">mpmod::ibandh</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable ibandh</div><div class="ttdoc">local fit 'band width histogram' (band size autodetection)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00246">mpmod.f90:246</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad6d384533ded7eae43c3275fb209161d"><div class="ttname"><a href="namespacempmod.html#ad6d384533ded7eae43c3275fb209161d">mpmod::nrec2</a></div><div class="ttdeci">integer(mpi) nrec2</div><div class="ttdoc">record number with largest chi^2/Ndf</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00053">mpmod.f90:53</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad7f8ba591d24891c069ddb501393a8be"><div class="ttname"><a href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">mpmod::blvec</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable blvec</div><div class="ttdoc">local fit vector 'b' (in A*x=b), replaced by 'x'</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00244">mpmod.f90:244</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad8f302f2683255b7d258697ce3bd4c5f"><div class="ttname"><a href="namespacempmod.html#ad8f302f2683255b7d258697ce3bd4c5f">mpmod::newite</a></div><div class="ttdeci">logical newite</div><div class="ttdoc">flag for new iteration</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00137">mpmod.f90:137</a></div></div>
<div class="ttc" id="anamespacempmod_html_af7d437f9a1210fa3b18c7a1ef5aa8872"><div class="ttname"><a href="namespacempmod.html#af7d437f9a1210fa3b18c7a1ef5aa8872">mpmod::vbnd</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable vbnd</div><div class="ttdoc">local fit band part of 'A'</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00248">mpmod.f90:248</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a19f6871ad06d22ac8dbe88a839b31e4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19f6871ad06d22ac8dbe88a839b31e4a">&#9670;&nbsp;</a></span>loopn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine loopn</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loop with fits and sums. </p>
<p>Loop over all binary files. Perform local fits to calculate Chi2, ndf and r.h.s. 'b' of linear equation system A*x=b. In first iteration(s) fill matrix A. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02315">2315</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160; </div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: dsum</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: elmt</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: factrj</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: factrk</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="keywordtype">    REAL</span>(mpr8) :: glder</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: peakd</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: peaki</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: ratae</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rhs</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: rloop</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: sgm</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: used</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: usei</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: weight</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ia</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ib</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ibuf</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inder</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioffb</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ipr</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isfrst</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: islast</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbij</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbik</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgb</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbij</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbik</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lastit</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncrit</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ndfs</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ngras</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nparl</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nr</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrej</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inone</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ilow</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nlow</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nzero</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    <span class="keywordtype">LOGICAL</span> :: btest</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160; </div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="keywordtype">    REAL</span>(mpd):: adder</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::funref</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::dchi2s</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::sndf</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: ii</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    isfrst(ibuf)=<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf)+1</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    islast(ibuf)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf))</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    inder(i)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(i)</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    glder(i)=<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(i)</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <span class="comment">!     ----- book and reset ---------------------------------------------</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 0) <span class="keywordflow">THEN</span>      <span class="comment">! first call</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;        lastit=-1</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;        <a class="code" href="namespacempmod.html#ab08ddac93a2ae6e853f4141d4a8dc956">iitera</a>=0</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160; </div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    <a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>=<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>+1           <span class="comment">! increase loop counter</span></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <a class="code" href="namespacempmod.html#a8f38a22c9a76684594cede594cf9041c">ndfsum</a>=0</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <a class="code" href="namespacempmod.html#a5582661ffb49367e25600e299095a81f">sumndf</a>=0.0_mpd</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    funref=0.0_mpd</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160; </div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 1) <span class="keywordflow">THEN</span>      <span class="comment">! book histograms for 1. iteration</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a14f4d28d6412fcfa886404bed5f4d7d9">gmpdef</a>(1,4,<span class="stringliteral">&#39;Function value in iterations&#39;</span>)</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3 .OR. <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span> <span class="comment">! extend to GMRES, i.e. 4?</span></div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a14f4d28d6412fcfa886404bed5f4d7d9">gmpdef</a>(2,3,<span class="stringliteral">&#39;Number of MINRES steps vs iteration nr&#39;</span>)</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>( 5,0.0,0.0,<span class="stringliteral">&#39;Number of degrees of freedom&#39;</span>)</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(11,0.0,0.0,<span class="stringliteral">&#39;Number of local parameters&#39;</span>)</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(23,0.0,0.0, <span class="stringliteral">&#39;SQRT of diagonal elements without presigma&#39;</span>)</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(24,0.0,0.0, <span class="stringliteral">&#39;Log10 of off-diagonal elements&#39;</span>)</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(25,0.0,0.0, <span class="stringliteral">&#39;Relative individual pre-sigma&#39;</span>)</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(26,0.0,0.0, <span class="stringliteral">&#39;Relative global pre-sigma&#39;</span>)</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160; </div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160; </div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(3,-<a class="code" href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">prange</a>,<a class="code" href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">prange</a>, &amp;   <span class="comment">! book</span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;        <span class="stringliteral">&#39;Normalized residuals of single (global) measurement&#39;</span>)</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(12,-<a class="code" href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">prange</a>,<a class="code" href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">prange</a>, &amp;   <span class="comment">! book</span></div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;        <span class="stringliteral">&#39;Normalized residuals of single (local) measurement&#39;</span>)</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(13,-<a class="code" href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">prange</a>,<a class="code" href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">prange</a>, &amp;   <span class="comment">! book</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;        <span class="stringliteral">&#39;Pulls of single (global) measurement&#39;</span>)</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(14,-<a class="code" href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">prange</a>,<a class="code" href="namespacempmod.html#a192239aafc622bfaf974605f454125ca">prange</a>, &amp;   <span class="comment">! book</span></div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        <span class="stringliteral">&#39;Pulls of single (local) measurement&#39;</span>)</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(4,0.0,0.0,<span class="stringliteral">&#39;Chi^2/Ndf after local fit&#39;</span>)</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a14f4d28d6412fcfa886404bed5f4d7d9">gmpdef</a>(4,5,<span class="stringliteral">&#39;location, dispersion (res.) vs record nr&#39;</span>)</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a14f4d28d6412fcfa886404bed5f4d7d9">gmpdef</a>(5,5,<span class="stringliteral">&#39;location, dispersion (pull) vs record nr&#39;</span>)</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160; </div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    <span class="comment">!      WRITE(*,*) &#39;LOOPN &#39;, NLOOPN, &#39; executing ICALCM=&#39;, ICALCM</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160; </div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;    <span class="comment">!     reset</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160; </div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>=0.0_mpd <span class="comment">! reset rhs vector              IGVEC</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    <a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>=0</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        <a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>=0.0_mpd</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        <a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>=0.</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> &gt;= 3) <a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>=0.0_mpd</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160; </div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 2) <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(6,0.0,0.0,<span class="stringliteral">&#39;Down-weight fraction&#39;</span>)</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160; </div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;    <a class="code" href="namespacempmod.html#ad8f302f2683255b7d258697ce3bd4c5f">newite</a>=.false.</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> /= lastit) <span class="keywordflow">THEN</span> <span class="comment">! new iteration</span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        <a class="code" href="namespacempmod.html#ad8f302f2683255b7d258697ce3bd4c5f">newite</a>=.true.</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;        funref=<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;            nrej=<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3)</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;            <span class="comment">!            CALL MEND</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>=<a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> &gt;= 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>=sqrt(<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>)</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> /= 0.0.AND.<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> &lt; 1.5) <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>=1.0</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> /= 0.0.AND.nrej == 0)    <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>=1.0</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    <span class="comment">!         WRITE(*,111) ! header line</span></div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160; </div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;    <span class="keywordflow">DO</span> i=0,3</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        <a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(i)=0   <span class="comment">! reset reject counter</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    <span class="keywordflow">DO</span> k=3,6</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;        <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(k)=0  <span class="comment">! cache usage</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        <a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-k)=0</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    <span class="comment">!     statistics per binary file</span></div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;        <a class="code" href="namespacempmod.html#a3b9c63124b62fe44ecd96e9de7c2ce5a">jfd</a>(i)=0</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;        <a class="code" href="namespacempmod.html#a4d6db74bc42c797522a81deff648d1a9">cfd</a>(i)=0.0</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;        <a class="code" href="namespacempmod.html#afacae0ada58a38cc14417f2f7de549f5">dfd</a>(i)=0</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;    </div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a> /= 0) <a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>=0 <span class="comment">! reset monitoring histograms</span></div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;    </div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <span class="comment">!     ----- read next data ----------------------------------------------</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a781f6fc2bdd91639f9a943c2b7801d4e">peread</a>(nr)  <span class="comment">! read records</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aacd49a512bb96f75b566fa8f2aee605b">peprep</a>(1)   <span class="comment">! prepare records</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;        ndfs  =0</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;        sndf  =0.0_mpd</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        dchi2s=0.0_mpd</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aeb76c893a1fbb54eb1e7c76ef189059a">loopbf</a>(<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>,ndfs,sndf,dchi2s,<a class="code" href="namespacempmod.html#a6c7f0eaa3bff73c3975cc1bcd197e335">nfiles</a>,<a class="code" href="namespacempmod.html#a3b9c63124b62fe44ecd96e9de7c2ce5a">jfd</a>,<a class="code" href="namespacempmod.html#a4d6db74bc42c797522a81deff648d1a9">cfd</a>,<a class="code" href="namespacempmod.html#afacae0ada58a38cc14417f2f7de549f5">dfd</a>)</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;        <a class="code" href="namespacempmod.html#a8f38a22c9a76684594cede594cf9041c">ndfsum</a>=<a class="code" href="namespacempmod.html#a8f38a22c9a76684594cede594cf9041c">ndfsum</a>+ndfs</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        <a class="code" href="namespacempmod.html#a5582661ffb49367e25600e299095a81f">sumndf</a>=<a class="code" href="namespacempmod.html#a5582661ffb49367e25600e299095a81f">sumndf</a>+sndf</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#abe72f30ba17fdfd70d04a47c5e3b6c08">addsum</a>(dchi2s)</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;        <span class="keywordflow">IF</span> (nr &lt;= 0) <span class="keywordflow">EXIT</span> <span class="comment">! next block of events ?</span></div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    <span class="comment">! sum up RHS (over threads) once (reduction in LOOPBF: summation for each block)</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    ioffb=0</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    <span class="keywordflow">DO</span> ipr=2,<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        ioffb=ioffb+<a class="code" href="namespacempmod.html#aeed9062f2928158f93522db257ef3cdc">lenglobalvec</a></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        <span class="keywordflow">DO</span> k=1,<a class="code" href="namespacempmod.html#aeed9062f2928158f93522db257ef3cdc">lenglobalvec</a></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;            <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(k)=<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(k)+<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(ioffb+k)</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;            <a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(k)=<a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(k)+<a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(ioffb+k)</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160; </div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        <span class="comment">! PRINT *, &#39; cache/w &#39;,(writeBufferHeader(-K),K=3,6),(writeBufferHeader(K),K=3,6)</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;        nparl=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(3)</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;        ncrit=<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(4)</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        used=real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-5),mps)/real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-3),mps)*0.1</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;        usei=real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(5),mps)/real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(3),mps)*0.1</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        peakd=real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(-6),mps)*0.1</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        peaki=real(<a class="code" href="namespacempmod.html#adee159837489a16915b8aba71ab24a2d">writebufferheader</a>(6),mps)*0.1</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        <span class="keyword">WRITE</span>(*,111) nparl,ncrit,usei,used,peaki,peakd</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;111     <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; Write cache usage (#flush,#overrun,&lt;levels&gt;,&#39;</span>,  &amp;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            <span class="stringliteral">&#39;peak(levels))&#39;</span>/2i7,<span class="stringliteral">&#39;,&#39;</span>,4(f6.1,<span class="stringliteral">&#39;%&#39;</span>))</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        <span class="comment">! fill second half (j&gt;i) of global matric for extended storage</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a8d3078659555c21fda8d43de37c311de">mextnd</a> &gt; 0) <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#adb4bd5344ceff0a34a1ff786dedc587a">mhalf2</a>()</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160; </div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    <span class="comment">! check entries/counters</span></div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    nlow=0</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    ilow=1</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;    nzero=0</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(i) == 0) nzero=nzero+1</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(i) &lt; <a class="code" href="namespacempmod.html#ae936dc93a37b86e747dc3ea21a18aa0d">mreqena</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;            nlow=nlow+1</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(i) &lt; <a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(ilow)) ilow=i</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    <span class="keywordflow">IF</span>(nlow &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        <a class="code" href="namespacempmod.html#a524d9e04315e58034b7bf6364443c329">nalow</a>=<a class="code" href="namespacempmod.html#a524d9e04315e58034b7bf6364443c329">nalow</a>+nlow</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(ilow)</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;        print *</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;        print *, <span class="stringliteral">&quot; ... warning ...&quot;</span> </div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        print *, <span class="stringliteral">&quot; global parameters with too few (&lt; MREQENA) accepted entries: &quot;</span>, nlow</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;        print *, <span class="stringliteral">&quot; minimum entries: &quot;</span>, <a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(ilow), <span class="stringliteral">&quot; for label &quot;</span>, <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,itgbi)</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;        print *</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;<span class="keywordflow">    END IF</span>   </div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1 .AND. nzero &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;        <a class="code" href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">ndefec</a> = nzero <span class="comment">! rank defect</span></div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;        <span class="keyword">WRITE</span>(*,*)   <span class="stringliteral">&#39;Warning: the rank defect of the symmetric&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,  &amp;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;            <span class="stringliteral">&#39;-by-&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<span class="stringliteral">&#39; matrix is &#39;</span>,<a class="code" href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">ndefec</a>,<span class="stringliteral">&#39; (should be zero).&#39;</span></div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;Warning: the rank defect of the symmetric&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,  &amp;</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;            <span class="stringliteral">&#39;-by-&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<span class="stringliteral">&#39; matrix is &#39;</span>,<a class="code" href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">ndefec</a>,<span class="stringliteral">&#39; (should be zero).&#39;</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a9da797a9827200adb3f0bc7f66769ec8">iforce</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;            <a class="code" href="namespacempmod.html#ab949b3b527978632aa8cf4dd409d94af">isubit</a>=1</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;            <span class="keyword">WRITE</span>(*,*)   <span class="stringliteral">&#39;         --&gt; enforcing SUBITO mode&#39;</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;         --&gt; enforcing SUBITO mode&#39;</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160; </div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <span class="comment">!     ----- after end-of-data add contributions from pre-sigma ---------</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160; </div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        <span class="comment">!        plot diagonal elements</span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        elmt=0.0</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>        <span class="comment">! diagonal elements</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;            ii=0</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                ii=i</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                ii=(ii*ii+ii)/2</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) ii=i</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 3) ii=i</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;            <span class="keywordflow">IF</span>(ii /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;                elmt=real(<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ii),mps)</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;                <span class="keywordflow">IF</span>(elmt &gt; 0.0) <span class="keyword">CALL </span>hmpent(23,1.0/sqrt(elmt))</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160; </div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160; </div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160; </div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <span class="comment">!     add pre-sigma contributions to matrix diagonal</span></div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160; </div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <span class="comment">!      WRITE(*,*) &#39;Adding to diagonal ICALCM IND6&#39;,ICALCM,IND6</span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160; </div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;        <span class="keywordflow">DO</span> ivgb=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>                        <span class="comment">! add evtl. pre-sigma</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;            <span class="comment">!          WRITE(*,*) &#39;Index &#39;,IVGB,IVGB,QM(IND6+IVGB)</span></div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a6627f321f4027818d9a70faaeff3a296">globalparpreweight</a>(ivgb) /= 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;                <span class="keywordflow">IF</span>(ivgb &gt; 0) <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a13adb5e2fcb06863ccfc03d886edd121">mupdat</a>(ivgb,ivgb,<a class="code" href="namespacempmod.html#a6627f321f4027818d9a70faaeff3a296">globalparpreweight</a>(ivgb))</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160; </div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    <span class="keyword">CALL </span>hmpwrt(23)</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    <span class="keyword">CALL </span>hmpwrt(24)</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    <span class="keyword">CALL </span>hmpwrt(25)</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;    <span class="keyword">CALL </span>hmpwrt(26)</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160; </div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160; </div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;    <span class="comment">!     add regularization term to F and to rhs --------------------------</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160; </div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    <span class="comment">!      WRITE(*,*) &#39;NREGUL &#39;,NREGUL,NLOOPN</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160; </div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4472993490c1aa3dff36e977d033b16b">nregul</a> /= 0) <span class="keywordflow">THEN</span> <span class="comment">! add regularization term to F and to rhs</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;        <span class="keywordflow">DO</span> ivgb=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;            itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(ivgb) <span class="comment">! global parameter index</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;            <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(ivgb)=<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(ivgb) -<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)*<a class="code" href="namespacempmod.html#a6627f321f4027818d9a70faaeff3a296">globalparpreweight</a>(ivgb)</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;            adder=<a class="code" href="namespacempmod.html#a6627f321f4027818d9a70faaeff3a296">globalparpreweight</a>(ivgb)*<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)**2</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#abe72f30ba17fdfd70d04a47c5e3b6c08">addsum</a>(adder)</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160; </div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160; </div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    <span class="comment">!     ----- add contributions from &quot;measurement&quot; -----------------------</span></div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160; </div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160; </div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    i=1</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span> (i &lt;= <a class="code" href="namespacempmod.html#ab2fc85b092d025d708c3278d253a49ac">lenmeasurements</a>)</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;        rhs=<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(i  )%value <span class="comment">! right hand side</span></div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        sgm=<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(i+1)%value <span class="comment">! sigma parameter</span></div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;        i=i+2</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;        weight=0.0</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;        <span class="keywordflow">IF</span>(sgm &gt; 0.0) weight=1.0/sgm**2</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160; </div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        dsum=-rhs</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160; </div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        <span class="comment">!     loop over label/factor pairs</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        ia=i</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        <span class="keywordflow">DO</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;            i=i+1</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            <span class="keywordflow">IF</span>(i &gt; <a class="code" href="namespacempmod.html#ab2fc85b092d025d708c3278d253a49ac">lenmeasurements</a>) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(i)%label == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;        ib=i-1</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160; </div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;        <span class="keywordflow">DO</span> j=ia,ib</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;            factrj=<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(j)%value</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;            itgbij=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(j)%label) <span class="comment">! total parameter index</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;            <span class="keywordflow">IF</span>(itgbij /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                dsum=dsum+factrj*<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbij)     <span class="comment">! residuum</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;            <span class="comment">!      add to vector</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;            ivgbij=0</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;            <span class="keywordflow">IF</span>(itgbij /= 0) ivgbij=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbij) <span class="comment">! variable-parameter index</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;            <span class="keywordflow">IF</span>(ivgbij &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(ivgbij)=<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(ivgbij) -weight*dsum*factrj <span class="comment">! vector</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                <a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(ivgbij)=<a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(ivgbij)+1</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;  </div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1.AND.ivgbij &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                <span class="keywordflow">DO</span> k=ia,j</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                    factrk=<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(k)%value</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;                    itgbik=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(<a class="code" href="namespacempmod.html#a4317659a48fe17852caee09327224a52">listmeasurements</a>(k)%label) <span class="comment">! total parameter index</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                    <span class="comment">!          add to matrix</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                    ivgbik=0</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                    <span class="keywordflow">IF</span>(itgbik /= 0) ivgbik=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbik) <span class="comment">! variable-parameter index</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                    <span class="keywordflow">IF</span>(ivgbij &gt; 0.AND.ivgbik &gt; 0) <span class="keywordflow">THEN</span>    <span class="comment">!</span></div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a13adb5e2fcb06863ccfc03d886edd121">mupdat</a>(ivgbij,ivgbik,weight*factrj*factrk)</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160; </div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;        adder=weight*dsum**2</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#abe72f30ba17fdfd70d04a47c5e3b6c08">addsum</a>(adder)   <span class="comment">! accumulate chi-square</span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160; </div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160; </div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    <span class="comment">!     ----- printout ---------------------------------------------------</span></div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160; </div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160; </div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a6aec1171868141ca383a49764641bd7f">getsum</a>(<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>)   <span class="comment">! get accurate sum (Chi^2)</span></div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <a class="code" href="namespacempmod.html#a57fed7fcdfb12f71e78770758ca65e43">flines</a>=0.5_mpd*<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>   <span class="comment">! Likelihood function value</span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    rloop=<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>+0.01*<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a></div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    <a class="code" href="namespacempmod.html#a0f2cdf5b4a5e4296e26d9eca386a5d7f">actfun</a>=real(funref-<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>,mps)</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 1) <a class="code" href="namespacempmod.html#a0f2cdf5b4a5e4296e26d9eca386a5d7f">actfun</a>=0.0</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;    ngras=nint(<a class="code" href="namespacempmod.html#a759375d6f5401f1c45fc915024774010">angras</a>,mpi)</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;    ratae=0.0                              <span class="comment">!!!</span></div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aafdaf33a39c571aca60be6c0c316b674">delfun</a> /= 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;        ratae=min(99.9,<a class="code" href="namespacempmod.html#a0f2cdf5b4a5e4296e26d9eca386a5d7f">actfun</a>/<a class="code" href="namespacempmod.html#aafdaf33a39c571aca60be6c0c316b674">delfun</a>)  <span class="comment">!!!</span></div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;        ratae=max(-99.9,ratae)</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160; </div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <span class="comment">!     rejects ...</span></div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160; </div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    nrej  =<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3)</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;        <span class="keywordflow">IF</span>(nrej /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Data rejected in initial loop:&#39;</span></div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;   &#39;</span>,  &amp;</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                <a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0), <span class="stringliteral">&#39; (rank deficit/NaN) &#39;</span>,<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1),<span class="stringliteral">&#39; (Ndf=0)   &#39;</span>,  &amp;</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                <a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2), <span class="stringliteral">&#39; (huge)   &#39;</span>,<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3),<span class="stringliteral">&#39; (large)&#39;</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;    <span class="comment">!      IF(NREJEC(1)+NREJEC(2)+NREJEC(3).NE.0) THEN</span></div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    <span class="comment">!         WRITE(LUNLOG,*) &#39;Data rejected in initial loop:&#39;,NREJEC(1),</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    <span class="comment">!     +   &#39; (Ndf=0)   &#39;,NREJEC(2),&#39; (huge)   &#39;,NREJEC(3),&#39; (large)&#39;</span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;    <span class="comment">!      END IF</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160; </div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160; </div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad8f302f2683255b7d258697ce3bd4c5f">newite</a>.AND.<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a31ed3022f8cd8aede6f4d869cf3ca045">nrecpr</a> /= 0.OR.<a class="code" href="namespacempmod.html#a2a8b9736839a9a3145b13f0646c681c2">nrecp2</a> /= 0) <a class="code" href="namespacempmod.html#a0e7012434383717ae81ed1a584cc12d6">nrecer</a>=<a class="code" href="namespacempmod.html#a3824f538ccd3ce24ae660346329e8ab6">nrec3</a></div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a31ed3022f8cd8aede6f4d869cf3ca045">nrecpr</a> &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;            <a class="code" href="namespacempmod.html#a31ed3022f8cd8aede6f4d869cf3ca045">nrecpr</a>=<a class="code" href="namespacempmod.html#a740fe4be0e801e4a988b543f74bee750">nrec1</a></div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a2a8b9736839a9a3145b13f0646c681c2">nrecp2</a> &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;            <a class="code" href="namespacempmod.html#a2a8b9736839a9a3145b13f0646c681c2">nrecp2</a>=<a class="code" href="namespacempmod.html#ad6d384533ded7eae43c3275fb209161d">nrec2</a></div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160; </div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> &lt;= 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a2010ded48e128ac616720dd5a8bc68da">nhistp</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        <span class="comment">!            CALL HMPRNT(3)  ! scaled residual of single measurement</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;        <span class="comment">!            CALL HMPRNT(12) ! scaled residual of single measurement</span></div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        <span class="comment">!            CALL HMPRNT(4)  ! chi^2/Ndf</span></div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        <span class="keyword">CALL </span>hmpwrt(3)</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;        <span class="keyword">CALL </span>hmpwrt(12)</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;        <span class="keyword">CALL </span>hmpwrt(4)</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;        <span class="keyword">CALL </span>gmpwrt(4) <span class="comment">! location, dispersion (res.) as a function of record nr</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> &lt;= <a class="code" href="namespacempmod.html#ac13777d4115b495604ad6df7507ebef0">lfitnp</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;            <span class="keyword">CALL </span>hmpwrt(13)</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;            <span class="keyword">CALL </span>hmpwrt(14)</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;            <span class="keyword">CALL </span>gmpwrt(5) <span class="comment">! location, dispersion (pull) as a function of record nr</span></div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    <span class="comment">!      IF(NLOOPN.EQ.2.AND.NHISTP.NE.0) CALL HMPRNT(6)</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 2) <span class="keyword">CALL </span>hmpwrt(6)</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> &lt;= 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;        <span class="comment">!         IF(NHISTP.NE.0) CALL HMPRNT(5)  ! number of degrees of freedom</span></div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;        <span class="comment">!         IF(NHISTP.NE.0) CALL HMPRNT(11) ! Nlocal</span></div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;        <span class="keyword">CALL </span>hmpwrt(5)</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;        <span class="keyword">CALL </span>hmpwrt(11)</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160; </div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    <span class="comment">!     local fit: band matrix structure !?</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 1.AND.<a class="code" href="namespacempmod.html#a55d73a7d752b965b5e38ede6b6bc3a40">nbndr</a>(1)+<a class="code" href="namespacempmod.html#a55d73a7d752b965b5e38ede6b6bc3a40">nbndr</a>(2) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;        <span class="keywordflow">DO</span> lun=6,8,2</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39; === local fits have bordered band matrix structure ===&#39;</span></div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a55d73a7d752b965b5e38ede6b6bc3a40">nbndr</a>(1) &gt; 0 ) <span class="keyword">WRITE</span>(lun,101) <span class="stringliteral">&#39; NBNDR&#39;</span>,<a class="code" href="namespacempmod.html#a55d73a7d752b965b5e38ede6b6bc3a40">nbndr</a>(1),<span class="stringliteral">&#39;number of records (upper/left border)&#39;</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a55d73a7d752b965b5e38ede6b6bc3a40">nbndr</a>(2) &gt; 0 ) <span class="keyword">WRITE</span>(lun,101) <span class="stringliteral">&#39; NBNDR&#39;</span>,<a class="code" href="namespacempmod.html#a55d73a7d752b965b5e38ede6b6bc3a40">nbndr</a>(2),<span class="stringliteral">&#39;number of records (lower/right border)&#39;</span></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;            <span class="keyword">WRITE</span>(lun,101) <span class="stringliteral">&#39; NBDRX&#39;</span>,<a class="code" href="namespacempmod.html#a8a0b7f0bb1466fe16b03c5abc9fa134a">nbdrx</a>,<span class="stringliteral">&#39;max border size&#39;</span></div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;            <span class="keyword">WRITE</span>(lun,101) <span class="stringliteral">&#39; NBNDX&#39;</span>,<a class="code" href="namespacempmod.html#a40caab8c79f0800ca8a83394a463cd83">nbndx</a>,<span class="stringliteral">&#39;max band width&#39;</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160; </div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    lastit=<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    </div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    <span class="comment">! monitoring of residuals</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a> &lt; 0 .OR. (<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 1 .AND. btest(<a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a>,0))) <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a4b6537e97d3eefbb3cb1f9bab1385708">monres</a></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160; </div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;101 <span class="keyword">FORMAT</span>(1x,a8,<span class="stringliteral">&#39; =&#39;</span>,i10,<span class="stringliteral">&#39; = &#39;</span>,a)</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;<span class="comment">! 101  FORMAT(&#39; LOOPN&#39;,I6,&#39; Function value&#39;,F22.8,10X,I6,&#39; records&#39;)</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;<span class="comment">! 102  FORMAT(&#39;   incl. constraint penalty&#39;,F22.8)</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="comment">! 103  FORMAT(I13,3X,A,G12.4)</span></div>
<div class="ttc" id="amphistab_8f90_html_a14f4d28d6412fcfa886404bed5f4d7d9"><div class="ttname"><a href="mphistab_8f90.html#a14f4d28d6412fcfa886404bed5f4d7d9">gmpdef</a></div><div class="ttdeci">subroutine gmpdef(ig, ityp, text)</div><div class="ttdef"><b>Definition:</b> <a href="mphistab_8f90_source.html#l00581">mphistab.f90:582</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0f2cdf5b4a5e4296e26d9eca386a5d7f"><div class="ttname"><a href="namespacempmod.html#a0f2cdf5b4a5e4296e26d9eca386a5d7f">mpmod::actfun</a></div><div class="ttdeci">real(mps) actfun</div><div class="ttdoc">actual function change</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00066">mpmod.f90:66</a></div></div>
<div class="ttc" id="anamespacempmod_html_a481eeaa95958f671e25cd2b3e9b1813c"><div class="ttname"><a href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">mpmod::nrejec</a></div><div class="ttdeci">integer(mpi), dimension(0:3) nrejec</div><div class="ttdoc">rejected events</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00133">mpmod.f90:133</a></div></div>
<div class="ttc" id="anamespacempmod_html_a499e3f9fb15b87000fa3ce817e6cbc57"><div class="ttname"><a href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">mpmod::fvalue</a></div><div class="ttdeci">real(mpd) fvalue</div><div class="ttdoc">function value (chi2 sum) solution</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00155">mpmod.f90:155</a></div></div>
<div class="ttc" id="anamespacempmod_html_a524d9e04315e58034b7bf6364443c329"><div class="ttname"><a href="namespacempmod.html#a524d9e04315e58034b7bf6364443c329">mpmod::nalow</a></div><div class="ttdeci">integer(mpi) nalow</div><div class="ttdoc">(sum of) global parameters with too few accepted entries</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00148">mpmod.f90:148</a></div></div>
<div class="ttc" id="anamespacempmod_html_a5582661ffb49367e25600e299095a81f"><div class="ttname"><a href="namespacempmod.html#a5582661ffb49367e25600e299095a81f">mpmod::sumndf</a></div><div class="ttdeci">real(mpd) sumndf</div><div class="ttdoc">weighted sum(ndf)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00157">mpmod.f90:157</a></div></div>
<div class="ttc" id="anamespacempmod_html_a57fed7fcdfb12f71e78770758ca65e43"><div class="ttname"><a href="namespacempmod.html#a57fed7fcdfb12f71e78770758ca65e43">mpmod::flines</a></div><div class="ttdeci">real(mpd) flines</div><div class="ttdoc">function value line search</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00156">mpmod.f90:156</a></div></div>
<div class="ttc" id="anamespacempmod_html_a72b8b49aa1bd9f36f2551c479805d907"><div class="ttname"><a href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">mpmod::matprecond</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable matprecond</div><div class="ttdoc">preconditioner (band) matrix</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00191">mpmod.f90:191</a></div></div>
<div class="ttc" id="anamespacempmod_html_a759375d6f5401f1c45fc915024774010"><div class="ttname"><a href="namespacempmod.html#a759375d6f5401f1c45fc915024774010">mpmod::angras</a></div><div class="ttdeci">real(mps) angras</div><div class="ttdoc">angle between gradient and search direction</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00067">mpmod.f90:67</a></div></div>
<div class="ttc" id="anamespacempmod_html_a8f38a22c9a76684594cede594cf9041c"><div class="ttname"><a href="namespacempmod.html#a8f38a22c9a76684594cede594cf9041c">mpmod::ndfsum</a></div><div class="ttdeci">integer(mpi) ndfsum</div><div class="ttdoc">sum(ndf)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00138">mpmod.f90:138</a></div></div>
<div class="ttc" id="anamespacempmod_html_a934ba105d1133de87b31daaa20415cee"><div class="ttname"><a href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">mpmod::ndefec</a></div><div class="ttdeci">integer(mpi) ndefec</div><div class="ttdoc">rank deficit for global matrix (from inversion)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00146">mpmod.f90:146</a></div></div>
<div class="ttc" id="anamespacempmod_html_aafdaf33a39c571aca60be6c0c316b674"><div class="ttname"><a href="namespacempmod.html#aafdaf33a39c571aca60be6c0c316b674">mpmod::delfun</a></div><div class="ttdeci">real(mps) delfun</div><div class="ttdoc">expected function change</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00065">mpmod.f90:65</a></div></div>
<div class="ttc" id="anamespacempmod_html_ab08ddac93a2ae6e853f4141d4a8dc956"><div class="ttname"><a href="namespacempmod.html#ab08ddac93a2ae6e853f4141d4a8dc956">mpmod::iitera</a></div><div class="ttdeci">integer(mpi) iitera</div><div class="ttdoc">MINRES iterations.</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00139">mpmod.f90:139</a></div></div>
<div class="ttc" id="anamespacempmod_html_aeed9062f2928158f93522db257ef3cdc"><div class="ttname"><a href="namespacempmod.html#aeed9062f2928158f93522db257ef3cdc">mpmod::lenglobalvec</a></div><div class="ttdeci">integer(mpi) lenglobalvec</div><div class="ttdoc">length of global vector 'b' (A*x=b)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00170">mpmod.f90:170</a></div></div>
<div class="ttc" id="apede_8f90_html_a4b6537e97d3eefbb3cb1f9bab1385708"><div class="ttname"><a href="pede_8f90.html#a4b6537e97d3eefbb3cb1f9bab1385708">monres</a></div><div class="ttdeci">subroutine monres</div><div class="ttdoc">Monitor input residuals.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l05940">pede.f90:5941</a></div></div>
<div class="ttc" id="apede_8f90_html_a6aec1171868141ca383a49764641bd7f"><div class="ttname"><a href="pede_8f90.html#a6aec1171868141ca383a49764641bd7f">getsum</a></div><div class="ttdeci">subroutine getsum(asum)</div><div class="ttdoc">Get accurate sum.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l09066">pede.f90:9067</a></div></div>
<div class="ttc" id="apede_8f90_html_abe72f30ba17fdfd70d04a47c5e3b6c08"><div class="ttname"><a href="pede_8f90.html#abe72f30ba17fdfd70d04a47c5e3b6c08">addsum</a></div><div class="ttdeci">subroutine addsum(add)</div><div class="ttdoc">Accurate summation.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l09041">pede.f90:9042</a></div></div>
<div class="ttc" id="apede_8f90_html_adb4bd5344ceff0a34a1ff786dedc587a"><div class="ttname"><a href="pede_8f90.html#adb4bd5344ceff0a34a1ff786dedc587a">mhalf2</a></div><div class="ttdeci">subroutine mhalf2</div><div class="ttdoc">Fill 2nd half of matrix for extended storage.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l04535">pede.f90:4536</a></div></div>
<div class="ttc" id="apede_8f90_html_aeb76c893a1fbb54eb1e7c76ef189059a"><div class="ttname"><a href="pede_8f90.html#aeb76c893a1fbb54eb1e7c76ef189059a">loopbf</a></div><div class="ttdeci">subroutine loopbf(nrej, ndfs, sndf, dchi2s, numfil, naccf, chi2f, ndff)</div><div class="ttdoc">Loop over records in read buffer (block), fits and sums.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l03063">pede.f90:3064</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0da5fd4f91da94fa7854e0939f5fd075"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0da5fd4f91da94fa7854e0939f5fd075">&#9670;&nbsp;</a></span>mcsolv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mcsolv </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), dimension(n), intent(in)&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), dimension(n), intent(out)&#160;</td>
          <td class="paramname"><em>y</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Solution for zero band width preconditioner. </p>
<p>Used by <a class="el" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">MINRES</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>size of vectors </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>rhs vector </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">y</td><td>result vector </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l06579">6579</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160; </div>
<div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>,<span class="keywordtype">INTENT(IN)</span> :: n</div>
<div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(IN)</span>  :: x(n)</div>
<div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(OUT)</span> :: y(n)</div>
<div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#aa6d1e48380366698fa934cf368cb0b4b">presol</a>(<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1),<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2),<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(1+<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>),<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(1+<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>*<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>),y,x)</div>
<div class="ttc" id="ampnum_8f90_html_aa6d1e48380366698fa934cf368cb0b4b"><div class="ttname"><a href="mpnum_8f90.html#aa6d1e48380366698fa934cf368cb0b4b">presol</a></div><div class="ttdeci">subroutine presol(p, n, cu, a, s, x, y)</div><div class="ttdoc">Constrained preconditioner, solution.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l02245">mpnum.f90:2246</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a51882a4f8268e9378cc1102daf447c42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51882a4f8268e9378cc1102daf447c42">&#9670;&nbsp;</a></span>mdiags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mdiags</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Solution by diagonalization. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l06206">6206</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160; </div>
<div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: evalue</div>
<div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iast</div>
<div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: idia</div>
<div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: imin</div>
<div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ioff1</div>
<div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nmax</div>
<div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nmin</div>
<div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ntop</div>
<div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;                                       <span class="comment">!</span></div>
<div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ii</div>
<div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;    <span class="keywordtype">EXTERNAL</span> <a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a></div>
<div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160; </div>
<div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160; </div>
<div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;    lun=<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>                       <span class="comment">! log file</span></div>
<div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a> == 0) lun=6</div>
<div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160; </div>
<div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;    <span class="comment">! save diagonal (for global correlation)</span></div>
<div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;        <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a> </div>
<div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;            ii=i</div>
<div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;            <a class="code" href="namespacempmod.html#aebe0725175cd12a48bc6ac0f2f0c6c68">workspacediag</a>(i)=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>((ii*ii+ii)/2) <span class="comment">! save diagonal elements</span></div>
<div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160; </div>
<div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a8ae2c7e3508121d8c1da42fe878d6e5a">qlssq</a>(<a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>,<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>,.true.) <span class="comment">! Q^t*A*Q</span></div>
<div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;        <span class="comment">! solve L^t*y=d by backward substitution</span></div>
<div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a84aeeb4100eb811e31aa54f09dcf2ae2">qlbsub</a>(<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>,<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>)</div>
<div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;        <span class="comment">! transform, reduce rhs</span></div>
<div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,1,.true.) <span class="comment">! Q^t*b</span></div>
<div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;        <span class="comment">! correction from eliminated part</span></div>
<div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;        <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a></div>
<div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;            ioff1=((<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+1)*<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>)/2+i</div>
<div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;            <span class="keywordflow">DO</span> j=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;                <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(i)=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(i)-<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ioff1)*<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>(j)</div>
<div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;                ioff1=ioff1+<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+j</div>
<div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160; </div>
<div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;        <span class="comment">!                         eigenvalues   eigenvectors   symm_input</span></div>
<div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;        <a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>=0.0_mpd</div>
<div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a36ccd26f5ba6d72c55e9f90b2e22b1e1">devrot</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>,<a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>,<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>,  &amp;</div>
<div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;            <a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>,<a class="code" href="namespacempmod.html#af4596bd67153123dc3124aa5067620c3">workspacei</a>)</div>
<div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;  </div>
<div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;        <span class="comment">!        histogram of positive eigenvalues</span></div>
<div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;  </div>
<div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;        nmax=int(1.0+log10(real(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(1),mps)),mpi) <span class="comment">! &gt; log of largest eigenvalue</span></div>
<div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;        imin=1</div>
<div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;        <span class="keywordflow">DO</span> i=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,1,-1</div>
<div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i) &gt; 0.0_mpd) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;                imin=i <span class="comment">! index of smallest pos. eigenvalue</span></div>
<div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;                <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;        nmin=int(log10(real(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(imin),mps)),mpi)   <span class="comment">! log of smallest pos. eigenvalue</span></div>
<div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;        ntop=nmin+6</div>
<div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;        <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span>(ntop &lt; nmax)</div>
<div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;            ntop=ntop+3</div>
<div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;  </div>
<div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a3f3455d53e876e4fa06564306a0aeba9">hmpdef</a>(7,real(nmin,mps),real(ntop,mps), <span class="stringliteral">&#39;log10 of positive eigenvalues&#39;</span>)</div>
<div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;        <span class="keywordflow">DO</span> idia=1,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(idia) &gt; 0.0_mpd) <span class="keywordflow">THEN</span> <span class="comment">! positive</span></div>
<div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;                evalue=log10(real(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(idia),mps))</div>
<div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;                <span class="keyword">CALL </span>hmpent(7,evalue)</div>
<div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a2010ded48e128ac616720dd5a8bc68da">nhistp</a> /= 0) <span class="keyword">CALL </span>hmprnt(7)</div>
<div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;        <span class="keyword">CALL </span>hmpwrt(7)</div>
<div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;  </div>
<div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;        iast=max(1,imin-60)</div>
<div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mphistab_8f90.html#a14f4d28d6412fcfa886404bed5f4d7d9">gmpdef</a>(3,2,<span class="stringliteral">&#39;low-value end of eigenvalues&#39;</span>)</div>
<div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;        <span class="keywordflow">DO</span> i=iast,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;            evalue=real(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i),mps)</div>
<div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;            <span class="keyword">CALL </span>gmpxy(3,real(i,mps),evalue)</div>
<div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a2010ded48e128ac616720dd5a8bc68da">nhistp</a> /= 0) <span class="keyword">CALL </span>gmprnt(3)</div>
<div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;        <span class="keyword">CALL </span>gmpwrt(3)</div>
<div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;  </div>
<div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;        <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a></div>
<div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;            <a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>(i)=0.0_mpd</div>
<div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i) /= 0.0_mpd) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;                <a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>(i)=max(0.0_mpd,log10(abs(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i)))+3.0_mpd)</div>
<div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i) &lt; 0.0_mpd) <a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>(i)=-<a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>(i)</div>
<div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;The first (largest) eigenvalues ...&#39;</span></div>
<div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;        <span class="keyword">WRITE</span>(lun,102) (<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i),i=1,min(20,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>))</div>
<div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;The last eigenvalues ... up to&#39;</span>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;        <span class="keyword">WRITE</span>(lun,102) (<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i),i=max(1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>-19),<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)</div>
<div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a> &gt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;The eigenvalues from&#39;</span>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+1,<span class="stringliteral">&#39; to&#39;</span>,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;            <span class="keyword">WRITE</span>(lun,102) (<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i),i=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+1,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>)</div>
<div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;Log10 + 3 of &#39;</span>,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,<span class="stringliteral">&#39; eigenvalues in decreasing&#39;</span>, <span class="stringliteral">&#39; order&#39;</span></div>
<div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;(for Eigenvalue &lt; 0.001 the value 0.0 is shown)&#39;</span></div>
<div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;        <span class="keyword">WRITE</span>(lun,101) (<a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>(i),i=1,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>)</div>
<div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>) &lt; 0) <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;Negative values are &#39;</span>,  &amp;</div>
<div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;            <span class="stringliteral">&#39;printed for negative eigenvalues&#39;</span></div>
<div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#acc1b41f704b9ad302fbbbb7685c3bf03">devsig</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>,<a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>,<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>,<a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>)</div>
<div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;        <span class="keyword">WRITE</span>(lun,*) <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,<span class="stringliteral">&#39; significances: insignificant if &#39;</span>,  &amp;</div>
<div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;            <span class="stringliteral">&#39;compatible with  N(0,1)&#39;</span></div>
<div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;        <span class="keyword">WRITE</span>(lun,101) (<a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>(i),i=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)</div>
<div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;  </div>
<div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;  </div>
<div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;101     <span class="keyword">FORMAT</span>(10f7.1)</div>
<div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;102     <span class="keyword">FORMAT</span>(5e14.6)</div>
<div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160; </div>
<div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160; </div>
<div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;    <span class="comment">!     solution ---------------------------------------------------------</span></div>
<div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;    <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>(:<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>)=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(:<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>)</div>
<div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;    <span class="comment">!                      eigenvalues   eigenvectors</span></div>
<div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a20cdb7dca1007e7cc6ea973e584f94ee">devsol</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>,<a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>,<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>,<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,<a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>)</div>
<div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160; </div>
<div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span>  </div>
<div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;        <span class="comment">! extend, transform back solution</span></div>
<div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;        <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+1:<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)=<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>(1:<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>)</div>
<div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,1,.false.) <span class="comment">! Q*x</span></div>
<div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160; </div>
<div class="ttc" id="ampnum_8f90_html_a20cdb7dca1007e7cc6ea973e584f94ee"><div class="ttname"><a href="mpnum_8f90.html#a20cdb7dca1007e7cc6ea973e584f94ee">devsol</a></div><div class="ttdeci">subroutine devsol(n, diag, u, b, x, work)</div><div class="ttdoc">Solution by diagonalization.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l00657">mpnum.f90:658</a></div></div>
<div class="ttc" id="ampnum_8f90_html_a36ccd26f5ba6d72c55e9f90b2e22b1e1"><div class="ttname"><a href="mpnum_8f90.html#a36ccd26f5ba6d72c55e9f90b2e22b1e1">devrot</a></div><div class="ttdeci">subroutine devrot(n, diag, u, v, work, iwork)</div><div class="ttdoc">Diagonalization.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l00377">mpnum.f90:378</a></div></div>
<div class="ttc" id="ampnum_8f90_html_acc1b41f704b9ad302fbbbb7685c3bf03"><div class="ttname"><a href="mpnum_8f90.html#acc1b41f704b9ad302fbbbb7685c3bf03">devsig</a></div><div class="ttdeci">subroutine devsig(n, diag, u, b, coef)</div><div class="ttdoc">Calculate significances.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l00619">mpnum.f90:620</a></div></div>
<div class="ttc" id="ampqldec_8f90_html_a84aeeb4100eb811e31aa54f09dcf2ae2"><div class="ttname"><a href="mpqldec_8f90.html#a84aeeb4100eb811e31aa54f09dcf2ae2">qlbsub</a></div><div class="ttdeci">subroutine qlbsub(d, y)</div><div class="ttdoc">Backward substitution.</div><div class="ttdef"><b>Definition:</b> <a href="mpqldec_8f90_source.html#l00630">mpqldec.f90:631</a></div></div>
<div class="ttc" id="ampqldec_8f90_html_a8ae2c7e3508121d8c1da42fe878d6e5a"><div class="ttname"><a href="mpqldec_8f90.html#a8ae2c7e3508121d8c1da42fe878d6e5a">qlssq</a></div><div class="ttdeci">subroutine qlssq(aprod, A, t)</div><div class="ttdoc">Similarity transformation by Q(t).</div><div class="ttdef"><b>Definition:</b> <a href="mpqldec_8f90_source.html#l00419">mpqldec.f90:420</a></div></div>
<div class="ttc" id="anamespacempmod_html_a01c8cb7d51d6b4e51481e5f5d4f56ca3"><div class="ttname"><a href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">mpmod::workspaceeigenvectors</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable workspaceeigenvectors</div><div class="ttdoc">workspace eigen vectors</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00199">mpmod.f90:199</a></div></div>
<div class="ttc" id="anamespacempmod_html_a4ad8460fdead8b7979a7c86ed8e010f2"><div class="ttname"><a href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">mpmod::globalcorrections</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable globalcorrections</div><div class="ttdoc">correction x_i (from A*x_i=b_i in iteration i)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00176">mpmod.f90:176</a></div></div>
<div class="ttc" id="anamespacempmod_html_a6e11527c10f149a78be81ce2b6a9181f"><div class="ttname"><a href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">mpmod::workspacediagonalization</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable workspacediagonalization</div><div class="ttdoc">workspace diag.</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00197">mpmod.f90:197</a></div></div>
<div class="ttc" id="anamespacempmod_html_ac70f5bd0f41b2449e7aba58fe1be094e"><div class="ttname"><a href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">mpmod::workspaced</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable workspaced</div><div class="ttdoc">(general) workspace (D)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00194">mpmod.f90:194</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad215c8375287930fd388c1e204140fbb"><div class="ttname"><a href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">mpmod::workspaceeigenvalues</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable workspaceeigenvalues</div><div class="ttdoc">workspace eigen values</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00198">mpmod.f90:198</a></div></div>
<div class="ttc" id="anamespacempmod_html_aebe0725175cd12a48bc6ac0f2f0c6c68"><div class="ttname"><a href="namespacempmod.html#aebe0725175cd12a48bc6ac0f2f0c6c68">mpmod::workspacediag</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable workspacediag</div><div class="ttdoc">diagonal of global matrix (for global corr.)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00195">mpmod.f90:195</a></div></div>
<div class="ttc" id="anamespacempmod_html_af4596bd67153123dc3124aa5067620c3"><div class="ttname"><a href="namespacempmod.html#af4596bd67153123dc3124aa5067620c3">mpmod::workspacei</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable workspacei</div><div class="ttdoc">(general) workspace (I)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00200">mpmod.f90:200</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9f1cf38841260b60fa064f16b1f06cbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f1cf38841260b60fa064f16b1f06cbc">&#9670;&nbsp;</a></span>mend()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mend</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>End of 'module' printout. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l08785">8785</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l08786"></a><span class="lineno"> 8786</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacempmod.html#a1282bf03151b92c7170a0cc36659cbdb">textl</a></div>
<div class="line"><a name="l08787"></a><span class="lineno"> 8787</span>&#160; </div>
<div class="line"><a name="l08788"></a><span class="lineno"> 8788</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l08789"></a><span class="lineno"> 8789</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l08790"></a><span class="lineno"> 8790</span>&#160;    <span class="keyword">WRITE</span>(*,*) <a class="code" href="namespacempmod.html#a1282bf03151b92c7170a0cc36659cbdb">textl</a></div>
<div class="line"><a name="l08791"></a><span class="lineno"> 8791</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9a561b65e706ac555980a527a863d5ea">petime</a></div>
<div class="line"><a name="l08792"></a><span class="lineno"> 8792</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="ttc" id="anamespacempmod_html_a1282bf03151b92c7170a0cc36659cbdb"><div class="ttname"><a href="namespacempmod.html#a1282bf03151b92c7170a0cc36659cbdb">mpmod::textl</a></div><div class="ttdeci">character(len=74) textl</div><div class="ttdoc">name of current MP 'module' (step)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00136">mpmod.f90:136</a></div></div>
<div class="ttc" id="apede_8f90_html_a9a561b65e706ac555980a527a863d5ea"><div class="ttname"><a href="pede_8f90.html#a9a561b65e706ac555980a527a863d5ea">petime</a></div><div class="ttdeci">subroutine petime</div><div class="ttdoc">Print times.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l08839">pede.f90:8840</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adb4bd5344ceff0a34a1ff786dedc587a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb4bd5344ceff0a34a1ff786dedc587a">&#9670;&nbsp;</a></span>mhalf2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mhalf2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fill 2nd half of matrix for extended storage. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04535">4535</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160; </div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ichunk</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iencdb</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iencdm</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ir</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ispc</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jtem</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jtemc</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jtemn</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nd</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160; </div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ij</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ijadd</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: k</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: kk</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: kl</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ku</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: indid</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ll</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: k8</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160; </div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;    nd=int(<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(2,1),mpi)-1   <span class="comment">! dimension of matrix</span></div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;    ichunk=min((nd+<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>-1)/<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>/8+1,1024)</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160; </div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    iencdb=<a class="code" href="namespacempmod.html#ad7d459edc90892891995ccb3ac96b6f3">nencdb</a>                       <span class="comment">! encoding info</span></div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;    iencdm=ishft(1,iencdb)-1</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;    <span class="keywordflow">DO</span> ispc=1,<a class="code" href="namespacempmod.html#a4ef9f014f98a92d810584e67f14f40ec">nspc</a></div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;        <span class="comment">! parallelize row loop</span></div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;        <span class="comment">! slot of 1024 &#39;I&#39; for next idle thread</span></div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;        <span class="comment">!$OMP PARALLEL DO &amp;</span></div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;        <span class="comment">!$OMP  PRIVATE(I,IR,K,KK,LL,KL,KU,K8,INDID,IJ,J,JTEMC,JTEM,JTEMN) &amp;</span></div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;        <span class="comment">!$OMP  SCHEDULE(DYNAMIC,ichunk)</span></div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;        <span class="keywordflow">DO</span> i=1,nd</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;            ir=i+(ispc-1)*(nd+1)</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;            kk=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(1,ir) <span class="comment">! offset in &#39;d&#39; (column lists)</span></div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;            ll=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(2,ir) <span class="comment">! offset in &#39;j&#39; (matrix)</span></div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;            kl=<a class="code" href="namespacempmod.html#afe0ea5bb9145eeb4c037e3938b76d427">sparsematrixcompression</a>(i+(ispc-1)*nd) <span class="comment">! number of regions in 1st half (j&lt;i)</span></div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;                        </div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;            ku=<a class="code" href="namespacempmod.html#a273a17d00e4e3cee47b5435f75b77788">sparsematrixoffsets</a>(1,ir+1)-kk</div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;            <span class="comment">!IF (sparseMatrixColumns(kk) == 0) THEN     ! compression ?</span></div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;            ku=(ku*8)/9-1        <span class="comment">! number of regions (-1)</span></div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;            indid=kk+ku/8+1      <span class="comment">! index of first region (after group offsets)</span></div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;            k8=kl/8                           <span class="comment">! region group (-1)</span></div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;            ll=ll+<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(kk+k8)  <span class="comment">! offset for group of (8) regions</span></div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;            <span class="keywordflow">DO</span> k=k8*8,kl-1</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;                ll=ll+iand(<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+k),iencdm) <span class="comment">! add region lengths</span></div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;            <span class="keywordflow">DO</span> k=kl,ku</div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;                jtemc=<a class="code" href="namespacempmod.html#a25cb0798e95628f518dd292ad182be59">sparsematrixcolumns</a>(indid+k)              <span class="comment">! compressed information</span></div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;                jtem =ishft(jtemc,-iencdb)     <span class="comment">! first column of region</span></div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;                jtemn=jtem+iand(jtemc,iencdm)  <span class="comment">! first column after region</span></div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;                <span class="keywordflow">DO</span> j=jtem,jtemn-1</div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;                    ij=<a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>(i,j)</div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;                    <span class="keywordflow">IF</span> (ispc==1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;                        <a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ll)=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ij)</div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;                    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;                        <a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(ll)=<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(-ij)</div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;                    ll=ll+1</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;        <span class="comment">!$OMP END PARALLEL DO</span></div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="aac8a73c63504a2719be59c3ed1a0ac97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac8a73c63504a2719be59c3ed1a0ac97">&#9670;&nbsp;</a></span>minver()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine minver</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Solution by matrix inversion. </p>
<p>Parallelized (SQMINL), solve A*x=b. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l06129">6129</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160; </div>
<div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ioff1</div>
<div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrank</div>
<div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ii</div>
<div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;    <span class="keywordtype">EXTERNAL</span> <a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a></div>
<div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160; </div>
<div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;    lun=<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>                       <span class="comment">! log file</span></div>
<div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a> == 0) <a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>=6</div>
<div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160; </div>
<div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;    <span class="comment">! save diagonal (for global correlation)</span></div>
<div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;        <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a> </div>
<div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;            ii=i</div>
<div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;            <a class="code" href="namespacempmod.html#aebe0725175cd12a48bc6ac0f2f0c6c68">workspacediag</a>(i)=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>((ii*ii+ii)/2) <span class="comment">! save diagonal elements</span></div>
<div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160; </div>
<div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;    <span class="comment">!      WRITE(*,*) &#39;MINVER ICALCM=&#39;,ICALCM</span></div>
<div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a8ae2c7e3508121d8c1da42fe878d6e5a">qlssq</a>(<a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>,<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>,.true.) <span class="comment">! Q^t*A*Q</span></div>
<div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;        <span class="comment">! solve L^t*y=d by backward substitution</span></div>
<div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a84aeeb4100eb811e31aa54f09dcf2ae2">qlbsub</a>(<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>,<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>)</div>
<div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;        <span class="comment">! transform, reduce rhs</span></div>
<div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,1,.true.) <span class="comment">! Q^t*b</span></div>
<div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;        <span class="comment">! correction from eliminated part</span></div>
<div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;        <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a></div>
<div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;            ioff1=((<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+1)*<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>)/2+i</div>
<div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;            <span class="keywordflow">DO</span> j=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;                <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(i)=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(i)-<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ioff1)*<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>(j)</div>
<div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;                ioff1=ioff1+<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+j</div>
<div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160; </div>
<div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;        <span class="comment">! invert and solve</span></div>
<div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a24d99a263ffebf0cbb2a8839f259c816">sqminl</a>(<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>, <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,nrank,  &amp;</div>
<div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;            <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>,<a class="code" href="namespacempmod.html#af4596bd67153123dc3124aa5067620c3">workspacei</a>)</div>
<div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> /= nrank) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;            <span class="keyword">WRITE</span>(*,*)   <span class="stringliteral">&#39;Warning: the rank defect of the symmetric&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,  &amp;</div>
<div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;                <span class="stringliteral">&#39;-by-&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<span class="stringliteral">&#39; matrix is &#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>-nrank,<span class="stringliteral">&#39; (should be zero).&#39;</span></div>
<div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;Warning: the rank defect of the symmetric&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,  &amp;</div>
<div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;                <span class="stringliteral">&#39;-by-&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<span class="stringliteral">&#39; matrix is &#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>-nrank,<span class="stringliteral">&#39; (should be zero).&#39;</span></div>
<div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a9da797a9827200adb3f0bc7f66769ec8">iforce</a> == 0 .AND. <a class="code" href="namespacempmod.html#ab949b3b527978632aa8cf4dd409d94af">isubit</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;                <a class="code" href="namespacempmod.html#ab949b3b527978632aa8cf4dd409d94af">isubit</a>=1</div>
<div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;                <span class="keyword">WRITE</span>(*,*)   <span class="stringliteral">&#39;         --&gt; enforcing SUBITO mode&#39;</span></div>
<div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;                <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;         --&gt; enforcing SUBITO mode&#39;</span></div>
<div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">ndefec</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;No rank defect of the symmetric matrix&#39;</span></div>
<div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;        <a class="code" href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">ndefec</a>=max(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>-nrank, <a class="code" href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">ndefec</a>)   <span class="comment">! rank defect</span></div>
<div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160; </div>
<div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;    <span class="keywordflow">ELSE</span>             <span class="comment">! multiply gradient by inverse matrix</span></div>
<div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;        <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>(:<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>)=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(:<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>)</div>
<div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a2f58743f91524d7e25eeec8d39699a3b">dbsvxl</a>(<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>,<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>,<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>)</div>
<div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160; </div>
<div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span>  </div>
<div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;        <span class="comment">! extend, transform back solution</span></div>
<div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;        <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+1:<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)=<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>(1:<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>)</div>
<div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,1,.false.) <span class="comment">! Q*x</span></div>
<div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160; </div>
<div class="ttc" id="ampnum_8f90_html_a24d99a263ffebf0cbb2a8839f259c816"><div class="ttname"><a href="mpnum_8f90.html#a24d99a263ffebf0cbb2a8839f259c816">sqminl</a></div><div class="ttdeci">subroutine sqminl(v, b, n, nrank, diag, next)</div><div class="ttdoc">Matrix inversion for LARGE matrices.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l00224">mpnum.f90:225</a></div></div>
<div class="ttc" id="ampnum_8f90_html_a2f58743f91524d7e25eeec8d39699a3b"><div class="ttname"><a href="mpnum_8f90.html#a2f58743f91524d7e25eeec8d39699a3b">dbsvxl</a></div><div class="ttdeci">subroutine dbsvxl(v, a, b, n)</div><div class="ttdoc">Product LARGE symmetric matrix, vector.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l01196">mpnum.f90:1197</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0bc980caefa591f99b8fd33645ea81e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bc980caefa591f99b8fd33645ea81e5">&#9670;&nbsp;</a></span>mminrs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mminrs</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Solution with <a class="el" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">MINRES</a>. </p>
<p>Solve A*x=b by minimizing |A*x-b| iteratively. Parallelized (AVPROD).</p>
<p>Use preconditioner with zero (precon) or finite (equdec) band width. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l06385">6385</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespaceminresmodule.html">minresmodule</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">minres</a></div>
<div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160; </div>
<div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: istop</div>
<div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itn</div>
<div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itnlim</div>
<div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nout</div>
<div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrkd</div>
<div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrkd2</div>
<div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160; </div>
<div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: shift</div>
<div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rtol</div>
<div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: anorm</div>
<div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: acond</div>
<div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: arnorm</div>
<div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rnorm</div>
<div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: ynorm</div>
<div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;    <span class="keywordtype">LOGICAL</span> :: checka</div>
<div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;    <span class="keywordtype">EXTERNAL</span> <a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>, <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a>, <a class="code" href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a></div>
<div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;    lun=<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>                       <span class="comment">! log file</span></div>
<div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a> == 0) lun=6</div>
<div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160; </div>
<div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;    nout=lun</div>
<div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;    itnlim=2000    <span class="comment">! iteration limit</span></div>
<div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;    shift =0.0_mpd   <span class="comment">! not used</span></div>
<div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;    rtol = <a class="code" href="namespacempmod.html#a83a4e54644058ec927f693131a6cc78e">mrestl</a> <span class="comment">! from steering</span></div>
<div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;    checka=.false.</div>
<div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160; </div>
<div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;    <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a> = <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a></div>
<div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;        <span class="comment">! solve L^t*y=d by backward substitution</span></div>
<div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a84aeeb4100eb811e31aa54f09dcf2ae2">qlbsub</a>(<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>,<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>)</div>
<div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;        <span class="comment">! input to AVPRD0</span></div>
<div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;        <a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>(1:<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>)=0.0_mpd</div>
<div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;        <a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+1:<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>)=<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a></div>
<div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>,1,.false.) <span class="comment">! Q*x</span></div>
<div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;        <span class="comment">! calclulate vecBav=globalMat*vecXav</span></div>
<div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,<a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>,<a class="code" href="namespacempmod.html#af1c41906f834bd434de691c18df074f8">vecbav</a>)</div>
<div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;        <span class="comment">! correction from eliminated part</span></div>
<div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;        <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>=<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>-<a class="code" href="namespacempmod.html#af1c41906f834bd434de691c18df074f8">vecbav</a></div>
<div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;        <span class="comment">! transform, reduce rhs</span></div>
<div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>,1,.true.) <span class="comment">! Q^t*b</span></div>
<div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160; </div>
<div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> == 0) <span class="keywordflow">THEN</span>           <span class="comment">! default preconditioner</span></div>
<div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a323b4bbd10611cb21471dd7f4209afd8">qlpssq</a>(<a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>,<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,1,.true.) <span class="comment">! transform preconditioner matrix</span></div>
<div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a1be727b806123cdbd7ae0695df918243">precon</a>(<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1),<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2),<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>, <a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(1+<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>),  &amp;</div>
<div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;                <a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(1+<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>*<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>),nrkd)</div>
<div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">minres</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,  <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a>, <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>, shift, checka ,.true. , &amp;</div>
<div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;            <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, itnlim, nout, rtol, istop, itn, anorm, acond, rnorm, arnorm, ynorm)</div>
<div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> &gt; 0) <span class="keywordflow">THEN</span>                          <span class="comment">! band matrix preconditioner</span></div>
<div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a323b4bbd10611cb21471dd7f4209afd8">qlpssq</a>(<a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>,<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a>,.true.) <span class="comment">! transform preconditioner matrix</span></div>
<div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;MMINRS: EQUDEC started&#39;</span>, <a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2), <a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1)</div>
<div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a67c9c5eec2673298f1eb58a1310ab0a3">equdec</a>(<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2),<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1),<a class="code" href="namespacempmod.html#a9189aeab6d135186cad819219868dbba">lprecm</a>,<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,<a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>,nrkd,nrkd2)</div>
<div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;MMINRS: EQUDEC ended  &#39;</span>, nrkd, nrkd2</div>
<div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">minres</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,  <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a>, <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>, shift, checka ,.true. , &amp;</div>
<div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;            <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, itnlim, nout, rtol, istop, itn, anorm, acond, rnorm, arnorm, ynorm)</div>
<div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">minres</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,  <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a>, <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>, shift, checka ,.false. , &amp;</div>
<div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;            <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, itnlim, nout, rtol, istop, itn, anorm, acond, rnorm, arnorm, ynorm)</div>
<div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160; </div>
<div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span>  </div>
<div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;        <span class="comment">! extend, transform back solution</span></div>
<div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;        <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+1:<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)=<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>(1:<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>)</div>
<div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,1,.false.) <span class="comment">! Q*x</span></div>
<div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160; </div>
<div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;    <a class="code" href="namespacempmod.html#ab08ddac93a2ae6e853f4141d4a8dc956">iitera</a>=itn</div>
<div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;    <a class="code" href="namespacempmod.html#ad3f204db26a5f1baf0ac5c48f1ffcf60">istopa</a>=istop</div>
<div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;    <a class="code" href="namespacempmod.html#a0f88223759b03c3447b6e94cce8034bb">mnrsit</a>=<a class="code" href="namespacempmod.html#a0f88223759b03c3447b6e94cce8034bb">mnrsit</a>+itn</div>
<div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160; </div>
<div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ad3f204db26a5f1baf0ac5c48f1ffcf60">istopa</a> == 0) print *, <span class="stringliteral">&#39;MINRES: istop=0, exact solution x=0.&#39;</span></div>
<div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160; </div>
<div class="ttc" id="ampnum_8f90_html_a1be727b806123cdbd7ae0695df918243"><div class="ttname"><a href="mpnum_8f90.html#a1be727b806123cdbd7ae0695df918243">precon</a></div><div class="ttdeci">subroutine precon(p, n, c, cu, a, s, nrkd)</div><div class="ttdoc">Constrained preconditioner, decomposition.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l02171">mpnum.f90:2172</a></div></div>
<div class="ttc" id="ampnum_8f90_html_a67c9c5eec2673298f1eb58a1310ab0a3"><div class="ttname"><a href="mpnum_8f90.html#a67c9c5eec2673298f1eb58a1310ab0a3">equdec</a></div><div class="ttdeci">subroutine equdec(n, m, ls, c, india, nrkd, nrkd2)</div><div class="ttdoc">Decomposition of equilibrium systems.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l02034">mpnum.f90:2035</a></div></div>
<div class="ttc" id="ampqldec_8f90_html_a323b4bbd10611cb21471dd7f4209afd8"><div class="ttname"><a href="mpqldec_8f90.html#a323b4bbd10611cb21471dd7f4209afd8">qlpssq</a></div><div class="ttdeci">subroutine qlpssq(aprod, B, m, t)</div><div class="ttdoc">Partial similarity transformation by Q(t).</div><div class="ttdef"><b>Definition:</b> <a href="mpqldec_8f90_source.html#l00497">mpqldec.f90:498</a></div></div>
<div class="ttc" id="anamespaceminresmodule_html"><div class="ttname"><a href="namespaceminresmodule.html">minresmodule</a></div><div class="ttdoc">MINRES solves symmetric systems Ax = b or min ||Ax - b||_2, where the matrix A may be indefinite and/...</div><div class="ttdef"><b>Definition:</b> <a href="minresModule_8f90_source.html#l00039">minresModule.f90:39</a></div></div>
<div class="ttc" id="anamespaceminresmodule_html_af74c4ebfeaa33584dabc74a700776cb3"><div class="ttname"><a href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">minresmodule::minres</a></div><div class="ttdeci">subroutine, public minres(n, Aprod, Msolve, b, shift, checkA, precon, x, itnlim, nout, rtol, istop, itn, Anorm, Acond, rnorm, Arnorm, ynorm)</div><div class="ttdoc">Solution of linear equation system.</div><div class="ttdef"><b>Definition:</b> <a href="minresModule_8f90_source.html#l00294">minresModule.f90:297</a></div></div>
<div class="ttc" id="anamespacempmod_html_a0f88223759b03c3447b6e94cce8034bb"><div class="ttname"><a href="namespacempmod.html#a0f88223759b03c3447b6e94cce8034bb">mpmod::mnrsit</a></div><div class="ttdeci">integer(mpi) mnrsit</div><div class="ttdoc">total number of MINRES internal iterations</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00093">mpmod.f90:93</a></div></div>
<div class="ttc" id="anamespacempmod_html_abd9c27b5cebd3829dc162bfa810253ef"><div class="ttname"><a href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">mpmod::indprecond</a></div><div class="ttdeci">integer(mpi), dimension(:), allocatable indprecond</div><div class="ttdoc">preconditioner pointer array</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00192">mpmod.f90:192</a></div></div>
<div class="ttc" id="anamespacempmod_html_ad3f204db26a5f1baf0ac5c48f1ffcf60"><div class="ttname"><a href="namespacempmod.html#ad3f204db26a5f1baf0ac5c48f1ffcf60">mpmod::istopa</a></div><div class="ttdeci">integer(mpi) istopa</div><div class="ttdoc">MINRES istop (convergence)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00140">mpmod.f90:140</a></div></div>
<div class="ttc" id="apede_8f90_html_a0da5fd4f91da94fa7854e0939f5fd075"><div class="ttname"><a href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a></div><div class="ttdeci">subroutine mcsolv(n, x, y)</div><div class="ttdoc">Solution for zero band width preconditioner.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l06579">pede.f90:6580</a></div></div>
<div class="ttc" id="apede_8f90_html_ad7828f3b25225915586ac1d5a1a98206"><div class="ttname"><a href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a></div><div class="ttdeci">subroutine avprod(n, x, b)</div><div class="ttdoc">Product symmetric matrix times vector.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l04394">pede.f90:4395</a></div></div>
<div class="ttc" id="apede_8f90_html_ae7da13e1cf0da04c46d9c36048880219"><div class="ttname"><a href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a></div><div class="ttdeci">subroutine mvsolv(n, x, y)</div><div class="ttdoc">Solution for finite band width preconditioner.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l06599">pede.f90:6600</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ade1c4784449e452a75d58bd02653b45e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade1c4784449e452a75d58bd02653b45e">&#9670;&nbsp;</a></span>mminrsqlp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mminrsqlp</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Solution with <a class="el" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">MINRES-QLP</a>. </p>
<p>Solve A*x=b by minimizing |A*x-b| iteratively. Parallelized (AVPROD).</p>
<p>Use preconditioner with zero (precon) or finite (equdec) band width. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l06478">6478</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespaceminresqlpmodule.html">minresqlpmodule</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlp</a></div>
<div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160; </div>
<div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: istop</div>
<div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itn</div>
<div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itnlim</div>
<div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nout</div>
<div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrkd</div>
<div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrkd2</div>
<div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160; </div>
<div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rtol</div>
<div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: mxxnrm</div>
<div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: trcond</div>
<div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160; </div>
<div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;    <span class="keywordtype">EXTERNAL</span> <a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>, <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a>, <a class="code" href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a></div>
<div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;    lun=<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>                       <span class="comment">! log file</span></div>
<div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a> == 0) lun=6</div>
<div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160; </div>
<div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;    nout=lun</div>
<div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;    itnlim=2000    <span class="comment">! iteration limit</span></div>
<div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;    rtol = <a class="code" href="namespacempmod.html#a83a4e54644058ec927f693131a6cc78e">mrestl</a> <span class="comment">! from steering</span></div>
<div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;    mxxnrm = real(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,mpd)/sqrt(epsilon(mxxnrm))</div>
<div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afe95475aa68062b3b36a6f2355b70583">mrmode</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;        trcond = 1.0_mpd/epsilon(trcond) <span class="comment">! only QR</span></div>
<div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afe95475aa68062b3b36a6f2355b70583">mrmode</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;        trcond = 1.0_mpd <span class="comment">! only QLP</span></div>
<div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;        trcond = <a class="code" href="namespacempmod.html#a180dbe1de7f777ca5046d679db34c607">mrtcnd</a> <span class="comment">! QR followed by QLP</span></div>
<div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160; </div>
<div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;    <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a> = <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a></div>
<div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;        <span class="comment">! solve L^t*y=d by backward substitution</span></div>
<div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a84aeeb4100eb811e31aa54f09dcf2ae2">qlbsub</a>(<a class="code" href="namespacempmod.html#a0c2a4eca186a1b56ad847a6403a40129">vecconsresiduals</a>,<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>)</div>
<div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;        <span class="comment">! input to AVPRD0</span></div>
<div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;        <a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>(1:<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>)=0.0_mpd</div>
<div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;        <a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+1:<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>)=<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a></div>
<div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>,1,.false.) <span class="comment">! Q*x</span></div>
<div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;        <span class="comment">! calclulate vecBav=globalMat*vecXav</span></div>
<div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,<a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>,<a class="code" href="namespacempmod.html#af1c41906f834bd434de691c18df074f8">vecbav</a>)</div>
<div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;        <span class="comment">! correction from eliminated part</span></div>
<div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;        <a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>=<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>-<a class="code" href="namespacempmod.html#af1c41906f834bd434de691c18df074f8">vecbav</a></div>
<div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;        <span class="comment">! transform, reduce rhs</span></div>
<div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>,1,.true.) <span class="comment">! Q^t*b</span></div>
<div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160; </div>
<div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> == 0) <span class="keywordflow">THEN</span>           <span class="comment">! default preconditioner</span></div>
<div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a323b4bbd10611cb21471dd7f4209afd8">qlpssq</a>(<a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>,<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,1,.true.) <span class="comment">! transform preconditioner matrix</span></div>
<div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a1be727b806123cdbd7ae0695df918243">precon</a>(<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1),<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2),<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>, <a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(1+<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>),  &amp;</div>
<div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;                <a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(1+<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>*<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>),nrkd)</div>
<div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlp</a>( n=<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>, aprod=<a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, b=<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>,  msolve=<a class="code" href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a>, nout=nout, &amp;</div>
<div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;            itnlim=itnlim, rtol=rtol, maxxnorm=mxxnrm, trancond=trcond, &amp;</div>
<div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;            x=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, istop=istop, itn=itn)</div>
<div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> &gt; 0) <span class="keywordflow">THEN</span>                          <span class="comment">! band matrix preconditioner</span></div>
<div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a323b4bbd10611cb21471dd7f4209afd8">qlpssq</a>(<a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>,<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a>,.true.) <span class="comment">! transform preconditioner matrix</span></div>
<div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;MMINRS: EQUDEC started&#39;</span>, <a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2), <a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1)</div>
<div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a67c9c5eec2673298f1eb58a1310ab0a3">equdec</a>(<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2),<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1),<a class="code" href="namespacempmod.html#a9189aeab6d135186cad819219868dbba">lprecm</a>,<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,<a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>,nrkd,nrkd2)</div>
<div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;            <span class="keyword">WRITE</span>(lun,*) <span class="stringliteral">&#39;MMINRS: EQUDEC ended  &#39;</span>, nrkd, nrkd2</div>
<div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160; </div>
<div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlp</a>( n=<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>, aprod=<a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, b=<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>,  msolve=<a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a>, nout=nout, &amp;</div>
<div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;            itnlim=itnlim, rtol=rtol, maxxnorm=mxxnrm, trancond=trcond, &amp;</div>
<div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;            x=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, istop=istop, itn=itn)</div>
<div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlp</a>( n=<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>, aprod=<a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, b=<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>, nout=nout, &amp;</div>
<div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;            itnlim=itnlim, rtol=rtol, maxxnorm=mxxnrm, trancond=trcond, &amp;</div>
<div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;            x=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, istop=istop, itn=itn)</div>
<div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160; </div>
<div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span>  </div>
<div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;        <span class="comment">! extend, transform back solution</span></div>
<div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;        <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+1:<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)=<a class="code" href="namespacempmod.html#a6b38b041e17c62cce3f1514687414691">vecconssolution</a>(1:<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>)</div>
<div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,1,.false.) <span class="comment">! Q*x</span></div>
<div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160; </div>
<div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;    <a class="code" href="namespacempmod.html#ab08ddac93a2ae6e853f4141d4a8dc956">iitera</a>=itn</div>
<div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;    <a class="code" href="namespacempmod.html#ad3f204db26a5f1baf0ac5c48f1ffcf60">istopa</a>=istop</div>
<div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;    <a class="code" href="namespacempmod.html#a0f88223759b03c3447b6e94cce8034bb">mnrsit</a>=<a class="code" href="namespacempmod.html#a0f88223759b03c3447b6e94cce8034bb">mnrsit</a>+itn</div>
<div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160; </div>
<div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ad3f204db26a5f1baf0ac5c48f1ffcf60">istopa</a> == 3) print *, <span class="stringliteral">&#39;MINRES: istop=0, exact solution x=0.&#39;</span></div>
<div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160; </div>
<div class="ttc" id="anamespaceminresqlpmodule_html"><div class="ttname"><a href="namespaceminresqlpmodule.html">minresqlpmodule</a></div><div class="ttdoc">MINRESQLP solves symmetric systems Ax = b or min ||Ax - b||_2, where the matrix A may be indefinite a...</div><div class="ttdef"><b>Definition:</b> <a href="minresqlpModule_8f90_source.html#l00042">minresqlpModule.f90:42</a></div></div>
<div class="ttc" id="anamespaceminresqlpmodule_html_ab0e9f6586048493a1e8e01f5f471b2c0"><div class="ttname"><a href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlpmodule::minresqlp</a></div><div class="ttdeci">subroutine, public minresqlp(n, Aprod, b, shift, Msolve, disable, nout, itnlim, rtol, maxxnorm, trancond, Acondlim, x, istop, itn, rnorm, Arnorm, xnorm, Anorm, Acond)</div><div class="ttdoc">Solution of linear equation system or least squares problem.</div><div class="ttdef"><b>Definition:</b> <a href="minresqlpModule_8f90_source.html#l00411">minresqlpModule.f90:414</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b6537e97d3eefbb3cb1f9bab1385708"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b6537e97d3eefbb3cb1f9bab1385708">&#9670;&nbsp;</a></span>monres()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine monres</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Monitor input residuals. </p>
<p>Read all data files again to monitor input residuals </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l05940">5940</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160; </div>
<div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ij</div>
<div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: imed</div>
<div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nent</div>
<div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(measBins)</span> :: isuml <span class="comment">! location</span></div>
<div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(measBins)</span> :: isums <span class="comment">! scale</span></div>
<div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: amed</div>
<div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: amad</div>
<div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;    </div>
<div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ioff</div>
<div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;    <span class="keywordtype">LOGICAL</span> :: lfirst</div>
<div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;    <span class="keyword">DATA</span> lfirst /.true./</div>
<div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160; </div>
<div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;    <span class="comment">! combine data from threads</span></div>
<div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;    ioff=0</div>
<div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;    <span class="keywordflow">DO</span> i=2,<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;        ioff=ioff+<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>*<a class="code" href="namespacempmod.html#aa9d3e269a0fe4f2a7d8a400e2f76d83e">nummeas</a></div>
<div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;        <span class="keywordflow">DO</span> j=1,<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>*<a class="code" href="namespacempmod.html#aa9d3e269a0fe4f2a7d8a400e2f76d83e">nummeas</a></div>
<div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;            <a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>(j)=<a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>(j)+<a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>(ioff+j)</div>
<div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;    </div>
<div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;    <span class="keywordflow">IF</span> (lfirst) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a7d7b32a3675926c99ecd59c27ee2a57a">imonmd</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;            <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a0ba5f44eb369bc3a679cf14f47bbfb80">lunmon</a>,<span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&#39;*** Normalized residuals grouped by first global label (per local fit cycle) ***&#39;</span></div>
<div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;            <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a0ba5f44eb369bc3a679cf14f47bbfb80">lunmon</a>,<span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&#39;*** Pulls grouped by first global label (per local fit cycle) ***&#39;</span></div>
<div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;        <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a0ba5f44eb369bc3a679cf14f47bbfb80">lunmon</a>,<span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&#39;! LFC     Label   Entries        Median  RMS(MAD)          &lt;error&gt;&#39;</span></div>
<div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;        lfirst=.false.</div>
<div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160; </div>
<div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;    <span class="comment">! analyze histograms</span></div>
<div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;    ioff=0</div>
<div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;    <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ad3d02cc546767024150d88e3ce56bc7e">measindex</a>(i) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;            isuml=0</div>
<div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;            <span class="comment">! sum up content                                                                     </span></div>
<div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;            isuml(1)=<a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>(ioff+1)                                                           </div>
<div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;            <span class="keywordflow">DO</span> j=2,<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>                                                                      </div>
<div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;                isuml(j)=isuml(j-1)+<a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>(ioff+j)                                            </div>
<div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;<span class="keywordflow">            END DO</span>                                                                              </div>
<div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;            nent=isuml(<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>)                                                                 </div>
<div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;            <span class="comment">! get median (for location)                                                          </span></div>
<div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;            <span class="keywordflow">DO</span> j=2,<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>                                                                      </div>
<div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;                <span class="keywordflow">IF</span> (2*isuml(j) &gt; nent) <span class="keywordflow">EXIT</span>                                                      </div>
<div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;<span class="keywordflow">            END DO</span>                                                                               </div>
<div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;            imed=j                                                                               </div>
<div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;            amed=real(j,mps)</div>
<div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;            <span class="keywordflow">IF</span> (isuml(j) &gt; isuml(j-1)) amed=amed+real(nent-2*isuml(j-1),mps)/real(2*isuml(j)-2*isuml(j-1),mps)     </div>
<div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;            amed=real(<a class="code" href="namespacempmod.html#a28b6187b715f1b20fe3feab43ec5c109">measbinsize</a>,mps)*(amed-real(<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>/2,mps))</div>
<div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;            <span class="comment">! sum up differences                                                                 </span></div>
<div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;            isums = 0                                                                            </div>
<div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;            <span class="keywordflow">DO</span> j=imed,<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>                                                                   </div>
<div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;                k=j-imed+1                                                                       </div>
<div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;                isums(k)=isums(k)+<a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>(ioff+j)                                              </div>
<div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;<span class="keywordflow">            END DO</span>                                                                               </div>
<div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;            <span class="keywordflow">DO</span> j=imed-1,1,-1                                                                     </div>
<div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;                k=imed-j                                                                         </div>
<div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;                isums(k)=isums(k)+<a class="code" href="namespacempmod.html#a5943384feedd0a3326d0e2921525b6fa">meashists</a>(ioff+j)                                              </div>
<div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;<span class="keywordflow">            END DO</span>                                                                               </div>
<div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;            <span class="keywordflow">DO</span> j=2, <a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>                                                                     </div>
<div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;                isums(j)=isums(j)+isums(j-1)</div>
<div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;<span class="keywordflow">            END DO</span>                                                                               </div>
<div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;            <span class="comment">! get median (for scale)                                                             </span></div>
<div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;            <span class="keywordflow">DO</span> j=2,<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a>                                                                      </div>
<div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;                <span class="keywordflow">IF</span> (2*isums(j) &gt; nent) <span class="keywordflow">EXIT</span>                                                      </div>
<div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;<span class="keywordflow">            END DO</span>                                                                               </div>
<div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;            amad=real(j-1,mps)</div>
<div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;            <span class="keywordflow">IF</span> (isums(j) &gt; isums(j-1)) amad=amad+real(nent-2*isums(j-1),mps)/real(2*isums(j)-2*isums(j-1),mps)     </div>
<div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;            amad=real(<a class="code" href="namespacempmod.html#a28b6187b715f1b20fe3feab43ec5c109">measbinsize</a>,mps)*amad</div>
<div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;            ij=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,i)                                                    </div>
<div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;            <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a0ba5f44eb369bc3a679cf14f47bbfb80">lunmon</a>,110) <a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>, ij, nent, amed, amad*1.4826, real(<a class="code" href="namespacempmod.html#add5d6ee87f88e926424677b1728576f8">measres</a>(i),mps)                                        </div>
<div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;            <span class="comment">!                                                                                    </span></div>
<div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;            ioff=ioff+<a class="code" href="namespacempmod.html#ac7f7ad5a42a202807247e85e4c92f0dd">measbins</a></div>
<div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;<span class="keywordflow">        END IF</span>                                                                   </div>
<div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160; </div>
<div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;110 <span class="keyword">FORMAT</span>(i5,2i10,3g14.5)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a53bbb2675cd69493efe130814cb9042a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53bbb2675cd69493efe130814cb9042a">&#9670;&nbsp;</a></span>mptwo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">program mptwo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Millepede II main program Pede. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l00553">553</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>

</div>
</div>
<a id="a9c76d03bc0e3c3a55898cf60cf1fbdcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c76d03bc0e3c3a55898cf60cf1fbdcc">&#9670;&nbsp;</a></span>mstart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mstart </td>
          <td>(</td>
          <td class="paramtype">character (len=*), intent(in)&#160;</td>
          <td class="paramname"><em>text</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start of 'module' printout. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l08749">8749</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l08750"></a><span class="lineno"> 8750</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l08751"></a><span class="lineno"> 8751</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacempmod.html#a1282bf03151b92c7170a0cc36659cbdb">textl</a></div>
<div class="line"><a name="l08752"></a><span class="lineno"> 8752</span>&#160; </div>
<div class="line"><a name="l08753"></a><span class="lineno"> 8753</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l08754"></a><span class="lineno"> 8754</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l08755"></a><span class="lineno"> 8755</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ka</div>
<div class="line"><a name="l08756"></a><span class="lineno"> 8756</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: kb</div>
<div class="line"><a name="l08757"></a><span class="lineno"> 8757</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: l</div>
<div class="line"><a name="l08758"></a><span class="lineno"> 8758</span>&#160;    <span class="keywordtype">CHARACTER (LEN=*)</span>, <span class="keywordtype">INTENT(IN)</span>  :: text</div>
<div class="line"><a name="l08759"></a><span class="lineno"> 8759</span>&#160;    <span class="keywordtype">CHARACTER (LEN=16)</span> :: textc</div>
<div class="line"><a name="l08760"></a><span class="lineno"> 8760</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l08761"></a><span class="lineno"> 8761</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l08762"></a><span class="lineno"> 8762</span>&#160;    <span class="keywordflow">DO</span> i=1,74</div>
<div class="line"><a name="l08763"></a><span class="lineno"> 8763</span>&#160;        <a class="code" href="namespacempmod.html#a1282bf03151b92c7170a0cc36659cbdb">textl</a>(i:i)=<span class="stringliteral">&#39;_&#39;</span></div>
<div class="line"><a name="l08764"></a><span class="lineno"> 8764</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l08765"></a><span class="lineno"> 8765</span>&#160;    l=len(text)</div>
<div class="line"><a name="l08766"></a><span class="lineno"> 8766</span>&#160;    ka=(74-l)/2</div>
<div class="line"><a name="l08767"></a><span class="lineno"> 8767</span>&#160;    kb=ka+l-1</div>
<div class="line"><a name="l08768"></a><span class="lineno"> 8768</span>&#160;    <a class="code" href="namespacempmod.html#a1282bf03151b92c7170a0cc36659cbdb">textl</a>(ka:kb)=text(1:l)</div>
<div class="line"><a name="l08769"></a><span class="lineno"> 8769</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l08770"></a><span class="lineno"> 8770</span>&#160;    <span class="keyword">WRITE</span>(*,*) <a class="code" href="namespacempmod.html#a1282bf03151b92c7170a0cc36659cbdb">textl</a></div>
<div class="line"><a name="l08771"></a><span class="lineno"> 8771</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l08772"></a><span class="lineno"> 8772</span>&#160;    textc=text(1:l)//<span class="stringliteral">&#39;-end&#39;</span></div>
<div class="line"><a name="l08773"></a><span class="lineno"> 8773</span>&#160; </div>
<div class="line"><a name="l08774"></a><span class="lineno"> 8774</span>&#160;    <span class="keywordflow">DO</span> i=1,74</div>
<div class="line"><a name="l08775"></a><span class="lineno"> 8775</span>&#160;        <a class="code" href="namespacempmod.html#a1282bf03151b92c7170a0cc36659cbdb">textl</a>(i:i)=<span class="stringliteral">&#39;_&#39;</span></div>
<div class="line"><a name="l08776"></a><span class="lineno"> 8776</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l08777"></a><span class="lineno"> 8777</span>&#160;    l=l+4</div>
<div class="line"><a name="l08778"></a><span class="lineno"> 8778</span>&#160;    ka=(74-l)/2</div>
<div class="line"><a name="l08779"></a><span class="lineno"> 8779</span>&#160;    kb=ka+l-1</div>
<div class="line"><a name="l08780"></a><span class="lineno"> 8780</span>&#160;    <a class="code" href="namespacempmod.html#a1282bf03151b92c7170a0cc36659cbdb">textl</a>(ka:kb)=textc(1:l)</div>
<div class="line"><a name="l08781"></a><span class="lineno"> 8781</span>&#160;    <span class="keywordflow">RETURN</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a13adb5e2fcb06863ccfc03d886edd121"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13adb5e2fcb06863ccfc03d886edd121">&#9670;&nbsp;</a></span>mupdat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mupdat </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), intent(in)&#160;</td>
          <td class="paramname"><em>add</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update element of global matrix. </p>
<p>Add value ADD to matrix element (I,J).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">i</td><td>first index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">j</td><td>second index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">add</td><td>summand </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02977">2977</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160; </div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160; </div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                      :: i</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                      :: j</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(IN)</span>             :: add</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160; </div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: ijadd</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: ia</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: ja</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: ij</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    <span class="keywordflow">IF</span>(i &lt;= 0.OR.j &lt;= 0) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    ia=max(i,j)          <span class="comment">! larger</span></div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    ja=min(i,j)          <span class="comment">! smaller</span></div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    ij=0</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 1) <span class="keywordflow">THEN</span>                  <span class="comment">! full symmetric matrix</span></div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        ij=ja+(ia*ia-ia)/2                <span class="comment">! ISYM index</span></div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        <a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ij)=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ij)+add</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span>             <span class="comment">! sparse symmetric matrix</span></div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;        ij=<a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>(i,j)                     <span class="comment">! inline code requires same time</span></div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        <span class="keywordflow">IF</span> (ij == 0) <span class="keywordflow">RETURN</span>               <span class="comment">! pair is suppressed</span></div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;        <span class="keywordflow">IF</span> (ij &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;            <a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ij)=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ij)+add</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;            <a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(-ij)=<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(-ij)+real(add,mps)</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> &gt;= 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> &gt; 0) <span class="keywordflow">THEN</span>     <span class="comment">! for Cholesky decomposition</span></div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;            <span class="keywordflow">IF</span>(ia &lt;= <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span>   <span class="comment">! variable global parameter</span></div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;                ij=<a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>(ia)-ia+ja</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;                <span class="keywordflow">IF</span>(ia &gt; 1.AND.ij &lt;= <a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>(ia-1)) ij=0</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                <span class="keywordflow">IF</span>(ij /= 0) <a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(ij)=<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(ij)+add</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;                <span class="keywordflow">IF</span>(ij &lt; 0.OR.ij &gt; <span class="keyword">size</span>(<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(23,<span class="stringliteral">&#39;Aborted, bad matrix index&#39;</span>)</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;                    stop <span class="stringliteral">&#39;mupdat: bad index&#39;</span></div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;            <span class="keywordflow">ELSE</span>                  <span class="comment">! Lagrange multiplier</span></div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;                ij=<a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)+(ia-<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>-1)*<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+ja</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;                <span class="keywordflow">IF</span>(ij /= 0) <a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(ij)=<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(ij)+add</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> == 0) <span class="keywordflow">THEN</span>      <span class="comment">! default preconditioner</span></div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;            <span class="keywordflow">IF</span>(ia &lt;= <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span>   <span class="comment">! variable global parameter</span></div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;                <span class="keywordflow">IF</span>(ja == ia) <a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(ia)=<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(ia)+add <span class="comment">! diag</span></div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;            <span class="keywordflow">ELSE</span>                  <span class="comment">! Lagrange multiplier</span></div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;                ij=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+(ia-<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>-1)*<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+ja</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;                <span class="keywordflow">IF</span>(ij /= 0) <a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(ij)=<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>(ij)+add</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;<span class="keywordflow">    END IF</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7ee8fc712707e7a8cafaf374b4a4e348"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ee8fc712707e7a8cafaf374b4a4e348">&#9670;&nbsp;</a></span>mvopen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mvopen </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>lun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character (len=*), intent(in)&#160;</td>
          <td class="paramname"><em>fname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open file. </p>
<p>Evtl. move existing file to ~ version.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">lun</td><td>unit number </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fname</td><td>file name </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l08802">8802</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l08803"></a><span class="lineno"> 8803</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l08804"></a><span class="lineno"> 8804</span>&#160; </div>
<div class="line"><a name="l08805"></a><span class="lineno"> 8805</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l08806"></a><span class="lineno"> 8806</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: l</div>
<div class="line"><a name="l08807"></a><span class="lineno"> 8807</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: lun</div>
<div class="line"><a name="l08808"></a><span class="lineno"> 8808</span>&#160;    <span class="keywordtype">CHARACTER (LEN=*)</span>, <span class="keywordtype">INTENT(IN)</span> :: fname</div>
<div class="line"><a name="l08809"></a><span class="lineno"> 8809</span>&#160;    <span class="keywordtype">CHARACTER (LEN=33)</span> :: nafile</div>
<div class="line"><a name="l08810"></a><span class="lineno"> 8810</span>&#160;    <span class="keywordtype">CHARACTER (LEN=33)</span> :: nbfile</div>
<div class="line"><a name="l08811"></a><span class="lineno"> 8811</span>&#160;    <span class="keywordtype">LOGICAL</span> :: ex</div>
<div class="line"><a name="l08812"></a><span class="lineno"> 8812</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l08813"></a><span class="lineno"> 8813</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l08814"></a><span class="lineno"> 8814</span>&#160;    l=len(fname)</div>
<div class="line"><a name="l08815"></a><span class="lineno"> 8815</span>&#160;    <span class="keywordflow">IF</span>(l &gt; 32) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08816"></a><span class="lineno"> 8816</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(17,<span class="stringliteral">&#39;Aborted, file name too long&#39;</span>)</div>
<div class="line"><a name="l08817"></a><span class="lineno"> 8817</span>&#160;        stop <span class="stringliteral">&#39;File name too long                    &#39;</span></div>
<div class="line"><a name="l08818"></a><span class="lineno"> 8818</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l08819"></a><span class="lineno"> 8819</span>&#160;    nafile=fname</div>
<div class="line"><a name="l08820"></a><span class="lineno"> 8820</span>&#160;    nafile(l+1:l+1)=<span class="stringliteral">&#39;~&#39;</span></div>
<div class="line"><a name="l08821"></a><span class="lineno"> 8821</span>&#160; </div>
<div class="line"><a name="l08822"></a><span class="lineno"> 8822</span>&#160;    <span class="keyword">INQUIRE</span>(file=nafile(1:l),exist=ex)</div>
<div class="line"><a name="l08823"></a><span class="lineno"> 8823</span>&#160;    <span class="keywordflow">IF</span>(ex) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08824"></a><span class="lineno"> 8824</span>&#160;        <span class="keyword">INQUIRE</span>(file=nafile(1:l+1),exist=ex)</div>
<div class="line"><a name="l08825"></a><span class="lineno"> 8825</span>&#160;        <span class="keywordflow">IF</span>(ex) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08826"></a><span class="lineno"> 8826</span>&#160;            <span class="keyword">CALL </span>system(<span class="stringliteral">&#39;rm &#39;</span>//nafile)</div>
<div class="line"><a name="l08827"></a><span class="lineno"> 8827</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08828"></a><span class="lineno"> 8828</span>&#160;        nbfile=nafile</div>
<div class="line"><a name="l08829"></a><span class="lineno"> 8829</span>&#160;        nafile(l+1:l+1)=<span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l08830"></a><span class="lineno"> 8830</span>&#160;        <span class="keyword">CALL </span>system(<span class="stringliteral">&#39;mv &#39;</span>//nafile//nbfile)</div>
<div class="line"><a name="l08831"></a><span class="lineno"> 8831</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l08832"></a><span class="lineno"> 8832</span>&#160;    <span class="keyword">OPEN</span>(unit=lun,file=fname)</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae7da13e1cf0da04c46d9c36048880219"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7da13e1cf0da04c46d9c36048880219">&#9670;&nbsp;</a></span>mvsolv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mvsolv </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), dimension(n), intent(in)&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mpd), dimension(n), intent(out)&#160;</td>
          <td class="paramname"><em>y</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Solution for finite band width preconditioner. </p>
<p>Used by <a class="el" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">MINRES</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>size of vectors </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>rhs vector </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">y</td><td>result vector </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l06599">6599</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160; </div>
<div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160; </div>
<div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: n</div>
<div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(IN)</span>  :: x(n)</div>
<div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;<span class="keywordtype">    REAL</span>(mpd), <span class="keywordtype">INTENT(OUT)</span> :: y(n)</div>
<div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;    </div>
<div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;    y=x                    <span class="comment">! copy to output vector</span></div>
<div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160; </div>
<div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#a52d41b509025b261281343ff5b243d3e">equslv</a>(<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(2),<a class="code" href="namespacempmod.html#a6c56088d848e1f4419e9f6c04cc343c6">nprecond</a>(1),<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,<a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>,y)</div>
<div class="ttc" id="ampnum_8f90_html_a52d41b509025b261281343ff5b243d3e"><div class="ttname"><a href="mpnum_8f90.html#a52d41b509025b261281343ff5b243d3e">equslv</a></div><div class="ttdeci">subroutine equslv(n, m, c, india, x)</div><div class="ttdoc">Solution of equilibrium systems (after decomposition).</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l02100">mpnum.f90:2101</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af8565eccdb9c88b8593d9584b2797261"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8565eccdb9c88b8593d9584b2797261">&#9670;&nbsp;</a></span>nufile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer(mpi) function nufile </td>
          <td>(</td>
          <td class="paramtype">character (len=*), intent(inout)&#160;</td>
          <td class="paramname"><em>fname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inquire on file. </p>
<p>Result = 1 for existing binary file, =2 for existing text file, else =0, &lt; 0 open error.</p>
<p>Text file names are recognized by the filename extension, which should contain 'xt' or 'tx'.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fname</td><td>file name, optionaly strip prefix. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l07965">7965</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l07966"></a><span class="lineno"> 7966</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l07967"></a><span class="lineno"> 7967</span>&#160; </div>
<div class="line"><a name="l07968"></a><span class="lineno"> 7968</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l07969"></a><span class="lineno"> 7969</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ios</div>
<div class="line"><a name="l07970"></a><span class="lineno"> 7970</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: l1</div>
<div class="line"><a name="l07971"></a><span class="lineno"> 7971</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ll</div>
<div class="line"><a name="l07972"></a><span class="lineno"> 7972</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nm</div>
<div class="line"><a name="l07973"></a><span class="lineno"> 7973</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: npat</div>
<div class="line"><a name="l07974"></a><span class="lineno"> 7974</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ntext</div>
<div class="line"><a name="l07975"></a><span class="lineno"> 7975</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nuprae</div>
<div class="line"><a name="l07976"></a><span class="lineno"> 7976</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: matint</div>
<div class="line"><a name="l07977"></a><span class="lineno"> 7977</span>&#160; </div>
<div class="line"><a name="l07978"></a><span class="lineno"> 7978</span>&#160;    <span class="keywordtype">CHARACTER (LEN=*)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: fname</div>
<div class="line"><a name="l07979"></a><span class="lineno"> 7979</span>&#160;    <span class="keywordtype">LOGICAL</span> :: ex</div>
<div class="line"><a name="l07980"></a><span class="lineno"> 7980</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l07981"></a><span class="lineno"> 7981</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l07982"></a><span class="lineno"> 7982</span>&#160;    <a class="code" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a>=0</div>
<div class="line"><a name="l07983"></a><span class="lineno"> 7983</span>&#160;    <span class="keywordflow">IF</span>(fname(1:5) == <span class="stringliteral">&#39;rfio:&#39;</span>) nuprae=1</div>
<div class="line"><a name="l07984"></a><span class="lineno"> 7984</span>&#160;    <span class="keywordflow">IF</span>(fname(1:5) == <span class="stringliteral">&#39;dcap:&#39;</span>) nuprae=2</div>
<div class="line"><a name="l07985"></a><span class="lineno"> 7985</span>&#160;    <span class="keywordflow">IF</span>(fname(1:5) == <span class="stringliteral">&#39;root:&#39;</span>) nuprae=3</div>
<div class="line"><a name="l07986"></a><span class="lineno"> 7986</span>&#160;    <span class="keywordflow">IF</span>(nuprae == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07987"></a><span class="lineno"> 7987</span>&#160;        <span class="keyword">INQUIRE</span>(file=fname,iostat=ios,exist=ex)</div>
<div class="line"><a name="l07988"></a><span class="lineno"> 7988</span>&#160;        <span class="keywordflow">IF</span>(ios /= 0) <a class="code" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a>=-abs(ios)</div>
<div class="line"><a name="l07989"></a><span class="lineno"> 7989</span>&#160;        <span class="keywordflow">IF</span>(ios /= 0) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l07990"></a><span class="lineno"> 7990</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(nuprae == 1) <span class="keywordflow">THEN</span>  <span class="comment">! rfio:</span></div>
<div class="line"><a name="l07991"></a><span class="lineno"> 7991</span>&#160;        ll=len(fname)</div>
<div class="line"><a name="l07992"></a><span class="lineno"> 7992</span>&#160;        fname=fname(6:ll)</div>
<div class="line"><a name="l07993"></a><span class="lineno"> 7993</span>&#160;        ex=.true.</div>
<div class="line"><a name="l07994"></a><span class="lineno"> 7994</span>&#160;        <a class="code" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a>=1</div>
<div class="line"><a name="l07995"></a><span class="lineno"> 7995</span>&#160;        <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l07996"></a><span class="lineno"> 7996</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07997"></a><span class="lineno"> 7997</span>&#160;        ex=.true.   <span class="comment">! assume file existence</span></div>
<div class="line"><a name="l07998"></a><span class="lineno"> 7998</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07999"></a><span class="lineno"> 7999</span>&#160;    <span class="keywordflow">IF</span>(ex) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08000"></a><span class="lineno"> 8000</span>&#160;        <a class="code" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a>=1                                   <span class="comment">! binary</span></div>
<div class="line"><a name="l08001"></a><span class="lineno"> 8001</span>&#160;        ll=len(fname)</div>
<div class="line"><a name="l08002"></a><span class="lineno"> 8002</span>&#160;        l1=max(1,ll-3)</div>
<div class="line"><a name="l08003"></a><span class="lineno"> 8003</span>&#160;        nm=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(<span class="stringliteral">&#39;xt&#39;</span>,fname(l1:ll),npat,ntext)</div>
<div class="line"><a name="l08004"></a><span class="lineno"> 8004</span>&#160;        <span class="keywordflow">IF</span>(nm == 2) <a class="code" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a>=2                       <span class="comment">! text</span></div>
<div class="line"><a name="l08005"></a><span class="lineno"> 8005</span>&#160;        <span class="keywordflow">IF</span>(nm &lt; 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08006"></a><span class="lineno"> 8006</span>&#160;            nm=<a class="code" href="mptext_8f90.html#a2caf7b022af31e22cf09e7f587f2237a">matint</a>(<span class="stringliteral">&#39;tx&#39;</span>,fname(l1:ll),npat,ntext)</div>
<div class="line"><a name="l08007"></a><span class="lineno"> 8007</span>&#160;            <span class="keywordflow">IF</span>(nm == 2) <a class="code" href="pede_8f90.html#af8565eccdb9c88b8593d9584b2797261">nufile</a>=2                   <span class="comment">! text</span></div>
<div class="line"><a name="l08008"></a><span class="lineno"> 8008</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l08009"></a><span class="lineno"> 8009</span>&#160;<span class="keywordflow">    END IF</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="af3fdc41dcd29ca7d77db610f59c005ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3fdc41dcd29ca7d77db610f59c005ff">&#9670;&nbsp;</a></span>pechk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine pechk </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>ibuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(out)&#160;</td>
          <td class="paramname"><em>nerr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check Millepede record. </p>
<p>Check integer structure of labels and markers (zeros). Check floats for NaNs.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ibuf</td><td>buffer number </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nerr</td><td>error flags </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02161">2161</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160; </div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="keywordtype">    REAL</span>(mpr8) :: glder</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: is</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ist</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inder</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioff</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isfrst</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: islast</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ja</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jb</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jsp</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nan</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nst</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160; </div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                      :: ibuf</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(OUT)</span>                     :: nerr</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    inder(i)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(i)</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    glder(i)=<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(i)</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    isfrst(ibuf)=<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf)+1</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    islast(ibuf)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf))</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160; </div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    ist=isfrst(ibuf)</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    nst=islast(ibuf)</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    nerr=0</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    is=ist</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    jsp=0</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    outer: <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span>(is &lt; nst)</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        ja=0</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        jb=0</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        inner1: <span class="keywordflow">DO</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;            is=is+1</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;            <span class="keywordflow">IF</span>(is &gt; nst) <span class="keywordflow">EXIT</span> outer</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;            <span class="keywordflow">IF</span>(inder(is) == 0) <span class="keywordflow">EXIT</span> inner1 <span class="comment">! found 1. marker</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="keywordflow">        END DO</span> inner1</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        ja=is</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        inner2: <span class="keywordflow">DO</span></div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;            is=is+1</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;            <span class="keywordflow">IF</span>(is &gt; nst) <span class="keywordflow">EXIT</span> outer</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;            <span class="keywordflow">IF</span>(inder(is) == 0) <span class="keywordflow">EXIT</span> inner2 <span class="comment">! found 2. marker</span></div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;<span class="keywordflow">        END DO</span> inner2</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        jb=is        </div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <span class="keywordflow">IF</span>(ja+1 == jb.AND.glder(jb) &lt; 0.0_mpr8) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;            <span class="comment">!  special data</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;            jsp=jb <span class="comment">! pointer to special data</span></div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;            is=is+nint(-glder(jb),mpi) <span class="comment">! skip NSP words</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;            cycle outer</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="keywordflow">        END IF</span>     </div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span>(inder(is+1) /= 0.AND.is &lt; nst)</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;            is=is+1</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;<span class="keywordflow">    END DO</span> outer</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <span class="keywordflow">IF</span>(is &gt; nst) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        ioff = <a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf)</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;        <span class="keyword">WRITE</span>(*,100) <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(ioff-1), int(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(ioff),mpi)</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;100     <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; PEREAD: record &#39;</span>, i8,<span class="stringliteral">&#39; in file &#39;</span>,i6, <span class="stringliteral">&#39; is broken !!!&#39;</span>)</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;        nerr=nerr+1</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    nan=0</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <span class="keywordflow">DO</span> i=ist, nst</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        <span class="keywordflow">IF</span>(.NOT.(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(i) &lt;= 0.0_mpr8).AND..NOT.(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(i) &gt; 0.0_mpr8)) nan=nan+1</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="keywordflow">IF</span>(nan &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        ioff = <a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf)</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;        <span class="keyword">WRITE</span>(*,101) <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(ioff-1), int(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(ioff),mpi), nan</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;101     <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; PEREAD: record &#39;</span>, i8,<span class="stringliteral">&#39; in file &#39;</span>,i6, <span class="stringliteral">&#39; contains &#39;</span>, i6, <span class="stringliteral">&#39; NaNs !!!&#39;</span>)</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;        nerr= nerr+2</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a16ef8020d3ee5c0aa46a0cb5b1dceba8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16ef8020d3ee5c0aa46a0cb5b1dceba8">&#9670;&nbsp;</a></span>peend()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine peend </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>icode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character (len=*), intent(in)&#160;</td>
          <td class="paramname"><em>cmessage</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print exit code. </p>
<p>Print exit code and message.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">icode</td><td>exit code </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cmessage</td><td>exit massage </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l08889">8889</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l08890"></a><span class="lineno"> 8890</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l08891"></a><span class="lineno"> 8891</span>&#160; </div>
<div class="line"><a name="l08892"></a><span class="lineno"> 8892</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l08893"></a><span class="lineno"> 8893</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: icode</div>
<div class="line"><a name="l08894"></a><span class="lineno"> 8894</span>&#160;    <span class="keywordtype">CHARACTER (LEN=*)</span>, <span class="keywordtype">INTENT(IN)</span> :: cmessage</div>
<div class="line"><a name="l08895"></a><span class="lineno"> 8895</span>&#160; </div>
<div class="line"><a name="l08896"></a><span class="lineno"> 8896</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a7ee8fc712707e7a8cafaf374b4a4e348">mvopen</a>(9,<span class="stringliteral">&#39;millepede.end&#39;</span>)</div>
<div class="line"><a name="l08897"></a><span class="lineno"> 8897</span>&#160;    <span class="keyword">WRITE</span>(9,101) icode, cmessage</div>
<div class="line"><a name="l08898"></a><span class="lineno"> 8898</span>&#160;101 <span class="keyword">FORMAT</span>(1x,i4,3x,a)</div>
<div class="line"><a name="l08899"></a><span class="lineno"> 8899</span>&#160;    <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08900"></a><span class="lineno"> 8900</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="aacd49a512bb96f75b566fa8f2aee605b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacd49a512bb96f75b566fa8f2aee605b">&#9670;&nbsp;</a></span>peprep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine peprep </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>mode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare records. </p>
<p>For global parameters replace label by index (<code>INONE</code>).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mode</td><td>&lt;=0: build index table (INONE) for global variables; <br  />
 &gt;0: use index table, can be parallelized, optional scale errors </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02066">2066</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160; </div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160; </div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span> :: mode</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160; </div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ibuf</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ichunk</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iproc</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isfrst</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: islast</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ist</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ja</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jb</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jsp</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nst</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">PARAMETER</span> :: maxbad = 100 <span class="comment">! max number of bad records with print out</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nbad</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nerr</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inone</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <span class="comment">!$    INTEGER(mpi) :: OMP_GET_THREAD_NUM</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160; </div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160; </div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    isfrst(ibuf)=<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf)+1</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    islast(ibuf)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ibuf))</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160; </div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="keywordflow">IF</span> (mode &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;        ichunk=min((<a class="code" href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">numreadbuffer</a>+<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>-1)/<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a>/32+1,256)</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;        <span class="comment">! parallelize record loop</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        <span class="comment">!$OMP  PARALLEL DO &amp;</span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        <span class="comment">!$OMP   DEFAULT(PRIVATE) &amp;</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="comment">!$OMP   SHARED(numReadBuffer,readBufferPointer,readBufferDataI,readBufferDataD,ICHUNK,iscerr,dscerr) &amp;</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        <span class="comment">!$OMP   SCHEDULE(DYNAMIC,ICHUNK)</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        <span class="keywordflow">DO</span> ibuf=1,<a class="code" href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">numreadbuffer</a> <span class="comment">! buffer for current record</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;            iproc=0</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;            <span class="comment">!$        IPROC=OMP_GET_THREAD_NUM()         ! thread number</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;            ist=isfrst(ibuf)</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;            nst=islast(ibuf)</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;            <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                <span class="keywordflow">IF</span>(jb == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                <span class="keywordflow">DO</span> j=1,ist-jb</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                    <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(jb+j)=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>( <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(jb+j) ) <span class="comment">! translate to index</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                <span class="comment">! scale error ?</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a533455573ccf4370eb5abae3534d4479">iscerr</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                    <span class="keywordflow">IF</span> (jb &lt; ist) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                        <a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(jb) = <a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(jb) * <a class="code" href="namespacempmod.html#a236e2be4ee4bcc945c1fa56101af9ef6">dscerr</a>(1) <span class="comment">! &#39;global&#39; measurement</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                        <a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(jb) = <a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(jb) * <a class="code" href="namespacempmod.html#a236e2be4ee4bcc945c1fa56101af9ef6">dscerr</a>(2) <span class="comment">! &#39;local&#39; measurement</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="keywordflow">                    END IF</span> </div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="keywordflow">                END IF</span>    </div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        <span class="comment">!$OMP  END PARALLEL DO</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160; </div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    <span class="comment">!$POMP INST BEGIN(peprep)</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    <span class="keywordflow">IF</span> (mode &lt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;        nbad=0</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="keywordflow">DO</span> ibuf=1,<a class="code" href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">numreadbuffer</a> <span class="comment">! buffer for current record</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#af3fdc41dcd29ca7d77db610f59c005ff">pechk</a>(ibuf,nerr)</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            <span class="keywordflow">IF</span>(nerr &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                nbad=nbad+1</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                <span class="keywordflow">IF</span>(nbad &gt;= maxbad) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                ist=isfrst(ibuf)</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                nst=islast(ibuf)</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                <span class="keywordflow">DO</span> <span class="comment">! loop over measurements</span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a2660e9144b1f62e900d2d8e2e1e6ba12">isjajb</a>(nst,ist,ja,jb,jsp)</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                    <span class="keywordflow">IF</span>(jb == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                    <span class="keywordflow">DO</span> j=1,ist-jb</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                        <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(jb+j)=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>( <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(jb+j) ) <span class="comment">! translate to index</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="keywordflow">                    END DO</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;        <span class="keywordflow">IF</span>(nbad &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(20,<span class="stringliteral">&#39;Aborted, bad binary records&#39;</span>)</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;            stop <span class="stringliteral">&#39;PEREAD: stopping due to bad records&#39;</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="comment">!$POMP INST END(peprep)</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160; </div>
<div class="ttc" id="apede_8f90_html_af3fdc41dcd29ca7d77db610f59c005ff"><div class="ttname"><a href="pede_8f90.html#af3fdc41dcd29ca7d77db610f59c005ff">pechk</a></div><div class="ttdeci">subroutine pechk(ibuf, nerr)</div><div class="ttdoc">Check Millepede record.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l02161">pede.f90:2162</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a781f6fc2bdd91639f9a943c2b7801d4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a781f6fc2bdd91639f9a943c2b7801d4e">&#9670;&nbsp;</a></span>peread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine peread </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(out)&#160;</td>
          <td class="paramname"><em>more</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read (block of) records from binary files. </p>
<p>Optionally using several threads (each file read by single thread). Records larger than the read buffer (<code>ndimbuf</code>) are skipped. In case of skipped events in the first loop over all binary files the buffer size is adapted to the maximum record size (and the initial loop (<code>LOOP1</code>) is repeated). C binary files are handled by <a class="el" href="readc_8c.html">readc.c</a> and may be gzipped.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">more</td><td>more records to come</td></tr>
  </table>
  </dd>
</dl>
<p>The records consist of parallel integer and real arrays: </p><pre class="fragment">    real array              integer array
1   0.0                     error count (this record)
2   RMEAS, measured value   0                            JA
3   local derivative        index of local derivative
4   local derivative        index of local derivative
5    ...
6   SIGMA, error (&gt;0)       0                            JB
    global derivative       label of global derivative
    global derivative       label of global derivative   IST
    RMEAS, measured value   0
    local derivative        index of local derivative
    local derivative        index of local derivative
    ...
    SIGMA, error            0
    global derivative       label of global derivative
    global derivative       label of global derivative
    ...
NR  global derivative       label of global derivative
</pre> 
<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l01737">1737</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160; </div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iact</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ierrc</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ierrf</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inder</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ioffp</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ios</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ithr</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jfile</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jrec</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: kfile</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: l</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: mpri</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: n</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nact</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nbuf</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ndata</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: noff</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: noffs</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: npointer</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: npri</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nr</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrc</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrd</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrpr</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nthr</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ntot</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: maxRecordSize</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: maxRecordFile</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(OUT)</span>                     :: more</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160; </div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <span class="keywordtype">LOGICAL</span> :: lprint</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="keywordtype">LOGICAL</span> :: floop</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordtype">LOGICAL</span> :: eof</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: ds0</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: ds1</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: ds2</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: dw</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="comment">!$    INTEGER(mpi) :: OMP_GET_THREAD_NUM</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <span class="keywordtype">CHARACTER (LEN=7)</span> :: cfile</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160; </div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    inder(i)=<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(i)</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160; </div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="keyword">DATA</span> lprint/.true./</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="keyword">DATA</span> floop/.true./</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keyword">DATA</span> npri / 0 /, mpri / 1000 /</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a> == 0) <span class="keywordflow">THEN</span>  <span class="comment">! start/restart</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>=0</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        <a class="code" href="namespacempmod.html#abee6ce994385c39f2092df791a95802a">nrecd</a>=0</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        ntot=0</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        <a class="code" href="namespacempmod.html#ae9b4e1a07cdab51403602c58a7375c44">sumrecords</a>=0</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        <a class="code" href="namespacempmod.html#ab5a8c50ef7c6456fd7f4811f22bcb3fc">skippedrecords</a>=0</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        <a class="code" href="namespacempmod.html#acf9a63b8c8fdedd6243ae33a00d8ba2a">numblocks</a>=0</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        <a class="code" href="namespacempmod.html#a5fbf5f0b5af5d89554c1074f9d8ae5bd">minrecordsinblock</a>=<span class="keyword">size</span>(<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>)</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <a class="code" href="namespacempmod.html#a82a7cc9262fb30799b5155b70812223d">maxrecordsinblock</a>=0</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>=0  <span class="comment">! reset management info</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        nrpr=1</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        nthr=<a class="code" href="namespacempmod.html#a77e02ad9f8ae7931e1d6ba63ea2450e8">mthrdr</a></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        nact=0   <span class="comment">! active threads (have something still to read)</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <span class="keywordflow">DO</span> k=1,nthr</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a> &lt; <a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                <a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a>=<a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a>+1</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(1,k)=<a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(2,k)=nact</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                nact=nact+1</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    npointer=<span class="keyword">size</span>(<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>)/nact</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    ndata=<span class="keyword">size</span>(<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>)/nact</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    more=-1</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <span class="keywordflow">DO</span> k=1,nthr</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        iact=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(2,k)</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(4,k)=0                 <span class="comment">! reset counter</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(5,k)=iact*ndata  <span class="comment">! reset offset</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <a class="code" href="namespacempmod.html#acf9a63b8c8fdedd6243ae33a00d8ba2a">numblocks</a>=<a class="code" href="namespacempmod.html#acf9a63b8c8fdedd6243ae33a00d8ba2a">numblocks</a>+1 <span class="comment">! new block</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160; </div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="comment">!$OMP  PARALLEL &amp;</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <span class="comment">!$OMP  DEFAULT(PRIVATE) &amp;</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="comment">!$OMP  SHARED(readBufferInfo,readBufferPointer,readBufferDataI,readBufferDataD, &amp;</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="comment">!$OMP  readBufferDataF,nPointer,nData,skippedRecords,ndimbuf,NTHR,NFILF,FLOOP, &amp;</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="comment">!$OMP        IFD,KFD,IFILE,NFILB,WFD,XFD,icheck,keepOpen) &amp;</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="comment">!$OMP  NUM_THREADS(NTHR)</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160; </div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    ithr=1</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="comment">!$ ITHR=OMP_GET_THREAD_NUM()+1     ! thread number</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    jfile=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(1,ithr)  <span class="comment">! file index</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    iact =<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(2,ithr)  <span class="comment">! active thread number</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    jrec =<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(3,ithr)  <span class="comment">! records read</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    ioffp=iact*npointer</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    noffs=(ithr-1)*<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a>        <span class="comment">! offset for intermediate float buffer</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160; </div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    files: <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span> (jfile &gt; 0)</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        kfile=<a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(2,jfile)</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        <span class="comment">! open again</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">keepopen</a> &lt; 1 .AND. <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(3,ithr) == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aba466fbf4e152b7b0367a5cf63e8311c">binopn</a>(kfile,ithr,ios)</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="keywordflow">        END IF</span>        </div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        records: <span class="keywordflow">DO</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;            nbuf=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(4,ithr)+1</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;            noff=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(5,ithr)+2     <span class="comment">! 2 header words per record</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;            nr=<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;            <span class="keywordflow">IF</span>(kfile &lt;= <a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a>) <span class="keywordflow">THEN</span> <span class="comment">! Fortran file</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                lun=kfile+10</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                <span class="keyword">READ</span>(lun,iostat=ierrf) n,(<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>(noffs+i),i=1,min(n/2,nr)),&amp;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;                    (<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(noff+i),i=1,min(n/2,nr))</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;                nr=n/2</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                <span class="comment">! convert to double</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                <span class="keywordflow">DO</span> i=1,nr</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                    <a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(noff+i)=real(<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>(noffs+i),mpr8)</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                <span class="comment">! IF (ierrf &lt; 0) REWIND lun ! end-of-file ! CHK use binrwd()</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                eof=(ierrf /= 0)</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;            <span class="keywordflow">ELSE</span>         <span class="comment">! C file</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                lun=kfile-<a class="code" href="namespacempmod.html#ad230bf8373d267fde45760392b60a9e6">nfilf</a></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">keepopen</a> &lt; 1) lun=ithr</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="preprocessor">#ifdef READ_C_FILES</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="preprocessor"></span>                <span class="keyword">CALL </span>readc(<a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(noff+1),<a class="code" href="namespacempmod.html#af8b1de9d0e46f662b0f521cffd946954">readbufferdataf</a>(noffs+1),<a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(noff+1),nr,lun,ierrc)</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                n=nr+nr</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                <span class="keywordflow">IF</span> (ierrc &gt; 4) <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(6,ithr)=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(6,ithr)+1</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="preprocessor"></span>                ierrc=0</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="preprocessor"></span>                eof=(ierrc &lt;= 0.AND.ierrc /= -4) <span class="comment">! allow buffer overruns -&gt; skip record</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                <span class="keywordflow">IF</span>(eof.AND.ierrc &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Read error for binary Cfile&#39;</span>, kfile, <span class="stringliteral">&#39;record&#39;</span>, jrec+1, <span class="stringliteral">&#39;:&#39;</span>, ierrc </div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                    <span class="keyword">WRITE</span>(8,*) <span class="stringliteral">&#39;Read error for binary Cfile&#39;</span>, kfile, <span class="stringliteral">&#39;record&#39;</span>, jrec+1, <span class="stringliteral">&#39;:&#39;</span>, ierrc</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &lt;= 0) <span class="keywordflow">THEN</span> <span class="comment">! stop unless &#39;checkinput&#39; mode</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                        <span class="keyword">WRITE</span>(cfile,<span class="stringliteral">&#39;(I7)&#39;</span>) kfile</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(18,<span class="stringliteral">&#39;Aborted, read error(s) for binary file &#39;</span> // cfile)</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                        stop <span class="stringliteral">&#39;PEREAD: stopping due to read errors&#39;</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="keywordflow">                    ENDIF</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;            <span class="keywordflow">IF</span>(eof) <span class="keywordflow">EXIT</span> records   <span class="comment">! end-of-files or error</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160; </div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            jrec=jrec+1</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;            <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(3,ithr)=jrec</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            <span class="keywordflow">IF</span>(floop) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                <a class="code" href="namespacempmod.html#ae87541b854b0ad82a402f5285b2f8226">xfd</a>(jfile)=max(<a class="code" href="namespacempmod.html#ae87541b854b0ad82a402f5285b2f8226">xfd</a>(jfile),n)</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                <span class="keywordflow">IF</span>(ithr == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                    <span class="keyword">CALL </span>hmplnt(1,n)</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                    <span class="keywordflow">IF</span>(inder(noff+1) /= 0) <span class="keyword">CALL </span>hmpent(8,real(inder(noff+1),mps))</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160; </div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            <span class="keywordflow">IF</span> (nr &lt;= <a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(4,ithr)=nbuf</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(5,ithr)=noff+nr</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160; </div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                <a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ioffp+nbuf)=noff       <span class="comment">! pointer to start of buffer</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(noff  )=noff+nr          <span class="comment">! pointer to  end  of buffer</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                <a class="code" href="namespacempmod.html#a8c24e8f929def2780a39d61958f944c0">readbufferdatai</a>(noff-1)=<a class="code" href="namespacempmod.html#a96612c6c1900e9c644f8c112ee6597be">ifd</a>(kfile)+jrec  <span class="comment">! global record number (available with LOOP2)</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                <a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(noff  )=real(kfile,mpr8) <span class="comment">! file number</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                <a class="code" href="namespacempmod.html#a41d697fdc7162d788f2f6a2cd7036163">readbufferdatad</a>(noff-1)=real(<a class="code" href="namespacempmod.html#a6ff460b472eb064eb6eb5604c0ac94af">wfd</a>(kfile),mpr8) <span class="comment">! weight</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160; </div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                <span class="keywordflow">IF</span> ((noff+nr+2+<a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a> &gt;= ndata*(iact+1)).OR.(nbuf &gt;= npointer)) <span class="keywordflow">EXIT</span> files <span class="comment">! buffer full</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                <span class="comment">!$OMP ATOMIC</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                <a class="code" href="namespacempmod.html#ab5a8c50ef7c6456fd7f4811f22bcb3fc">skippedrecords</a>=<a class="code" href="namespacempmod.html#ab5a8c50ef7c6456fd7f4811f22bcb3fc">skippedrecords</a>+1</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                cycle records</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160; </div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="keywordflow">        END DO</span> records</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160; </div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(1,ithr)=-jfile   <span class="comment">! flag eof        </span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">keepopen</a> &lt; 1) <span class="keywordflow">THEN</span> <span class="comment">! close again</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a050daae79bead3c51481f24efcd9be87">bincls</a>(kfile,ithr)</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        <span class="keywordflow">ELSE</span> <span class="comment">! rewind </span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a337ebc7d0fe6a4a5525ef7851cfb2a38">binrwd</a>(kfile)    </div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(1,jfile) == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;            print *, <span class="stringliteral">&#39;PEREAD: file &#39;</span>, kfile, <span class="stringliteral">&#39;read the first time, found&#39;</span>,jrec,<span class="stringliteral">&#39; records&#39;</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;            <a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(1,jfile)=-jrec</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        <span class="comment">!        take next file</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        <span class="comment">!$OMP CRITICAL</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a> &lt; <a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;            <a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a>=<a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a>+1</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;            jrec=0</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;            <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(1,ithr)=<a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;            <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(3,ithr)=jrec</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <span class="comment">!$OMP END CRITICAL</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        jfile=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(1,ithr)</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160; </div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="keywordflow">    END DO</span> files</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="comment">!$OMP END PARALLEL</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="comment">!     compress pointers</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    nrd=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(4,1) <span class="comment">! buffers from 1 .thread</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    <span class="keywordflow">DO</span> k=2,nthr</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        iact =<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(2,k)</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        ioffp=iact*npointer</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        nbuf=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(4,k)</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        <span class="keywordflow">DO</span> l=1,nbuf</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;            <a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(nrd+l)=<a class="code" href="namespacempmod.html#af3ba16780eb459de8bc936aa70d022dd">readbufferpointer</a>(ioffp+l)</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;        nrd=nrd+nbuf</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160; </div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    more=0</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <span class="keywordflow">DO</span> k=1,nthr</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;        jfile=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(1,k)</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        <span class="keywordflow">IF</span> (jfile &gt; 0) <span class="keywordflow">THEN</span> <span class="comment">! no eof yet</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(2,k)=more</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;            more=more+1</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            <span class="comment">! no more files, thread retires</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;            <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(1,k)=0</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;            <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(2,k)=-1</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;            <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(3,k)=0</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;            <a class="code" href="namespacempmod.html#abee6ce994385c39f2092df791a95802a">nrecd</a>=<a class="code" href="namespacempmod.html#abee6ce994385c39f2092df791a95802a">nrecd</a>+<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(6,k)</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;            <a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(6,k)=0</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    <span class="comment">!     record limit ?</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#abebbe378eaef934cd254dbb758556e27">mxrec</a> &gt; 0.AND.(ntot+nrd) &gt;= <a class="code" href="namespacempmod.html#abebbe378eaef934cd254dbb758556e27">mxrec</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;        nrd=<a class="code" href="namespacempmod.html#abebbe378eaef934cd254dbb758556e27">mxrec</a>-ntot</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        more=-1</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        <span class="keywordflow">DO</span> k=1,nthr</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;            jfile=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(1,k)</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;            <span class="keywordflow">IF</span> (jfile &gt; 0) <span class="keywordflow">THEN</span>   <span class="comment">! rewind or close files</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                nrc=<a class="code" href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">readbufferinfo</a>(3,k)</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(1,jfile) == 1) <a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(1,jfile)=-nrc</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                kfile=<a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(2,jfile)</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6db3c468e271deb9fcc570f614c33182">keepopen</a> &lt; 1) <span class="keywordflow">THEN</span> <span class="comment">! close again</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a050daae79bead3c51481f24efcd9be87">bincls</a>(kfile,k)</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                <span class="keywordflow">ELSE</span> <span class="comment">! rewind</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a337ebc7d0fe6a4a5525ef7851cfb2a38">binrwd</a>(kfile)</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="keywordflow">                END IF</span>               </div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    ntot=ntot+nrd</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>=ntot</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <a class="code" href="namespacempmod.html#a7943c808f797a0e0955edf388eccefd7">numreadbuffer</a>=nrd</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160; </div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    <a class="code" href="namespacempmod.html#ae9b4e1a07cdab51403602c58a7375c44">sumrecords</a>=<a class="code" href="namespacempmod.html#ae9b4e1a07cdab51403602c58a7375c44">sumrecords</a>+nrd</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <a class="code" href="namespacempmod.html#a5fbf5f0b5af5d89554c1074f9d8ae5bd">minrecordsinblock</a>=min(<a class="code" href="namespacempmod.html#a5fbf5f0b5af5d89554c1074f9d8ae5bd">minrecordsinblock</a>,nrd)</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <a class="code" href="namespacempmod.html#a82a7cc9262fb30799b5155b70812223d">maxrecordsinblock</a>=max(<a class="code" href="namespacempmod.html#a82a7cc9262fb30799b5155b70812223d">maxrecordsinblock</a>,nrd)</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160; </div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span> (<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == 0.AND.ntot &gt;= nrpr)</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; Record &#39;</span>,nrpr</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        <span class="keywordflow">IF</span> (nrpr &lt; 100000) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;            nrpr=nrpr*10</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;            nrpr=nrpr+100000</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160; </div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a> &gt; 0.AND.<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> &lt;= 1.AND. npri &lt; mpri.AND.<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        npri=npri+1</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        <span class="keywordflow">IF</span> (npri == 1) <span class="keyword">WRITE</span>(*,100)</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        <span class="keyword">WRITE</span>(*,101) <a class="code" href="namespacempmod.html#a6f741969fa404307697fa4c882036251">nrec</a>, nrd, more ,<a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;100     <span class="keyword">FORMAT</span>(/<span class="stringliteral">&#39; PeRead        records         active      file&#39;</span>  &amp;</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;            /<span class="stringliteral">&#39;            total     block   threads    number&#39;</span>)</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;101     <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; PeRead&#39;</span>,4i10)</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160; </div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    <span class="keywordflow">IF</span> (more &lt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        <a class="code" href="namespacempmod.html#aaf3638261c09dfeedd95fd4e0306d130">ifile</a>=0</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <span class="keywordflow">IF</span> (floop) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            <span class="comment">!           check for file weights</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;            ds0=0.0_mpd</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;            ds1=0.0_mpd</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;            ds2=0.0_mpd</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;            maxrecordsize=0</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;            maxrecordfile=0</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;            <span class="keywordflow">DO</span> k=1,<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ae87541b854b0ad82a402f5285b2f8226">xfd</a>(k) &gt; maxrecordsize) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                    maxrecordsize=<a class="code" href="namespacempmod.html#ae87541b854b0ad82a402f5285b2f8226">xfd</a>(k)</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                    maxrecordfile=k</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                dw=real(-<a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(1,k),mpd)</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6ff460b472eb064eb6eb5604c0ac94af">wfd</a>(k) /= 1.0) <a class="code" href="namespacempmod.html#a458c83043d826c318e19efc0a43af555">nfilw</a>=<a class="code" href="namespacempmod.html#a458c83043d826c318e19efc0a43af555">nfilw</a>+1</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                ds0=ds0+dw</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                ds1=ds1+dw*real(<a class="code" href="namespacempmod.html#a6ff460b472eb064eb6eb5604c0ac94af">wfd</a>(k),mpd)</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;                ds2=ds2+dw*real(<a class="code" href="namespacempmod.html#a6ff460b472eb064eb6eb5604c0ac94af">wfd</a>(k)**2,mpd)</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            print *, <span class="stringliteral">&#39;PEREAD: file &#39;</span>, maxrecordfile, <span class="stringliteral">&#39;with max record size &#39;</span>, maxrecordsize</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a458c83043d826c318e19efc0a43af555">nfilw</a> &gt; 0.AND.ds0 &gt; 0.0_mpd) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                ds1=ds1/ds0</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;                ds2=ds2/ds0-ds1*ds1</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                <span class="keywordflow">DO</span> lun=6,<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,2</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                    <span class="keyword">WRITE</span>(lun,177) <a class="code" href="namespacempmod.html#a458c83043d826c318e19efc0a43af555">nfilw</a>,real(ds1,mps),real(ds2,mps)</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;177                 <span class="keyword">FORMAT</span>(/<span class="stringliteral">&#39; !!!!!&#39;</span>,i4,<span class="stringliteral">&#39; weighted binary files&#39;</span>,  &amp;</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                        /<span class="stringliteral">&#39; !!!!! mean, variance of weights =&#39;</span>,2g12.4)</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="keywordflow">                END DO</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;            <span class="comment">!           integrate record numbers</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;            <span class="keywordflow">DO</span> k=2,<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                <a class="code" href="namespacempmod.html#a96612c6c1900e9c644f8c112ee6597be">ifd</a>(k)=<a class="code" href="namespacempmod.html#a96612c6c1900e9c644f8c112ee6597be">ifd</a>(k-1)-<a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>(1,k-1)</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;            <span class="comment">!           sort</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;            <span class="keywordflow">IF</span> (nthr &gt; 1) <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#ac95580af88f23895acfc53d125c8928a">sort2k</a>(<a class="code" href="namespacempmod.html#a3852011c11e76a7c89c7932e1d5b506f">kfd</a>,<a class="code" href="namespacempmod.html#a6458e61b82e3761bd069c0370c843575">nfilb</a>)  </div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#ab5a8c50ef7c6456fd7f4811f22bcb3fc">skippedrecords</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;                print *, <span class="stringliteral">&#39;PEREAD skipped records: &#39;</span>, <a class="code" href="namespacempmod.html#ab5a8c50ef7c6456fd7f4811f22bcb3fc">skippedrecords</a></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;                <a class="code" href="namespacempmod.html#a4984f1c03a4dbe4fc004e0fe4cae6793">ndimbuf</a>=maxrecordsize/2 <span class="comment">! adjust buffer size</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        lprint=.false.</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        floop=.false.</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#abe14a8df50c6aa08d3de9f0d74875d2f">ncache</a> &gt; 0.AND.<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> &lt;= 1.AND.<a class="code" href="namespacempmod.html#aa764c242afe782137d163ff94e47fdfa">mprint</a> &gt; 0)  &amp;</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            <span class="keyword">WRITE</span>(*,179) <a class="code" href="namespacempmod.html#acf9a63b8c8fdedd6243ae33a00d8ba2a">numblocks</a>, <a class="code" href="namespacempmod.html#ae9b4e1a07cdab51403602c58a7375c44">sumrecords</a>, <a class="code" href="namespacempmod.html#a5fbf5f0b5af5d89554c1074f9d8ae5bd">minrecordsinblock</a>, <a class="code" href="namespacempmod.html#a82a7cc9262fb30799b5155b70812223d">maxrecordsinblock</a></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;179     <span class="keyword">FORMAT</span>(/<span class="stringliteral">&#39; Read  cache usage (#blocks, #records, &#39;</span>,  &amp;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            <span class="stringliteral">&#39;min,max records/block&#39;</span>/17x,4i10)</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160; </div>
<div class="ttc" id="ampnum_8f90_html_ac95580af88f23895acfc53d125c8928a"><div class="ttname"><a href="mpnum_8f90.html#ac95580af88f23895acfc53d125c8928a">sort2k</a></div><div class="ttdeci">subroutine sort2k(a, n)</div><div class="ttdoc">Quick sort 2.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l01607">mpnum.f90:1608</a></div></div>
<div class="ttc" id="anamespacempmod_html_a1ffb3d8800c25d3af88e6a722c9d5f5d"><div class="ttname"><a href="namespacempmod.html#a1ffb3d8800c25d3af88e6a722c9d5f5d">mpmod::readbufferinfo</a></div><div class="ttdeci">integer(mpi), dimension(:,:), allocatable readbufferinfo</div><div class="ttdoc">buffer management (per thread)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00233">mpmod.f90:233</a></div></div>
<div class="ttc" id="anamespacempmod_html_a5fbf5f0b5af5d89554c1074f9d8ae5bd"><div class="ttname"><a href="namespacempmod.html#a5fbf5f0b5af5d89554c1074f9d8ae5bd">mpmod::minrecordsinblock</a></div><div class="ttdeci">integer(mpi) minrecordsinblock</div><div class="ttdoc">min. records in block</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00163">mpmod.f90:163</a></div></div>
<div class="ttc" id="anamespacempmod_html_a82a7cc9262fb30799b5155b70812223d"><div class="ttname"><a href="namespacempmod.html#a82a7cc9262fb30799b5155b70812223d">mpmod::maxrecordsinblock</a></div><div class="ttdeci">integer(mpi) maxrecordsinblock</div><div class="ttdoc">max. records in block</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00164">mpmod.f90:164</a></div></div>
<div class="ttc" id="anamespacempmod_html_acf9a63b8c8fdedd6243ae33a00d8ba2a"><div class="ttname"><a href="namespacempmod.html#acf9a63b8c8fdedd6243ae33a00d8ba2a">mpmod::numblocks</a></div><div class="ttdeci">integer(mpi) numblocks</div><div class="ttdoc">number of (read) blocks</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00160">mpmod.f90:160</a></div></div>
<div class="ttc" id="anamespacempmod_html_ae9b4e1a07cdab51403602c58a7375c44"><div class="ttname"><a href="namespacempmod.html#ae9b4e1a07cdab51403602c58a7375c44">mpmod::sumrecords</a></div><div class="ttdeci">integer(mpi) sumrecords</div><div class="ttdoc">sum of records</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00161">mpmod.f90:161</a></div></div>
<div class="ttc" id="apede_8f90_html_a337ebc7d0fe6a4a5525ef7851cfb2a38"><div class="ttname"><a href="pede_8f90.html#a337ebc7d0fe6a4a5525ef7851cfb2a38">binrwd</a></div><div class="ttdeci">subroutine binrwd(kfile)</div><div class="ttdoc">Rewind binary file.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l09013">pede.f90:9014</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9a561b65e706ac555980a527a863d5ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a561b65e706ac555980a527a863d5ea">&#9670;&nbsp;</a></span>petime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine petime</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print times. </p>
<p>Print the elapsed and total time. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l08839">8839</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l08840"></a><span class="lineno"> 8840</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l08841"></a><span class="lineno"> 8841</span>&#160; </div>
<div class="line"><a name="l08842"></a><span class="lineno"> 8842</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l08843"></a><span class="lineno"> 8843</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">DIMENSION(2)</span> :: ta</div>
<div class="line"><a name="l08844"></a><span class="lineno"> 8844</span>&#160;<span class="keywordtype">    REAL</span> :: rst</div>
<div class="line"><a name="l08845"></a><span class="lineno"> 8845</span>&#160;<span class="keywordtype">    REAL</span> :: delta</div>
<div class="line"><a name="l08846"></a><span class="lineno"> 8846</span>&#160;<span class="keywordtype">    REAL</span> :: rstp</div>
<div class="line"><a name="l08847"></a><span class="lineno"> 8847</span>&#160;<span class="keywordtype">    REAL</span> :: secnd1</div>
<div class="line"><a name="l08848"></a><span class="lineno"> 8848</span>&#160;<span class="keywordtype">    REAL</span> :: secnd2</div>
<div class="line"><a name="l08849"></a><span class="lineno"> 8849</span>&#160;    <span class="keywordtype">INTEGER</span> :: ncount</div>
<div class="line"><a name="l08850"></a><span class="lineno"> 8850</span>&#160;    <span class="keywordtype">INTEGER</span> :: nhour1</div>
<div class="line"><a name="l08851"></a><span class="lineno"> 8851</span>&#160;    <span class="keywordtype">INTEGER</span> :: minut1</div>
<div class="line"><a name="l08852"></a><span class="lineno"> 8852</span>&#160;    <span class="keywordtype">INTEGER</span> :: nsecd1</div>
<div class="line"><a name="l08853"></a><span class="lineno"> 8853</span>&#160;    <span class="keywordtype">INTEGER</span> :: nhour2</div>
<div class="line"><a name="l08854"></a><span class="lineno"> 8854</span>&#160;    <span class="keywordtype">INTEGER</span> :: minut2</div>
<div class="line"><a name="l08855"></a><span class="lineno"> 8855</span>&#160;    <span class="keywordtype">INTEGER</span> :: nsecd2</div>
<div class="line"><a name="l08856"></a><span class="lineno"> 8856</span>&#160; </div>
<div class="line"><a name="l08857"></a><span class="lineno"> 8857</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l08858"></a><span class="lineno"> 8858</span>&#160;    <span class="keyword">DATA</span> ncount/0/</div>
<div class="line"><a name="l08859"></a><span class="lineno"> 8859</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l08860"></a><span class="lineno"> 8860</span>&#160;    ncount=ncount+1</div>
<div class="line"><a name="l08861"></a><span class="lineno"> 8861</span>&#160;    <span class="keyword">CALL </span>etime(ta,rst)</div>
<div class="line"><a name="l08862"></a><span class="lineno"> 8862</span>&#160;    <span class="keywordflow">IF</span>(ncount &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l08863"></a><span class="lineno"> 8863</span>&#160;        delta=rst</div>
<div class="line"><a name="l08864"></a><span class="lineno"> 8864</span>&#160;        nsecd1=int(delta,<a class="code" href="namespacempdef.html#a3fc26af88c2fce97882db26de5535606">mpi</a>) <span class="comment">! -&gt; integer</span></div>
<div class="line"><a name="l08865"></a><span class="lineno"> 8865</span>&#160;        nhour1=nsecd1/3600</div>
<div class="line"><a name="l08866"></a><span class="lineno"> 8866</span>&#160;        minut1=nsecd1/60-60*nhour1</div>
<div class="line"><a name="l08867"></a><span class="lineno"> 8867</span>&#160;        secnd1=delta-60*(minut1+60*nhour1)</div>
<div class="line"><a name="l08868"></a><span class="lineno"> 8868</span>&#160;        delta=rst-rstp</div>
<div class="line"><a name="l08869"></a><span class="lineno"> 8869</span>&#160;        nsecd2=int(delta,<a class="code" href="namespacempdef.html#a3fc26af88c2fce97882db26de5535606">mpi</a>) <span class="comment">! -&gt; integer</span></div>
<div class="line"><a name="l08870"></a><span class="lineno"> 8870</span>&#160;        nhour2=nsecd2/3600</div>
<div class="line"><a name="l08871"></a><span class="lineno"> 8871</span>&#160;        minut2=nsecd2/60-60*nhour2</div>
<div class="line"><a name="l08872"></a><span class="lineno"> 8872</span>&#160;        secnd2=delta-60*(minut2+60*nhour2)</div>
<div class="line"><a name="l08873"></a><span class="lineno"> 8873</span>&#160;        <span class="keyword">WRITE</span>(*,101) nhour1,minut1,secnd1, nhour2,minut2,secnd2</div>
<div class="line"><a name="l08874"></a><span class="lineno"> 8874</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l08875"></a><span class="lineno"> 8875</span>&#160; </div>
<div class="line"><a name="l08876"></a><span class="lineno"> 8876</span>&#160;    rstp=rst</div>
<div class="line"><a name="l08877"></a><span class="lineno"> 8877</span>&#160;    <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l08878"></a><span class="lineno"> 8878</span>&#160;101 <span class="keyword">FORMAT</span>(i4,<span class="stringliteral">&#39; h&#39;</span>,i3,<span class="stringliteral">&#39; min&#39;</span>,f5.1,<span class="stringliteral">&#39; sec total&#39;</span>,18x,<span class="stringliteral">&#39;elapsed&#39;</span>,  &amp;</div>
<div class="line"><a name="l08879"></a><span class="lineno"> 8879</span>&#160;        i4,<span class="stringliteral">&#39; h&#39;</span>,i3,<span class="stringliteral">&#39; min&#39;</span>,f5.1,<span class="stringliteral">&#39; sec&#39;</span>)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a211a4f852cb64ceb591540c9980b0b1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a211a4f852cb64ceb591540c9980b0b1b">&#9670;&nbsp;</a></span>ploopa()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine ploopa </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>lunp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print title for iteration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">lunp</td><td>unit number </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02736">2736</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160; </div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160; </div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                  :: lunp</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;    <span class="comment">!     ..</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    <span class="keyword">WRITE</span>(lunp,*)   <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;    <span class="keyword">WRITE</span>(lunp,101) <span class="comment">! header line</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;    <span class="keyword">WRITE</span>(lunp,102) <span class="comment">! header line</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;101 <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; it fc&#39;</span>,<span class="stringliteral">&#39;   fcn_value dfcn_exp  slpr costh  iit st&#39;</span>,  &amp;</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;        <span class="stringliteral">&#39; ls  step cutf&#39;</span>,1x,<span class="stringliteral">&#39;rejects hhmmss FMS&#39;</span>)</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;102 <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; -- --&#39;</span>,<span class="stringliteral">&#39; ----------- --------  ---- -----  --- --&#39;</span>,  &amp;</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;        <span class="stringliteral">&#39; -- ----- ----&#39;</span>,1x,<span class="stringliteral">&#39;------- ------ ---&#39;</span>)</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;    <span class="keywordflow">RETURN</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a00d065081954e0f87a892d3aa5e22619"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00d065081954e0f87a892d3aa5e22619">&#9670;&nbsp;</a></span>ploopb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine ploopb </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>lunp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print iteration line. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">lunp</td><td>unit number </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02757">2757</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160; </div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ma</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    <span class="keywordtype">INTEGER</span> :: minut</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nfa</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <span class="keywordtype">INTEGER</span> :: nhour</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrej</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nsecnd</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: ratae</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;<span class="keywordtype">    REAL</span> :: rstb</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: secnd</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: slopes(3)</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: steps(3)</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">DIMENSION(2)</span> :: ta</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160; </div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                  :: lunp</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160; </div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;    <span class="keywordtype">CHARACTER (LEN=4)</span>:: ccalcm(4)</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    <span class="keyword">DATA</span> ccalcm / <span class="stringliteral">&#39; end&#39;</span>,<span class="stringliteral">&#39;   S&#39;</span>, <span class="stringliteral">&#39; F  &#39;</span>,<span class="stringliteral">&#39; FMS&#39;</span> /</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160; </div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;    nrej=<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3)    <span class="comment">! rejects</span></div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    <span class="keywordflow">IF</span>(nrej &gt; 9999999) nrej=9999999</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <span class="keyword">CALL </span>etime(ta,rstb)</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    <a class="code" href="namespacempmod.html#a69d00600354c38e563fe2693492b1a72">deltim</a>=rstb-<a class="code" href="namespacempmod.html#a9d225bf5ad5a9160e3a99feca7b7bd22">rstart</a></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#ad0e1b3c263ba5e50c1a0da7ee9d60864">sechms</a>(<a class="code" href="namespacempmod.html#a69d00600354c38e563fe2693492b1a72">deltim</a>,nhour,minut,secnd) <span class="comment">! time</span></div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    nsecnd=nint(secnd,mpi)</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;        <span class="keyword">WRITE</span>(lunp,103) <a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>,<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>,<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>,  &amp;</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;            <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>,nrej,nhour,minut,nsecnd,ccalcm(<a class="code" href="namespacempmod.html#ac4071e54b5562829dba9c413b93cce82">lcalcm</a>)</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a43ee8b52852b956110d6d504ebf18176">lsinfo</a> == 10) <span class="keywordflow">THEN</span> <span class="comment">! line search skipped</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;            <span class="keyword">WRITE</span>(lunp,105) <a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>,<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>,<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>,<a class="code" href="namespacempmod.html#aafdaf33a39c571aca60be6c0c316b674">delfun</a>,  &amp;</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;                <a class="code" href="namespacempmod.html#ab08ddac93a2ae6e853f4141d4a8dc956">iitera</a>,<a class="code" href="namespacempmod.html#ad3f204db26a5f1baf0ac5c48f1ffcf60">istopa</a>,<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>,nrej,nhour,minut,nsecnd,ccalcm(<a class="code" href="namespacempmod.html#ac4071e54b5562829dba9c413b93cce82">lcalcm</a>)</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;            <span class="keyword">CALL </span><a class="code" href="linesrch_8f90.html#a0f5aa61e120727553eeb125290e5b830">ptlopt</a>(nfa,ma,slopes,steps)  <span class="comment">! slopes steps</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;            ratae=max(-99.9,min(99.9,slopes(2)/slopes(1)))</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;            <a class="code" href="namespacempmod.html#aef5a8e458ab79c6ffcf58a0674aebe7f">stepl</a>=steps(2)</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;            <span class="keyword">WRITE</span>(lunp,104) <a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>,<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>,<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>,<a class="code" href="namespacempmod.html#aafdaf33a39c571aca60be6c0c316b674">delfun</a>,ratae,<a class="code" href="namespacempmod.html#a759375d6f5401f1c45fc915024774010">angras</a>,  &amp;</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;                <a class="code" href="namespacempmod.html#ab08ddac93a2ae6e853f4141d4a8dc956">iitera</a>,<a class="code" href="namespacempmod.html#ad3f204db26a5f1baf0ac5c48f1ffcf60">istopa</a>,<a class="code" href="namespacempmod.html#a43ee8b52852b956110d6d504ebf18176">lsinfo</a>,<a class="code" href="namespacempmod.html#aef5a8e458ab79c6ffcf58a0674aebe7f">stepl</a>, <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a>,nrej,nhour,minut,nsecnd,ccalcm(<a class="code" href="namespacempmod.html#ac4071e54b5562829dba9c413b93cce82">lcalcm</a>)</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;103 <span class="keyword">FORMAT</span>(i3,i3,e12.5,38x,f5.1, 1x,i7,  i3,i2.2,i2.2,a4)</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;104 <span class="keyword">FORMAT</span>(i3,i3,e12.5,1x,e8.2,f6.3,f6.3,i5,2i3,f6.3,f5.1,  &amp;</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;        1x,i7,  i3,i2.2,i2.2,a4)</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;105 <span class="keyword">FORMAT</span>(i3,i3,e12.5,1x,e8.2,12x,i5,i3,9x,f5.1,  &amp;</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;        1x,i7,  i3,i2.2,i2.2,a4)</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="keywordflow">RETURN</span></div>
<div class="ttc" id="alinesrch_8f90_html_a0f5aa61e120727553eeb125290e5b830"><div class="ttname"><a href="linesrch_8f90.html#a0f5aa61e120727553eeb125290e5b830">ptlopt</a></div><div class="ttdeci">subroutine ptlopt(nf, m, slopes, steps)</div><div class="ttdoc">Get details.</div><div class="ttdef"><b>Definition:</b> <a href="linesrch_8f90_source.html#l00258">linesrch.f90:259</a></div></div>
<div class="ttc" id="anamespacempmod_html_a43ee8b52852b956110d6d504ebf18176"><div class="ttname"><a href="namespacempmod.html#a43ee8b52852b956110d6d504ebf18176">mpmod::lsinfo</a></div><div class="ttdeci">integer(mpi) lsinfo</div><div class="ttdoc">line search: returned information</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00141">mpmod.f90:141</a></div></div>
<div class="ttc" id="anamespacempmod_html_a69d00600354c38e563fe2693492b1a72"><div class="ttname"><a href="namespacempmod.html#a69d00600354c38e563fe2693492b1a72">mpmod::deltim</a></div><div class="ttdeci">real(mps) deltim</div><div class="ttdoc">cpu time difference</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00143">mpmod.f90:143</a></div></div>
<div class="ttc" id="anamespacempmod_html_a9d225bf5ad5a9160e3a99feca7b7bd22"><div class="ttname"><a href="namespacempmod.html#a9d225bf5ad5a9160e3a99feca7b7bd22">mpmod::rstart</a></div><div class="ttdeci">real rstart</div><div class="ttdoc">cpu start time for solution iterations</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00142">mpmod.f90:142</a></div></div>
<div class="ttc" id="anamespacempmod_html_ac4071e54b5562829dba9c413b93cce82"><div class="ttname"><a href="namespacempmod.html#ac4071e54b5562829dba9c413b93cce82">mpmod::lcalcm</a></div><div class="ttdeci">integer(mpi) lcalcm</div><div class="ttdoc">last calclation mode</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00149">mpmod.f90:149</a></div></div>
<div class="ttc" id="anamespacempmod_html_aef5a8e458ab79c6ffcf58a0674aebe7f"><div class="ttname"><a href="namespacempmod.html#aef5a8e458ab79c6ffcf58a0674aebe7f">mpmod::stepl</a></div><div class="ttdeci">real(mps) stepl</div><div class="ttdoc">step length (line search)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00135">mpmod.f90:135</a></div></div>
<div class="ttc" id="apede_8f90_html_ad0e1b3c263ba5e50c1a0da7ee9d60864"><div class="ttname"><a href="pede_8f90.html#ad0e1b3c263ba5e50c1a0da7ee9d60864">sechms</a></div><div class="ttdeci">subroutine sechms(deltat, nhour, minut, secnd)</div><div class="ttdoc">Time conversion.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l04617">pede.f90:4618</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7ab172fc202eaaabcafa19c12a28342e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ab172fc202eaaabcafa19c12a28342e">&#9670;&nbsp;</a></span>ploopc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine ploopc </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>lunp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print sub-iteration line. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">lunp</td><td>unit number </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02813">2813</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160; </div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ma</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: minut</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nfa</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nhour</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrej</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nsecnd</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: ratae</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;<span class="keywordtype">    REAL</span> :: rstb</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: secnd</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: slopes(3)</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: steps(3)</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">DIMENSION(2)</span> :: ta</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160; </div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                  :: lunp</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    <span class="keywordtype">CHARACTER (LEN=4)</span>:: ccalcm(4)</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    <span class="keyword">DATA</span> ccalcm / <span class="stringliteral">&#39; end&#39;</span>,<span class="stringliteral">&#39;   S&#39;</span>, <span class="stringliteral">&#39; F  &#39;</span>,<span class="stringliteral">&#39; FMS&#39;</span> /</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160; </div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    nrej=<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3)    <span class="comment">! rejects</span></div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;    <span class="keywordflow">IF</span>(nrej &gt; 9999999) nrej=9999999</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    <span class="keyword">CALL </span>etime(ta,rstb)</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    <a class="code" href="namespacempmod.html#a69d00600354c38e563fe2693492b1a72">deltim</a>=rstb-<a class="code" href="namespacempmod.html#a9d225bf5ad5a9160e3a99feca7b7bd22">rstart</a></div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#ad0e1b3c263ba5e50c1a0da7ee9d60864">sechms</a>(<a class="code" href="namespacempmod.html#a69d00600354c38e563fe2693492b1a72">deltim</a>,nhour,minut,secnd) <span class="comment">! time</span></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    nsecnd=nint(secnd,mpi)</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a43ee8b52852b956110d6d504ebf18176">lsinfo</a> == 10) <span class="keywordflow">THEN</span> <span class="comment">! line search skipped</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;        <span class="keyword">WRITE</span>(lunp,104) <a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>,<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>,nrej,nhour,minut,nsecnd,ccalcm(<a class="code" href="namespacempmod.html#ac4071e54b5562829dba9c413b93cce82">lcalcm</a>)</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;        <span class="keyword">CALL </span><a class="code" href="linesrch_8f90.html#a0f5aa61e120727553eeb125290e5b830">ptlopt</a>(nfa,ma,slopes,steps)  <span class="comment">! slopes steps</span></div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;        ratae=abs(slopes(2)/slopes(1))</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;        <a class="code" href="namespacempmod.html#aef5a8e458ab79c6ffcf58a0674aebe7f">stepl</a>=steps(2)</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        <span class="keyword">WRITE</span>(lunp,105) <a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>,<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>, ratae,<a class="code" href="namespacempmod.html#a43ee8b52852b956110d6d504ebf18176">lsinfo</a>,  &amp;</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;            <a class="code" href="namespacempmod.html#aef5a8e458ab79c6ffcf58a0674aebe7f">stepl</a>,nrej,nhour,minut,nsecnd,ccalcm(<a class="code" href="namespacempmod.html#ac4071e54b5562829dba9c413b93cce82">lcalcm</a>)</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;104 <span class="keyword">FORMAT</span>(3x,i3,e12.5,9x, 35x, i7,  i3,i2.2,i2.2,a4)</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;105 <span class="keyword">FORMAT</span>(3x,i3,e12.5,9x,     f6.3,14x,i3,f6.3,6x, i7,  i3,i2.2,i2.2,a4)</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="aefcec18b7566f81bf311d769ce42c736"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefcec18b7566f81bf311d769ce42c736">&#9670;&nbsp;</a></span>ploopd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine ploopd </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>lunp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print solution line. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">lunp</td><td>unit number </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l02860">2860</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;    <span class="keywordtype">INTEGER</span> :: minut</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <span class="keywordtype">INTEGER</span> :: nhour</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nsecnd</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;<span class="keywordtype">    REAL</span> :: rstb</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: secnd</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">DIMENSION(2)</span> :: ta</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160; </div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160; </div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                  :: lunp</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    <span class="keywordtype">CHARACTER (LEN=4)</span>:: ccalcm(4)</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    <span class="keyword">DATA</span> ccalcm / <span class="stringliteral">&#39; end&#39;</span>,<span class="stringliteral">&#39;   S&#39;</span>, <span class="stringliteral">&#39; F  &#39;</span>,<span class="stringliteral">&#39; FMS&#39;</span> /</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    <span class="keyword">CALL </span>etime(ta,rstb)</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <a class="code" href="namespacempmod.html#a69d00600354c38e563fe2693492b1a72">deltim</a>=rstb-<a class="code" href="namespacempmod.html#a9d225bf5ad5a9160e3a99feca7b7bd22">rstart</a></div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#ad0e1b3c263ba5e50c1a0da7ee9d60864">sechms</a>(<a class="code" href="namespacempmod.html#a69d00600354c38e563fe2693492b1a72">deltim</a>,nhour,minut,secnd) <span class="comment">! time</span></div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    nsecnd=nint(secnd,mpi)</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160; </div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    <span class="keyword">WRITE</span>(lunp,106) nhour,minut,nsecnd,ccalcm(<a class="code" href="namespacempmod.html#ac4071e54b5562829dba9c413b93cce82">lcalcm</a>)</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;106 <span class="keyword">FORMAT</span>(69x,i3,i2.2,i2.2,a4)</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;    <span class="keywordflow">RETURN</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a05b5198a853192b0d4af53dcade84ae4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05b5198a853192b0d4af53dcade84ae4">&#9670;&nbsp;</a></span>prpcon()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine prpcon</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare constraints. </p>
<p>Count, sort constraints and split into disjoint blocks. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l01243">1243</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: icgb</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isblck</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ilast</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgb</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jcgb</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: label</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: labelf</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: labell</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncon</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: npar</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nconmx</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nparmx</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inone</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itype</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncgbw</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: newlen</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nvar</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: last</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lastlen</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: length</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: rows</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>=0</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    ncgbw=0</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a>=0</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a> == 0) <span class="keywordflow">RETURN</span>  <span class="comment">! no constraints</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160; </div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    newlen=0</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    lastlen=0</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    nvar=-1</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    i=0</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    last=-1</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    itype=0</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="comment">!        find next constraint header and count nr of constraints</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keywordflow">DO</span> <span class="keywordflow">WHILE</span>(i &lt; <a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a>)</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        i=i+1</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        label=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i)%label</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <span class="keywordflow">IF</span>(last == 0.AND.label &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a> &gt; 0 .AND. <a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a>&gt;0) <span class="keyword">WRITE</span>(*,113) <a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>, newlen-lastlen-3, nvar</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;            <span class="keywordflow">IF</span> (nvar == 0) <a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a>=<a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a>+1</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            <span class="keywordflow">IF</span> (nvar == 0 .AND. <a class="code" href="namespacempmod.html#a0da38225092e2c44fe754ce2177a38e6">iskpec</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                <span class="comment">! overwrite</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                newlen=lastlen</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                <span class="comment">! copy previous value (for label 0)</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                newlen=newlen+1</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                <a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(newlen)%value=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i-1)%value</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                lastlen=newlen-1 <span class="comment">! end of last accepted constraint</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            <a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>=<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>+1</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            itype=-label</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="keywordflow">IF</span>(itype == 2) ncgbw=ncgbw+1</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            nvar=0</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        last=label</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        <span class="keywordflow">IF</span>(label &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            itgbi=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(label) <span class="comment">! -&gt; ITGBI= index of parameter label</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            ivgb =<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi) <span class="comment">! -&gt; variable-parameter index</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            <span class="keywordflow">IF</span> (ivgb &gt; 0) nvar=nvar+1</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <span class="keywordflow">IF</span>(label &gt; 0.AND.itype == 2) <span class="keywordflow">THEN</span>  <span class="comment">! weighted constraints</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;            itgbi=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(label) <span class="comment">! -&gt; ITGBI= index of parameter label</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;            <a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i)%value=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i)%value*<a class="code" href="namespacempmod.html#ab83ffab12b6a35c57e98c88dc4829934">globalparcounts</a>(itgbi)</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        newlen=newlen+1</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(newlen)%label=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i)%label <span class="comment">! copy label</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(newlen)%value=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i)%value <span class="comment">! copy value</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a> &gt; 0 .AND. <a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a>&gt;0) <span class="keyword">WRITE</span>(*,113) <a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>, newlen-lastlen-2, nvar</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keywordflow">IF</span> (nvar == 0) <a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a>=<a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a>+1</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keywordflow">IF</span> (nvar == 0 .AND. <a class="code" href="namespacempmod.html#a0da38225092e2c44fe754ce2177a38e6">iskpec</a> &gt; 0) newlen=lastlen</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a>=newlen</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a> &gt; 0 .AND. <a class="code" href="namespacempmod.html#a0da38225092e2c44fe754ce2177a38e6">iskpec</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;PRPCON:&#39;</span>,<a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a>,<span class="stringliteral">&#39; empty constraints skipped&#39;</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        <a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>=<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>-<a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordflow">IF</span> (ncgbw == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;PRPCON:&#39;</span>,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>,<span class="stringliteral">&#39; constraints accepted&#39;</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;PRPCON:&#39;</span>,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>,<span class="stringliteral">&#39; constraints accepted,&#39;</span>,ncgbw, <span class="stringliteral">&#39;weighted&#39;</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="keyword">WRITE</span>(*,*)</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    </div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a> == 0) <span class="keywordflow">RETURN</span>  <span class="comment">! no constraints left</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <span class="comment">! keys and index for sorting of constraints</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    length=<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>+1; rows=3</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>,rows,length,<span class="stringliteral">&#39;keys and index for sorting (I)&#39;</span>)</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>+1)=<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a>+1</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="comment">! start of constraint in list</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>,length,<span class="stringliteral">&#39;start of constraint in list (I)&#39;</span>)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>+1)=<a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a>+1</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">! start and parameter range of constraint blocks </span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>,rows,length,<span class="stringliteral">&#39;start of constraint blocks, par. range (I)&#39;</span>)</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160; </div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="comment">! prepare</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    i=1</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">DO</span> icgb=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="comment">! new constraint </span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb)=i</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(1,icgb)=<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a> <span class="comment">! min variable parameter</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(2,icgb)=0    <span class="comment">! max variable parameter</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        <a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(3,icgb)=icgb <span class="comment">! index</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        i=i+2</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keywordflow">DO</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            label=<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i)%label</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            itgbi=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(label) <span class="comment">! -&gt; ITGBI= index of parameter label</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            ivgb =<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi) <span class="comment">! -&gt; variable-parameter index</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;            <span class="keywordflow">IF</span>(ivgb &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                <a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(1,icgb)=min(<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(1,icgb),ivgb)</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                <a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(2,icgb)=max(<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(2,icgb),ivgb)</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="keywordflow">            END IF</span>    </div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            i=i+1</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;            <span class="keywordflow">IF</span>(i &gt; <a class="code" href="namespacempmod.html#a8fb6c37ed80936c41bb54513f5b8fc28">lenconstraints</a>) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4161819bdd4b40597f39eec350be2e41">listconstraints</a>(i)%label == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    </div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="comment">! sort constraints</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <span class="keyword">call </span><a class="code" href="mpnum_8f90.html#afe21c37313ca7c9b8c16eec2d23c2f1a">sort2i</a>(<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>)</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    </div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="comment">! loop over sorted constraints, try to split into blocks</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>=0</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    nconmx=0</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    nparmx=0</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <a class="code" href="namespacempmod.html#ad32c2d7b939231b33b0be6888bab16ff">mszcon</a>=0</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <a class="code" href="namespacempmod.html#a757ff82bb004a2ac99fc745d44e1dc7c">mszprd</a>=0</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    isblck=1</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    ilast=0</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="keywordflow">DO</span> jcgb=1,<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        <span class="comment">! index in list </span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        icgb=<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(3,jcgb)</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        <span class="comment">! split into disjoint blocks</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        ilast=max(ilast, <a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(2,jcgb))</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;            labelf=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(1,jcgb)))</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            labell=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(2,jcgb)))</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; Cons. sorted&#39;</span>, jcgb, icgb, <a class="code" href="namespacempmod.html#aa78a3bec7bbd9d59a39476c3f2472f13">vecconsstart</a>(icgb), labelf, labell</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="keywordflow">        END IF</span>   </div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(1,jcgb+1) &gt; ilast) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;            <a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>=<a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>+1</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            <a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(1,<a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>)=isblck</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            <a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(2,<a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>)=<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(1,isblck) <span class="comment">! save first parameter in block</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            <a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(3,<a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>)=ilast <span class="comment">! save last parameter in block</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;            ncon=jcgb+1-isblck</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;            npar=ilast+1-<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(1,isblck)</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            nconmx=max(nconmx,ncon)</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;            nparmx=max(nparmx,npar)</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;            <a class="code" href="namespacempmod.html#ad32c2d7b939231b33b0be6888bab16ff">mszcon</a>=<a class="code" href="namespacempmod.html#ad32c2d7b939231b33b0be6888bab16ff">mszcon</a>+ncon*npar          <span class="comment">! (sum of) block size for constraint matrix     </span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;            <a class="code" href="namespacempmod.html#a757ff82bb004a2ac99fc745d44e1dc7c">mszprd</a>=<a class="code" href="namespacempmod.html#a757ff82bb004a2ac99fc745d44e1dc7c">mszprd</a>+(ncon*ncon+ncon)/2 <span class="comment">! (sum of) block size for product matrix     </span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                labelf=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(<a class="code" href="namespacempmod.html#a1e60aa0ce0882db83c26c58578f9c6c3">matconssort</a>(1,isblck)))</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                labell=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(ilast))</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; Cons. block &#39;</span>, <a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>, isblck, jcgb, labelf, labell</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="keywordflow">            ENDIF</span>    </div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            <span class="comment">! reset for new block</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;            isblck=jcgb+1</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <a class="code" href="namespacempmod.html#ad0f4ab2196b482dcb225f864b1990ef0">matconsblocks</a>(1,<a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>+1)=<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>+1</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>+<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="keyword">WRITE</span>(*,*)</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;PRPCON: constraints split into &#39;</span>, <a class="code" href="namespacempmod.html#a7ea61583b25121f0b2a93431b46abe1d">ncblck</a>, <span class="stringliteral">&#39;(disjoint) blocks&#39;</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        max block size (cons., par.) &#39;</span>, nconmx, nparmx</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 0) <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        total block matrix sizes     &#39;</span>, <a class="code" href="namespacempmod.html#ad32c2d7b939231b33b0be6888bab16ff">mszcon</a>, <a class="code" href="namespacempmod.html#a757ff82bb004a2ac99fc745d44e1dc7c">mszprd</a></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="keywordflow">    END IF</span>    </div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;113 <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; constraint&#39;</span>,i6,<span class="stringliteral">&#39; : &#39;</span>,i9,<span class="stringliteral">&#39; parameters,&#39;</span>,i9,<span class="stringliteral">&#39; variable&#39;</span>)</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160; </div>
<div class="ttc" id="ampnum_8f90_html_afe21c37313ca7c9b8c16eec2d23c2f1a"><div class="ttname"><a href="mpnum_8f90.html#afe21c37313ca7c9b8c16eec2d23c2f1a">sort2i</a></div><div class="ttdeci">subroutine sort2i(a, n)</div><div class="ttdoc">Quick sort 2 with index.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l01700">mpnum.f90:1701</a></div></div>
<div class="ttc" id="anamespacempmod_html_aa6d46427d8c8c795ef39fab60abe46d1"><div class="ttname"><a href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">mpmod::ncgbe</a></div><div class="ttdeci">integer(mpi) ncgbe</div><div class="ttdoc">number of empty constraints (no variable parameters)</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00122">mpmod.f90:122</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b13fb17eb0fffb15b9e5b136c22f620"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b13fb17eb0fffb15b9e5b136c22f620">&#9670;&nbsp;</a></span>prtglo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine prtglo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print final log file. </p>
<p>For each global parameter:</p><ul>
<li>label (I10)</li>
<li>parameter value (G14.5)</li>
<li>presigma (G14.5)</li>
<li>difference of parameters values (G14.5)</li>
<li>difference at last iteration (G14.5)</li>
<li>error (standard deviation) (G14.5)</li>
<li>global correlation (F8.3), on request only</li>
<li>Entries from binary files or during iterations </li>
</ul>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l03982">3982</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160; </div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;<span class="keywordtype">    REAL</span>(mps):: dpa</div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;<span class="keywordtype">    REAL</span>(mps):: err</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;<span class="keywordtype">    REAL</span>(mps):: gcor</div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: icount</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ie</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iev</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ij</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: imin</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iprlim</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: isub</div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbl</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbi</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: label</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lup</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;<span class="keywordtype">    REAL</span>(mps):: par</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160; </div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;<span class="keywordtype">    REAL</span>(mpd):: diag</div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::gmati</div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;<span class="keywordtype">    REAL</span>(mpd)::gcor2</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: labele(3)</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>:: ii</div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;<span class="keywordtype">    REAL</span>(mps):: compnt(3)</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160; </div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;    lup=09</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a7ee8fc712707e7a8cafaf374b4a4e348">mvopen</a>(lup,<span class="stringliteral">&#39;millepede.res&#39;</span>)</div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160; </div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;         Result of fit for global parameters&#39;</span></div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;         ===================================&#39;</span></div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160; </div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    <span class="keyword">WRITE</span>(*,101)</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160; </div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;    <span class="keyword">WRITE</span>(lup,*) <span class="stringliteral">&#39;Parameter   ! first 3 elements per line are&#39;</span>,  &amp;</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;        <span class="stringliteral">&#39; significant (if used as input)&#39;</span></div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160; </div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160; </div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;    iprlim=10</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;    <span class="keywordflow">DO</span> itgbi=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a>  <span class="comment">! all parameter variables</span></div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;        itgbl=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,itgbi)</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;        ivgbi=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi)</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        par=real(<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi),mps)      <span class="comment">! initial value</span></div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;        icount=0 <span class="comment">! counts</span></div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;        <span class="keywordflow">IF</span>(ivgbi &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;            icount=<a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>(ivgbi) <span class="comment">! used in last iteration</span></div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;            dpa=real(<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)-<a class="code" href="namespacempmod.html#ade9e2f7c5771cc50bf7aa563f636d46f">globalparstart</a>(itgbi),mps)       <span class="comment">! difference</span></div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1.OR.<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;                ii=ivgbi</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;                ii=(ii*ii+ii)/2</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;                gmati=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ii)</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;                err=sqrt(abs(real(gmati,mps)))</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;                <span class="keywordflow">IF</span>(gmati &lt; 0.0_mpd) err=-err</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;                diag=<a class="code" href="namespacempmod.html#aebe0725175cd12a48bc6ac0f2f0c6c68">workspacediag</a>(ivgbi)</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;                gcor=-1.0</div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;                <span class="keywordflow">IF</span>(gmati*diag &gt; 0.0_mpd) <span class="keywordflow">THEN</span>   <span class="comment">! global correlation</span></div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;                    gcor2=1.0_mpd-1.0_mpd/(gmati*diag)</div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;                    <span class="keywordflow">IF</span>(gcor2 &gt;= 0.0_mpd.AND.gcor2 &lt;= 1.0_mpd) gcor=real(sqrt(gcor2),mps)</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a6ce41cb56c2f370937da667f23b91628">ipcntr</a> &gt; 1) icount=<a class="code" href="namespacempmod.html#ab83ffab12b6a35c57e98c88dc4829934">globalparcounts</a>(itgbi) <span class="comment">! from binary files </span></div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;        <span class="keywordflow">IF</span>(itgbi &lt;= iprlim) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;            <span class="keywordflow">IF</span>(ivgbi &lt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;                <span class="keyword">WRITE</span>(*  ,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps)</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1.OR.<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a69e637868d9cc0b9cadb29e82502df9c">igcorr</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;                        <span class="keyword">WRITE</span>(*,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa,err</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;                    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;                        <span class="keyword">WRITE</span>(*,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa,err,gcor</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;                    <span class="keyword">WRITE</span>(*,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa</div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(itgbi == iprlim+1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;            <span class="keyword">WRITE</span>(*  ,*) <span class="stringliteral">&#39;... (further printout suppressed, but see log file)&#39;</span></div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160; </div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;        <span class="comment">!      file output</span></div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;        <span class="keywordflow">IF</span>(ivgbi &lt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6ce41cb56c2f370937da667f23b91628">ipcntr</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;                <span class="keyword">WRITE</span>(lup,110) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),icount</div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;                <span class="keyword">WRITE</span>(lup,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps)</div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;<span class="keywordflow">            END IF</span>               </div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1.OR.<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6ce41cb56c2f370937da667f23b91628">ipcntr</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;                    <span class="keyword">WRITE</span>(lup,112) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa,err,icount            </div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a69e637868d9cc0b9cadb29e82502df9c">igcorr</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;                    <span class="keyword">WRITE</span>(lup,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa,err,gcor</div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;                    <span class="keyword">WRITE</span>(lup,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa,err</div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a6ce41cb56c2f370937da667f23b91628">ipcntr</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;                    <span class="keyword">WRITE</span>(lup,111) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa,icount</div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;                    <span class="keyword">WRITE</span>(lup,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;<span class="keywordflow">                END IF</span>    </div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;    rewind lup</div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;    <span class="keyword">CLOSE</span>(unit=lup)</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160; </div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span>        <span class="comment">! diagonalisation: write eigenvectors</span></div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a7ee8fc712707e7a8cafaf374b4a4e348">mvopen</a>(lup,<span class="stringliteral">&#39;millepede.eve&#39;</span>)</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;        imin=1</div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;        <span class="keywordflow">DO</span> i=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,1,-1</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i) &gt; 0.0_mpd) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;                imin=i          <span class="comment">! index of smallest pos. eigenvalue</span></div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;                <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;        iev=0</div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;  </div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;        <span class="keywordflow">DO</span> isub=0,min(15,imin-1)</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;            <span class="keywordflow">IF</span>(isub &lt; 10) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;                i=imin-isub</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;                i=isub-9</div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;    </div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;            <span class="comment">!        DO I=IMIN,MAX(1,IMIN-9),-1    ! backward loop, up to 10 vectors</span></div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Eigenvector &#39;</span>,i,<span class="stringliteral">&#39; with eigenvalue&#39;</span>,<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i)</div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;            <span class="keyword">WRITE</span>(lup,*) <span class="stringliteral">&#39;Eigenvector &#39;</span>,i,<span class="stringliteral">&#39; with eigenvalue&#39;</span>,<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>(i)</div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;            <span class="keywordflow">DO</span> j=1,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;                ij=j+(i-1)*<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>      <span class="comment">! index with eigenvector array</span></div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;                <span class="keywordflow">IF</span>(j &lt;= <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;                    itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(j)</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;                    label=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,itgbi)</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;                    label=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>-j             <span class="comment">! label negative for constraints</span></div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;                iev=iev+1</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;                labele(iev)=label</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;                compnt(iev)=real(<a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>(ij),mps)    <span class="comment">! component</span></div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;                <span class="keywordflow">IF</span>(iev == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;                    <span class="keyword">WRITE</span>(lup,103) (labele(ie),compnt(ie),ie=1,iev)</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;                    iev=0</div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;            <span class="keywordflow">IF</span>(iev /= 0) <span class="keyword">WRITE</span>(lup,103) (labele(ie),compnt(ie),ie=1,iev)</div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;            iev=0</div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;            <span class="keyword">WRITE</span>(lup,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;  </div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160; </div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;101 <span class="keyword">FORMAT</span>(1x,<span class="stringliteral">&#39;    label       parameter      presigma        differ&#39;</span>,  &amp;</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;        <span class="stringliteral">&#39;         error&#39;</span>/ 1x,<span class="stringliteral">&#39;-----------&#39;</span>,4x,4(<span class="stringliteral">&#39;-------------&#39;</span>))</div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;102 <span class="keyword">FORMAT</span>(i10,2x,4g14.5,f8.3)</div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;103 <span class="keyword">FORMAT</span>(3(i11,f11.7,2x))</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;110 <span class="keyword">FORMAT</span>(i10,2x,2g14.5,28x,i12)</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;111 <span class="keyword">FORMAT</span>(i10,2x,3g14.5,14x,i12)</div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;112 <span class="keyword">FORMAT</span>(i10,2x,4g14.5,i12)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a55905c06a76e1e5c575cee7f55f244fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55905c06a76e1e5c575cee7f55f244fb">&#9670;&nbsp;</a></span>prtstat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine prtstat</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print input statistic. </p>
<p>For each global parameter:</p><ul>
<li>label (I10)</li>
<li>parameter value (G14.5)</li>
<li>presigma (G14.5)</li>
<li>difference of parameters values (G14.5), = 0.</li>
<li>Entries from binary files </li>
</ul>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04162">4162</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160; </div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;<span class="keywordtype">    REAL</span>(mps):: par</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;<span class="keywordtype">    REAL</span>(mps):: presig</div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: icount</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbl</div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbi</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lup</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncon</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160; </div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160; </div>
<div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;    lup=09</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a7ee8fc712707e7a8cafaf374b4a4e348">mvopen</a>(lup,<span class="stringliteral">&#39;millepede.res&#39;</span>)</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;    <span class="keyword">WRITE</span>(lup,*) <span class="stringliteral">&#39;*** Results of checking input only, no solution performed ***&#39;</span></div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;    <span class="keyword">WRITE</span>(lup,*) <span class="stringliteral">&#39;! fixed-1: by pre-sigma, -2: by entries cut, -3: by iterated entries cut&#39;</span></div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;    <span class="keyword">WRITE</span>(lup,*) <span class="stringliteral">&#39;!      Label       Value     Pre-sigma         Entries Constraints  Status &#39;</span></div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;    <span class="comment">!iprlim=10</span></div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;    <span class="keywordflow">DO</span> itgbi=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a>  <span class="comment">! all parameter variables</span></div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;        itgbl=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,itgbi)</div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;        ivgbi=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi)</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;        par=real(<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi),mps)      <span class="comment">! initial value</span></div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;        presig=real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps) <span class="comment">! initial presigma</span></div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;        icount=<a class="code" href="namespacempmod.html#ab83ffab12b6a35c57e98c88dc4829934">globalparcounts</a>(itgbi) <span class="comment">! from binary files</span></div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;        ncon=<a class="code" href="namespacempmod.html#af4b661118569bdd0c6776a5f76dbf8c0">globalparcons</a>(itgbi) <span class="comment">! number of active constraints</span></div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160; </div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;        <span class="keywordflow">IF</span> (ivgbi &lt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;            <span class="keyword">WRITE</span>(lup,110) itgbl,par,presig,icount,ncon,ivgbi</div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;            <span class="keyword">WRITE</span>(lup,111) itgbl,par,presig,icount,ncon</div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;    <span class="comment">! appearance statistics</span></div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a3a46c2c458b2d5934aef13d8b80fa540">icheck</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;        <span class="keyword">WRITE</span>(lup,*) <span class="stringliteral">&#39;! &#39;</span></div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;        <span class="keyword">WRITE</span>(lup,*) <span class="stringliteral">&#39;! Appearance statistics &#39;</span></div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;        <span class="keyword">WRITE</span>(lup,*) <span class="stringliteral">&#39;!      Label  First file and record  Last file and record   #files  #paired-par&#39;</span></div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;        <span class="keywordflow">DO</span> itgbi=1,<a class="code" href="namespacempmod.html#a750f7431a207d867d6bc87919933e86d">ntgb</a></div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;            <span class="keyword">WRITE</span>(lup,112) <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,itgbi), (<a class="code" href="namespacempmod.html#ae44d9ec64cc3d6783bf91e63e9f61435">appearancecounter</a>(itgbi*5+k), k=-4,0), <a class="code" href="namespacempmod.html#a46bd7a6037c5d52224f22143b1f0ee02">paircounter</a>(itgbi)</div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;    rewind lup</div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;    <span class="keyword">CLOSE</span>(unit=lup)</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160; </div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;110 <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; ! &#39;</span>,i10,2x,2g14.5,2i12,<span class="stringliteral">&#39;  fixed&#39;</span>,i2)</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;111 <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; ! &#39;</span>,i10,2x,2g14.5,2i12,<span class="stringliteral">&#39;  variable&#39;</span>)</div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;112 <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; !.&#39;</span>,i10,6i11)</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad0e1b3c263ba5e50c1a0da7ee9d60864"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0e1b3c263ba5e50c1a0da7ee9d60864">&#9670;&nbsp;</a></span>sechms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine sechms </td>
          <td>(</td>
          <td class="paramtype">real(mps), intent(in)&#160;</td>
          <td class="paramname"><em>deltat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(out)&#160;</td>
          <td class="paramname"><em>nhour</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(mpi), intent(out)&#160;</td>
          <td class="paramname"><em>minut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(mps), intent(out)&#160;</td>
          <td class="paramname"><em>secnd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Time conversion. </p>
<p>Convert from seconds to hours, minues, seconds</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">deltat</td><td>time in seconds </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nhour</td><td>hours </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">minut</td><td>minutes </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">secnd</td><td>seconds </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04617">4617</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdef.html">mpdef</a></div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160; </div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;<span class="keywordtype">    REAL</span>(mps), <span class="keywordtype">INTENT(IN)</span> :: deltat</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(OUT)</span> :: minut</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(OUT)</span>:: nhour</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;<span class="keywordtype">    REAL</span>(mps), <span class="keywordtype">INTENT(OUT)</span>:: secnd</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nsecd</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    <span class="comment">!     DELTAT = time in sec  -&gt; NHOUR,MINUT,SECND</span></div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;    nsecd=nint(deltat,<a class="code" href="namespacempdef.html#a3fc26af88c2fce97882db26de5535606">mpi</a>) <span class="comment">! -&gt; integer</span></div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    nhour=nsecd/3600</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;    minut=nsecd/60-60*nhour</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    secnd=deltat-60*(minut+60*nhour)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a43640e5d5710aee16e26f464a8d91db6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43640e5d5710aee16e26f464a8d91db6">&#9670;&nbsp;</a></span>solglo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine solglo </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>ivgbi</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Error for single global parameter from <a class="el" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">MINRES</a>. </p>
<p>Calculate single row 'x_i' from inverse matrix by solving A*x_i=b with b=0 except b_i=1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ivgbi</td><td>index of variable parameter </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l00978">978</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespaceminresmodule.html">minresmodule</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">minres</a></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160; </div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: par</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: dpa</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: err</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: gcor2</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iph</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: istop</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbl</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itn</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itnlim</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nout</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                      :: ivgbi</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: shift</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rtol</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: anorm</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: acond</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: arnorm</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rnorm</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: ynorm</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: gmati</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: diag</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ijadd</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: jk</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ii</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordtype">LOGICAL</span> :: checka</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordtype">EXTERNAL</span> <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a>, <a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keyword">DATA</span> iph/0/</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keywordflow">IF</span>(iph == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        iph=1</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keyword">WRITE</span>(*,101)</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(ivgbi)</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    itgbl=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,itgbi)</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160; </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>=0.0_mpd <span class="comment">! reset rhs vector IGVEC</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(ivgbi)=1.0_mpd</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="comment">!      NOUT  =6</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    nout  =0</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    itnlim=200</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    shift =0.0_mpd</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    rtol  = <a class="code" href="namespacempmod.html#a83a4e54644058ec927f693131a6cc78e">mrestl</a> <span class="comment">! from steering</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    checka=.false.</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> == 0) <span class="keywordflow">THEN</span>           <span class="comment">! default preconditioner</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">minres</a>(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,  <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a>, <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>, shift, checka ,.true. , &amp;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, itnlim, nout, rtol, istop, itn, anorm, acond, rnorm, arnorm, ynorm)</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> &gt; 0) <span class="keywordflow">THEN</span>       <span class="comment">! band matrix preconditioner</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">minres</a>(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,  <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a>, <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>, shift, checka ,.true. , &amp;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, itnlim, nout, rtol, istop, itn, anorm, acond, rnorm, arnorm, ynorm)</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresmodule.html#af74c4ebfeaa33584dabc74a700776cb3">minres</a>(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,  <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a>, <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>, shift, checka ,.false. , &amp;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, itnlim, nout, rtol, istop, itn, anorm, acond, rnorm, arnorm, ynorm)</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160; </div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    par=real(<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi),mps)</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    dpa=real(par-<a class="code" href="namespacempmod.html#ade9e2f7c5771cc50bf7aa563f636d46f">globalparstart</a>(itgbi),mps)</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    gmati=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(ivgbi)</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    err=sqrt(abs(real(gmati,mps)))</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">IF</span>(gmati &lt; 0.0_mpd) err=-err</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 1) <span class="keywordflow">THEN</span> <span class="comment">! normal matrix               ! ???</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        ii=ivgbi</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        jk=(ii*ii+ii)/2</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span> <span class="comment">! sparse matrix</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        jk=<a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>(ivgbi,ivgbi)</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">IF</span> (jk &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        diag=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(jk)</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        diag=real(<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(-jk),mpd)</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    gcor2=real(1.0_mpd-1.0_mpd/(gmati*diag),mps) <span class="comment">! global correlation (squared)</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="keyword">WRITE</span>(*,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa,err,gcor2,itn</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;101 <span class="keyword">FORMAT</span>(1x,<span class="stringliteral">&#39;    label     parameter    presigma      differ&#39;</span>,  &amp;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="stringliteral">&#39;       Error gcor^2   iit&#39;</span>/ 1x,<span class="stringliteral">&#39;---------&#39;</span>,2x,5(<span class="stringliteral">&#39;-----------&#39;</span>),2x,<span class="stringliteral">&#39;----&#39;</span>)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;102 <span class="keyword">FORMAT</span>(i10,2x,4g12.4,f7.4,i6,i4)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a913bbaf83d851f71a5f48ad8beda9579"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a913bbaf83d851f71a5f48ad8beda9579">&#9670;&nbsp;</a></span>solgloqlp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine solgloqlp </td>
          <td>(</td>
          <td class="paramtype">integer(mpi), intent(in)&#160;</td>
          <td class="paramname"><em>ivgbi</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Error for single global parameter from <a class="el" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">MINRES-QLP</a>. </p>
<p>Calculate single row 'x_i' from inverse matrix by solving A*x_i=b with b=0 except b_i=1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ivgbi</td><td>index of variable parameter </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l01074">1074</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespaceminresqlpmodule.html">minresqlpmodule</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlp</a></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: par</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: dpa</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: err</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: gcor2</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iph</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: istop</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbl</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itn</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itnlim</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nout</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160; </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">INTENT(IN)</span>                      :: ivgbi</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: shift</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: rtol</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: mxxnrm</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: trcond</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: gmati</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: diag</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ijadd</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: jk</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ii</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordtype">EXTERNAL</span> <a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, <a class="code" href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a>, <a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keyword">DATA</span> iph/0/</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">IF</span>(iph == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        iph=1</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="keyword">WRITE</span>(*,101)</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(ivgbi)</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    itgbl=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,itgbi)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160; </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>=0.0_mpd <span class="comment">! reset rhs vector IGVEC</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(ivgbi)=1.0_mpd</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160; </div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="comment">!      NOUT  =6</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    nout  =0</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    itnlim=200</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    shift =0.0_mpd</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    rtol  = <a class="code" href="namespacempmod.html#a83a4e54644058ec927f693131a6cc78e">mrestl</a> <span class="comment">! from steering</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    mxxnrm = real(<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>,mpd)/sqrt(epsilon(mxxnrm))</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afe95475aa68062b3b36a6f2355b70583">mrmode</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        trcond = 1.0_mpd/epsilon(trcond) <span class="comment">! only QR</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afe95475aa68062b3b36a6f2355b70583">mrmode</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        trcond = 1.0_mpd <span class="comment">! only QLP</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        trcond = <a class="code" href="namespacempmod.html#a180dbe1de7f777ca5046d679db34c607">mrtcnd</a> <span class="comment">! QR followed by QLP</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; </div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> == 0) <span class="keywordflow">THEN</span>           <span class="comment">! default preconditioner</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlp</a>( n=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>, aprod=<a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, b=<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>,  msolve=<a class="code" href="pede_8f90.html#a0da5fd4f91da94fa7854e0939f5fd075">mcsolv</a>, nout=nout, &amp;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            itnlim=itnlim, rtol=rtol, maxxnorm=mxxnrm, trancond=trcond, &amp;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;            x=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, istop=istop, itn=itn)</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> &gt; 0) <span class="keywordflow">THEN</span>       <span class="comment">! band matrix preconditioner</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlp</a>( n=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>, aprod=<a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, b=<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>,  msolve=<a class="code" href="pede_8f90.html#ae7da13e1cf0da04c46d9c36048880219">mvsolv</a>, nout=nout, &amp;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;            itnlim=itnlim, rtol=rtol, maxxnorm=mxxnrm, trancond=trcond, &amp;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;            x=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, istop=istop, itn=itn)</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceminresqlpmodule.html#ab0e9f6586048493a1e8e01f5f471b2c0">minresqlp</a>( n=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>, aprod=<a class="code" href="pede_8f90.html#ad7828f3b25225915586ac1d5a1a98206">avprod</a>, b=<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>, nout=nout, &amp;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            itnlim=itnlim, rtol=rtol, maxxnorm=mxxnrm, trancond=trcond, &amp;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            x=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, istop=istop, itn=itn)</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160; </div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    par=real(<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi),mps)</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    dpa=real(par-<a class="code" href="namespacempmod.html#ade9e2f7c5771cc50bf7aa563f636d46f">globalparstart</a>(itgbi),mps)</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    gmati=<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(ivgbi)</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    err=sqrt(abs(real(gmati,mps)))</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="keywordflow">IF</span>(gmati &lt; 0.0_mpd) err=-err</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 1) <span class="keywordflow">THEN</span> <span class="comment">! normal matrix               ! ???</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        ii=ivgbi</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        jk=(ii*ii+ii)/2</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span> <span class="comment">! sparse matrix</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        jk=<a class="code" href="pede_8f90.html#a50f66d2e4734adbf982eb00fd98b4765">ijadd</a>(ivgbi,ivgbi)</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keywordflow">IF</span> (jk &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        diag=<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(jk)</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        diag=real(<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>(-jk),mpd)</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    gcor2=real(1.0_mpd-1.0_mpd/(gmati*diag),mps) <span class="comment">! global correlation (squared)</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keyword">WRITE</span>(*,102) itgbl,par,real(<a class="code" href="namespacempmod.html#a86837eb66ab98086bb5dfcc2bdcf31f5">globalparpresigma</a>(itgbi),mps),dpa,err,gcor2,itn</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;101 <span class="keyword">FORMAT</span>(1x,<span class="stringliteral">&#39;    label     parameter    presigma      differ&#39;</span>,  &amp;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="stringliteral">&#39;       Error gcor^2   iit&#39;</span>/ 1x,<span class="stringliteral">&#39;---------&#39;</span>,2x,5(<span class="stringliteral">&#39;-----------&#39;</span>),2x,<span class="stringliteral">&#39;----&#39;</span>)</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;102 <span class="keyword">FORMAT</span>(i10,2x,4g12.4,f7.4,i6,i4)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a44d814f6965ac4c5b4ff7bbcd2cd2a81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44d814f6965ac4c5b4ff7bbcd2cd2a81">&#9670;&nbsp;</a></span>upone()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine upone</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update, redefine hash indices. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l04725">4725</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160; </div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iprime</div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nused</div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;    <span class="keywordtype">LOGICAL</span> :: finalUpdate</div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: oldLength</div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: newLength</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>, <span class="keywordtype">PARAMETER</span> :: two = 2</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: tempArr</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;    finalupdate=(<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-3) == <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1))</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;    <span class="keywordflow">IF</span>(finalupdate) <span class="keywordflow">THEN</span> <span class="comment">! final (cleanup) call</span></div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#ac95580af88f23895acfc53d125c8928a">sort2k</a>(<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>,<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)) <span class="comment">! sort items</span></div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;    <span class="comment">! save old LabelIndex</span></div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;    nused = <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)</div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;    oldlength = <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-0)</div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(temparr,two,oldlength,<span class="stringliteral">&#39;INONE: temp array&#39;</span>)</div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;    temparr(:,1:nused)=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(:,1:nused)</div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>)</div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(<a class="code" href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">globalparhashtable</a>)</div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;    <span class="comment">! create new LabelIndex</span></div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;    newlength = <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-3)</div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>,two,newlength,<span class="stringliteral">&#39;INONE: label &amp; index&#39;</span>)</div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">globalparhashtable</a>,2*newlength,<span class="stringliteral">&#39;INONE: hash pointer&#39;</span>)</div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;    <a class="code" href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">globalparhashtable</a> = 0</div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;    <a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(:,1:nused) = temparr(:,1:nused) <span class="comment">! copy back saved content</span></div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpdealloc.html">mpdealloc</a>(temparr)</div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;    <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-0)=int(newlength,mpi)   <span class="comment">! length of labels/indices</span></div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;    <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-3)=<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)</div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;    <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-4)=<a class="code" href="pede_8f90.html#a7aa3f7f61de11f6e0d2a7dced6d3f69a">iprime</a>(<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-0))          <span class="comment">! prime number &lt; LNDA</span></div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;    <span class="comment">! redefine hash</span></div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;    outer: <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1)</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;        j=1+mod(<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(1,i),<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-4))+<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-0)</div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;        inner: <span class="keywordflow">DO</span></div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;            k=j</div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;            j=<a class="code" href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">globalparhashtable</a>(k)</div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;            <span class="keywordflow">IF</span>(j == 0) <span class="keywordflow">EXIT</span> inner    <span class="comment">! unused hash code</span></div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;            <span class="keywordflow">IF</span>(j == i) cycle outer <span class="comment">! found</span></div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;<span class="keywordflow">        ENDDO</span> inner</div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;        <a class="code" href="namespacempmod.html#a523a4554452c5d2f3701b32fa121569e">globalparhashtable</a>(k)=i</div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;<span class="keywordflow">    END DO</span> outer</div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;    <span class="keywordflow">IF</span>(.NOT.finalupdate) <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160; </div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;    <a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-2)=1       <span class="comment">! set flag to inhibit further updates</span></div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#aaa30cb56ca934b418737a68984572a94">lvllog</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;        <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;        <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;INONE: array reduced to&#39;</span>,newlength,<span class="stringliteral">&#39; words&#39;</span></div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;        <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;INONE:&#39;</span>,<a class="code" href="namespacempmod.html#a4488f6309fa46c9530700bc3a0cfded1">globalparheader</a>(-1),<span class="stringliteral">&#39; items stored.&#39;</span></div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;<span class="keywordflow">    END IF</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeef08c1cf1a5fbab320c7e26af2322c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeef08c1cf1a5fbab320c7e26af2322c7">&#9670;&nbsp;</a></span>vmprep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine vmprep </td>
          <td>(</td>
          <td class="paramtype">integer(mpl), dimension(2), intent(in)&#160;</td>
          <td class="paramname"><em>msize</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare storage for vectors and matrices. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msize</td><td>number of words for storage of global matrix (double, single prec.) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l06034">6034</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempdalc.html">mpdalc</a></div>
<div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160; </div>
<div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ncon</div>
<div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;                         <span class="comment">!</span></div>
<div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span>, <span class="keywordtype">INTENT(IN)</span> :: msize(2)</div>
<div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160; </div>
<div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: length</div>
<div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;    <span class="comment">!                         Vector/matrix storage</span></div>
<div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;    length=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>*<a class="code" href="namespacempmod.html#a5af511204d09bc46ee6cb804dd82bd53">mthrd</a></div>
<div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>,length,<span class="stringliteral">&#39;rhs vector&#39;</span>) <span class="comment">! double precision vector</span></div>
<div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a53fec879e0d94b5a03d6069bfc6e75cf">globalcounter</a>,length,<span class="stringliteral">&#39;rhs counter&#39;</span>) <span class="comment">! integer vector</span></div>
<div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;    <a class="code" href="namespacempmod.html#aeed9062f2928158f93522db257ef3cdc">lenglobalvec</a>=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;    length=<a class="code" href="namespacempmod.html#a637ef67798bd4e1581b22a7a57fbeaba">naeqn</a></div>
<div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a33e7585dc2943d8d4ed1022787a3f5a6">localcorrections</a>,length,<span class="stringliteral">&#39;residual vector of one record&#39;</span>)</div>
<div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;    length=<a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a>*<a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a></div>
<div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ab40ff975fc09d47aee1f14b1f4ffd31f">aux</a>,length,<span class="stringliteral">&#39; local fit scratch array: aux&#39;</span>)</div>
<div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af7d437f9a1210fa3b18c7a1ef5aa8872">vbnd</a>,length,<span class="stringliteral">&#39; local fit scratch array: vbnd&#39;</span>)</div>
<div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a66e389ec7e3ccbcdddec753a6c475f4e">vbdr</a>,length,<span class="stringliteral">&#39; local fit scratch array: vbdr&#39;</span>)</div>
<div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;    length=((<a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a>+1)*<a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a>)/2</div>
<div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#aa0630265e6c1e7890d5ece82c0be46d3">clmat</a>,length,<span class="stringliteral">&#39; local fit matrix: clmat&#39;</span>)</div>
<div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a187fb71e280caea2fc638d5908cebd36">vbk</a>,length,<span class="stringliteral">&#39; local fit scratch array: vbk&#39;</span>)</div>
<div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;    length=<a class="code" href="namespacempmod.html#aaaf5ac98d0ee925f1168ada4b459ec97">nalcn</a></div>
<div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ad7f8ba591d24891c069ddb501393a8be">blvec</a>,length,<span class="stringliteral">&#39; local fit vector: blvec&#39;</span>)</div>
<div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a6469f9da002e9aeb45812d77697b241b">vzru</a>,length,<span class="stringliteral">&#39; local fit scratch array: vzru&#39;</span>)</div>
<div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a8b7034c842a76da7ffa767f2ca4d644a">scdiag</a>,length,<span class="stringliteral">&#39; local fit scratch array: scdiag&#39;</span>)</div>
<div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a289d1542245a5f6ea00ce0892d4f3dd7">scflag</a>,length,<span class="stringliteral">&#39; local fit scratch array: scflag&#39;</span>)</div>
<div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ab93460a465928ec3e6295ac3b9d45792">ibandh</a>,2*length,<span class="stringliteral">&#39; local fit band width hist.: ibandh&#39;</span>)</div>
<div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160; </div>
<div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>,msize(1),<span class="stringliteral">&#39;global matrix (D)&#39;</span> )</div>
<div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a5f258a56ef64706cd0968dec98563b30">globalmatf</a>,msize(2),<span class="stringliteral">&#39;global matrix (F)&#39;</span>)</div>
<div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160; </div>
<div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> &gt;= 3) <span class="keywordflow">THEN</span>                  <span class="comment">! GMRES/MINRES algorithms</span></div>
<div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;        <span class="comment">!        array space is:</span></div>
<div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;        <span class="comment">!           variable-width band matrix or diagonal matrix for parameters</span></div>
<div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;        <span class="comment">!           followed by rectangular matrix for constraints</span></div>
<div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;        <span class="comment">!           followed by symmetric matrix for constraints</span></div>
<div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;        ncon=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>-<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> &gt; 0) <span class="keywordflow">THEN</span>               <span class="comment">! variable-width band matrix</span></div>
<div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;            length=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;            <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>,length,<span class="stringliteral">&#39;pointer-array variable-band matrix&#39;</span>)</div>
<div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;            <span class="keywordflow">DO</span> i=1,min(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)</div>
<div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;                <a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>(i)=(i*i+i)/2           <span class="comment">! increasing number</span></div>
<div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;            <span class="keywordflow">DO</span> i=min(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)+1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;                <a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>(i)=<a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>(i-1)+<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> <span class="comment">! fixed band width</span></div>
<div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;            <span class="keywordflow">DO</span> i=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+1,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>                <span class="comment">! reset</span></div>
<div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;                <a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>(i)=0</div>
<div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;            length=<a class="code" href="namespacempmod.html#abd9c27b5cebd3829dc162bfa810253ef">indprecond</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)+ncon*<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+(ncon*ncon+ncon)/2</div>
<div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;            <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,length,<span class="stringliteral">&#39;variable-band matrix&#39;</span>)</div>
<div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;        <span class="keywordflow">ELSE</span>                               <span class="comment">! default preconditioner</span></div>
<div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;            length=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+ncon*<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>+(ncon*ncon+ncon)/2</div>
<div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;            <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a72b8b49aa1bd9f36f2551c479805d907">matprecond</a>,length,<span class="stringliteral">&#39;default preconditioner matrix&#39;</span>)</div>
<div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160; </div>
<div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160; </div>
<div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;    length=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,length,<span class="stringliteral">&#39;corrections&#39;</span>)      <span class="comment">! double prec corrections</span></div>
<div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160; </div>
<div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ac70f5bd0f41b2449e7aba58fe1be094e">workspaced</a>,length,<span class="stringliteral">&#39;auxiliary array (D1)&#39;</span>)  <span class="comment">! double aux 1</span></div>
<div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a9dd4ee8c48338d92a75678a5158350f6">workspacelinesearch</a>,length,<span class="stringliteral">&#39;auxiliary array (D2)&#39;</span>)  <span class="comment">! double aux 2</span></div>
<div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;    <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af4596bd67153123dc3124aa5067620c3">workspacei</a>, length,<span class="stringliteral">&#39;auxiliary array (I)&#39;</span>)   <span class="comment">! int aux 1</span></div>
<div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160; </div>
<div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#aebe0725175cd12a48bc6ac0f2f0c6c68">workspacediag</a>,length,<span class="stringliteral">&#39;diagonal of global matrix)&#39;</span>)  <span class="comment">! double aux 1</span></div>
<div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;    <span class="comment">!         CALL MEGARR(&#39;t D&#39;,2*NAGB,&#39;auxiliary array&#39;)  ! double aux 8</span></div>
<div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160; </div>
<div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#aebe0725175cd12a48bc6ac0f2f0c6c68">workspacediag</a>,length,<span class="stringliteral">&#39;diagonal of global matrix&#39;</span>)  <span class="comment">! double aux 1</span></div>
<div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a6e11527c10f149a78be81ce2b6a9181f">workspacediagonalization</a>,length,<span class="stringliteral">&#39;auxiliary array (D3)&#39;</span>)  <span class="comment">! double aux 3</span></div>
<div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>,length,<span class="stringliteral">&#39;auxiliary array (D6)&#39;</span>)  <span class="comment">! double aux 6</span></div>
<div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;        length=<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a>*<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>,length,<span class="stringliteral">&#39;(rotation) matrix U&#39;</span>)   <span class="comment">! rotation matrix</span></div>
<div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160; </div>
<div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> &gt;= 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#adddb9f17136f5c963d2680cdf7040823">vecxav</a>,length,<span class="stringliteral">&#39;vector X (AVPROD)&#39;</span>)  <span class="comment">! double aux 1</span></div>
<div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;        <span class="keyword">CALL </span><a class="code" href="interfacempdalc_1_1mpalloc.html">mpalloc</a>(<a class="code" href="namespacempmod.html#af1c41906f834bd434de691c18df074f8">vecbav</a>,length,<span class="stringliteral">&#39;vector B (AVPROD)&#39;</span>)  <span class="comment">! double aux 1</span></div>
<div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160; </div>
<div class="ttc" id="anamespacempmod_html_a9dd4ee8c48338d92a75678a5158350f6"><div class="ttname"><a href="namespacempmod.html#a9dd4ee8c48338d92a75678a5158350f6">mpmod::workspacelinesearch</a></div><div class="ttdeci">real(mpd), dimension(:), allocatable workspacelinesearch</div><div class="ttdoc">workspace line search</div><div class="ttdef"><b>Definition:</b> <a href="mpmod_8f90_source.html#l00196">mpmod.f90:196</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1f814e28cf6765f05543d04194f8d4ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f814e28cf6765f05543d04194f8d4ac">&#9670;&nbsp;</a></span>xloopn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xloopn</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Standard solution algorithm. </p>
<p>Iterative solution. In current iteration calculate: </p><pre class="fragment">ICALCM = +1   Matrix, gradient, Function value &amp; solution
ICALCM =  0   gradient, Function value
ICALCM = -1   solution
ICALCM = -2   end
</pre><p> Solution is obtained by selected method and improved by line search. </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l06632">6632</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160; </div>
<div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: catio</div>
<div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: concu2</div>
<div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;<span class="keywordtype">    REAL</span>(mps) :: concut</div>
<div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">DIMENSION(2)</span> :: ta</div>
<div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iact</div>
<div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: iagain</div>
<div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: idx</div>
<div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: info</div>
<div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ioff</div>
<div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: itgbi</div>
<div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: ivgbi</div>
<div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: jcalcm</div>
<div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: k</div>
<div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: labelg</div>
<div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: litera</div>
<div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lrej</div>
<div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lun</div>
<div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: lunp</div>
<div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: minf</div>
<div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: mrati</div>
<div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nan</div>
<div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nfaci</div>
<div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nloopsol</div>
<div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrati</div>
<div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nrej</div>
<div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: nsol</div>
<div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: inone</div>
<div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160; </div>
<div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: stp</div>
<div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: dratio</div>
<div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: dwmean</div>
<div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: db</div>
<div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: db1</div>
<div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: db2</div>
<div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;<span class="keywordtype">    REAL</span>(mpd) :: dbdot</div>
<div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;    <span class="keywordtype">LOGICAL</span> :: btest</div>
<div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;    <span class="keywordtype">LOGICAL</span> :: warner</div>
<div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;    <span class="keywordtype">LOGICAL</span> :: warners</div>
<div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;    <span class="keywordtype">LOGICAL</span> :: warnerss</div>
<div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;    <span class="keywordtype">LOGICAL</span> :: lsflag</div>
<div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;    <span class="keywordtype">CHARACTER (LEN=7)</span> :: cratio</div>
<div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;    <span class="keywordtype">CHARACTER (LEN=7)</span> :: cfacin</div>
<div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;    <span class="keywordtype">CHARACTER (LEN=7)</span> :: crjrat</div>
<div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;    <span class="keywordtype">EXTERNAL</span> <a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a></div>
<div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;    <span class="keywordtype">SAVE</span></div>
<div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;    <span class="comment">!     ...</span></div>
<div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160; </div>
<div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;    <span class="comment">!     Printout of algorithm for solution and important parameters ------</span></div>
<div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160; </div>
<div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;    lun=<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>                       <span class="comment">! log file</span></div>
<div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a> == 0) <a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>=6</div>
<div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160; </div>
<div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;    <span class="keywordflow">DO</span> lunp=6,<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>-6</div>
<div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;        <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;        <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39;Solution algorithm: &#39;</span></div>
<div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;        <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;=================================================== &#39;</span></div>
<div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;  </div>
<div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;solution method:&#39;</span>,<span class="stringliteral">&#39;matrix inversion&#39;</span></div>
<div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;solution method:&#39;</span>,<span class="stringliteral">&#39;diagonalization&#39;</span></div>
<div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;solution method:&#39;</span>, <span class="stringliteral">&#39;minres (Paige/Saunders)&#39;</span></div>
<div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;solution method:&#39;</span>, <span class="stringliteral">&#39;minres-qlp (Choi/Paige/Saunders)&#39;</span></div>
<div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afe95475aa68062b3b36a6f2355b70583">mrmode</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;                <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;   using QR factorization&#39;</span> <span class="comment">! only QR</span></div>
<div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afe95475aa68062b3b36a6f2355b70583">mrmode</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;                <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;   using QLP factorization&#39;</span> <span class="comment">! only QLP</span></div>
<div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;                <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;   using QR and QLP factorization&#39;</span> <span class="comment">! QR followed by QLP</span></div>
<div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;                <span class="keyword">WRITE</span>(lunp,123) <span class="stringliteral">&#39;transition condition&#39;</span>, <a class="code" href="namespacempmod.html#a180dbe1de7f777ca5046d679db34c607">mrtcnd</a></div>
<div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 5) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;solution method:&#39;</span>,  &amp;</div>
<div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;                <span class="stringliteral">&#39;gmres (generalized minimzation of residuals)&#39;</span></div>
<div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;        <span class="keyword">WRITE</span>(lunp,123) <span class="stringliteral">&#39;convergence limit at Delta F=&#39;</span>,<a class="code" href="namespacempmod.html#abdfc0236851e1d21ba3276e22f9e6b7b">dflim</a></div>
<div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;        <span class="keyword">WRITE</span>(lunp,122) <span class="stringliteral">&#39;maximum number of iterations=&#39;</span>,<a class="code" href="namespacempmod.html#a880fa8e41c4e97b22457dd7d5948085d">mitera</a></div>
<div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;        <a class="code" href="namespacempmod.html#af7338d32712bd5917c14fd665b022354">matrit</a>=min(<a class="code" href="namespacempmod.html#af7338d32712bd5917c14fd665b022354">matrit</a>,<a class="code" href="namespacempmod.html#a880fa8e41c4e97b22457dd7d5948085d">mitera</a>)</div>
<div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#af7338d32712bd5917c14fd665b022354">matrit</a> &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;            <span class="keyword">WRITE</span>(lunp,122) <span class="stringliteral">&#39;matrix recalculation up to &#39;</span>,<a class="code" href="namespacempmod.html#af7338d32712bd5917c14fd665b022354">matrit</a>, <span class="stringliteral">&#39;. iteration&#39;</span></div>
<div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> &gt;= 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;                <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;matrix storage:&#39;</span>,<span class="stringliteral">&#39;full&#39;</span></div>
<div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1d26fb8a51a9907a0d5b96f7799b2873">matsto</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;                <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;matrix storage:&#39;</span>,<span class="stringliteral">&#39;sparse&#39;</span></div>
<div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;            <span class="keyword">WRITE</span>(lunp,122) <span class="stringliteral">&#39;pre-con band-width parameter=&#39;</span>,<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a></div>
<div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;                <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;pre-conditioning:&#39;</span>,<span class="stringliteral">&#39;default&#39;</span></div>
<div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;                <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;pre-conditioning:&#39;</span>,<span class="stringliteral">&#39;none!&#39;</span></div>
<div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5c18a685730f9b6f5e79316ffb84dd56">mbandw</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a9189aeab6d135186cad819219868dbba">lprecm</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;                    <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;pre-conditioning=&#39;</span>,<span class="stringliteral">&#39;skyline-matrix (rank preserving)&#39;</span></div>
<div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;                    <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;pre-conditioning=&#39;</span>,<span class="stringliteral">&#39;band-matrix&#39;</span></div>
<div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160;<span class="keywordflow">                ENDIF</span></div>
<div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a0f67e1561e3f56675b01c5c884f74c27">regpre</a> == 0.0_mpd.AND.<a class="code" href="namespacempmod.html#ae3b172f60491ca00efdcfd53f982e9c7">npresg</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;using pre-sigmas:&#39;</span>,<span class="stringliteral">&#39;no&#39;</span></div>
<div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160;            <span class="comment">! FIXME: NPRESG contains parameters that failed the &#39;entries&#39; cut...</span></div>
<div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;            <span class="keyword">WRITE</span>(lunp,124) <span class="stringliteral">&#39;pre-sigmas defined for&#39;</span>,  &amp;</div>
<div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160;<span class="keywordtype">                REAL</span>(100*npresg,mps)/<span class="keywordtype">REAL(nvgb,mps)</span>,<span class="stringliteral">&#39; % of variable parameters&#39;</span></div>
<div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;            <span class="keyword">WRITE</span>(lunp,123) <span class="stringliteral">&#39;default pre-sigma=&#39;</span>,<a class="code" href="namespacempmod.html#a0f67e1561e3f56675b01c5c884f74c27">regpre</a></div>
<div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a4472993490c1aa3dff36e977d033b16b">nregul</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;regularization:&#39;</span>,<span class="stringliteral">&#39;no&#39;</span></div>
<div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;regularization:&#39;</span>,<span class="stringliteral">&#39;yes&#39;</span></div>
<div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;            <span class="keyword">WRITE</span>(lunp,123) <span class="stringliteral">&#39;regularization factor=&#39;</span>,<a class="code" href="namespacempmod.html#a4e5959808432f81b874e1293d55c3f0a">regula</a></div>
<div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;  </div>
<div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> /= 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;Chi square cut equiv 3 st.dev applied&#39;</span></div>
<div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;            <span class="keyword">WRITE</span>(lunp,123) <span class="stringliteral">&#39;... in first iteration with factor&#39;</span>,<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a></div>
<div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;            <span class="keyword">WRITE</span>(lunp,123) <span class="stringliteral">&#39;... in second iteration with factor&#39;</span>,<a class="code" href="namespacempmod.html#a35bd9aa2a4c5b99227310b10bf934cc3">chirem</a></div>
<div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39; (reduced by sqrt in next iterations)&#39;</span></div>
<div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a533455573ccf4370eb5abae3534d4479">iscerr</a> &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;            <span class="keyword">WRITE</span>(lunp,121) <span class="stringliteral">&#39;Scaling of measurement errors applied&#39;</span></div>
<div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160;            <span class="keyword">WRITE</span>(lunp,123) <span class="stringliteral">&#39;... factor for &quot;global&quot; measuements&#39;</span>,<a class="code" href="namespacempmod.html#a236e2be4ee4bcc945c1fa56101af9ef6">dscerr</a>(1)</div>
<div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160;            <span class="keyword">WRITE</span>(lunp,123) <span class="stringliteral">&#39;... factor for &quot;local&quot;  measuements&#39;</span>,<a class="code" href="namespacempmod.html#a236e2be4ee4bcc945c1fa56101af9ef6">dscerr</a>(2)</div>
<div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;<span class="keywordflow">        END IF</span> </div>
<div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160;            <span class="keyword">WRITE</span>(lunp,122) <span class="stringliteral">&#39;Down-weighting of outliers in&#39;</span>, <a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a>,<span class="stringliteral">&#39; iterations&#39;</span></div>
<div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160;            <span class="keyword">WRITE</span>(lunp,123) <span class="stringliteral">&#39;Cut on downweight fraction&#39;</span>,<a class="code" href="namespacempmod.html#a5e0286590b4d042e8d883ffa7aa82726">dwcut</a></div>
<div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160;  </div>
<div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;  </div>
<div class="line"><a name="l06771"></a><span class="lineno"> 6771</span>&#160;121     <span class="keyword">FORMAT</span>(1x,a40,3x,a)</div>
<div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160;122     <span class="keyword">FORMAT</span>(1x,a40,3x,i0,a)</div>
<div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;123     <span class="keyword">FORMAT</span>(1x,a40,2x,e9.2)</div>
<div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160;124     <span class="keyword">FORMAT</span>(1x,a40,3x,f5.1,a)</div>
<div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160; </div>
<div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160;    <span class="comment">!     initialization of iterations -------------------------------------</span></div>
<div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160; </div>
<div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;    <a class="code" href="namespacempmod.html#ab08ddac93a2ae6e853f4141d4a8dc956">iitera</a>=0</div>
<div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;    nsol  =0                  <span class="comment">! counter for solutions</span></div>
<div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160;    info  =0</div>
<div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;    <a class="code" href="namespacempmod.html#a43ee8b52852b956110d6d504ebf18176">lsinfo</a>=0</div>
<div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;    stp   =0.0_mpd</div>
<div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;    <a class="code" href="namespacempmod.html#aef5a8e458ab79c6ffcf58a0674aebe7f">stepl</a> =real(stp,mps)</div>
<div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;    concut=1.0e-12            <span class="comment">! initial constraint accuracy</span></div>
<div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;    concu2=1.0e-06            <span class="comment">! constraint accuracy</span></div>
<div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;    <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=1                  <span class="comment">! require matrix calculation</span></div>
<div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;    <a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>=0                  <span class="comment">! iteration counter</span></div>
<div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;    <a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>=-1</div>
<div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;    litera=-2</div>
<div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160;    nloopsol=0                <span class="comment">! (new) solution from this nloopn</span></div>
<div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;    nrej=0                    <span class="comment">! reset number of rejects</span></div>
<div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;        <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.5             <span class="comment">! not accurate</span></div>
<div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;        minf=1</div>
<div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;        <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.5             <span class="comment">! not acurate</span></div>
<div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;        minf=2</div>
<div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;        <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.1             <span class="comment">! accurate</span></div>
<div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;        minf=3</div>
<div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;        <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.1             <span class="comment">! accurate</span></div>
<div class="line"><a name="l06804"></a><span class="lineno"> 6804</span>&#160;        minf=3</div>
<div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 5) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;        <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.1             <span class="comment">! accurate</span></div>
<div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160;        minf=3</div>
<div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160; </div>
<div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;    <span class="comment">!     check initial feasibility of constraint equations ----------------</span></div>
<div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160; </div>
<div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a9adc153c089b03a0bf78f856c789e830">nofeas</a> == 0) <span class="keywordflow">THEN</span>        <span class="comment">! make parameter feasible</span></div>
<div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;        <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;Checking feasibility of parameters:&#39;</span></div>
<div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Checking feasibility of parameters:&#39;</span></div>
<div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#ae0971beb43bf6994f05975fe8638e926">feasib</a>(concut,iact) <span class="comment">! check feasibility</span></div>
<div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;        <span class="keywordflow">IF</span>(iact /= 0) <span class="keywordflow">THEN</span>       <span class="comment">! done ...</span></div>
<div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;            <span class="keyword">WRITE</span>(*,102) concut</div>
<div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;   parameters are made feasible&#39;</span></div>
<div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;            <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,102) concut</div>
<div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;            <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;   parameters are made feasible&#39;</span></div>
<div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160;        <span class="keywordflow">ELSE</span>                     <span class="comment">! ... was OK</span></div>
<div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;   parameters are feasible  (i.e. satisfy constraints)&#39;</span></div>
<div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;            <span class="keyword">WRITE</span>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,*) <span class="stringliteral">&#39;   parameters are feasible  (i.e. satisfy constraints)&#39;</span></div>
<div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;        concut=concu2            <span class="comment">! cut for constraint check</span></div>
<div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;    iact=1                      <span class="comment">! set flag for new data loop</span></div>
<div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160;    <a class="code" href="namespacempmod.html#a9adc153c089b03a0bf78f856c789e830">nofeas</a>=0                    <span class="comment">! set check-feasibility flag</span></div>
<div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160; </div>
<div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;    <span class="keyword">WRITE</span>(*,*)<span class="stringliteral">&#39;Reading files and accumulating vectors/matrices ...&#39;</span></div>
<div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160; </div>
<div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160;    <span class="keyword">CALL </span>etime(ta,<a class="code" href="namespacempmod.html#a9d225bf5ad5a9160e3a99feca7b7bd22">rstart</a>)</div>
<div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;    <a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>=-1</div>
<div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;    litera= 0</div>
<div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;    jcalcm=-1</div>
<div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;    iagain= 0</div>
<div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160; </div>
<div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;    <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=1</div>
<div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160; </div>
<div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;    <span class="comment">!     Block 1: data loop with vector (and matrix) calculation ----------</span></div>
<div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160; </div>
<div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> &gt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;            <a class="code" href="namespacempmod.html#ac4071e54b5562829dba9c413b93cce82">lcalcm</a>=jcalcm+3 <span class="comment">! mode (1..4) of last loop</span></div>
<div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;            <span class="keywordflow">IF</span>(jcalcm+1 /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a211a4f852cb64ceb591540c9980b0b1b">ploopa</a>(6) <span class="comment">! header</span></div>
<div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a00d065081954e0f87a892d3aa5e22619">ploopb</a>(6)</div>
<div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a211a4f852cb64ceb591540c9980b0b1b">ploopa</a>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>) <span class="comment">! iteration line</span></div>
<div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a00d065081954e0f87a892d3aa5e22619">ploopb</a>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>)</div>
<div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;                    <a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>=1</div>
<div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;                    <span class="keyword">CALL </span>gmpxyd(1,real(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>,mps),real(<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>,mps),0.5,0.) <span class="comment">! fcn-value graph (no Delta)</span></div>
<div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160;                    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> /= litera) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06858"></a><span class="lineno"> 6858</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a00d065081954e0f87a892d3aa5e22619">ploopb</a>(6)</div>
<div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;                        <span class="comment">!                  CALL PLOOPA(LUNLOG)</span></div>
<div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a00d065081954e0f87a892d3aa5e22619">ploopb</a>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>)</div>
<div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;                        litera=<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a></div>
<div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;                        <span class="keyword">CALL </span>gmpxyd(1,real(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>,mps),real(<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>,mps),0.5,<a class="code" href="namespacempmod.html#aafdaf33a39c571aca60be6c0c316b674">delfun</a>) <span class="comment">! fcn-value (with expected)</span></div>
<div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;                        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3 .OR. <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span> <span class="comment">! extend to 4, i.e. GMRES?</span></div>
<div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;                            <span class="keyword">CALL </span>gmpxy(2,real(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>,mps),real(<a class="code" href="namespacempmod.html#ab08ddac93a2ae6e853f4141d4a8dc956">iitera</a>,mps)) <span class="comment">! MINRES iterations</span></div>
<div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;<span class="keywordflow">                        END IF</span></div>
<div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160;                    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a7ab172fc202eaaabcafa19c12a28342e">ploopc</a>(6) <span class="comment">! sub-iteration line</span></div>
<div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a7ab172fc202eaaabcafa19c12a28342e">ploopc</a>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>)</div>
<div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160;                        <span class="keyword">CALL </span>gmpxyd(1,real(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>,mps),real(<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>,mps),0.5,0.) <span class="comment">! fcn-value graph (no Delta)</span></div>
<div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aefcec18b7566f81bf311d769ce42c736">ploopd</a>(6) <span class="comment">! solution line</span></div>
<div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aefcec18b7566f81bf311d769ce42c736">ploopd</a>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>)</div>
<div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;            <span class="keyword">CALL </span>etime(ta,<a class="code" href="namespacempmod.html#a9d225bf5ad5a9160e3a99feca7b7bd22">rstart</a>)</div>
<div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;            <span class="comment">! CHK</span></div>
<div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;            <span class="keywordflow">IF</span> (iabs(jcalcm) &lt;= 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160;                idx=jcalcm+4</div>
<div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160;                <a class="code" href="namespacempmod.html#a5f983528b5d86943f47bbe7921fa4db2">times</a>(idx  )=(<a class="code" href="namespacempmod.html#a5f983528b5d86943f47bbe7921fa4db2">times</a>(idx  )*<a class="code" href="namespacempmod.html#a5f983528b5d86943f47bbe7921fa4db2">times</a>(idx+3)+<a class="code" href="namespacempmod.html#a69d00600354c38e563fe2693492b1a72">deltim</a>) /(<a class="code" href="namespacempmod.html#a5f983528b5d86943f47bbe7921fa4db2">times</a>(idx+3)+1.0)</div>
<div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160;                <a class="code" href="namespacempmod.html#a5f983528b5d86943f47bbe7921fa4db2">times</a>(idx+3)= <a class="code" href="namespacempmod.html#a5f983528b5d86943f47bbe7921fa4db2">times</a>(idx+3)+1.0</div>
<div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;        jcalcm=<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a></div>
<div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160; </div>
<div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a> &gt;= 0) <span class="keywordflow">THEN</span>             <span class="comment">! ICALCM = +1 &amp; 0</span></div>
<div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a19f6871ad06d22ac8dbe88a839b31e4a">loopn</a>                       <span class="comment">! data loop</span></div>
<div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9376bb5e257206e87c2237f8e0b6bd28">addcst</a>                      <span class="comment">! constraints</span></div>
<div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;            lrej=nrej</div>
<div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;            nrej=<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3) <span class="comment">! total number of rejects</span></div>
<div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;            <span class="keywordflow">IF</span>(3*nrej &gt; <a class="code" href="namespacempmod.html#ab4defd4786d68de426cd2bce457f42f7">nrecal</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06892"></a><span class="lineno"> 6892</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Data rejected in previous loop:   &#39;</span></div>
<div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;   &#39;</span>,  &amp;</div>
<div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160;                    <a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0), <span class="stringliteral">&#39; (rank deficit/NaN) &#39;</span>,<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1),<span class="stringliteral">&#39; (Ndf=0)   &#39;</span>,  &amp;</div>
<div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;                    <a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2), <span class="stringliteral">&#39; (huge)   &#39;</span>,<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3),<span class="stringliteral">&#39; (large)&#39;</span></div>
<div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Too many rejects (&gt;33.3%) - stop&#39;</span></div>
<div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(26,<span class="stringliteral">&#39;Aborted, too many rejects&#39;</span>)</div>
<div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;                stop</div>
<div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;          <span class="comment">!     Block 2: new iteration with calculation of solution --------------</span></div>
<div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160; </div>
<div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;        <span class="keywordflow">IF</span>(abs(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>) == 1) <span class="keywordflow">THEN</span>    <span class="comment">! ICALCM = +1 &amp; -1</span></div>
<div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;            <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#a512aaf42b8f2cbfe6178c7a2a2e883ed">nagb</a></div>
<div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;                <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(i)=<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>(i)     <span class="comment">! copy rhs</span></div>
<div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160;            <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l06909"></a><span class="lineno"> 6909</span>&#160;                itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(i)</div>
<div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160;                <a class="code" href="namespacempmod.html#a9dd4ee8c48338d92a75678a5158350f6">workspacelinesearch</a>(i)=<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)  <span class="comment">! copy X for line search</span></div>
<div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;            <a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>=<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a>+1                  <span class="comment">! increase iteration count</span></div>
<div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#aac8a73c63504a2719be59c3ed1a0ac97">minver</a>                   <span class="comment">! inversion</span></div>
<div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a51882a4f8268e9378cc1102daf447c42">mdiags</a>                   <span class="comment">! diagonalization</span></div>
<div class="line"><a name="l06917"></a><span class="lineno"> 6917</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a0bc980caefa591f99b8fd33645ea81e5">mminrs</a>                   <span class="comment">! MINRES</span></div>
<div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#ade1c4784449e452a75d58bd02653b45e">mminrsqlp</a>                <span class="comment">! MINRES-QLP</span></div>
<div class="line"><a name="l06921"></a><span class="lineno"> 6921</span>&#160;            <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 5) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;... reserved for GMRES (not yet!)&#39;</span></div>
<div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a0bc980caefa591f99b8fd33645ea81e5">mminrs</a>                   <span class="comment">! GMRES not yet</span></div>
<div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160;            nloopsol=<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a>                   <span class="comment">! (new) solution for this nloopn</span></div>
<div class="line"><a name="l06926"></a><span class="lineno"> 6926</span>&#160; </div>
<div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;            <span class="comment">!     check feasibility and evtl. make step vector feasible</span></div>
<div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160; </div>
<div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;            <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l06930"></a><span class="lineno"> 6930</span>&#160;                itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(i)</div>
<div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;                <a class="code" href="namespacempmod.html#a21163abbb7c516b63ca1f338881a4083">globalparcopy</a>(itgbi)=<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)               <span class="comment">! save</span></div>
<div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;                <a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)=<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)+<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(i) <span class="comment">! update</span></div>
<div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#ae0971beb43bf6994f05975fe8638e926">feasib</a>(concut,iact)  <span class="comment">! improve constraints</span></div>
<div class="line"><a name="l06935"></a><span class="lineno"> 6935</span>&#160;            concut=concu2             <span class="comment">! new cut for constraint check</span></div>
<div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;            <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l06937"></a><span class="lineno"> 6937</span>&#160;                itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(i)</div>
<div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;                <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>(i)=<a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)-<a class="code" href="namespacempmod.html#a21163abbb7c516b63ca1f338881a4083">globalparcopy</a>(itgbi) <span class="comment">! feasible stp</span></div>
<div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;                <a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)=<a class="code" href="namespacempmod.html#a21163abbb7c516b63ca1f338881a4083">globalparcopy</a>(itgbi)               <span class="comment">! restore</span></div>
<div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160; </div>
<div class="line"><a name="l06942"></a><span class="lineno"> 6942</span>&#160;            db=<a class="code" href="mpnum_8f90.html#a639d876a6e8ba1c3dc98794a1ef5827f">dbdot</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>)</div>
<div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;            db1=<a class="code" href="mpnum_8f90.html#a639d876a6e8ba1c3dc98794a1ef5827f">dbdot</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>,<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>)</div>
<div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;            db2=<a class="code" href="mpnum_8f90.html#a639d876a6e8ba1c3dc98794a1ef5827f">dbdot</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>,<a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>)</div>
<div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;            <a class="code" href="namespacempmod.html#aafdaf33a39c571aca60be6c0c316b674">delfun</a>=real(db,mps)</div>
<div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;            <a class="code" href="namespacempmod.html#a759375d6f5401f1c45fc915024774010">angras</a>=real(db/sqrt(db1*db2),mps)</div>
<div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160; </div>
<div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160;            <span class="comment">! do line search for this iteration/solution ?</span></div>
<div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;            <span class="comment">! lsearch &gt;2: all, =2: all with (next) chicut =1., =1: last, &lt;1: none</span></div>
<div class="line"><a name="l06950"></a><span class="lineno"> 6950</span>&#160;            lsflag=(<a class="code" href="namespacempmod.html#af9c19a04780821443ac195c341a4e678">lsearch</a> &gt; 2 .OR. (<a class="code" href="namespacempmod.html#af9c19a04780821443ac195c341a4e678">lsearch</a> == 2 .AND. <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> &lt; 2.25) .OR. &amp;</div>
<div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;                (<a class="code" href="namespacempmod.html#af9c19a04780821443ac195c341a4e678">lsearch</a> == 1 .AND. <a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> &lt; 2.25 .AND. (<a class="code" href="namespacempmod.html#aafdaf33a39c571aca60be6c0c316b674">delfun</a> &lt;= <a class="code" href="namespacempmod.html#abdfc0236851e1d21ba3276e22f9e6b7b">dflim</a> .OR. <a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> &gt;= <a class="code" href="namespacempmod.html#a880fa8e41c4e97b22457dd7d5948085d">mitera</a>)))</div>
<div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;            <span class="keywordflow">IF</span> (lsflag) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;                <span class="comment">! initialize line search based on slopes and prepare next</span></div>
<div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;                <span class="keyword">CALL </span><a class="code" href="linesrch_8f90.html#a9246f737a7f0e8a260a6a7c5d9b53897">ptldef</a>(<a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>, 10.0, minf,10)</div>
<div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160;                <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;                    <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.5            <span class="comment">! not accurate</span></div>
<div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;                    minf=3</div>
<div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;                    <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.5            <span class="comment">! not acurate</span></div>
<div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;                    minf=3</div>
<div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160;                    <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.1            <span class="comment">! accurate</span></div>
<div class="line"><a name="l06963"></a><span class="lineno"> 6963</span>&#160;                    minf=4</div>
<div class="line"><a name="l06964"></a><span class="lineno"> 6964</span>&#160;                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;                    <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.1            <span class="comment">! accurate</span></div>
<div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;                    minf=4</div>
<div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 5) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160;                    <a class="code" href="namespacempmod.html#a80dff2cc33740f10589c0a3740915c43">wolfc2</a>=0.1            <span class="comment">! accurate</span></div>
<div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;                    minf=4</div>
<div class="line"><a name="l06970"></a><span class="lineno"> 6970</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160; </div>
<div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;            <span class="comment">! change significantly negative ?</span></div>
<div class="line"><a name="l06974"></a><span class="lineno"> 6974</span>&#160;            <span class="keywordflow">IF</span>(db &lt;= -16.0_mpd*sqrt(max(db1,db2))*epsilon(db)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06975"></a><span class="lineno"> 6975</span>&#160;                <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Function not decreasing:&#39;</span>,db</div>
<div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;                <span class="keywordflow">IF</span>(db &gt; -1.0e-3_mpd) <span class="keywordflow">THEN</span> <span class="comment">! 100311, VB/CK: allow some margin for numerics</span></div>
<div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;                    iagain=iagain+1</div>
<div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160;                    <span class="keywordflow">IF</span> (iagain &lt;= 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;                        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;... again matrix calculation&#39;</span></div>
<div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160;                        <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=1</div>
<div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;                        cycle</div>
<div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160;                    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;                        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;... aborting iterations&#39;</span></div>
<div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;                        <span class="keywordflow">GO TO</span> 90</div>
<div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160;<span class="keywordflow">                    END IF</span></div>
<div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;                <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06987"></a><span class="lineno"> 6987</span>&#160;                    <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;... stopping iterations&#39;</span></div>
<div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160;                    iagain=-1</div>
<div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;                    <span class="keywordflow">GO TO</span> 90</div>
<div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;                iagain=0</div>
<div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;            <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=0                         <span class="comment">! switch</span></div>
<div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;        <span class="comment">!     Block 3: line searching ------------------------------------------</span></div>
<div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160; </div>
<div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>+2 == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;        <span class="keywordflow">IF</span> (lsflag) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160;            <span class="keyword">CALL </span><a class="code" href="linesrch_8f90.html#a51d0bfcb54529dd7ec244c1013a740e1">ptline</a>(<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,<a class="code" href="namespacempmod.html#a9dd4ee8c48338d92a75678a5158350f6">workspacelinesearch</a>, &amp;   <span class="comment">! current parameter values</span></div>
<div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160;                <a class="code" href="namespacempmod.html#a57fed7fcdfb12f71e78770758ca65e43">flines</a>, &amp;          <span class="comment">! chi^2 function value</span></div>
<div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;                <a class="code" href="namespacempmod.html#ac4ad271e889f6d6ae362bdc80e3af05c">globalvector</a>, &amp;    <span class="comment">! gradient</span></div>
<div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160;                <a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a>, &amp;   <span class="comment">! step vector stp</span></div>
<div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160;                stp, &amp;             <span class="comment">! returned step factor</span></div>
<div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;                info)              <span class="comment">! returned information</span></div>
<div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;        <span class="comment">!      WRITE(*,*) &#39;PTLINE returns INFO, STP=&#39;,INFO, STP</span></div>
<div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;        <span class="keywordflow">ELSE</span> <span class="comment">! skip line search</span></div>
<div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;            info=10</div>
<div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;            <a class="code" href="namespacempmod.html#aef5a8e458ab79c6ffcf58a0674aebe7f">stepl</a>=1.0</div>
<div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == nloopsol) <span class="keywordflow">THEN</span>  <span class="comment">! new solution: update corrections</span></div>
<div class="line"><a name="l07011"></a><span class="lineno"> 7011</span>&#160;                <a class="code" href="namespacempmod.html#a9dd4ee8c48338d92a75678a5158350f6">workspacelinesearch</a>=<a class="code" href="namespacempmod.html#a9dd4ee8c48338d92a75678a5158350f6">workspacelinesearch</a>+<a class="code" href="namespacempmod.html#a4ad8460fdead8b7979a7c86ed8e010f2">globalcorrections</a></div>
<div class="line"><a name="l07012"></a><span class="lineno"> 7012</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l07013"></a><span class="lineno"> 7013</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l07014"></a><span class="lineno"> 7014</span>&#160;        <a class="code" href="namespacempmod.html#a43ee8b52852b956110d6d504ebf18176">lsinfo</a>=info</div>
<div class="line"><a name="l07015"></a><span class="lineno"> 7015</span>&#160; </div>
<div class="line"><a name="l07016"></a><span class="lineno"> 7016</span>&#160;        <a class="code" href="namespacempmod.html#aef5a8e458ab79c6ffcf58a0674aebe7f">stepl</a>=real(stp,mps)</div>
<div class="line"><a name="l07017"></a><span class="lineno"> 7017</span>&#160;        nan=0</div>
<div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;        <span class="keywordflow">DO</span> i=1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160;            itgbi=<a class="code" href="namespacempmod.html#a9f40327b7480f15ae2a445c2d84c2dce">globalparvartototal</a>(i)</div>
<div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;            <span class="keywordflow">IF</span> ((.NOT.(<a class="code" href="namespacempmod.html#a9dd4ee8c48338d92a75678a5158350f6">workspacelinesearch</a>(i) &lt;= 0.0_mpd)).AND.  &amp;</div>
<div class="line"><a name="l07021"></a><span class="lineno"> 7021</span>&#160;                (.NOT.(<a class="code" href="namespacempmod.html#a9dd4ee8c48338d92a75678a5158350f6">workspacelinesearch</a>(i) &gt; 0.0_mpd))) nan=nan+1</div>
<div class="line"><a name="l07022"></a><span class="lineno"> 7022</span>&#160;            <a class="code" href="namespacempmod.html#a0231b312a2d1c7f33f04f99bce560206">globalparameter</a>(itgbi)=<a class="code" href="namespacempmod.html#a9dd4ee8c48338d92a75678a5158350f6">workspacelinesearch</a>(i) <span class="comment">! current parameter values</span></div>
<div class="line"><a name="l07023"></a><span class="lineno"> 7023</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l07024"></a><span class="lineno"> 7024</span>&#160; </div>
<div class="line"><a name="l07025"></a><span class="lineno"> 7025</span>&#160;        <span class="keywordflow">IF</span> (nan &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07026"></a><span class="lineno"> 7026</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Result vector containes &#39;</span>, nan,<span class="stringliteral">&#39; NaNs - stop&#39;</span></div>
<div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;            <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(25,<span class="stringliteral">&#39;Aborted, result vector contains NaNs&#39;</span>)</div>
<div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;            stop</div>
<div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160; </div>
<div class="line"><a name="l07031"></a><span class="lineno"> 7031</span>&#160;        <span class="comment">!     subito exit, if required -----------------------------------------</span></div>
<div class="line"><a name="l07032"></a><span class="lineno"> 7032</span>&#160; </div>
<div class="line"><a name="l07033"></a><span class="lineno"> 7033</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#ab949b3b527978632aa8cf4dd409d94af">isubit</a> /= 0) <span class="keywordflow">THEN</span> <span class="comment">! subito</span></div>
<div class="line"><a name="l07034"></a><span class="lineno"> 7034</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Subito!     Exit after first step.&#39;</span></div>
<div class="line"><a name="l07035"></a><span class="lineno"> 7035</span>&#160;            <span class="keywordflow">GO TO</span> 90</div>
<div class="line"><a name="l07036"></a><span class="lineno"> 7036</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160; </div>
<div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;        <span class="keywordflow">IF</span>(info == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;INFO=0 should not happen (line search input err)&#39;</span></div>
<div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;            <span class="keywordflow">IF</span> (iagain &lt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07041"></a><span class="lineno"> 7041</span>&#160;                <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=1</div>
<div class="line"><a name="l07042"></a><span class="lineno"> 7042</span>&#160;                cycle</div>
<div class="line"><a name="l07043"></a><span class="lineno"> 7043</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l07044"></a><span class="lineno"> 7044</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07045"></a><span class="lineno"> 7045</span>&#160;        <span class="keywordflow">IF</span>(info &lt; 0 .OR. <a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> == nloopsol) cycle</div>
<div class="line"><a name="l07046"></a><span class="lineno"> 7046</span>&#160;        <span class="comment">!     Block 4: line search convergence ---------------------------------</span></div>
<div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160; </div>
<div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160;        <span class="keyword">CALL </span><a class="code" href="linesrch_8f90.html#afa73a97efe3dd8fed52cd565400932a2">ptlprt</a>(<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>)</div>
<div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#ae0971beb43bf6994f05975fe8638e926">feasib</a>(concut,iact)               <span class="comment">! check constraints</span></div>
<div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;        <span class="keywordflow">IF</span>(iact /= 0.OR.<a class="code" href="namespacempmod.html#afec212accc825c6969fc5160ca45d5e7">chicut</a> &gt; 1.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07051"></a><span class="lineno"> 7051</span>&#160;            <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=-1</div>
<div class="line"><a name="l07052"></a><span class="lineno"> 7052</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> &lt; <a class="code" href="namespacempmod.html#af7338d32712bd5917c14fd665b022354">matrit</a>) <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=+1</div>
<div class="line"><a name="l07053"></a><span class="lineno"> 7053</span>&#160;            cycle <span class="comment">! iterate</span></div>
<div class="line"><a name="l07054"></a><span class="lineno"> 7054</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07055"></a><span class="lineno"> 7055</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aafdaf33a39c571aca60be6c0c316b674">delfun</a> &lt;= <a class="code" href="namespacempmod.html#abdfc0236851e1d21ba3276e22f9e6b7b">dflim</a>)  <span class="keywordflow">GO TO</span> 90           <span class="comment">! convergence</span></div>
<div class="line"><a name="l07056"></a><span class="lineno"> 7056</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> &gt;= <a class="code" href="namespacempmod.html#a880fa8e41c4e97b22457dd7d5948085d">mitera</a>) <span class="keywordflow">GO TO</span> 90           <span class="comment">! ending</span></div>
<div class="line"><a name="l07057"></a><span class="lineno"> 7057</span>&#160;        <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=-1</div>
<div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a57697e5da0fafabbc104674a4bb453c5">iterat</a> &lt; <a class="code" href="namespacempmod.html#af7338d32712bd5917c14fd665b022354">matrit</a>) <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=+1</div>
<div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;        cycle                                <span class="comment">! next iteration</span></div>
<div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160; </div>
<div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;        <span class="comment">!     Block 5: iteration ending ----------------------------------------</span></div>
<div class="line"><a name="l07062"></a><span class="lineno"> 7062</span>&#160; </div>
<div class="line"><a name="l07063"></a><span class="lineno"> 7063</span>&#160;90      <a class="code" href="namespacempmod.html#aacb8ec6bcb93febc26d16ac84250546c">icalcm</a>=-2</div>
<div class="line"><a name="l07064"></a><span class="lineno"> 7064</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07065"></a><span class="lineno"> 7065</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3) /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07066"></a><span class="lineno"> 7066</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07067"></a><span class="lineno"> 7067</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Data rejected in last loop:   &#39;</span></div>
<div class="line"><a name="l07068"></a><span class="lineno"> 7068</span>&#160;        <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;   &#39;</span>,  &amp;</div>
<div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160;            <a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0), <span class="stringliteral">&#39; (rank deficit/NaN) &#39;</span>,<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1),<span class="stringliteral">&#39; (Ndf=0)   &#39;</span>,  &amp;</div>
<div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;            <a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2), <span class="stringliteral">&#39; (huge)   &#39;</span>,<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3),<span class="stringliteral">&#39; (large)&#39;</span></div>
<div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;    </div>
<div class="line"><a name="l07073"></a><span class="lineno"> 7073</span>&#160;    <span class="comment">! monitoring of residuals</span></div>
<div class="line"><a name="l07074"></a><span class="lineno"> 7074</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a> &gt; 0 .AND. btest(<a class="code" href="namespacempmod.html#affc38d07d26b8dc7faf3938e57d6cfdc">imonit</a>,1)) <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a4b6537e97d3eefbb3cb1f9bab1385708">monres</a></div>
<div class="line"><a name="l07075"></a><span class="lineno"> 7075</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a0ba5f44eb369bc3a679cf14f47bbfb80">lunmon</a> &gt; 0) <span class="keyword">CLOSE</span>(unit=<a class="code" href="namespacempmod.html#a0ba5f44eb369bc3a679cf14f47bbfb80">lunmon</a>)</div>
<div class="line"><a name="l07076"></a><span class="lineno"> 7076</span>&#160; </div>
<div class="line"><a name="l07077"></a><span class="lineno"> 7077</span>&#160;    dwmean=<a class="code" href="namespacempmod.html#a5582661ffb49367e25600e299095a81f">sumndf</a>/real(<a class="code" href="namespacempmod.html#a8f38a22c9a76684594cede594cf9041c">ndfsum</a>,mpd)</div>
<div class="line"><a name="l07078"></a><span class="lineno"> 7078</span>&#160;    dratio=<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a>/dwmean/real(<a class="code" href="namespacempmod.html#a8f38a22c9a76684594cede594cf9041c">ndfsum</a>-<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,mpd)</div>
<div class="line"><a name="l07079"></a><span class="lineno"> 7079</span>&#160;    catio=real(dratio,mps)</div>
<div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> /= 1.AND.<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;        catio=catio/0.9326  <span class="comment">! correction Huber downweighting (in global chi2)       </span></div>
<div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;    mrati=nint(100.0*catio,mpi)</div>
<div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160; </div>
<div class="line"><a name="l07085"></a><span class="lineno"> 7085</span>&#160;    <span class="keywordflow">DO</span> lunp=6,<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>,<a class="code" href="namespacempmod.html#a7e5f04f69ce192eab3da3c6adef45544">lunlog</a>-6</div>
<div class="line"><a name="l07086"></a><span class="lineno"> 7086</span>&#160;        <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07087"></a><span class="lineno"> 7087</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a458c83043d826c318e19efc0a43af555">nfilw</a> &lt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07088"></a><span class="lineno"> 7088</span>&#160;            <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39;Sum(Chi^2)/Sum(Ndf) =&#39;</span>,<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a></div>
<div class="line"><a name="l07089"></a><span class="lineno"> 7089</span>&#160;            <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39;                    / (&#39;</span>,<a class="code" href="namespacempmod.html#a8f38a22c9a76684594cede594cf9041c">ndfsum</a>,<span class="stringliteral">&#39;-&#39;</span>,<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a name="l07090"></a><span class="lineno"> 7090</span>&#160;            <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39;                    =&#39;</span>,dratio</div>
<div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;            <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39;Sum(W*Chi^2)/Sum(Ndf)/&lt;W&gt; =&#39;</span>,<a class="code" href="namespacempmod.html#a499e3f9fb15b87000fa3ce817e6cbc57">fvalue</a></div>
<div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;            <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39;                          / (&#39;</span>,<a class="code" href="namespacempmod.html#a8f38a22c9a76684594cede594cf9041c">ndfsum</a>,<span class="stringliteral">&#39;-&#39;</span>, <a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;            <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39;                          /&#39;</span>,dwmean</div>
<div class="line"><a name="l07095"></a><span class="lineno"> 7095</span>&#160;            <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39;                          =&#39;</span>,dratio</div>
<div class="line"><a name="l07096"></a><span class="lineno"> 7096</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07097"></a><span class="lineno"> 7097</span>&#160;        <span class="keyword">WRITE</span>(lunp,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07098"></a><span class="lineno"> 7098</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a1382c8f22d05b905d2f9268ad65843be">nloopn</a> /= 1.AND.<a class="code" href="namespacempmod.html#ad21dcfeb0abe011282d736f16516c81e">lhuber</a> /= 0) <span class="keyword">WRITE</span>(lunp,*)  &amp;</div>
<div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160;            <span class="stringliteral">&#39;            with correction for down-weighting   &#39;</span>,catio</div>
<div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;    nrej=<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(0)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(1)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(2)+<a class="code" href="namespacempmod.html#a481eeaa95958f671e25cd2b3e9b1813c">nrejec</a>(3) <span class="comment">! total number of rejects</span></div>
<div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160; </div>
<div class="line"><a name="l07103"></a><span class="lineno"> 7103</span>&#160;    <span class="comment">!     ... the end with exit code ???????????????????????????????????????</span></div>
<div class="line"><a name="l07104"></a><span class="lineno"> 7104</span>&#160; </div>
<div class="line"><a name="l07105"></a><span class="lineno"> 7105</span>&#160;    <span class="comment">!      WRITE(*,199)              ! write exit code</span></div>
<div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;    <span class="comment">!     + &#39;-----------------------------------------------------------&#39;</span></div>
<div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;    <span class="comment">!      IF(ITEXIT.EQ.0) WRITE(*,199)</span></div>
<div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;    <span class="comment">!     +  &#39;Exit code = 0:  Convergence reached&#39;</span></div>
<div class="line"><a name="l07109"></a><span class="lineno"> 7109</span>&#160;    <span class="comment">!      IF(ITEXIT.EQ.1) WRITE(*,199)</span></div>
<div class="line"><a name="l07110"></a><span class="lineno"> 7110</span>&#160;    <span class="comment">!     +  &#39;Exit code = 1:  No improvement in last iteration&#39;</span></div>
<div class="line"><a name="l07111"></a><span class="lineno"> 7111</span>&#160;    <span class="comment">!      IF(ITEXIT.EQ.2) WRITE(*,199)</span></div>
<div class="line"><a name="l07112"></a><span class="lineno"> 7112</span>&#160;    <span class="comment">!     +  &#39;Exit code = 2:  Maximum number of iterations reached&#39;</span></div>
<div class="line"><a name="l07113"></a><span class="lineno"> 7113</span>&#160;    <span class="comment">!      IF(ITEXIT.EQ.3) WRITE(*,199)</span></div>
<div class="line"><a name="l07114"></a><span class="lineno"> 7114</span>&#160;    <span class="comment">!     +  &#39;Exit code = 3:  Failure&#39;</span></div>
<div class="line"><a name="l07115"></a><span class="lineno"> 7115</span>&#160;    <span class="comment">!      WRITE(*,199)</span></div>
<div class="line"><a name="l07116"></a><span class="lineno"> 7116</span>&#160;    <span class="comment">!     + &#39;-----------------------------------------------------------&#39;</span></div>
<div class="line"><a name="l07117"></a><span class="lineno"> 7117</span>&#160;    <span class="comment">!      WRITE(*,199) &#39; &#39;</span></div>
<div class="line"><a name="l07118"></a><span class="lineno"> 7118</span>&#160; </div>
<div class="line"><a name="l07119"></a><span class="lineno"> 7119</span>&#160; </div>
<div class="line"><a name="l07120"></a><span class="lineno"> 7120</span>&#160;    nrati=nint(10000.0*real(nrej,mps)/real(<a class="code" href="namespacempmod.html#ab4defd4786d68de426cd2bce457f42f7">nrecal</a>,mps),mpi)</div>
<div class="line"><a name="l07121"></a><span class="lineno"> 7121</span>&#160;    <span class="keyword">WRITE</span>(crjrat,197) 0.01_mpd*real(nrati,mpd)</div>
<div class="line"><a name="l07122"></a><span class="lineno"> 7122</span>&#160;    nfaci=nint(100.0*sqrt(catio),mpi)</div>
<div class="line"><a name="l07123"></a><span class="lineno"> 7123</span>&#160; </div>
<div class="line"><a name="l07124"></a><span class="lineno"> 7124</span>&#160;    <span class="keyword">WRITE</span>(cratio,197) 0.01_mpd*real(mrati,mpd)</div>
<div class="line"><a name="l07125"></a><span class="lineno"> 7125</span>&#160;    <span class="keyword">WRITE</span>(cfacin,197) 0.01_mpd*real(nfaci,mpd)</div>
<div class="line"><a name="l07126"></a><span class="lineno"> 7126</span>&#160; </div>
<div class="line"><a name="l07127"></a><span class="lineno"> 7127</span>&#160;    warner=.false. <span class="comment">! warnings</span></div>
<div class="line"><a name="l07128"></a><span class="lineno"> 7128</span>&#160;    <span class="keywordflow">IF</span>(mrati &lt; 90.OR.mrati &gt; 110) warner=.true.</div>
<div class="line"><a name="l07129"></a><span class="lineno"> 7129</span>&#160;    <span class="keywordflow">IF</span>(nrati &gt; 100) warner=.true.</div>
<div class="line"><a name="l07130"></a><span class="lineno"> 7130</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a> /= 0) warner=.true.</div>
<div class="line"><a name="l07131"></a><span class="lineno"> 7131</span>&#160;    warners = .false. <span class="comment">! severe warnings</span></div>
<div class="line"><a name="l07132"></a><span class="lineno"> 7132</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a524d9e04315e58034b7bf6364443c329">nalow</a> /= 0) warners=.true.</div>
<div class="line"><a name="l07133"></a><span class="lineno"> 7133</span>&#160;    warnerss = .false. <span class="comment">! more severe warnings</span></div>
<div class="line"><a name="l07134"></a><span class="lineno"> 7134</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5166bef83080484149414b730f3770e8">nmiss1</a> /= 0) warnerss=.true.</div>
<div class="line"><a name="l07135"></a><span class="lineno"> 7135</span>&#160;    <span class="keywordflow">IF</span>(iagain /= 0) warnerss=.true.</div>
<div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">ndefec</a> /= 0) warnerss=.true.</div>
<div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160; </div>
<div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160;    <span class="keywordflow">IF</span>(warner.OR.warners.OR.warnerss) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07140"></a><span class="lineno"> 7140</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07141"></a><span class="lineno"> 7141</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;WarningWarningWarningWarningWarningWarningWarningWarningWar&#39;</span></div>
<div class="line"><a name="l07142"></a><span class="lineno"> 7142</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;arningWarningWarningWarningWarningWarningWarningWarningWarn&#39;</span></div>
<div class="line"><a name="l07143"></a><span class="lineno"> 7143</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;rningWarningWarningWarningWarningWarningWarningWarningWarni&#39;</span></div>
<div class="line"><a name="l07144"></a><span class="lineno"> 7144</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;ningWarningWarningWarningWarningWarningWarningWarningWarnin&#39;</span></div>
<div class="line"><a name="l07145"></a><span class="lineno"> 7145</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;ingWarningWarningWarningWarningWarningWarningWarningWarning&#39;</span></div>
<div class="line"><a name="l07146"></a><span class="lineno"> 7146</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;ngWarningWarningWarningWarningWarningWarningWarningWarningW&#39;</span></div>
<div class="line"><a name="l07147"></a><span class="lineno"> 7147</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;gWarningWarningWarningWarningWarningWarningWarningWarningWa&#39;</span></div>
<div class="line"><a name="l07148"></a><span class="lineno"> 7148</span>&#160; </div>
<div class="line"><a name="l07149"></a><span class="lineno"> 7149</span>&#160;        <span class="keywordflow">IF</span>(mrati &lt; 90.OR.mrati &gt; 110) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07150"></a><span class="lineno"> 7150</span>&#160;            <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07151"></a><span class="lineno"> 7151</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        Chi^2/Ndf = &#39;</span>,cratio, <span class="stringliteral">&#39;  (should be close to 1)&#39;</span></div>
<div class="line"><a name="l07152"></a><span class="lineno"> 7152</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        =&gt; multiply all input standard &#39;</span>,  &amp;</div>
<div class="line"><a name="l07153"></a><span class="lineno"> 7153</span>&#160;                <span class="stringliteral">&#39;deviations by factor&#39;</span>,cfacin</div>
<div class="line"><a name="l07154"></a><span class="lineno"> 7154</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07155"></a><span class="lineno"> 7155</span>&#160; </div>
<div class="line"><a name="l07156"></a><span class="lineno"> 7156</span>&#160;        <span class="keywordflow">IF</span>(nrati &gt; 100) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07157"></a><span class="lineno"> 7157</span>&#160;            <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07158"></a><span class="lineno"> 7158</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        Fraction of rejects =&#39;</span>,crjrat,<span class="stringliteral">&#39; %&#39;</span>,  &amp;</div>
<div class="line"><a name="l07159"></a><span class="lineno"> 7159</span>&#160;                <span class="stringliteral">&#39;  (should be far below 1 %)&#39;</span></div>
<div class="line"><a name="l07160"></a><span class="lineno"> 7160</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        =&gt; please provide correct mille data&#39;</span></div>
<div class="line"><a name="l07161"></a><span class="lineno"> 7161</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07162"></a><span class="lineno"> 7162</span>&#160; </div>
<div class="line"><a name="l07163"></a><span class="lineno"> 7163</span>&#160;        <span class="keywordflow">IF</span>(iagain /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07164"></a><span class="lineno"> 7164</span>&#160;            <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07165"></a><span class="lineno"> 7165</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        Matrix not positiv definite &#39;</span>//  &amp;</div>
<div class="line"><a name="l07166"></a><span class="lineno"> 7166</span>&#160;                <span class="stringliteral">&#39;(function not decreasing)&#39;</span></div>
<div class="line"><a name="l07167"></a><span class="lineno"> 7167</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        =&gt; please provide correct mille data&#39;</span></div>
<div class="line"><a name="l07168"></a><span class="lineno"> 7168</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07169"></a><span class="lineno"> 7169</span>&#160; </div>
<div class="line"><a name="l07170"></a><span class="lineno"> 7170</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">ndefec</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07171"></a><span class="lineno"> 7171</span>&#160;            <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07172"></a><span class="lineno"> 7172</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        Rank defect =&#39;</span>,<a class="code" href="namespacempmod.html#a934ba105d1133de87b31daaa20415cee">ndefec</a>,  &amp;</div>
<div class="line"><a name="l07173"></a><span class="lineno"> 7173</span>&#160;                <span class="stringliteral">&#39;  for global matrix, should be 0&#39;</span></div>
<div class="line"><a name="l07174"></a><span class="lineno"> 7174</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        =&gt; please provide correct mille data&#39;</span></div>
<div class="line"><a name="l07175"></a><span class="lineno"> 7175</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07176"></a><span class="lineno"> 7176</span>&#160;        </div>
<div class="line"><a name="l07177"></a><span class="lineno"> 7177</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a5166bef83080484149414b730f3770e8">nmiss1</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07178"></a><span class="lineno"> 7178</span>&#160;            <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07179"></a><span class="lineno"> 7179</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        Rank defect =&#39;</span>,<a class="code" href="namespacempmod.html#a5166bef83080484149414b730f3770e8">nmiss1</a>,  &amp;</div>
<div class="line"><a name="l07180"></a><span class="lineno"> 7180</span>&#160;                <span class="stringliteral">&#39;  for constraint equations, should be 0&#39;</span></div>
<div class="line"><a name="l07181"></a><span class="lineno"> 7181</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        =&gt; please correct constraint definition&#39;</span></div>
<div class="line"><a name="l07182"></a><span class="lineno"> 7182</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07183"></a><span class="lineno"> 7183</span>&#160;                </div>
<div class="line"><a name="l07184"></a><span class="lineno"> 7184</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;            <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        Number of empty constraints =&#39;</span>,<a class="code" href="namespacempmod.html#aa6d46427d8c8c795ef39fab60abe46d1">ncgbe</a>, <span class="stringliteral">&#39;, should be 0&#39;</span></div>
<div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        =&gt; please check constraint definition, mille data&#39;</span></div>
<div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160; </div>
<div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a524d9e04315e58034b7bf6364443c329">nalow</a> /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07191"></a><span class="lineno"> 7191</span>&#160;            <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07192"></a><span class="lineno"> 7192</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        Possible rank defects =&#39;</span>,<a class="code" href="namespacempmod.html#a524d9e04315e58034b7bf6364443c329">nalow</a>,  &amp;</div>
<div class="line"><a name="l07193"></a><span class="lineno"> 7193</span>&#160;                <span class="stringliteral">&#39;  for global vector (too few entries)&#39;</span></div>
<div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;            <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;        =&gt; please check mille data and ENTRIES cut&#39;</span></div>
<div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160;        </div>
<div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;WarningWarningWarningWarningWarningWarningWarningWarningWar&#39;</span></div>
<div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;arningWarningWarningWarningWarningWarningWarningWarningWarn&#39;</span></div>
<div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;rningWarningWarningWarningWarningWarningWarningWarningWarni&#39;</span></div>
<div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;ningWarningWarningWarningWarningWarningWarningWarningWarnin&#39;</span></div>
<div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;ingWarningWarningWarningWarningWarningWarningWarningWarning&#39;</span></div>
<div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;ngWarningWarningWarningWarningWarningWarningWarningWarningW&#39;</span></div>
<div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39;gWarningWarningWarningWarningWarningWarningWarningWarningWa&#39;</span></div>
<div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;        <span class="keyword">WRITE</span>(*,199) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l07206"></a><span class="lineno"> 7206</span>&#160; </div>
<div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160; </div>
<div class="line"><a name="l07209"></a><span class="lineno"> 7209</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a9f1cf38841260b60fa064f16b1f06cbc">mend</a>                <span class="comment">! modul ending</span></div>
<div class="line"><a name="l07210"></a><span class="lineno"> 7210</span>&#160; </div>
<div class="line"><a name="l07211"></a><span class="lineno"> 7211</span>&#160;    <span class="comment">!     ------------------------------------------------------------------</span></div>
<div class="line"><a name="l07212"></a><span class="lineno"> 7212</span>&#160; </div>
<div class="line"><a name="l07213"></a><span class="lineno"> 7213</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07214"></a><span class="lineno"> 7214</span>&#160; </div>
<div class="line"><a name="l07215"></a><span class="lineno"> 7215</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07216"></a><span class="lineno"> 7216</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a4360dd45378ac25a7f673c5ddf6d29ff">zdiags</a></div>
<div class="line"><a name="l07217"></a><span class="lineno"> 7217</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3 .OR. <a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 4) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07218"></a><span class="lineno"> 7218</span>&#160;        <span class="comment">!        errors and correlations from MINRES</span></div>
<div class="line"><a name="l07219"></a><span class="lineno"> 7219</span>&#160;        <span class="keywordflow">DO</span>  k=1,<a class="code" href="namespacempmod.html#a0db3baa2b317f4fa930d474ff9e289ed">mnrsel</a></div>
<div class="line"><a name="l07220"></a><span class="lineno"> 7220</span>&#160;            labelg=<a class="code" href="namespacempmod.html#a16e4025d654964cf8a2eccdbd65a6318">lbmnrs</a>(k)</div>
<div class="line"><a name="l07221"></a><span class="lineno"> 7221</span>&#160;            <span class="keywordflow">IF</span>(labelg == 0) cycle</div>
<div class="line"><a name="l07222"></a><span class="lineno"> 7222</span>&#160;            itgbi=<a class="code" href="pede_8f90.html#ad3441582f1e3d1880efd14bb86c592aa">inone</a>(labelg)</div>
<div class="line"><a name="l07223"></a><span class="lineno"> 7223</span>&#160;            ivgbi=0</div>
<div class="line"><a name="l07224"></a><span class="lineno"> 7224</span>&#160;            <span class="keywordflow">IF</span>(itgbi /= 0) ivgbi=<a class="code" href="namespacempmod.html#a8a41e0e932702180f248638fe285c63a">globalparlabelindex</a>(2,itgbi)</div>
<div class="line"><a name="l07225"></a><span class="lineno"> 7225</span>&#160;            <span class="keywordflow">IF</span>(ivgbi &lt; 0) ivgbi=0</div>
<div class="line"><a name="l07226"></a><span class="lineno"> 7226</span>&#160;            <span class="keywordflow">IF</span>(ivgbi == 0) cycle</div>
<div class="line"><a name="l07227"></a><span class="lineno"> 7227</span>&#160;            <span class="comment">!          determine error and global correlation for parameter IVGBI</span></div>
<div class="line"><a name="l07228"></a><span class="lineno"> 7228</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07229"></a><span class="lineno"> 7229</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a43640e5d5710aee16e26f464a8d91db6">solglo</a>(ivgbi)</div>
<div class="line"><a name="l07230"></a><span class="lineno"> 7230</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07231"></a><span class="lineno"> 7231</span>&#160;                <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a913bbaf83d851f71a5f48ad8beda9579">solgloqlp</a>(ivgbi)</div>
<div class="line"><a name="l07232"></a><span class="lineno"> 7232</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;  </div>
<div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> == 5) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07236"></a><span class="lineno"> 7236</span>&#160;  </div>
<div class="line"><a name="l07237"></a><span class="lineno"> 7237</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07238"></a><span class="lineno"> 7238</span>&#160; </div>
<div class="line"><a name="l07239"></a><span class="lineno"> 7239</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a10d5958e349af9b608e3126a783e3f97">metsol</a> &lt;= 2) <span class="keywordflow">THEN</span> <span class="comment">! inversion or diagonalization ?</span></div>
<div class="line"><a name="l07240"></a><span class="lineno"> 7240</span>&#160;        <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l07241"></a><span class="lineno"> 7241</span>&#160;        <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07242"></a><span class="lineno"> 7242</span>&#160;            <span class="comment">! extend, transform matrix</span></div>
<div class="line"><a name="l07243"></a><span class="lineno"> 7243</span>&#160;            <span class="keywordflow">DO</span> i=<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>-<a class="code" href="namespacempmod.html#acfd3a7e698690995206c13b2437a93ad">ncgb</a>+1,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160;                ioff=((i-1)*i)/2</div>
<div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;                <a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>(ioff+1:ioff+i)=0.0_mpd</div>
<div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l07247"></a><span class="lineno"> 7247</span>&#160;            <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a8ae2c7e3508121d8c1da42fe878d6e5a">qlssq</a>(<a class="code" href="pede_8f90.html#a9531a8f5f9a2cde1c04ef76ea1620259">avprd0</a>,<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>,.false.) <span class="comment">! Q^t*A*Q</span></div>
<div class="line"><a name="l07248"></a><span class="lineno"> 7248</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l07249"></a><span class="lineno"> 7249</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07250"></a><span class="lineno"> 7250</span>&#160; </div>
<div class="line"><a name="l07251"></a><span class="lineno"> 7251</span>&#160;    <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a4b13fb17eb0fffb15b9e5b136c22f620">prtglo</a>              <span class="comment">! print result</span></div>
<div class="line"><a name="l07252"></a><span class="lineno"> 7252</span>&#160; </div>
<div class="line"><a name="l07253"></a><span class="lineno"> 7253</span>&#160;    <span class="keywordflow">IF</span> (warnerss) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07254"></a><span class="lineno"> 7254</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(3,<span class="stringliteral">&#39;Ended with severe warnings (bad global matrix)&#39;</span>)</div>
<div class="line"><a name="l07255"></a><span class="lineno"> 7255</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (warners) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(2,<span class="stringliteral">&#39;Ended with severe warnings (insufficient measurements)&#39;</span>)</div>
<div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (warner) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(1,<span class="stringliteral">&#39;Ended with warnings (bad measurements)&#39;</span>)</div>
<div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;        <span class="keyword">CALL </span><a class="code" href="pede_8f90.html#a16ef8020d3ee5c0aa46a0cb5b1dceba8">peend</a>(0,<span class="stringliteral">&#39;Ended normally&#39;</span>)</div>
<div class="line"><a name="l07261"></a><span class="lineno"> 7261</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l07262"></a><span class="lineno"> 7262</span>&#160; </div>
<div class="line"><a name="l07263"></a><span class="lineno"> 7263</span>&#160;102 <span class="keyword">FORMAT</span>(<span class="stringliteral">&#39; Call FEASIB with cut=&#39;</span>,g10.3)</div>
<div class="line"><a name="l07264"></a><span class="lineno"> 7264</span>&#160;    <span class="comment">! 103  FORMAT(1X,A,G12.4)</span></div>
<div class="line"><a name="l07265"></a><span class="lineno"> 7265</span>&#160;197 <span class="keyword">FORMAT</span>(f7.2)    </div>
<div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;199 <span class="keyword">FORMAT</span>(7x,a)</div>
<div class="ttc" id="alinesrch_8f90_html_a51d0bfcb54529dd7ec244c1013a740e1"><div class="ttname"><a href="linesrch_8f90.html#a51d0bfcb54529dd7ec244c1013a740e1">ptline</a></div><div class="ttdeci">subroutine ptline(n, x, f, g, s, step, info)</div><div class="ttdoc">Perform linesearch.</div><div class="ttdef"><b>Definition:</b> <a href="linesrch_8f90_source.html#l00089">linesrch.f90:90</a></div></div>
<div class="ttc" id="alinesrch_8f90_html_a9246f737a7f0e8a260a6a7c5d9b53897"><div class="ttname"><a href="linesrch_8f90.html#a9246f737a7f0e8a260a6a7c5d9b53897">ptldef</a></div><div class="ttdeci">subroutine ptldef(gtole, stmax, minfe, maxfe)</div><div class="ttdoc">Initialize line search.</div><div class="ttdef"><b>Definition:</b> <a href="linesrch_8f90_source.html#l00232">linesrch.f90:233</a></div></div>
<div class="ttc" id="alinesrch_8f90_html_afa73a97efe3dd8fed52cd565400932a2"><div class="ttname"><a href="linesrch_8f90.html#afa73a97efe3dd8fed52cd565400932a2">ptlprt</a></div><div class="ttdeci">subroutine ptlprt(lunp)</div><div class="ttdoc">Print line search data.</div><div class="ttdef"><b>Definition:</b> <a href="linesrch_8f90_source.html#l00294">linesrch.f90:295</a></div></div>
<div class="ttc" id="ampnum_8f90_html_a639d876a6e8ba1c3dc98794a1ef5827f"><div class="ttname"><a href="mpnum_8f90.html#a639d876a6e8ba1c3dc98794a1ef5827f">dbdot</a></div><div class="ttdeci">real(mpd) function dbdot(n, dx, dy)</div><div class="ttdoc">Dot product.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l01090">mpnum.f90:1091</a></div></div>
<div class="ttc" id="apede_8f90_html_a00d065081954e0f87a892d3aa5e22619"><div class="ttname"><a href="pede_8f90.html#a00d065081954e0f87a892d3aa5e22619">ploopb</a></div><div class="ttdeci">subroutine ploopb(lunp)</div><div class="ttdoc">Print iteration line.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l02757">pede.f90:2758</a></div></div>
<div class="ttc" id="apede_8f90_html_a0bc980caefa591f99b8fd33645ea81e5"><div class="ttname"><a href="pede_8f90.html#a0bc980caefa591f99b8fd33645ea81e5">mminrs</a></div><div class="ttdeci">subroutine mminrs</div><div class="ttdoc">Solution with MINRES.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l06385">pede.f90:6386</a></div></div>
<div class="ttc" id="apede_8f90_html_a19f6871ad06d22ac8dbe88a839b31e4a"><div class="ttname"><a href="pede_8f90.html#a19f6871ad06d22ac8dbe88a839b31e4a">loopn</a></div><div class="ttdeci">subroutine loopn</div><div class="ttdoc">Loop with fits and sums.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l02315">pede.f90:2316</a></div></div>
<div class="ttc" id="apede_8f90_html_a211a4f852cb64ceb591540c9980b0b1b"><div class="ttname"><a href="pede_8f90.html#a211a4f852cb64ceb591540c9980b0b1b">ploopa</a></div><div class="ttdeci">subroutine ploopa(lunp)</div><div class="ttdoc">Print title for iteration.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l02736">pede.f90:2737</a></div></div>
<div class="ttc" id="apede_8f90_html_a4360dd45378ac25a7f673c5ddf6d29ff"><div class="ttname"><a href="pede_8f90.html#a4360dd45378ac25a7f673c5ddf6d29ff">zdiags</a></div><div class="ttdeci">subroutine zdiags</div><div class="ttdoc">Covariance matrix for diagonalization (,correction of eigenvectors).</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l06348">pede.f90:6349</a></div></div>
<div class="ttc" id="apede_8f90_html_a43640e5d5710aee16e26f464a8d91db6"><div class="ttname"><a href="pede_8f90.html#a43640e5d5710aee16e26f464a8d91db6">solglo</a></div><div class="ttdeci">subroutine solglo(ivgbi)</div><div class="ttdoc">Error for single global parameter from MINRES.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l00978">pede.f90:979</a></div></div>
<div class="ttc" id="apede_8f90_html_a4b13fb17eb0fffb15b9e5b136c22f620"><div class="ttname"><a href="pede_8f90.html#a4b13fb17eb0fffb15b9e5b136c22f620">prtglo</a></div><div class="ttdeci">subroutine prtglo</div><div class="ttdoc">Print final log file.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l03982">pede.f90:3983</a></div></div>
<div class="ttc" id="apede_8f90_html_a51882a4f8268e9378cc1102daf447c42"><div class="ttname"><a href="pede_8f90.html#a51882a4f8268e9378cc1102daf447c42">mdiags</a></div><div class="ttdeci">subroutine mdiags</div><div class="ttdoc">Solution by diagonalization.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l06206">pede.f90:6207</a></div></div>
<div class="ttc" id="apede_8f90_html_a7ab172fc202eaaabcafa19c12a28342e"><div class="ttname"><a href="pede_8f90.html#a7ab172fc202eaaabcafa19c12a28342e">ploopc</a></div><div class="ttdeci">subroutine ploopc(lunp)</div><div class="ttdoc">Print sub-iteration line.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l02813">pede.f90:2814</a></div></div>
<div class="ttc" id="apede_8f90_html_a913bbaf83d851f71a5f48ad8beda9579"><div class="ttname"><a href="pede_8f90.html#a913bbaf83d851f71a5f48ad8beda9579">solgloqlp</a></div><div class="ttdeci">subroutine solgloqlp(ivgbi)</div><div class="ttdoc">Error for single global parameter from MINRES-QLP.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l01074">pede.f90:1075</a></div></div>
<div class="ttc" id="apede_8f90_html_a9376bb5e257206e87c2237f8e0b6bd28"><div class="ttname"><a href="pede_8f90.html#a9376bb5e257206e87c2237f8e0b6bd28">addcst</a></div><div class="ttdeci">subroutine addcst</div><div class="ttdoc">Add constraint information to matrix and vector.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l01169">pede.f90:1170</a></div></div>
<div class="ttc" id="apede_8f90_html_aac8a73c63504a2719be59c3ed1a0ac97"><div class="ttname"><a href="pede_8f90.html#aac8a73c63504a2719be59c3ed1a0ac97">minver</a></div><div class="ttdeci">subroutine minver</div><div class="ttdoc">Solution by matrix inversion.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l06129">pede.f90:6130</a></div></div>
<div class="ttc" id="apede_8f90_html_ade1c4784449e452a75d58bd02653b45e"><div class="ttname"><a href="pede_8f90.html#ade1c4784449e452a75d58bd02653b45e">mminrsqlp</a></div><div class="ttdeci">subroutine mminrsqlp</div><div class="ttdoc">Solution with MINRES-QLP.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l06478">pede.f90:6479</a></div></div>
<div class="ttc" id="apede_8f90_html_ae0971beb43bf6994f05975fe8638e926"><div class="ttname"><a href="pede_8f90.html#ae0971beb43bf6994f05975fe8638e926">feasib</a></div><div class="ttdeci">subroutine feasib(concut, iact)</div><div class="ttdoc">Make parameters feasible.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l01576">pede.f90:1577</a></div></div>
<div class="ttc" id="apede_8f90_html_aefcec18b7566f81bf311d769ce42c736"><div class="ttname"><a href="pede_8f90.html#aefcec18b7566f81bf311d769ce42c736">ploopd</a></div><div class="ttdeci">subroutine ploopd(lunp)</div><div class="ttdoc">Print solution line.</div><div class="ttdef"><b>Definition:</b> <a href="pede_8f90_source.html#l02860">pede.f90:2861</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4360dd45378ac25a7f673c5ddf6d29ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4360dd45378ac25a7f673c5ddf6d29ff">&#9670;&nbsp;</a></span>zdiags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine zdiags</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Covariance matrix for diagonalization (,correction of eigenvectors). </p>

<p class="definition">Definition at line <a class="el" href="pede_8f90_source.html#l06348">6348</a> of file <a class="el" href="pede_8f90_source.html">pede.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacempmod.html">mpmod</a></div>
<div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160; </div>
<div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: i</div>
<div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ioff1</div>
<div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;    <span class="keywordtype">INTEGER(mpl)</span> :: ioff2</div>
<div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;    <span class="keywordtype">INTEGER(mpi)</span> :: j</div>
<div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160; </div>
<div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;    <span class="comment">!                      eigenvalue    eigenvectors  cov.matrix</span></div>
<div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;    <span class="keyword">CALL </span><a class="code" href="mpnum_8f90.html#ab1c8f4ab95e058209d96c6271f5ec95b">devinv</a>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,<a class="code" href="namespacempmod.html#ad215c8375287930fd388c1e204140fbb">workspaceeigenvalues</a>,<a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>,<a class="code" href="namespacempmod.html#a418f82bf6cdbb40027ea6d5ada0fc4dc">globalmatd</a>)  <span class="comment">! inv</span></div>
<div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160; </div>
<div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;    <span class="comment">!use elimination for constraints ?</span></div>
<div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;    <span class="keywordflow">IF</span>(<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a> &lt; <a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>) <span class="keywordflow">THEN</span>  </div>
<div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;        <span class="comment">! extend, transform eigenvectors</span></div>
<div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;        ioff1=<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>*<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a></div>
<div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;        ioff2=<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>*<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;        <a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>(ioff2+1:)=0.0_mpd</div>
<div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;        <span class="keywordflow">DO</span> i=<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,1,-1</div>
<div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;            ioff1=ioff1-<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a></div>
<div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;            ioff2=ioff2-<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a></div>
<div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;            <span class="keywordflow">DO</span> j=<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>,1,-1</div>
<div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;                <a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>(ioff2+j)=<a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>(ioff1+j)</div>
<div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;            <a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>(ioff2+<a class="code" href="namespacempmod.html#a376d0f92a8cc5b0dcb21f941c701013e">nfgb</a>+1:ioff2+<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>)=0.0_mpd</div>
<div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;        <span class="keyword">CALL </span><a class="code" href="mpqldec_8f90.html#a3e522a08e6631a6147aeb68abfe93652">qlmlq</a>(<a class="code" href="namespacempmod.html#a01c8cb7d51d6b4e51481e5f5d4f56ca3">workspaceeigenvectors</a>,<a class="code" href="namespacempmod.html#ad22ac7402f34720faeef22520d14c583">nvgb</a>,.false.) <span class="comment">! Q*U</span></div>
<div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160; </div>
<div class="ttc" id="ampnum_8f90_html_ab1c8f4ab95e058209d96c6271f5ec95b"><div class="ttname"><a href="mpnum_8f90.html#ab1c8f4ab95e058209d96c6271f5ec95b">devinv</a></div><div class="ttdeci">subroutine devinv(n, diag, u, v)</div><div class="ttdoc">Inversion by diagonalization. Get inverse matrix V from DIAG and U.</div><div class="ttdef"><b>Definition:</b> <a href="mpnum_8f90_source.html#l00704">mpnum.f90:705</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_23416660aff6402864c13eb5e981e75a.html">millepede</a></li><li class="navelem"><a class="el" href="pede_8f90.html">pede.f90</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
